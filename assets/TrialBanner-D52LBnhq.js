import{a as e,j as s}from"./query-Caj74EYQ.js";import{u as n,r as a}from"./vendor-router-B2AaIOtG.js";import{u as i,b as t,e as r,f as l,c as o}from"./index-1YdTwRLp.js";import{b as d,a5 as c,O as h,a6 as m,l as j,a7 as u,M as x,C as p,a8 as g,K as v,z as b,q as N,T as f,g as w}from"./icons-UlaFLuKM.js";const z=()=>{const{dojos:r,activeDojo:l,switchDojo:o,loading:m,filter:j,setFilter:u}=i(),{user:x}=t(),p=n(),[g,v]=e.useState(!1),[b,N]=e.useState({top:0,left:0}),f=e.useRef(null),w="all"===j;if(e.useEffect(()=>{g&&A()},[g]),m)return s.jsx("div",{className:"dojo-switcher loading",children:s.jsx("div",{className:"spinner-small"})});if(!l)return s.jsx("div",{className:"dojo-switcher loading",children:s.jsx("div",{style:{color:"#ff6b35",fontSize:"0.85rem",padding:"10px"},children:"Kein Dojo gefunden"})});if(!r||0===r.length)return s.jsx("div",{className:"dojo-switcher loading",children:s.jsx("div",{style:{color:"#ff6b35",fontSize:"0.85rem",padding:"10px"},children:"Keine Dojos verfÃ¼gbar"})});const z=e=>{if("kleinunternehmer"===e.steuer_status){return`${(e.jahresumsatz_aktuell/e.kleinunternehmer_grenze*100).toFixed(0)}% der Grenze`}return`USt-pflichtig (${e.ust_satz}%)`},k=("admin"===(null==x?void 0:x.rolle)||"admin"===(null==x?void 0:x.role))&&null===(null==x?void 0:x.dojo_id),y="super-admin"===l,S="verband"===l,D="support"===l;console.log("ðŸ” DojoSwitcher Super-Admin Check:",{role:null==x?void 0:x.role,rolle:null==x?void 0:x.rolle,dojo_id:null==x?void 0:x.dojo_id,isSuperAdmin:k});const A=()=>{if(f.current){const e=f.current.getBoundingClientRect(),s={top:e.bottom+8,left:e.left};N(s)}};return s.jsxs("div",{className:"dojo-switcher",children:[s.jsxs("button",{ref:f,className:"dojo-switcher-trigger",onClick:e=>{e.preventDefault(),e.stopPropagation(),v(!g)},title:"Zwischen Dojos wechseln",type:"button",children:[D?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)"}}),s.jsxs("div",{className:"dojo-switcher-content",children:[s.jsx("div",{className:"dojo-switcher-label",children:"Support:"}),s.jsx("div",{className:"dojo-switcher-name",children:"ðŸŽ« Support Center"})]})]}):S?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%)"}}),s.jsxs("div",{className:"dojo-switcher-content",children:[s.jsx("div",{className:"dojo-switcher-label",children:"Verband:"}),s.jsx("div",{className:"dojo-switcher-name",children:"ðŸŒ TDA Verband"})]})]}):y?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #DAA520 0%, #B8860B 100%)"}}),s.jsxs("div",{className:"dojo-switcher-content",children:[s.jsx("div",{className:"dojo-switcher-label",children:"Verwaltung:"}),s.jsx("div",{className:"dojo-switcher-name",children:"ðŸ† TDA Int'l Org"})]})]}):w?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #FFD700 0%, #FF6B35 50%, #3B82F6 100%)"}}),s.jsxs("div",{className:"dojo-switcher-content",children:[s.jsx("div",{className:"dojo-switcher-label",children:"Ansicht:"}),s.jsx("div",{className:"dojo-switcher-name",children:"Alle Dojos"})]})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"dojo-color-indicator",style:{backgroundColor:l.farbe}}),s.jsxs("div",{className:"dojo-switcher-content",children:[s.jsx("div",{className:"dojo-switcher-label",children:"Aktives Dojo:"}),s.jsx("div",{className:"dojo-switcher-name",children:l.dojoname})]})]}),s.jsx(d,{size:14,className:"chevron "+(g?"open":"")})]}),g&&a.createPortal(s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"dojo-switcher-overlay",onClick:e=>{e.preventDefault(),e.stopPropagation(),v(!1)}}),s.jsxs("div",{className:"dojo-switcher-dropdown",style:{top:`${b.top}px`,left:`${b.left}px`},children:[s.jsxs("div",{className:"dropdown-header",children:[s.jsx("h3",{children:"Dojo wechseln"}),s.jsx("p",{children:"WÃ¤hlen Sie das aktive Dojo aus"})]}),s.jsxs("div",{className:"dropdown-list",children:[k&&s.jsxs("button",{type:"button",className:"dropdown-item verband "+(S?"active":""),onClick:e=>{e.preventDefault(),e.stopPropagation(),o("verband"),u("current"),v(!1),p("/dashboard",{replace:!0})},children:[s.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%)"}}),s.jsxs("div",{className:"dropdown-item-content",children:[s.jsxs("div",{className:"dropdown-item-header",children:[s.jsx("span",{className:"dropdown-item-name",children:"ðŸŒ TDA Verband"}),s.jsx("span",{className:"badge badge-blue",children:"Verband"}),S&&s.jsx(c,{size:12,className:"check-icon"})]}),s.jsx("div",{className:"dropdown-item-info",children:s.jsx("span",{className:"dropdown-item-inhaber",children:"Verbandsverwaltung & Mitgliedsschulen"})}),s.jsx("div",{className:"dropdown-item-umsatz",children:"Mitglieder, Turniere, Events & Verbands-Finanzen"})]})]}),k&&s.jsxs("button",{type:"button",className:"dropdown-item super-admin "+(y?"active":""),onClick:e=>{e.preventDefault(),e.stopPropagation(),o("super-admin"),u("current"),v(!1),p("/dashboard",{replace:!0})},children:[s.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #DAA520 0%, #B8860B 100%)"}}),s.jsxs("div",{className:"dropdown-item-content",children:[s.jsxs("div",{className:"dropdown-item-header",children:[s.jsx("span",{className:"dropdown-item-name",children:"ðŸ† TDA Int'l Org"}),s.jsx("span",{className:"badge badge-gold",children:"Super-Admin"}),y&&s.jsx(c,{size:12,className:"check-icon"})]}),s.jsx("div",{className:"dropdown-item-info",children:s.jsx("span",{className:"dropdown-item-inhaber",children:"Verwaltung aller Dojos & Subdomains"})}),s.jsx("div",{className:"dropdown-item-umsatz",children:"Globale Statistiken, Dojo-Management & Software-Verwaltung"})]})]}),k&&s.jsxs("button",{type:"button",className:"dropdown-item support "+(D?"active":""),onClick:e=>{e.preventDefault(),e.stopPropagation(),o("support"),u("current"),v(!1),p("/dashboard",{replace:!0})},children:[s.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)"}}),s.jsxs("div",{className:"dropdown-item-content",children:[s.jsxs("div",{className:"dropdown-item-header",children:[s.jsx("span",{className:"dropdown-item-name",children:"ðŸŽ« Support Center"}),s.jsx("span",{className:"badge badge-green",children:"Support"}),D&&s.jsx(c,{size:12,className:"check-icon"})]}),s.jsx("div",{className:"dropdown-item-info",children:s.jsx("span",{className:"dropdown-item-inhaber",children:"Ticket-System & Kundenservice"})}),s.jsx("div",{className:"dropdown-item-umsatz",children:"Alle Support-Tickets, Statistiken & Bearbeitung"})]})]}),s.jsxs("button",{type:"button",className:"dropdown-item "+(w?"active":""),onClick:e=>{e.preventDefault(),e.stopPropagation(),(()=>{if(r.length>0){const e=r.find(e=>e.ist_hauptdojo)||r[0];o(e)}u("all"),v(!1),p("/dashboard",{replace:!0})})()},children:[s.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #FFD700 0%, #FF6B35 50%, #3B82F6 100%)"}}),s.jsxs("div",{className:"dropdown-item-content",children:[s.jsxs("div",{className:"dropdown-item-header",children:[s.jsx("span",{className:"dropdown-item-name",children:"Alle Dojos"}),s.jsx("span",{className:"badge badge-primary",children:"Gesamt"}),w&&s.jsx(c,{size:12,className:"check-icon"})]}),s.jsx("div",{className:"dropdown-item-info",children:s.jsx("span",{className:"dropdown-item-inhaber",children:"Kombinierte Ansicht aller Dojos"})}),s.jsxs("div",{className:"dropdown-item-umsatz",children:["Gesamtumsatz ",(new Date).getFullYear(),": ",(Array.isArray(r)?r.reduce((e,s)=>e+parseFloat(s.jahresumsatz_aktuell||0),0):0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})," â‚¬"]})]})]}),Array.isArray(r)&&r.map(e=>s.jsxs("button",{type:"button",className:"dropdown-item "+(w||l.id!==e.id?"":"active"),onClick:s=>{s.preventDefault(),s.stopPropagation(),(e=>{o(e),u("current"),v(!1),p("/dashboard",{replace:!0})})(e)},children:[s.jsx("div",{className:"dojo-color-indicator",style:{backgroundColor:e.farbe}}),s.jsxs("div",{className:"dropdown-item-content",children:[s.jsxs("div",{className:"dropdown-item-header",children:[s.jsx("span",{className:"dropdown-item-name",children:e.dojoname}),e.ist_hauptdojo&&s.jsx("span",{className:"badge badge-primary",children:"Haupt"}),!w&&l.id===e.id&&s.jsx(c,{size:12,className:"check-icon"})]}),s.jsxs("div",{className:"dropdown-item-info",children:[s.jsx("span",{className:"dropdown-item-inhaber",children:e.inhaber}),s.jsx("span",{className:"dropdown-item-status",children:z(e)})]}),s.jsxs("div",{className:"dropdown-item-umsatz",children:["Umsatz ",(new Date).getFullYear(),": ",parseFloat(e.jahresumsatz_aktuell||0).toLocaleString("de-DE")," â‚¬"]})]})]},e.id))]}),s.jsx("div",{className:"dropdown-footer",children:s.jsxs("a",{href:"/dashboard/dojos",className:"link-manage-dojos",children:[s.jsx(h,{size:12}),"Dojos verwalten"]})})]})]}),document.body)]})},k=()=>{const{standorte:n,activeStandort:a,currentStandort:i,switchStandort:t,loading:l,hasMultipleLocations:o}=r(),[j,u]=e.useState(!1),[x,p]=e.useState({top:0,left:0}),g=e.useRef(null);if(!o)return null;if(e.useEffect(()=>{j&&b()},[j]),l)return s.jsx("div",{className:"standort-switcher loading",children:s.jsx("div",{className:"spinner-small"})});if(!n||0===n.length)return null;const v=e=>{t(e),u(!1)},b=()=>{if(g.current){const e=g.current.getBoundingClientRect(),s={top:e.bottom+8,left:e.left};p(s)}};return e.useEffect(()=>{const e=e=>{g.current&&!g.current.contains(e.target)&&u(!1)};return j&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[j]),s.jsxs("div",{className:"standort-switcher",children:[s.jsxs("button",{ref:g,className:"standort-switcher-trigger",onClick:e=>{e.preventDefault(),e.stopPropagation(),u(!j)},title:"Zwischen Standorten wechseln",type:"button",children:["all"===a?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"standort-color-indicator",style:{background:"linear-gradient(135deg, #10B981 0%, #3B82F6 100%)"}}),s.jsxs("div",{className:"standort-switcher-content",children:[s.jsx("div",{className:"standort-switcher-label",children:"Standort:"}),s.jsx("div",{className:"standort-switcher-name",children:"Alle Standorte"})]})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"standort-color-indicator",style:{background:(null==i?void 0:i.farbe)||"#4F46E5"}}),s.jsxs("div",{className:"standort-switcher-content",children:[s.jsx("div",{className:"standort-switcher-label",children:"Standort:"}),s.jsxs("div",{className:"standort-switcher-name",children:[(null==i?void 0:i.name)||"Unbekannt",(null==i?void 0:i.ist_hauptstandort)&&s.jsx("span",{className:"standort-badge",children:"Haupt"})]})]})]}),s.jsx(d,{size:16,className:"chevron "+(j?"open":"")})]}),j&&s.jsxs("div",{className:"standort-switcher-dropdown",style:{position:"fixed",top:`${x.top}px`,left:`${x.left}px`,zIndex:1e4},children:[s.jsxs("div",{className:"dropdown-header",children:[s.jsx(m,{size:14}),s.jsx("span",{children:"Standorte"})]}),s.jsxs("button",{className:"standort-option "+("all"===a?"active":""),onClick:()=>v("all"),children:[s.jsx("div",{className:"standort-option-indicator",style:{background:"linear-gradient(135deg, #10B981 0%, #3B82F6 100%)"}}),s.jsxs("div",{className:"standort-option-content",children:[s.jsxs("div",{className:"standort-option-name",children:[s.jsx(h,{size:14,style:{marginRight:"6px"}}),"Alle Standorte"]}),s.jsxs("div",{className:"standort-option-stats",children:[n.length," Standort",1!==n.length?"e":""]})]}),"all"===a&&s.jsx(c,{size:16,className:"check-icon"})]}),s.jsx("div",{className:"dropdown-divider"}),n.sort((e,s)=>e.ist_hauptstandort&&!s.ist_hauptstandort?-1:!e.ist_hauptstandort&&s.ist_hauptstandort?1:e.sortierung!==s.sortierung?e.sortierung-s.sortierung:(e.name||"").localeCompare(s.name||"")).map(e=>s.jsxs("button",{className:"standort-option "+(a===e.standort_id?"active":""),onClick:()=>v(e.standort_id),children:[s.jsx("div",{className:"standort-option-indicator",style:{background:e.farbe||"#4F46E5"}}),s.jsxs("div",{className:"standort-option-content",children:[s.jsxs("div",{className:"standort-option-name",children:[s.jsx(m,{size:14,style:{marginRight:"6px"}}),e.name,e.ist_hauptstandort&&s.jsx("span",{className:"standort-badge-small",children:"Haupt"})]}),s.jsxs("div",{className:"standort-option-stats",children:[e.anzahl_kurse||0," Kurse Â· ",e.anzahl_raeume||0," RÃ¤ume"]})]}),a===e.standort_id&&s.jsx(c,{size:16,className:"check-icon"})]},e.standort_id))]})]})},y=()=>{const[n,a]=e.useState([]),[i,t]=e.useState(!1),[r,d]=e.useState(null);e.useEffect(()=>{const e=async()=>{try{console.log("ðŸ” Checking for new registrations...");const e=await l(`${o.apiBaseUrl}/notifications/admin/unread`);console.log("ðŸ“¡ Response status:",e.status);const s=await e.json();if(console.log("ðŸ“¦ Response data:",s),s.success&&s.notifications&&s.notifications.length>0){console.log("âœ… Found notifications:",s.notifications.length);const e=s.notifications.filter(e=>"admin_alert"===e.type);console.log("ðŸš¨ Admin alerts found:",e.length),e.length>0&&(console.log("ðŸŽ‰ Showing popup with notification:",e[0]),a(e),d(e[0]),t(!0))}else console.log("â„¹ï¸ No new notifications")}catch(e){console.error("âŒ Fehler beim Abrufen der Benachrichtigungen:",e)}};console.log("ðŸš€ Starting notification checker..."),e();const s=setInterval(e,1e4);return()=>{console.log("ðŸ›‘ Stopping notification checker"),clearInterval(s)}},[]);const c=async()=>{if(r)try{await l(`/notifications/admin/${r.id}/read`,{method:"PUT"});const e=n.filter(e=>e.id!==r.id);a(e),e.length>0?d(e[0]):(t(!1),d(null))}catch(e){console.error("Fehler beim SchlieÃŸen der Benachrichtigung:",e),t(!1)}};if(!i||!r)return null;const h=(e=>{const s={};return e.split("<br>").forEach(e=>{const n=e.match(/<strong>(.*?):<\/strong>\s*(.*)/);if(n){const e=n[1].trim(),a=n[2].trim();s[e]=a}}),s})(r.message);return s.jsx("div",{className:"admin-registration-popup-overlay",children:s.jsxs("div",{className:"admin-registration-popup",children:[s.jsxs("div",{className:"popup-header",children:[s.jsxs("div",{className:"header-content",children:[s.jsx(j,{size:28,className:"header-icon"}),s.jsxs("div",{children:[s.jsx("h2",{children:r.subject}),s.jsx("p",{className:"timestamp",children:new Date(r.created_at).toLocaleString("de-DE")})]})]}),s.jsx("button",{className:"close-btn",onClick:c,children:s.jsx(u,{size:24})})]}),s.jsxs("div",{className:"popup-content",children:[s.jsx("div",{className:"notification-badge",children:n.length>1&&s.jsxs("span",{className:"badge",children:[n.length," neue Registrierung",n.length>1?"en":""]})}),s.jsxs("div",{className:"member-info-grid",children:[h.Name&&s.jsxs("div",{className:"info-item",children:[s.jsx(j,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Name"}),s.jsx("p",{children:h.Name})]})]}),h.Email&&s.jsxs("div",{className:"info-item",children:[s.jsx(x,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Email"}),s.jsx("p",{children:h.Email})]})]}),h.Geburtsdatum&&"N/A"!==h.Geburtsdatum&&s.jsxs("div",{className:"info-item",children:[s.jsx(p,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Geburtsdatum"}),s.jsx("p",{children:h.Geburtsdatum})]})]}),h.Telefon&&"N/A"!==h.Telefon&&s.jsxs("div",{className:"info-item",children:[s.jsx(g,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Telefon"}),s.jsx("p",{children:h.Telefon})]})]}),h.Adresse&&s.jsxs("div",{className:"info-item full-width",children:[s.jsx(m,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Adresse"}),s.jsx("p",{children:h.Adresse})]})]}),h.Tarif&&"N/A"!==h.Tarif&&s.jsxs("div",{className:"info-item full-width",children:[s.jsx(v,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"GewÃ¤hlter Tarif"}),s.jsx("p",{children:h.Tarif})]})]}),h.Vertragsbeginn&&"N/A"!==h.Vertragsbeginn&&s.jsxs("div",{className:"info-item",children:[s.jsx(p,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Vertragsbeginn"}),s.jsx("p",{children:h.Vertragsbeginn})]})]}),h.Zahlungszyklus&&"N/A"!==h.Zahlungszyklus&&s.jsxs("div",{className:"info-item",children:[s.jsx(v,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Zahlungszyklus"}),s.jsx("p",{children:h.Zahlungszyklus})]})]}),h.Zahlungsmethode&&"N/A"!==h.Zahlungsmethode&&s.jsxs("div",{className:"info-item",children:[s.jsx(v,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Zahlungsmethode"}),s.jsx("p",{children:h.Zahlungsmethode})]})]})]})]}),s.jsx("div",{className:"popup-footer",children:s.jsx("button",{className:"btn-primary",onClick:c,children:"OK, verstanden"})})]})})},S=({stats:e})=>{if(!e||!e.subscription_status)return null;const{subscription_status:n,trial_days_remaining:a,subscription_days_remaining:i,subscription_plan:t}=e;if("trial"===n){if(null===a||a<0)return null;let e="info",n=s.jsx(N,{size:24}),i="",t=!1;return 0===a?(e="danger",n=s.jsx(f,{size:24}),i="â° Ihre Testphase lÃ¤uft heute ab! SchlieÃŸen Sie jetzt ein Abonnement ab.",t=!0):1===a?(e="danger",n=s.jsx(f,{size:24}),i="â° Ihre Testphase lÃ¤uft morgen ab! SchlieÃŸen Sie jetzt ein Abonnement ab.",t=!0):a<=3?(e="warning",n=s.jsx(f,{size:24}),i=`âš ï¸ Ihre Testphase lÃ¤uft in ${a} Tagen ab. Sichern Sie sich jetzt Ihren Zugang.`,t=!0):a<=7?(e="warning",n=s.jsx(N,{size:24}),i=`Ihre Testphase lÃ¤uft noch ${a} Tage.`,t=!1):(e="info",n=s.jsx(w,{size:24}),i=`âœ“ Testphase aktiv - Noch ${a} Tage verbleibend.`,t=!1),s.jsxs("div",{className:`trial-banner trial-banner-${e}`,children:[s.jsx("div",{className:"trial-banner-icon",children:n}),s.jsx("div",{className:"trial-banner-content",children:s.jsx("div",{className:"trial-banner-message",children:i})}),t&&s.jsx("a",{href:"mailto:abo@tda-intl.org",className:"trial-banner-button",children:"Jetzt Abo abschlieÃŸen"})]})}if("active"===n){if(null!==i&&i<=14){let e=i<=3?"danger":"warning",n=i<=3?s.jsx(f,{size:24}):s.jsx(N,{size:24}),a=0===i?"â° Ihr Abonnement lÃ¤uft heute ab!":1===i?"â° Ihr Abonnement lÃ¤uft morgen ab!":`Ihr ${t||"Abonnement"} lÃ¤uft in ${i} Tagen ab.`;return s.jsxs("div",{className:`trial-banner trial-banner-${e}`,children:[s.jsx("div",{className:"trial-banner-icon",children:n}),s.jsx("div",{className:"trial-banner-content",children:s.jsx("div",{className:"trial-banner-message",children:a})}),s.jsx("a",{href:"mailto:abo@tda-intl.org",className:"trial-banner-button",children:"Jetzt verlÃ¤ngern"})]})}}else if("expired"===n)return s.jsxs("div",{className:"trial-banner trial-banner-expired",children:[s.jsx("div",{className:"trial-banner-icon",children:s.jsx(b,{size:24})}),s.jsx("div",{className:"trial-banner-content",children:s.jsx("div",{className:"trial-banner-message",children:"âŒ Ihr Zugang ist abgelaufen. Bitte schlieÃŸen Sie ein Abonnement ab."})}),s.jsx("a",{href:"mailto:abo@tda-intl.org",className:"trial-banner-button",children:"Jetzt Abo abschlieÃŸen"})]});return null};export{y as A,z as D,k as S,S as T};
