import{a as e,j as t}from"./query-Caj74EYQ.js";import{u as n,a as r}from"./index-B0gO-Ppw.js";import{$ as i,k as s,g as o,I as l,R as a,Q as d,F as p,K as x,o as c,q as g}from"./icons-eh0tbLFx.js";import"./vendor-router-B2AaIOtG.js";import"./charts-QHQg_ypW.js";const h=()=>{var h;const{activeDojo:y}=n(),[f,j]=e.useState(!1),[b,m]=e.useState([]),[v,S]=e.useState(!1),[I,D]=e.useState(!0),[k,w]=e.useState("invoices"),[T,z]=e.useState({start:new Date((new Date).getFullYear(),(new Date).getMonth(),1).toISOString().split("T")[0],end:(new Date).toISOString().split("T")[0]}),E=(null==y?void 0:y.id)||y;e.useEffect(()=>{E&&"super-admin"!==E&&(R(),B())},[E]);const R=async()=>{var e;try{D(!0);const t=await r.get(`/integrations/status?dojo_id=${E}`);S((null==(e=t.data.datev)?void 0:e.configured)||!1)}catch(t){console.error("Fehler beim Prüfen der Konfiguration:",t),S(!1)}finally{D(!1)}},B=async()=>{try{const e=await r.get(`/integrations/datev/exports?dojo_id=${E}`);m(e.data.exports||[])}catch(e){console.error("Fehler beim Laden der Export-Historie:",e)}},C=[{key:"invoices",title:"Rechnungen",description:"Buchungsstapel mit allen Rechnungen",icon:t.jsx(p,{size:24})},{key:"payments",title:"Zahlungen",description:"Zahlungseingänge für den Zeitraum",icon:t.jsx(x,{size:24})},{key:"debitoren",title:"Debitoren",description:"Stammdaten aller Mitglieder",icon:t.jsx(c,{size:24})}];return I?t.jsx("div",{style:u.container,children:t.jsx("div",{style:u.loading,children:"Prüfe Konfiguration..."})}):t.jsxs("div",{style:u.container,children:[t.jsxs("div",{style:u.header,children:[t.jsx(i,{size:32,color:"#006633"}),t.jsxs("div",{children:[t.jsx("h2",{style:u.title,children:"DATEV Export"}),t.jsx("p",{style:u.subtitle,children:"Exportiere Buchungsdaten im DATEV-Format"})]})]}),!v&&t.jsxs("div",{style:u.warningBox,children:[t.jsx(s,{size:24}),t.jsxs("div",{children:[t.jsx("strong",{children:"DATEV nicht konfiguriert"}),t.jsx("p",{style:{margin:"4px 0 0 0"},children:"Bitte konfiguriere zuerst die Beraternummer und Mandantennummer in den Integration-Einstellungen."})]})]}),t.jsxs("div",{style:u.section,children:[t.jsx("h3",{style:u.sectionTitle,children:"1. Export-Typ wählen"}),t.jsx("div",{style:u.exportTypeGrid,children:C.map(e=>t.jsxs("button",{style:{...u.exportTypeCard,borderColor:k===e.key?"#ffd700":"rgba(255, 255, 255, 0.1)",background:k===e.key?"rgba(255, 215, 0, 0.1)":"rgba(255, 255, 255, 0.05)"},onClick:()=>w(e.key),children:[t.jsx("div",{style:{...u.exportTypeIcon,color:k===e.key?"#ffd700":"#888"},children:e.icon}),t.jsxs("div",{style:u.exportTypeInfo,children:[t.jsx("strong",{style:{color:k===e.key?"#ffd700":"#fff"},children:e.title}),t.jsx("span",{style:{color:"#888",fontSize:"12px"},children:e.description})]}),k===e.key&&t.jsx(o,{size:20,color:"#ffd700"})]},e.key))})]}),t.jsxs("div",{style:u.section,children:[t.jsx("h3",{style:u.sectionTitle,children:"2. Zeitraum wählen"}),t.jsxs("div",{style:u.dateRangeRow,children:[t.jsxs("div",{style:u.dateGroup,children:[t.jsx("label",{style:u.label,children:"Von"}),t.jsx("input",{type:"date",value:T.start,onChange:e=>z({...T,start:e.target.value}),style:u.dateInput})]}),t.jsxs("div",{style:u.dateGroup,children:[t.jsx("label",{style:u.label,children:"Bis"}),t.jsx("input",{type:"date",value:T.end,onChange:e=>z({...T,end:e.target.value}),style:u.dateInput})]}),t.jsxs("div",{style:u.presetButtons,children:[t.jsx("button",{style:u.presetButton,onClick:()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1);z({start:t.toISOString().split("T")[0],end:e.toISOString().split("T")[0]})},children:"Dieser Monat"}),t.jsx("button",{style:u.presetButton,onClick:()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth()-1,1),n=new Date(e.getFullYear(),e.getMonth(),0);z({start:t.toISOString().split("T")[0],end:n.toISOString().split("T")[0]})},children:"Letzter Monat"}),t.jsx("button",{style:u.presetButton,onClick:()=>{const e=new Date,t=new Date(e.getFullYear(),0,1);z({start:t.toISOString().split("T")[0],end:e.toISOString().split("T")[0]})},children:"Dieses Jahr"})]})]})]}),t.jsxs("div",{style:u.section,children:[t.jsx("h3",{style:u.sectionTitle,children:"3. Export starten"}),t.jsxs("div",{style:u.exportInfo,children:[t.jsx(l,{size:20}),t.jsx("p",{children:"Der Export wird im DATEV-EXTF-Format (ASCII) erstellt und kann direkt in DATEV Unternehmen Online oder DATEV Kanzlei-Rechnungswesen importiert werden."})]}),t.jsx("button",{style:{...u.exportButton,opacity:!v||f?.5:1},onClick:async()=>{var e,t,n,i;try{j(!0);const n=await r.get(`/integrations/datev/export/${k}?dojo_id=${E}&start=${T.start}&end=${T.end}`,{responseType:"blob"}),i=(null==(t=null==(e=n.headers["content-disposition"])?void 0:e.split("filename=")[1])?void 0:t.replace(/"/g,""))||`datev_${k}_${T.start}_${T.end}.csv`,s=window.URL.createObjectURL(new Blob([n.data])),o=document.createElement("a");o.href=s,o.setAttribute("download",i),document.body.appendChild(o),o.click(),o.parentNode.removeChild(o),window.URL.revokeObjectURL(s),B()}catch(s){console.error("Fehler beim Export:",s),alert("Export fehlgeschlagen: "+((null==(i=null==(n=s.response)?void 0:n.data)?void 0:i.error)||s.message))}finally{j(!1)}},disabled:!v||f,children:f?t.jsxs(t.Fragment,{children:[t.jsx(a,{size:20,className:"spinning"})," Exportiere..."]}):t.jsxs(t.Fragment,{children:[t.jsx(d,{size:20})," ",null==(h=C.find(e=>e.key===k))?void 0:h.title," exportieren"]})})]}),t.jsxs("div",{style:u.section,children:[t.jsx("h3",{style:u.sectionTitle,children:"Letzte Exporte"}),0===b.length?t.jsx("p",{style:{color:"#888",textAlign:"center",padding:"20px"},children:"Noch keine Exporte durchgeführt"}):t.jsx("div",{style:u.historyList,children:b.slice(0,10).map((e,n)=>t.jsxs("div",{style:u.historyItem,children:[t.jsxs("div",{style:u.historyIcon,children:["invoices"===e.export_type&&t.jsx(p,{size:18}),"payments"===e.export_type&&t.jsx(x,{size:18}),"debitoren"===e.export_type&&t.jsx(c,{size:18})]}),t.jsxs("div",{style:u.historyInfo,children:[t.jsxs("strong",{style:{color:"#fff"},children:["invoices"===e.export_type&&"Rechnungen","payments"===e.export_type&&"Zahlungen","debitoren"===e.export_type&&"Debitoren"]}),t.jsxs("span",{style:{color:"#888",fontSize:"12px"},children:[e.record_count," Datensätze | ",e.start_date," - ",e.end_date]})]}),t.jsxs("div",{style:u.historyDate,children:[t.jsx(g,{size:14}),t.jsx("span",{children:new Date(e.created_at).toLocaleDateString("de-DE")})]})]},n))})]}),t.jsxs("div",{style:u.helpSection,children:[t.jsx("h4",{style:{color:"#ffd700",margin:"0 0 12px 0"},children:"DATEV Import-Anleitung"}),t.jsxs("ol",{style:{margin:0,paddingLeft:"20px",color:"#aaa",lineHeight:1.8},children:[t.jsx("li",{children:"Exportiere die gewünschten Daten als CSV-Datei"}),t.jsx("li",{children:"Öffne DATEV Unternehmen Online oder Kanzlei-Rechnungswesen"}),t.jsx("li",{children:'Gehe zu "Stapelverarbeitung" → "ASCII-Import"'}),t.jsx("li",{children:"Wähle die heruntergeladene CSV-Datei"}),t.jsx("li",{children:"Prüfe die Vorschau und bestätige den Import"})]})]})]})},u={container:{padding:"24px",maxWidth:"900px",margin:"0 auto"},header:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"32px"},title:{color:"#006633",margin:0,fontSize:"24px"},subtitle:{color:"#aaa",margin:"4px 0 0 0",fontSize:"14px"},warningBox:{display:"flex",alignItems:"flex-start",gap:"16px",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"12px",padding:"20px",marginBottom:"24px",color:"#ef4444"},section:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 215, 0, 0.2)",borderRadius:"12px",padding:"24px",marginBottom:"20px"},sectionTitle:{color:"#ffd700",margin:"0 0 16px 0",fontSize:"16px"},exportTypeGrid:{display:"flex",flexDirection:"column",gap:"12px"},exportTypeCard:{display:"flex",alignItems:"center",gap:"16px",padding:"16px 20px",background:"transparent",border:"2px solid",borderRadius:"12px",cursor:"pointer",textAlign:"left",transition:"all 0.2s"},exportTypeIcon:{width:"48px",height:"48px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center"},exportTypeInfo:{flex:1,display:"flex",flexDirection:"column",gap:"4px"},dateRangeRow:{display:"flex",alignItems:"flex-end",gap:"16px",flexWrap:"wrap"},dateGroup:{display:"flex",flexDirection:"column",gap:"8px"},label:{color:"#888",fontSize:"13px"},dateInput:{padding:"12px 16px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid rgba(255, 215, 0, 0.3)",borderRadius:"8px",color:"#fff",fontSize:"14px"},presetButtons:{display:"flex",gap:"8px",marginLeft:"auto"},presetButton:{padding:"10px 16px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"#fff",fontSize:"13px",cursor:"pointer"},exportInfo:{display:"flex",alignItems:"flex-start",gap:"12px",background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:"8px",padding:"16px",marginBottom:"20px",color:"#aaa",fontSize:"14px"},exportButton:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",width:"100%",padding:"16px 24px",background:"#006633",border:"none",borderRadius:"12px",color:"#fff",fontWeight:"bold",fontSize:"16px",cursor:"pointer"},historyList:{display:"flex",flexDirection:"column",gap:"8px"},historyItem:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",background:"rgba(0, 0, 0, 0.2)",borderRadius:"8px"},historyIcon:{color:"#888"},historyInfo:{flex:1,display:"flex",flexDirection:"column",gap:"2px"},historyDate:{display:"flex",alignItems:"center",gap:"6px",color:"#888",fontSize:"12px"},helpSection:{background:"rgba(0, 102, 51, 0.1)",border:"1px solid rgba(0, 102, 51, 0.3)",borderRadius:"12px",padding:"20px"},loading:{textAlign:"center",padding:"60px",color:"#888"}};export{h as default};
