import{a as e,j as s}from"./query-Caj74EYQ.js";import{u as a,a as n,c as r}from"./index-DJzZu8AC.js";import{j as t}from"./index-CkXcCt97.js";/* empty css             */import{u as l}from"./vendor-router-Co3o87Zc.js";import"./icons-DiLw-1i5.js";import"./charts-C1Gv3M_c.js";function i({embedded:i=!1}){const c=l(),{token:d}=a(),[o,h]=e.useState([]),[u,m]=e.useState(!0),[w,b]=e.useState(""),[j,N]=e.useState("alle"),[f,x]=e.useState(null),v=()=>{try{if(d){const e=t(d);return 1===e.id||1===e.user_id||"admin"===e.username}}catch(e){console.error("Token decode error:",e)}return!1};e.useEffect(()=>{i||v()?(async()=>{var e,s;m(!0),b("");try{const e=new URLSearchParams;"alle"!==j&&e.append("status",j);const s=await n.get(`${r.apiBaseUrl}/news?${e.toString()}`,{headers:{Authorization:`Bearer ${d}`}});h(s.data.news||[])}catch(a){console.error("Fehler beim Laden der News:",a),b("Fehler beim Laden der News: "+((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.error)||a.message))}finally{m(!1)}})():c("/dashboard")},[d,j]);const p=e=>{switch(e){case"veroeffentlicht":return s.jsx("span",{className:"news-status-badge published",children:"VerÃ¶ffentlicht"});case"entwurf":return s.jsx("span",{className:"news-status-badge draft",children:"Entwurf"});case"archiviert":return s.jsx("span",{className:"news-status-badge archived",children:"Archiviert"});default:return s.jsx("span",{className:"news-status-badge",children:e})}},g=e=>e?new Date(e).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return v()?s.jsxs("div",{className:"news-verwaltung "+(i?"embedded":""),children:[s.jsxs("div",{className:"news-header",children:[s.jsxs("div",{className:"news-header-left",children:[!i&&s.jsx("button",{className:"btn-back",onClick:()=>c("/dashboard"),children:"â† ZurÃ¼ck"}),s.jsx("h1",{children:"ðŸ“° News verwalten"})]}),s.jsx("button",{className:"btn-create-news",onClick:()=>c("/dashboard/news/neu"),children:"+ Neue News erstellen"})]}),w&&s.jsx("div",{className:"news-error",children:w}),s.jsxs("div",{className:"news-filter",children:[s.jsx("button",{className:"filter-btn "+("alle"===j?"active":""),onClick:()=>N("alle"),children:"Alle"}),s.jsx("button",{className:"filter-btn "+("entwurf"===j?"active":""),onClick:()=>N("entwurf"),children:"EntwÃ¼rfe"}),s.jsx("button",{className:"filter-btn "+("veroeffentlicht"===j?"active":""),onClick:()=>N("veroeffentlicht"),children:"VerÃ¶ffentlicht"}),s.jsx("button",{className:"filter-btn "+("archiviert"===j?"active":""),onClick:()=>N("archiviert"),children:"Archiviert"})]}),u?s.jsx("div",{className:"news-loading",children:"LÃ¤dt News..."}):0===o.length?s.jsxs("div",{className:"news-empty",children:[s.jsx("p",{children:"Keine News vorhanden."}),s.jsx("button",{className:"btn-create-news",onClick:()=>c("/dashboard/news/neu"),children:"Erste News erstellen"})]}):s.jsx("div",{className:"news-list",children:o.map(e=>{return s.jsxs("div",{className:"news-card",children:[s.jsxs("div",{className:"news-card-header",children:[s.jsx("h3",{className:"news-title",children:e.titel}),s.jsxs("div",{className:"news-badges",children:[p(e.status),(a=e.zielgruppe,"homepage"===a?s.jsx("span",{className:"news-zielgruppe-badge homepage",children:"Nur Homepage"}):s.jsx("span",{className:"news-zielgruppe-badge all-dojos",children:"Alle Dojos"}))]})]}),e.kurzbeschreibung&&s.jsx("p",{className:"news-description",children:e.kurzbeschreibung}),s.jsxs("div",{className:"news-card-footer",children:[s.jsxs("div",{className:"news-meta",children:[s.jsxs("span",{className:"news-date",children:["Erstellt: ",g(e.created_at)]}),e.veroeffentlicht_am&&s.jsxs("span",{className:"news-date",children:["VerÃ¶ffentlicht: ",g(e.veroeffentlicht_am)]})]}),s.jsxs("div",{className:"news-actions",children:[s.jsx("button",{className:"btn-edit",onClick:()=>c(`/dashboard/news/bearbeiten/${e.id}`),children:"Bearbeiten"}),f===e.id?s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"btn-delete-confirm",onClick:()=>(async e=>{var s,a;try{await n.delete(`${r.apiBaseUrl}/news/${e}`,{headers:{Authorization:`Bearer ${d}`}}),h(o.filter(s=>s.id!==e)),x(null)}catch(t){console.error("Fehler beim LÃ¶schen:",t),b("Fehler beim LÃ¶schen: "+((null==(a=null==(s=t.response)?void 0:s.data)?void 0:a.error)||t.message))}})(e.id),children:"BestÃ¤tigen"}),s.jsx("button",{className:"btn-cancel",onClick:()=>x(null),children:"Abbrechen"})]}):s.jsx("button",{className:"btn-delete",onClick:()=>x(e.id),children:"LÃ¶schen"})]})]})]},e.id);var a})})]}):null}export{i as default};
