import{j as e}from"./animation-1wuIdCBS.js";import{r as s}from"./vendor-router-BhMXg4Z-.js";import a from"./MemberHeader-B9i2VG32.js";import{u as n,c as t}from"./index-DUnH23_2.js";import{z as i,q as r,p as l,A as c,n as d,a5 as o,C as h,$ as m}from"./icons-D7rg4pDH.js";import"./vendor-react-DtuzQOD1.js";/* empty css                  */import"./query-Bs1dTGah.js";const u=()=>{var u,j;const{user:x}=n(),[g,v]=s.useState({}),[p,N]=s.useState(!0),[f,b]=s.useState(null),[w,y]=s.useState(!1),[z,S]=s.useState([]),[k,D]=s.useState(null),[M,$]=s.useState(null);s.useEffect(()=>{T()},[]);const T=async()=>{N(!0);try{const s=(null==x?void 0:x.email)||"tom@example.com";console.log("MemberStats: Lade Mitgliedsdaten f√ºr Email:",s);const a=await fetch(`/mitglieder/by-email/${encodeURIComponent(s)}`);if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const n=await a.json();console.log("MemberStats: Mitgliedsdaten geladen:",n),$(n);const i=await fetch(`/anwesenheit/${n.mitglied_id}`);let r=[];i.ok&&(r=await i.json());const l=Array.isArray(r)?r.length:0,c=Array.isArray(r)?r.filter(e=>1===e.anwesend||!0===e.anwesend).length:0,d=l>0?Math.round(c/l*100):0,o=B(r);let h=[];try{const e=await fetch(`/fortschritt/mitglied/${n.mitglied_id}/ziele`);e.ok&&(h=await e.json())}catch(e){console.log("Keine Ziele verf√ºgbar")}v({trainingsstunden:l,anwesenheit:d,"aktuellerG√ºrtel":n.gurtfarbe||"Wei√ügurt",naechsterGuertel:A(n.gurtfarbe),trainingswochen:Math.floor(l/2),durchschnittlicheStunden:l>0?Math.round(l/6):0,laengsteSerie:8,aktuelleSerie:3,pruefungen:[],monatsDaten:o,ziele:h}),await(async()=>{try{const e=await fetch(`${t.apiBaseUrl}/mitglieder/comparison-stats`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const s=await e.json();D(s)}else console.log("Vergleichsdaten-API nicht verf√ºgbar, zeige keine Vergleichsdaten"),D(null)}catch(e){console.error("Fehler beim Laden der Vergleichsdaten:",e),D(null)}})()}catch(e){console.error("Fehler beim Laden der Statistiken:",e),v({trainingsstunden:0,anwesenheit:0,"aktuellerG√ºrtel":"Nicht verf√ºgbar",naechsterGuertel:"-",trainingswochen:0,durchschnittlicheStunden:0,laengsteSerie:0,aktuelleSerie:0,pruefungen:[],monatsDaten:[],ziele:[]})}finally{N(!1)}},A=e=>{const s=["Wei√ügurt","Gelbgurt","Orangegurt","Gr√ºngurt","Blaugurt","Braungurt","Schwarzgurt"],a=s.findIndex(s=>s.toLowerCase()===(e||"").toLowerCase());return a>=0&&a<s.length-1?s[a+1]:"Schwarzgurt"},B=e=>{if(!Array.isArray(e)||0===e.length)return[];const s={};return e.forEach(e=>{if(!e.datum||1!==e.anwesend)return;const a=new Date(e.datum),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`,t=`${["Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"][a.getMonth()]} ${a.getFullYear()}`;s[n]||(s[n]={monat:t,stunden:0,tage:0,sortKey:n}),s[n].stunden+=1,s[n].tage+=1}),Object.values(s).sort((e,s)=>e.sortKey.localeCompare(s.sortKey)).slice(-6)};return p?e.jsxs("div",{className:"dashboard-container",children:[e.jsx(a,{}),e.jsx("div",{className:"dashboard-content",children:e.jsxs("div",{className:"member-stats-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Lade Statistiken..."})]})})]}):e.jsxs("div",{className:"dashboard-container",children:[e.jsx(a,{}),e.jsx("div",{className:"dashboard-content",children:e.jsxs("div",{className:"member-stats",children:[e.jsxs("div",{className:"stats-header",children:[e.jsxs("h1",{children:[e.jsx(i,{size:32}),"Meine Statistiken"]}),e.jsx("p",{children:"Dein Trainingsfortschritt und deine Erfolge im √úberblick"})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card primary",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(r,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-number",children:g.trainingsstunden}),e.jsx("div",{className:"stat-label",children:"Trainingsstunden"}),e.jsx("div",{className:"stat-trend",children:"+12 diese Woche"})]})]}),e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(l,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsxs("div",{className:"stat-number",children:[g.anwesenheit,"%"]}),e.jsx("div",{className:"stat-label",children:"Anwesenheit"}),e.jsx("div",{className:"stat-trend",children:"Sehr gut!"})]})]}),e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(c,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-number",children:g.aktuellerG√ºrtel}),e.jsx("div",{className:"stat-label",children:"Aktueller G√ºrtel"}),e.jsxs("div",{className:"stat-trend",children:["N√§chster: ",g.naechsterGuertel]})]})]}),e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(d,{size:24})}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-number",children:g.aktuelleSerie}),e.jsx("div",{className:"stat-label",children:"Trainingstage in Serie"}),e.jsxs("div",{className:"stat-trend",children:["Best: ",g.laengsteSerie," Tage"]})]})]})]}),k&&e.jsxs("div",{className:"stats-section",children:[e.jsxs("h2",{children:[e.jsx(l,{size:20}),"Vergleich mit anderen Mitgliedern"]}),e.jsx("div",{className:"comparison-grid",children:Object.entries(k).map(([s,a])=>{const n=(t=a.percentile)>=90?{level:"Top 10%",color:"#10B981",icon:"ü•á"}:t>=75?{level:"Sehr gut",color:"#3B82F6",icon:"ü•à"}:t>=50?{level:"√úberdurchschnittlich",color:"#8B5CF6",icon:"ü•â"}:t>=25?{level:"Durchschnittlich",color:"#F59E0B",icon:"üìä"}:{level:"Verbesserung m√∂glich",color:"#EF4444",icon:"üìà"};var t;return e.jsxs("div",{className:"comparison-card",children:[e.jsxs("div",{className:"comparison-header",children:[e.jsx("h3",{children:{trainingsstunden:"Trainingsstunden",anwesenheit:"Anwesenheit (%)",trainingswochen:"Trainingswochen"}[s]}),e.jsxs("div",{className:"performance-badge",style:{color:n.color},children:[e.jsx("span",{children:n.icon}),e.jsx("span",{children:n.level})]})]}),e.jsxs("div",{className:"comparison-values",children:[e.jsxs("div",{className:"value-row",children:[e.jsx("span",{className:"label",children:"Dein Wert:"}),e.jsxs("span",{className:"value primary",children:[a.deinWert,"anwesenheit"===s?"%":"trainingsstunden"===s?"h":""]})]}),e.jsxs("div",{className:"value-row",children:[e.jsx("span",{className:"label",children:"Durchschnitt:"}),e.jsxs("span",{className:"value",children:[a.durchschnitt,"anwesenheit"===s?"%":"trainingsstunden"===s?"h":""]})]}),e.jsxs("div",{className:"value-row",children:[e.jsx("span",{className:"label",children:"Top 10%:"}),e.jsxs("span",{className:"value top",children:[a.top10Prozent,"anwesenheit"===s?"%":"trainingsstunden"===s?"h":""]})]})]}),e.jsxs("div",{className:"comparison-bar",children:[e.jsxs("div",{className:"bar-container",children:[e.jsx("div",{className:"bar-average",style:{width:a.durchschnitt/a.top10Prozent*100+"%"}}),e.jsx("div",{className:"bar-top",style:{width:"100%"}}),e.jsx("div",{className:"bar-your",style:{width:a.deinWert/a.top10Prozent*100+"%"}})]}),e.jsxs("div",{className:"bar-labels",children:[e.jsx("span",{children:"Durchschnitt"}),e.jsx("span",{children:"Dein Wert"}),e.jsx("span",{children:"Top 10%"})]})]})]},s)})}),e.jsx("div",{className:"comparison-note",children:e.jsx("p",{children:"üìä Basierend auf anonymisierten Daten aller aktiven Mitglieder"})})]}),e.jsxs("div",{className:"stats-section",children:[e.jsxs("h2",{children:[e.jsx(o,{size:20}),"Pr√ºfungsverlauf"]}),e.jsx("div",{className:"pruefungen-list",children:null==(u=g.pruefungen)?void 0:u.map((s,a)=>e.jsxs("div",{className:"pruefung-item",children:[e.jsx("div",{className:"pruefung-date",children:new Date(s.datum).toLocaleDateString("de-DE")}),e.jsxs("div",{className:"pruefung-details",children:[e.jsxs("div",{className:"pruefung-guertel",children:[s.guertel," G√ºrtel"]}),e.jsx("div",{className:`pruefung-status ${s.status}`,children:"bestanden"===s.status?"‚úÖ Bestanden":s.status})]})]},a))})]}),e.jsxs("div",{className:"stats-section",children:[e.jsxs("h2",{children:[e.jsx(h,{size:20}),"Trainingsstunden pro Monat"]}),e.jsx("div",{className:"training-chart-wrapper",children:e.jsx("div",{className:"training-chart",style:{position:"relative",zIndex:1},children:null==(j=g.monatsDaten)?void 0:j.map((s,a)=>{const n=Math.max(...g.monatsDaten.map(e=>e.stunden)),t=g.monatsDaten.reduce((e,s)=>e+s.stunden,0)/g.monatsDaten.length,i=n>0?s.stunden/n*100:0;let r="medium";return s.stunden>=1.1*t?r="high":s.stunden<=.9*t&&(r="low"),e.jsxs("div",{className:"chart-bar",style:{cursor:"pointer"},children:[e.jsx("div",{className:"bar-container",style:{display:"flex",flexDirection:"column",justifyContent:"flex-end"},onClick:()=>{console.log("Balken geklickt, Monat:",s),b(s);const[e,a]=s.monat.split(" ");(async(e,s,a)=>{try{console.log(`Lade Monatsdetails f√ºr Monat ${e}/${s}, Mitglied-ID: ${a}`);const n=await fetch(`/anwesenheit/${a}`);if(n.ok){const a=(await n.json()).filter(a=>{const n=new Date(a.datum);return n.getMonth()+1===parseInt(e)&&n.getFullYear()===parseInt(s)&&1===a.anwesend});console.log(`Gefundene Trainingstage f√ºr ${e}/${s}:`,a.length),S(a)}else console.log("Anwesenheitsdaten nicht verf√ºgbar"),S([])}catch(n){console.error("Fehler beim Laden der Monatsdetails:",n),S([])}})(new Date(Date.parse(e+" 1, 2000")).getMonth()+1,a,null==M?void 0:M.mitglied_id),y(!0)},children:e.jsx("div",{className:`bar-fill ${r}`,style:{height:`${Math.max(i,10)}%`,width:"100%"},children:e.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:"600"},children:[s.stunden,"h"]})})}),e.jsx("div",{className:"bar-label",children:s.monat})]},a)})})})]}),g.ziele&&g.ziele.length>0&&e.jsxs("div",{className:"stats-section",children:[e.jsxs("h2",{children:[e.jsx(d,{size:20}),"Deine Ziele"]}),e.jsx("div",{className:"goals-list",children:g.ziele.map((s,a)=>e.jsxs("div",{className:"goal-item",children:[e.jsxs("div",{className:"goal-progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${s.fortschritt_prozent||0}%`}})}),e.jsx("span",{children:s.titel})]}),e.jsx("div",{className:"goal-status",children:s.messbar&&s.ziel_wert?`${s.aktueller_wert||0}/${s.ziel_wert} (${s.fortschritt_prozent||0}%)`:"erreicht"===s.status?"‚úÖ Erreicht":"In Arbeit"})]},a))})]})]})}),w&&f&&e.jsx("div",{className:"month-details-overlay",onClick:()=>y(!1),children:e.jsxs("div",{className:"month-details-popup",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"month-details-header",children:[e.jsxs("h3",{children:["Trainingsdetails - ",f.monat]}),e.jsx("button",{className:"close-button",onClick:()=>y(!1),children:e.jsx(m,{size:20})})]}),e.jsxs("div",{className:"month-details-content",children:[e.jsxs("div",{className:"month-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx(h,{size:16}),e.jsxs("span",{children:[f.tage," Trainingstage"]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx(r,{size:16}),e.jsxs("span",{children:[f.stunden," Trainingsstunden"]})]})]}),e.jsxs("div",{className:"training-days-list",children:[e.jsx("h4",{children:"Trainingsdaten:"}),z.length>0?z.map((s,a)=>e.jsxs("div",{className:"training-day-item",children:[e.jsxs("div",{className:"training-date",children:[e.jsx(h,{size:14}),e.jsx("span",{children:new Date(s.datum).toLocaleDateString("de-DE")})]}),e.jsxs("div",{className:"training-details",children:[e.jsxs("div",{className:"training-time",children:[e.jsx(r,{size:14}),e.jsx("span",{children:s.uhrzeit||s.stunde})]}),e.jsxs("div",{className:"training-course",children:[e.jsx(o,{size:14}),e.jsx("span",{children:s.kurs_name||s.kurs||s.gruppenname})]}),e.jsxs("div",{className:"training-trainer",children:[e.jsx(c,{size:14}),e.jsx("span",{children:s.trainer_name||s.trainer})]})]})]},a)):e.jsx("div",{className:"no-data",children:e.jsx("p",{children:"Keine Trainingsdaten f√ºr diesen Monat verf√ºgbar."})})]})]})]})})]})};export{u as default};
