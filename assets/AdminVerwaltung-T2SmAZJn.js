import{a as e,j as n}from"./query-Caj74EYQ.js";import{f as s,c as a,a as r}from"./index-lGWqIYMX.js";import{aj as l,a2 as i,_ as t,X as o,ao as c,a5 as d,bj as m,o as u,d as h,c as b,a as p,b as g,l as x,i as f}from"./icons-C9nQ4cWf.js";const j=()=>{const[r,h]=e.useState([]),[b,p]=e.useState(!0),[g,x]=e.useState(null),[f,j]=e.useState(!1),[v,y]=e.useState({name:"",beschreibung:"",groesse:"",kapazitaet:"",farbe:"#4F46E5",aktiv:!0}),N=async()=>{try{p(!0);const e=await s(`${a.apiBaseUrl}/raeume`),n=await e.json();n.success?h(n.data):console.error("Fehler beim Laden der RÃ¤ume:",n)}catch(e){console.error("Fehler beim Laden der RÃ¤ume:",e)}finally{p(!1)}};e.useEffect(()=>{N()},[]);const k=(e,n,s)=>{h(r.map(a=>a.raum_id===e?{...a,[n]:s}:a))};if(b)return n.jsxs("div",{className:"raum-verwaltung loading",children:[n.jsx("div",{className:"loading-spinner"}),n.jsx("p",{children:"RÃ¤ume werden geladen..."})]});const z={sectionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem",padding:"1.5rem",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 215, 0, 0.2)",borderRadius:"12px",backdropFilter:"blur(10px)"},headerContent:{display:"flex",alignItems:"center",gap:"1rem"},headerIcon:{color:"#ffd700",width:"24px",height:"24px"},headerTitle:{margin:0,color:"#ffd700",fontSize:"1.5rem",fontWeight:600,fontFamily:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',textTransform:"none",fontStyle:"normal",letterSpacing:"normal"},headerSubtitle:{margin:0,color:"rgba(255, 255, 255, 0.7)",fontSize:"0.9rem"},btnPrimary:{display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",background:"linear-gradient(135deg, #ffd700, #ffed4a)",color:"#1a1a2e",border:"none",borderRadius:"8px",fontSize:"0.9rem",fontWeight:600,cursor:"pointer"},roomCard:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 215, 0, 0.2)",borderRadius:"12px",overflow:"hidden",backdropFilter:"blur(10px)"},roomHeader:{display:"flex",alignItems:"center",gap:"1rem",padding:"1.5rem",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",background:"transparent"},roomName:{flexGrow:1,margin:0,fontSize:"1.1rem",fontWeight:600,color:"#ffffff"},roomDetails:{padding:"1.5rem",background:"transparent"},btnIcon:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"6px",background:"rgba(255, 255, 255, 0.05)",color:"rgba(255, 255, 255, 0.8)",cursor:"pointer"},btnIconDanger:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",border:"1px solid #EF4444",borderRadius:"6px",background:"rgba(255, 255, 255, 0.05)",color:"#EF4444",cursor:"pointer"}};return n.jsxs("div",{className:"raum-verwaltung",children:[n.jsxs("div",{className:"section-header",style:z.sectionHeader,children:[n.jsxs("div",{className:"header-content",style:z.headerContent,children:[n.jsx(l,{style:z.headerIcon}),n.jsxs("div",{children:[n.jsx("h2",{style:z.headerTitle,children:"Raumverwaltung"}),n.jsx("p",{style:z.headerSubtitle,children:"Verwalten Sie die TrainingsrÃ¤ume Ihres Dojos"})]})]}),n.jsxs("button",{className:"btn-primary",style:z.btnPrimary,onClick:()=>j(!0),disabled:f,children:[n.jsx(i,{size:16}),"Raum hinzufÃ¼gen"]})]}),f&&n.jsxs("div",{className:"room-form-card",children:[n.jsxs("div",{className:"form-header",children:[n.jsx("h3",{children:"Neuen Raum hinzufÃ¼gen"}),n.jsx("button",{className:"btn-icon",onClick:()=>j(!1),children:n.jsx(t,{size:16})})]}),n.jsxs("div",{className:"form-grid",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Raumname *"}),n.jsx("input",{type:"text",value:v.name,onChange:e=>y({...v,name:e.target.value}),placeholder:"z.B. Hauptraum, Nebenraum...",className:"form-input"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Beschreibung"}),n.jsx("input",{type:"text",value:v.beschreibung,onChange:e=>y({...v,beschreibung:e.target.value}),placeholder:"Kurze Beschreibung des Raums",className:"form-input"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"GrÃ¶ÃŸe"}),n.jsx("input",{type:"text",value:v.groesse,onChange:e=>y({...v,groesse:e.target.value}),placeholder:"z.B. 120 mÂ², GroÃŸ, Klein...",className:"form-input"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"KapazitÃ¤t"}),n.jsx("input",{type:"number",value:v.kapazitaet,onChange:e=>y({...v,kapazitaet:e.target.value}),placeholder:"Max. Anzahl Personen",className:"form-input",min:"1"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Farbe"}),n.jsxs("div",{className:"color-input-group",children:[n.jsx("input",{type:"color",value:v.farbe,onChange:e=>y({...v,farbe:e.target.value}),className:"color-input"}),n.jsx("span",{className:"color-value",children:v.farbe})]})]}),n.jsx("div",{className:"form-group",children:n.jsxs("label",{className:"checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:v.aktiv,onChange:e=>y({...v,aktiv:e.target.checked})}),"Raum ist aktiv"]})})]}),n.jsxs("div",{className:"form-actions",children:[n.jsx("button",{className:"btn-secondary",onClick:()=>j(!1),children:"Abbrechen"}),n.jsxs("button",{className:"btn-primary",onClick:async()=>{if(v.name.trim())try{const e=await s(`${a.apiBaseUrl}/raeume`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)}),n=await e.json();n.success?(y({name:"",beschreibung:"",groesse:"",kapazitaet:"",farbe:"#4F46E5",aktiv:!0}),j(!1),N()):alert("Fehler beim HinzufÃ¼gen des Raums: "+n.error)}catch(e){console.error("Fehler beim HinzufÃ¼gen des Raums:",e),alert("Fehler beim HinzufÃ¼gen des Raums")}else alert("Bitte geben Sie einen Raumnamen ein")},children:[n.jsx(o,{size:16}),"Raum hinzufÃ¼gen"]})]})]}),n.jsxs("div",{className:"rooms-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(350px, 1fr))",gap:"1.5rem",marginBottom:"2rem"},children:[r.map(e=>n.jsxs("div",{className:`room-card ${e.aktiv?"":"inactive"} ${g===e.raum_id?"editing":""}`,style:{...z.roomCard,opacity:e.aktiv?1:.6,border:g===e.raum_id?"2px solid #ffd700":"1px solid rgba(255, 215, 0, 0.2)"},children:[n.jsxs("div",{className:"room-header",style:z.roomHeader,children:[n.jsx("div",{className:"room-color",style:{backgroundColor:e.farbe,width:"20px",height:"20px",borderRadius:"50%",flexShrink:0,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"}}),g===e.raum_id?n.jsx("input",{type:"text",value:e.name,onChange:n=>k(e.raum_id,"name",n.target.value),className:"room-name-input",style:{flexGrow:1,padding:"0.5rem",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 215, 0, 0.3)",borderRadius:"6px",fontSize:"1.1rem",fontWeight:600,color:"#ffffff"}}):n.jsx("h3",{className:"room-name",style:z.roomName,children:e.name}),n.jsx("div",{className:"room-actions",style:{display:"flex",gap:"0.5rem"},children:g===e.raum_id?n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"btn-icon success",style:{...z.btnIcon,borderColor:"#10B981",color:"#10B981"},onClick:()=>(async e=>{if(e.name.trim())try{const n=await s(`${a.apiBaseUrl}/raeume/${e.raum_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,beschreibung:e.beschreibung,groesse:e.groesse,kapazitaet:e.kapazitaet,farbe:e.farbe,aktiv:e.aktiv})}),r=await n.json();r.success?(x(null),N()):alert("Fehler beim Speichern des Raums: "+r.error)}catch(n){console.error("Fehler beim Speichern des Raums:",n),alert("Fehler beim Speichern des Raums")}else alert("Bitte geben Sie einen Raumnamen ein")})(e),children:n.jsx(o,{size:16})}),n.jsx("button",{className:"btn-icon",style:z.btnIcon,onClick:()=>x(null),children:n.jsx(t,{size:16})})]}):n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"btn-icon",style:z.btnIcon,onClick:()=>x(e.raum_id),children:n.jsx(c,{size:16})}),n.jsx("button",{className:"btn-icon danger",style:z.btnIconDanger,onClick:()=>(async(e,n)=>{if(confirm(`MÃ¶chten Sie den Raum "${n}" wirklich lÃ¶schen?`))try{const n=await s(`${a.apiBaseUrl}/raeume/${e}`,{method:"DELETE"}),r=await n.json();r.success?N():alert("Fehler beim LÃ¶schen des Raums: "+r.error)}catch(r){console.error("Fehler beim LÃ¶schen des Raums:",r),alert("Fehler beim LÃ¶schen des Raums")}})(e.raum_id,e.name),children:n.jsx(d,{size:16})})]})})]}),g===e.raum_id?n.jsxs("div",{className:"room-edit-form",style:{padding:"1.5rem",background:"rgba(0, 0, 0, 0.2)"},children:[n.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1rem"},children:[n.jsx("label",{style:{fontSize:"0.9rem",fontWeight:500,color:"rgba(255, 255, 255, 0.8)",textTransform:"none"},children:"Beschreibung"}),n.jsx("input",{type:"text",value:e.beschreibung||"",onChange:n=>k(e.raum_id,"beschreibung",n.target.value),style:{padding:"0.75rem",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 215, 0, 0.2)",borderRadius:"8px",fontSize:"0.9rem",color:"#ffffff"}})]}),n.jsxs("div",{className:"form-row",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[n.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[n.jsx("label",{style:{fontSize:"0.9rem",fontWeight:500,color:"rgba(255, 255, 255, 0.8)",textTransform:"none"},children:"GrÃ¶ÃŸe"}),n.jsx("input",{type:"text",value:e.groesse||"",onChange:n=>k(e.raum_id,"groesse",n.target.value),style:{padding:"0.75rem",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 215, 0, 0.2)",borderRadius:"8px",fontSize:"0.9rem",color:"#ffffff"}})]}),n.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[n.jsx("label",{style:{fontSize:"0.9rem",fontWeight:500,color:"rgba(255, 255, 255, 0.8)",textTransform:"none"},children:"KapazitÃ¤t"}),n.jsx("input",{type:"number",value:e.kapazitaet||"",onChange:n=>k(e.raum_id,"kapazitaet",n.target.value),style:{padding:"0.75rem",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 215, 0, 0.2)",borderRadius:"8px",fontSize:"0.9rem",color:"#ffffff"},min:"1"})]})]}),n.jsxs("div",{className:"form-row",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[n.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[n.jsx("label",{style:{fontSize:"0.9rem",fontWeight:500,color:"rgba(255, 255, 255, 0.8)",textTransform:"none"},children:"Farbe"}),n.jsx("input",{type:"color",value:e.farbe||"#4F46E5",onChange:n=>k(e.raum_id,"farbe",n.target.value),style:{width:"50px",height:"40px",border:"1px solid rgba(255, 215, 0, 0.3)",borderRadius:"8px",cursor:"pointer",background:"transparent"}})]}),n.jsx("div",{className:"form-group",style:{display:"flex",flexDirection:"column",gap:"0.5rem",justifyContent:"flex-end"},children:n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",color:"rgba(255, 255, 255, 0.8)",fontSize:"0.9rem",textTransform:"none"},children:[n.jsx("input",{type:"checkbox",checked:e.aktiv,onChange:n=>k(e.raum_id,"aktiv",n.target.checked),style:{width:"18px",height:"18px",accentColor:"#ffd700"}}),"Aktiv"]})})]})]}):n.jsxs("div",{className:"room-details",style:z.roomDetails,children:[e.beschreibung&&n.jsx("p",{className:"room-description",style:{margin:"0 0 1rem 0",color:"rgba(255, 255, 255, 0.7)",fontSize:"0.9rem",lineHeight:1.5},children:e.beschreibung}),n.jsxs("div",{className:"room-info",style:{display:"flex",flexWrap:"wrap",gap:"1rem",marginBottom:"1rem"},children:[e.groesse&&n.jsxs("div",{className:"room-info-item",style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"rgba(255, 255, 255, 0.7)",fontSize:"0.9rem"},children:[n.jsx(m,{size:14,style:{color:"#ffd700"}}),n.jsx("span",{children:e.groesse})]}),e.kapazitaet&&n.jsxs("div",{className:"room-info-item",style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"rgba(255, 255, 255, 0.7)",fontSize:"0.9rem"},children:[n.jsx(u,{size:14,style:{color:"#ffd700"}}),n.jsxs("span",{children:[e.kapazitaet," Personen"]})]})]}),!e.aktiv&&n.jsx("div",{className:"room-status inactive",style:{display:"inline-block",padding:"0.25rem 0.75rem",borderRadius:"20px",fontSize:"0.8rem",fontWeight:500,background:"rgba(239, 68, 68, 0.2)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.3)"},children:"Inaktiv"})]})]},e.raum_id)),0===r.length&&n.jsxs("div",{className:"empty-state",style:{gridColumn:"1 / -1",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"3rem",textAlign:"center",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 215, 0, 0.2)",borderRadius:"12px",backdropFilter:"blur(10px)"},children:[n.jsx(l,{size:48,style:{color:"rgba(255, 215, 0, 0.4)",marginBottom:"1rem"}}),n.jsx("h3",{style:{margin:"0 0 0.5rem 0",color:"#ffffff",fontSize:"1.2rem",fontWeight:600},children:"Keine RÃ¤ume vorhanden"}),n.jsx("p",{style:{margin:"0 0 2rem 0",color:"rgba(255, 255, 255, 0.6)",fontSize:"0.9rem"},children:"FÃ¼gen Sie Ihren ersten Trainingsraum hinzu"}),n.jsxs("button",{className:"btn-primary",style:z.btnPrimary,onClick:()=>j(!0),children:[n.jsx(i,{size:16}),"Ersten Raum hinzufÃ¼gen"]})]})]})]})},v=({value:s,onChange:a,placeholder:l="Finanzamt suchen...",className:i="",disabled:t=!1})=>{const[o,c]=e.useState([]),[d,m]=e.useState([]),[u,h]=e.useState(""),[b,p]=e.useState(!1),[g,x]=e.useState(!1),[f,j]=e.useState([]),[v,y]=e.useState(""),[N,k]=e.useState(!1),[z,w]=e.useState({name:"",ort:"",bundesland:"",plz:"",strasse:"",telefon:"",email:"",finanzamtnummer:""}),C=e.useRef(null),S=e.useRef(null);e.useEffect(()=>{F(),B()},[]),e.useEffect(()=>{R()},[u,v,o]),e.useEffect(()=>{const e=e=>{C.current&&!C.current.contains(e.target)&&(p(!1),k(!1))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),e.useEffect(()=>{s&&"object"==typeof s?h(`${s.name}, ${s.ort}`):"string"==typeof s&&h(s)},[s]);const F=async()=>{try{x(!0);const e=await r.get("/finanzaemter");c(e.data)}catch(e){console.error("Fehler beim Laden der FinanzÃ¤mter:",e)}finally{x(!1)}},B=async()=>{try{const e=await r.get("/finanzaemter/bundeslaender");j(e.data)}catch(e){console.error("Fehler beim Laden der BundeslÃ¤nder:",e)}},R=()=>{let e=o;if(v&&(e=e.filter(e=>e.bundesland===v)),u){const n=u.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(n)||e.ort.toLowerCase().includes(n)||e.bundesland.toLowerCase().includes(n))}m(e.slice(0,50))},P=e=>{h(`${e.name}, ${e.ort}`),a(e),p(!1),k(!1)};return n.jsxs("div",{className:`finanzamt-selector ${i}`,ref:C,children:[n.jsxs("div",{className:"finanzamt-input-container",children:[n.jsx("input",{ref:S,type:"text",value:u,onChange:e=>{const n=e.target.value;h(n),p(!0),k(!1),n||a(null)},onFocus:()=>p(!0),onKeyDown:e=>{"Escape"===e.key&&(p(!1),k(!1))},placeholder:l,disabled:t,className:"finanzamt-input"}),n.jsx("div",{className:"finanzamt-filters",children:n.jsxs("select",{value:v,onChange:e=>y(e.target.value),className:"bundesland-filter",children:[n.jsx("option",{value:"",children:"Alle BundeslÃ¤nder"}),f.map(e=>n.jsx("option",{value:e,children:e},e))]})})]}),b&&n.jsx("div",{className:"finanzamt-dropdown",children:g?n.jsx("div",{className:"loading",children:"Lade FinanzÃ¤mter..."}):n.jsxs(n.Fragment,{children:[d.length>0?n.jsx("div",{className:"finanzamt-list",children:d.map(e=>n.jsxs("div",{className:"finanzamt-item",onClick:()=>P(e),children:[n.jsx("div",{className:"finanzamt-name",children:e.name}),n.jsxs("div",{className:"finanzamt-details",children:[e.ort,", ",e.bundesland,e.finanzamtnummer&&n.jsxs("span",{className:"finanzamt-nummer",children:[" (#",e.finanzamtnummer,")"]})]})]},e.id))}):n.jsx("div",{className:"no-results",children:n.jsx("p",{children:"Keine FinanzÃ¤mter gefunden"})}),n.jsx("div",{className:"finanzamt-actions",children:n.jsx("button",{type:"button",className:"create-finanzamt-btn",onClick:()=>k(!N),children:"+ Finanzamt nicht vorhanden? Anlegen"})}),N&&n.jsxs("div",{className:"create-finanzamt-form",children:[n.jsx("h4",{children:"Neues Finanzamt anlegen"}),n.jsxs("form",{onSubmit:async e=>{var n,s;e.preventDefault();try{x(!0);const e=(await r.post("/finanzaemter",z)).data.finanzamt;c(n=>[...n,e]),P(e),w({name:"",ort:"",bundesland:"",plz:"",strasse:"",telefon:"",email:"",finanzamtnummer:""}),alert("Finanzamt erfolgreich angelegt!")}catch(a){console.error("Fehler beim Anlegen des Finanzamts:",a),alert("Fehler beim Anlegen des Finanzamts: "+((null==(s=null==(n=a.response)?void 0:n.data)?void 0:s.error)||a.message))}finally{x(!1)}},children:[n.jsxs("div",{className:"form-row",children:[n.jsx("input",{type:"text",placeholder:"Name des Finanzamts *",value:z.name,onChange:e=>w(n=>({...n,name:e.target.value})),required:!0}),n.jsx("input",{type:"text",placeholder:"Ort *",value:z.ort,onChange:e=>w(n=>({...n,ort:e.target.value})),required:!0})]}),n.jsxs("div",{className:"form-row",children:[n.jsxs("select",{value:z.bundesland,onChange:e=>w(n=>({...n,bundesland:e.target.value})),required:!0,children:[n.jsx("option",{value:"",children:"Bundesland auswÃ¤hlen *"}),f.map(e=>n.jsx("option",{value:e,children:e},e))]}),n.jsx("input",{type:"text",placeholder:"PLZ",value:z.plz,onChange:e=>w(n=>({...n,plz:e.target.value}))})]}),n.jsxs("div",{className:"form-row",children:[n.jsx("input",{type:"text",placeholder:"StraÃŸe und Hausnummer",value:z.strasse,onChange:e=>w(n=>({...n,strasse:e.target.value}))}),n.jsx("input",{type:"text",placeholder:"Telefon",value:z.telefon,onChange:e=>w(n=>({...n,telefon:e.target.value}))})]}),n.jsxs("div",{className:"form-row",children:[n.jsx("input",{type:"email",placeholder:"E-Mail",value:z.email,onChange:e=>w(n=>({...n,email:e.target.value}))}),n.jsx("input",{type:"text",placeholder:"Finanzamt-Nummer",value:z.finanzamtnummer,onChange:e=>w(n=>({...n,finanzamtnummer:e.target.value}))})]}),n.jsxs("div",{className:"form-actions",children:[n.jsx("button",{type:"submit",className:"save-btn",disabled:g,children:g?"Wird angelegt...":"Finanzamt anlegen"}),n.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>k(!1),children:"Abbrechen"})]})]})]})]})})]})},y=()=>{const[r,l]=e.useState("admin"),[i,t]=e.useState([]),[o,m]=e.useState(!1),[j,v]=e.useState({text:"",type:""}),[y,N]=e.useState({admin:!0,supervisor:!0,trainer:!0,verkauf:!0}),[k,z]=e.useState(!1),[w,C]=e.useState(!1),[S,F]=e.useState(null),[B,R]=e.useState({username:"",email:"",role:""}),[P,E]=e.useState({newPassword:"",confirmPassword:""}),T=[{key:"admin",label:"Admin",icon:"ðŸ‘¨â€ðŸ’¼",color:"#3b82f6"},{key:"supervisor",label:"Supervisor",icon:"ðŸ‘”",color:"#8b5cf6"},{key:"trainer",label:"Trainer",icon:"ðŸ¥‹",color:"#10b981"},{key:"verkauf",label:"Verkauf",icon:"ðŸ’°",color:"#f59e0b"}],$=[{key:"mitglieder",label:"Mitglieder",icon:"ðŸ‘¥"},{key:"vertraege",label:"VertrÃ¤ge",icon:"ðŸ“"},{key:"finanzen",label:"Finanzen",icon:"ðŸ’°"},{key:"pruefungen",label:"PrÃ¼fungen",icon:"ðŸ¥‹"},{key:"stundenplan",label:"Stundenplan",icon:"ðŸ“…"},{key:"verkauf",label:"Verkauf/Kasse",icon:"ðŸ›’"},{key:"berichte",label:"Berichte",icon:"ðŸ“ˆ"},{key:"einstellungen",label:"Einstellungen",icon:"âš™ï¸"}],[I,L]=e.useState({admin:{mitglieder:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!0},vertraege:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!0},finanzen:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!0},pruefungen:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!0},stundenplan:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!0},verkauf:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!0},berichte:{lesen:!0,exportieren:!0},einstellungen:{lesen:!0,bearbeiten:!0}},supervisor:{mitglieder:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!1},vertraege:{lesen:!0,erstellen:!1,bearbeiten:!0,loeschen:!1},finanzen:{lesen:!0,erstellen:!1,bearbeiten:!1,loeschen:!1},pruefungen:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!1},stundenplan:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!1},verkauf:{lesen:!0,erstellen:!0,bearbeiten:!1,loeschen:!1},berichte:{lesen:!0,exportieren:!1},einstellungen:{lesen:!0,bearbeiten:!1}},trainer:{mitglieder:{lesen:!0,erstellen:!1,bearbeiten:!1,loeschen:!1},vertraege:{lesen:!1,erstellen:!1,bearbeiten:!1,loeschen:!1},finanzen:{lesen:!1,erstellen:!1,bearbeiten:!1,loeschen:!1},pruefungen:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!1},stundenplan:{lesen:!0,erstellen:!1,bearbeiten:!1,loeschen:!1},verkauf:{lesen:!1,erstellen:!1,bearbeiten:!1,loeschen:!1},berichte:{lesen:!1,exportieren:!1},einstellungen:{lesen:!1,bearbeiten:!1}},verkauf:{mitglieder:{lesen:!0,erstellen:!1,bearbeiten:!1,loeschen:!1},vertraege:{lesen:!1,erstellen:!1,bearbeiten:!1,loeschen:!1},finanzen:{lesen:!1,erstellen:!1,bearbeiten:!1,loeschen:!1},pruefungen:{lesen:!1,erstellen:!1,bearbeiten:!1,loeschen:!1},stundenplan:{lesen:!0,erstellen:!1,bearbeiten:!1,loeschen:!1},verkauf:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!1},berichte:{lesen:!1,exportieren:!1},einstellungen:{lesen:!1,bearbeiten:!1}}});e.useEffect(()=>{D()},[]);const D=async()=>{m(!0);try{const e=await s(`${a.apiBaseUrl}/auth/users`);if(!e.ok)throw new Error("Fehler beim Laden");const n=await e.json();t(n)}catch(e){U("Fehler beim Laden der Benutzer: "+e.message,"error")}finally{m(!1)}},U=(e,n="info")=>{v({text:e,type:n}),setTimeout(()=>v({text:"",type:""}),5e3)},_=async()=>{m(!0);try{if(!(await s(`${a.apiBaseUrl}/permissions`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({permissions:I})})).ok)throw new Error("Fehler beim Speichern");U("Berechtigungen erfolgreich gespeichert!","success")}catch(e){U("Fehler beim Speichern: "+e.message,"error")}finally{m(!1)}},A=e=>i.filter(n=>n.role===e);return n.jsxs("div",{className:"admin-verwaltung",children:[n.jsx("div",{className:"page-header",children:n.jsxs("div",{className:"header-left",children:[n.jsx(h,{size:32,className:"header-icon"}),n.jsxs("div",{children:[n.jsx("h1",{children:"Benutzerverwaltung & Berechtigungen"}),n.jsx("p",{children:"Verwalten Sie Benutzer nach Rollen und definieren Sie Zugriffsrechte"})]})]})}),j.text&&n.jsx("div",{className:`message message-${j.type}`,children:j.text}),n.jsxs("div",{className:"tabs-container",children:[T.map(e=>n.jsxs("button",{className:"tab-button "+(r===e.key?"active":""),onClick:()=>l(e.key),style:r===e.key?{borderBottomColor:e.color}:{},children:[n.jsx("span",{className:"tab-icon",children:e.icon}),e.label,n.jsx("span",{className:"tab-count",children:A(e.key).length})]},e.key)),n.jsxs("button",{className:"tab-button "+("rechte"===r?"active":""),onClick:()=>l("rechte"),children:[n.jsx(b,{size:18,className:"tab-icon"}),"Rechtezuweisung"]})]}),n.jsx("div",{className:"tab-content",children:"rechte"===r?n.jsxs("div",{className:"rechte-container",children:[n.jsxs("div",{className:"rechte-header",children:[n.jsxs("div",{children:[n.jsx("h2",{children:"Rechtezuweisung"}),n.jsx("p",{children:"Definiere hier die Berechtigungen fÃ¼r jede Rolle. Alle Benutzer in einer Rolle erhalten automatisch diese Rechte."})]}),n.jsxs("button",{className:"btn btn-primary",onClick:_,disabled:o,children:[n.jsx(h,{size:18}),o?"Speichern...":"Berechtigungen speichern"]})]}),T.map(e=>n.jsxs("div",{className:"rolle-section",children:[n.jsxs("div",{className:"rolle-header clickable",style:{borderLeftColor:e.color},onClick:()=>{return n=e.key,void N(e=>({...e,[n]:!e[n]}));var n},children:[n.jsx("span",{className:"rolle-icon",children:e.icon}),n.jsx("h3",{children:e.label}),n.jsx("div",{className:"rolle-toggle",children:y[e.key]?n.jsx(p,{size:20}):n.jsx(g,{size:20})})]}),y[e.key]&&n.jsx("div",{className:"berechtigungen-grid",children:$.map(s=>n.jsxs("div",{className:"berechtigungs-card",children:[n.jsxs("div",{className:"bereich-header",children:[n.jsx("span",{className:"bereich-icon",children:s.icon}),n.jsx("h4",{children:s.label})]}),n.jsx("div",{className:"aktionen-checkboxes",children:["lesen","erstellen","bearbeiten","loeschen","exportieren"].map(a=>{var r,l;if("berichte"===s.key&&!["lesen","exportieren"].includes(a))return null;if("einstellungen"===s.key&&!["lesen","bearbeiten"].includes(a))return null;const i=(null==(l=null==(r=I[e.key])?void 0:r[s.key])?void 0:l[a])||!1;return n.jsxs("label",{className:"checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:i,onChange:n=>((e,n,s,a)=>{L(r=>({...r,[e]:{...r[e],[n]:{...r[e][n],[s]:a}}}))})(e.key,s.key,a,n.target.checked)}),n.jsx("span",{children:a.charAt(0).toUpperCase()+a.slice(1)})]},a)})})]},s.key))})]},e.key))]}):(e=>{const r=A(e),l=T.find(n=>n.key===e);return n.jsxs("div",{className:"users-container",children:[n.jsxs("div",{className:"users-header",children:[n.jsxs("div",{children:[n.jsxs("h2",{style:{color:l.color},children:[l.icon," ",l.label]}),n.jsxs("p",{children:[r.length," Benutzer mit dieser Rolle"]})]}),n.jsxs("button",{className:"btn btn-primary",children:[n.jsx(x,{size:18}),"Benutzer hinzufÃ¼gen"]})]}),0===r.length?n.jsxs("div",{className:"empty-state",children:[n.jsx(u,{size:48}),n.jsxs("p",{children:['Keine Benutzer mit der Rolle "',l.label,'"']})]}):n.jsx("div",{className:"users-grid",children:r.map(e=>{var r,i;return n.jsxs("div",{className:"user-card",children:[n.jsx("div",{className:"user-avatar",style:{background:l.color},children:((null==(r=e.vorname)?void 0:r[0])||(null==(i=e.username)?void 0:i[0])||"U").toUpperCase()}),n.jsxs("div",{className:"user-info",children:[n.jsxs("h3",{children:[e.vorname," ",e.nachname]}),n.jsxs("p",{className:"username",children:["@",e.username]}),n.jsx("p",{className:"email",children:e.email})]}),n.jsxs("div",{className:"user-actions",children:[n.jsx("button",{className:"btn-icon",title:"Bearbeiten",onClick:()=>(e=>{F(e),R({username:e.username,email:e.email,role:e.role}),z(!0)})(e),children:n.jsx(c,{size:16})}),n.jsx("button",{className:"btn-icon",title:"Passwort Ã¤ndern",onClick:()=>(e=>{F(e),E({newPassword:"",confirmPassword:""}),C(!0)})(e),children:n.jsx(f,{size:16})}),n.jsx("button",{className:"btn-icon btn-danger",title:"LÃ¶schen",onClick:()=>(async e=>{if(1===e.id)return void U("Super-Admin kann nicht gelÃ¶scht werden","error");if(window.confirm(`MÃ¶chten Sie den Benutzer "${e.username}" (${e.email}) wirklich lÃ¶schen?\n\nDieser Vorgang kann nicht rÃ¼ckgÃ¤ngig gemacht werden!`)){m(!0);try{const n=await s(`${a.apiBaseUrl}/auth/users/${e.id}`,{method:"DELETE"}),r=await n.json();if(!n.ok)throw new Error(r.error||"Fehler beim LÃ¶schen");U(r.message||"Benutzer erfolgreich gelÃ¶scht","success"),D()}catch(n){U(n.message,"error")}finally{m(!1)}}})(e),children:n.jsx(d,{size:16})})]})]},e.id)})})]})})(r)}),k&&n.jsx("div",{className:"modal-overlay",onClick:()=>z(!1),children:n.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h2",{children:"Benutzer bearbeiten"}),n.jsx("button",{className:"modal-close",onClick:()=>z(!1),children:"Ã—"})]}),n.jsxs("div",{className:"modal-body",children:[n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Benutzername"}),n.jsx("input",{type:"text",value:B.username,onChange:e=>R({...B,username:e.target.value}),placeholder:"Benutzername"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"E-Mail"}),n.jsx("input",{type:"email",value:B.email,onChange:e=>R({...B,email:e.target.value}),placeholder:"E-Mail"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Rolle"}),n.jsxs("select",{value:B.role,onChange:e=>R({...B,role:e.target.value}),children:[n.jsx("option",{value:"",children:"Rolle wÃ¤hlen..."}),T.map(e=>n.jsxs("option",{value:e.key,children:[e.icon," ",e.label]},e.key))]})]})]}),n.jsxs("div",{className:"modal-footer",children:[n.jsx("button",{className:"btn btn-secondary",onClick:()=>z(!1),children:"Abbrechen"}),n.jsx("button",{className:"btn btn-primary",onClick:async()=>{if(B.username&&B.email&&B.role){m(!0);try{const e=await s(`${a.apiBaseUrl}/auth/users/${S.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)}),n=await e.json();if(!e.ok)throw new Error(n.error||"Fehler beim Speichern");U(n.message||"Benutzer erfolgreich aktualisiert","success"),z(!1),D()}catch(e){U(e.message,"error")}finally{m(!1)}}else U("Bitte alle Felder ausfÃ¼llen","error")},disabled:o,children:o?"Speichern...":"Speichern"})]})]})}),w&&n.jsx("div",{className:"modal-overlay",onClick:()=>C(!1),children:n.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h2",{children:"Passwort zurÃ¼cksetzen"}),n.jsx("button",{className:"modal-close",onClick:()=>C(!1),children:"Ã—"})]}),n.jsxs("div",{className:"modal-body",children:[n.jsxs("p",{className:"modal-info",children:["Passwort fÃ¼r: ",n.jsx("strong",{children:null==S?void 0:S.username})," (",null==S?void 0:S.email,")"]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Neues Passwort"}),n.jsx("input",{type:"password",value:P.newPassword,onChange:e=>E({...P,newPassword:e.target.value}),placeholder:"Mindestens 6 Zeichen"})]}),n.jsxs("div",{className:"form-group",children:[n.jsx("label",{children:"Passwort wiederholen"}),n.jsx("input",{type:"password",value:P.confirmPassword,onChange:e=>E({...P,confirmPassword:e.target.value}),placeholder:"Passwort wiederholen"})]})]}),n.jsxs("div",{className:"modal-footer",children:[n.jsx("button",{className:"btn btn-secondary",onClick:()=>C(!1),children:"Abbrechen"}),n.jsx("button",{className:"btn btn-primary",onClick:async()=>{if(P.newPassword&&P.confirmPassword)if(P.newPassword===P.confirmPassword)if(P.newPassword.length<6)U("Passwort muss mindestens 6 Zeichen lang sein","error");else{m(!0);try{const e=await s(`${a.apiBaseUrl}/auth/users/${S.id}/password`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({newPassword:P.newPassword})}),n=await e.json();if(!e.ok)throw new Error(n.error||"Fehler beim ZurÃ¼cksetzen");U(n.message||"Passwort erfolgreich zurÃ¼ckgesetzt","success"),C(!1),E({newPassword:"",confirmPassword:""})}catch(e){U(e.message,"error")}finally{m(!1)}}else U("PasswÃ¶rter stimmen nicht Ã¼berein","error");else U("Bitte beide Felder ausfÃ¼llen","error")},disabled:o,children:o?"ZurÃ¼cksetzen...":"Passwort zurÃ¼cksetzen"})]})]})})]})};export{y as A,v as F,j as R};
