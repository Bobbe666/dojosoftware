import{j as e}from"./animation-1wuIdCBS.js";import{r as s}from"./vendor-router-BhMXg4Z-.js";import{k as n,c as t}from"./index-DUnH23_2.js";import{P as i,F as a,C as r,w as l,J as o,K as c,o as d,bm as h,D as m,p as u,A as j}from"./icons-D7rg4pDH.js";import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";const x=()=>{const[x,b]=s.useState([]),[f,w]=s.useState("all"),[p,g]=s.useState(!1),[k,v]=s.useState(""),[N,y]=s.useState(!1),D=[{id:"all",label:"Alle Dokumente",icon:e.jsx(a,{size:18})},{id:"vertrag",label:"Mitgliedschaftsvertrag",icon:e.jsx(a,{size:18}),color:"#DC2626",featured:!0},{id:"mitgliederliste",label:"Mitgliederliste",icon:e.jsx(d,{size:18}),color:"#3B82F6"},{id:"anwesenheit",label:"Anwesenheitsberichte",icon:e.jsx(h,{size:18}),color:"#10B981"},{id:"beitraege",label:"BeitragsÃ¼bersicht",icon:e.jsx(m,{size:18}),color:"#F59E0B"},{id:"statistiken",label:"Statistiken",icon:e.jsx(u,{size:18}),color:"#8B5CF6"},{id:"pruefungen",label:"PrÃ¼fungsurkunden",icon:e.jsx(j,{size:18}),color:"#EF4444"},{id:"custom",label:"Benutzerdefiniert",icon:e.jsx(a,{size:18}),color:"#6B7280"}];s.useEffect(()=>{z()},[]);const z=async()=>{g(!0);try{const e=await n(`${t.apiBaseUrl}/dokumente?status=erstellt`);if(!e.ok)throw new Error("Fehler beim Laden der Dokumente");const s=(await e.json()).map(e=>({id:e.id,name:e.name,type:e.typ,created:new Date(e.erstellt_am).toLocaleDateString("de-DE"),size:B(e.dateigroesse),format:e.dateityp,downloads:e.downloads}));b(s)}catch(e){v("âŒ Fehler beim Laden der Dokumente"),console.error(e)}finally{g(!1)}},B=e=>{if(!e)return"0 KB";const s=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,s)*100)/100+" "+["Bytes","KB","MB","GB"][s]},S="all"===f?x:x.filter(e=>e.type===f),C=s=>{const n=D.find(e=>e.id===s);return(null==n?void 0:n.icon)||e.jsx(a,{size:18})};return e.jsxs("div",{className:"berichte-dokumente",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"ğŸ“„ Berichte & Dokumente"}),e.jsx("p",{children:"PDF-Berichte erstellen, verwalten und herunterladen"})]}),k&&e.jsx("div",{className:"message "+(k.includes("âœ…")?"success":k.includes("âŒ")?"error":"info"),children:k}),e.jsxs("div",{className:"quick-create-section",children:[e.jsx("h2",{children:"âš¡ Neues Dokument erstellen"}),e.jsx("div",{className:"quick-create-grid",children:D.filter(e=>"all"!==e.id).map(s=>e.jsxs("div",{className:"quick-create-card "+(s.featured?"featured":""),onClick:()=>(async e=>{const s=D.find(s=>s.label===e);if(s){v(`âœ¨ PDF-Erstellung fÃ¼r "${e}" wird gestartet...`),g(!0);try{const i=(new Date).toISOString().split("T")[0],a=`${e}_${i}`,r=await n(`${t.apiBaseUrl}/dokumente/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({typ:s.id,name:a,parameter:{generatedAt:(new Date).toISOString()}})});if(!r.ok){const e=await r.json();throw new Error(e.error||"Fehler bei der PDF-Generierung")}await r.json(),v(`âœ… ${e} erfolgreich erstellt!`),await z(),y(!1)}catch(i){v(`âŒ Fehler: ${i.message}`),console.error(i)}finally{g(!1)}}})(s.label),style:{borderLeftColor:s.color},children:[e.jsx("div",{className:"quick-create-icon",style:{color:s.color},children:s.icon}),e.jsxs("div",{className:"quick-create-content",children:[e.jsx("h3",{children:s.label}),e.jsxs("button",{className:"btn-create",children:[e.jsx(i,{size:16}),"Erstellen"]})]})]},s.id))})]}),e.jsxs("div",{className:"document-filter",children:[e.jsx("h2",{children:"ğŸ“š Gespeicherte Dokumente"}),e.jsx("div",{className:"filter-buttons",children:D.map(s=>e.jsxs("button",{className:"filter-btn "+(f===s.id?"active":""),onClick:()=>w(s.id),children:[s.icon,e.jsx("span",{children:s.label})]},s.id))})]}),e.jsx("div",{className:"documents-list",children:p?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Laden..."})]}):0===S.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(a,{size:64}),e.jsx("h3",{children:"Keine Dokumente vorhanden"}),e.jsx("p",{children:"Erstellen Sie Ihr erstes Dokument mit den Schnellaktionen oben."})]}):e.jsx("div",{className:"documents-grid",children:S.map(s=>e.jsxs("div",{className:"document-card",children:[e.jsxs("div",{className:"document-header",children:[e.jsx("div",{className:"document-icon",children:C(s.type)}),e.jsxs("div",{className:"document-info",children:[e.jsx("h3",{children:s.name}),e.jsxs("div",{className:"document-meta",children:[e.jsxs("span",{children:[e.jsx(r,{size:14})," ",s.created]}),e.jsxs("span",{children:["â€¢ ",s.size]}),e.jsxs("span",{children:["â€¢ ",s.format]})]})]})]}),e.jsxs("div",{className:"document-actions",children:[e.jsx("button",{className:"btn-action btn-download",onClick:()=>(async e=>{v(`ğŸ“¥ Download "${e.name}" wird gestartet...`);try{const s=await n(`/dokumente/${e.id}/download`);if(!s.ok)throw new Error("Download fehlgeschlagen");const t=await s.blob(),i=window.URL.createObjectURL(t),a=document.createElement("a");a.href=i,a.download=`${e.name}.pdf`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(i),document.body.removeChild(a),v(`âœ… "${e.name}" erfolgreich heruntergeladen`),await z()}catch(s){v(`âŒ Download-Fehler: ${s.message}`),console.error(s)}})(s),title:"Herunterladen",children:e.jsx(l,{size:18})}),e.jsx("button",{className:"btn-action btn-edit",onClick:()=>v(`âœï¸ Bearbeiten von "${s.name}" wird vorbereitet...`),title:"Bearbeiten",children:e.jsx(o,{size:18})}),e.jsx("button",{className:"btn-action btn-delete",onClick:()=>(async e=>{if(window.confirm("MÃ¶chten Sie dieses Dokument wirklich lÃ¶schen?")){g(!0);try{if(!(await n(`/dokumente/${e}`,{method:"DELETE"})).ok)throw new Error("LÃ¶schen fehlgeschlagen");v("âœ… Dokument erfolgreich gelÃ¶scht"),await z()}catch(s){v(`âŒ Fehler beim LÃ¶schen: ${s.message}`),console.error(s)}finally{g(!1)}}})(s.id),title:"LÃ¶schen",children:e.jsx(c,{size:18})})]})]},s.id))})}),N&&e.jsx("div",{className:"modal-overlay",onClick:()=>y(!1),children:e.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[e.jsx("h2",{children:"ğŸ“„ Dokument erstellen"}),e.jsx("p",{children:"Diese Funktion wird in KÃ¼rze verfÃ¼gbar sein."}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{className:"btn-secondary",onClick:()=>y(!1),children:"SchlieÃŸen"})})]})})]})};export{x as default};
