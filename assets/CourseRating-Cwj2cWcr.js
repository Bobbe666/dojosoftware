import{a as e,j as s}from"./query-Caj74EYQ.js";import r from"./MemberHeader-IalPk7Zc.js";import{c as a}from"./index-CREwepoQ.js";import{e as i,g as n,C as t,U as d,w as l,a4 as c,aG as h}from"./icons-DiLw-1i5.js";/* empty css                  */import"./vendor-router-Co3o87Zc.js";import"./charts-C1Gv3M_c.js";const o=()=>{const[o,m]=e.useState([]),[j,u]=e.useState(0),[x,g]=e.useState(""),[w,v]=e.useState(!0),[b,N]=e.useState(!1),[p,f]=e.useState(!1),B=e=>{const s="string"==typeof e?new Date(e):e,r=new Date,a=new Date(r.getTime()-864e5);return s.toDateString()===r.toDateString()?"Heute":s.toDateString()===a.toDateString()?"Gestern":s.toLocaleDateString("de-DE",{weekday:"short",day:"numeric",month:"short"})};if(e.useEffect(()=>{(async()=>{v(!0);try{const e=await fetch(`${a.apiBaseUrl}/mitglieder/ratable-courses`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const s=await e.json();m(s.courses||[])}else console.error("Fehler beim Laden der bewertbaren Kurse:",e.statusText),m([])}catch(e){console.error("Fehler beim Laden der Kurse:",e),m([])}finally{v(!1)}})()},[]),w)return s.jsxs("div",{className:"dashboard-container",children:[s.jsx(r,{}),s.jsx("div",{className:"dashboard-content",children:s.jsxs("div",{className:"course-rating-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("span",{children:"Lade bewertbare Kurse..."})]})})]});const S=o.filter(e=>!e.rated),k=o.filter(e=>e.rated);return s.jsxs("div",{className:"dashboard-container",children:[s.jsx(r,{}),s.jsx("div",{className:"dashboard-content",children:s.jsxs("div",{className:"course-rating",children:[s.jsx("div",{className:"rating-header",children:s.jsxs("div",{className:"header-content",children:[s.jsx(i,{size:24}),s.jsx("h1",{children:"Kurs-Bewertung"}),s.jsx("p",{children:"Wie war dein Training? Teile deine Erfahrung mit uns!"})]})}),p&&s.jsxs("div",{className:"success-message",children:[s.jsx(n,{size:20}),s.jsx("span",{children:"Vielen Dank fÃ¼r deine Bewertung! ğŸ‰"})]}),S.length>0?s.jsxs("div",{className:"ratable-courses",children:[s.jsxs("h2",{children:[s.jsx(t,{size:20}),"Bewerte deine Kurse"]}),s.jsx("div",{className:"courses-list",children:S.map(e=>s.jsxs("div",{className:"course-card",children:[s.jsxs("div",{className:"course-info",children:[s.jsxs("div",{className:"course-header",children:[s.jsx("h3",{children:e.kurs_name}),s.jsx("span",{className:"course-date",children:B(e.datum)})]}),s.jsxs("div",{className:"course-details",children:[s.jsxs("div",{className:"detail-item",children:[s.jsx(d,{size:16}),s.jsx("span",{children:e.trainer_name})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx(l,{size:16}),s.jsxs("span",{children:[e.uhrzeit," â€¢ ",e.duration," Min"]})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx(c,{size:16}),s.jsx("span",{children:e.raum})]})]})]}),s.jsxs("div",{className:"rating-section",children:[s.jsxs("div",{className:"rating-stars",children:[s.jsx("label",{children:"Wie war das Training?"}),s.jsx("div",{className:"stars",children:[1,2,3,4,5].map(e=>s.jsx("button",{className:"star "+(e<=j?"filled":""),onClick:()=>u(e),children:s.jsx(i,{size:24})},e))}),s.jsxs("div",{className:"rating-text",children:[0===j&&"Bewertung wÃ¤hlen",1===j&&"ğŸ˜ Sehr schlecht",2===j&&"ğŸ˜• Schlecht",3===j&&"ğŸ˜ Okay",4===j&&"ğŸ˜Š Gut",5===j&&"ğŸ¤© Sehr gut!"]})]}),s.jsxs("div",{className:"comment-section",children:[s.jsx("label",{children:"Optional: Kommentar hinzufÃ¼gen"}),s.jsx("textarea",{value:x,onChange:e=>g(e.target.value),placeholder:"Wie war der Trainer? Was hat dir besonders gefallen? VerbesserungsvorschlÃ¤ge?",rows:"3",maxLength:"500"}),s.jsxs("div",{className:"comment-counter",children:[x.length,"/500 Zeichen"]})]}),s.jsx("button",{className:"submit-button",onClick:()=>(async e=>{if(0!==j){N(!0);try{const s=await fetch(`${a.apiBaseUrl}/mitglieder/submit-rating`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({courseId:e,rating:j,comment:x.trim()})});if(!s.ok){const e=await s.json();throw new Error(e.message||"Fehler beim Speichern der Bewertung")}await s.json(),m(s=>s.map(s=>s.id===e?{...s,rated:!0}:s)),f(!0),u(0),g(""),setTimeout(()=>f(!1),3e3)}catch(s){console.error("Fehler beim Absenden der Bewertung:",s),alert(`Fehler beim Absenden der Bewertung: ${s.message}`)}finally{N(!1)}}else alert("Bitte wÃ¤hle eine Bewertung aus!")})(e.id),disabled:0===j||b,children:b?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"loading-spinner small"}),"Wird gesendet..."]}):s.jsxs(s.Fragment,{children:[s.jsx(h,{size:16}),"Bewertung absenden"]})})]})]},e.id))})]}):s.jsxs("div",{className:"no-ratable-courses",children:[s.jsx(i,{size:48}),s.jsx("h3",{children:"Keine Kurse zu bewerten"}),s.jsx("p",{children:"Du hast momentan keine Kurse, die bewertet werden kÃ¶nnen."})]}),k.length>0&&s.jsxs("div",{className:"rated-courses",children:[s.jsxs("h2",{children:[s.jsx(n,{size:20}),"Bereits bewertete Kurse"]}),s.jsx("div",{className:"rated-list",children:k.map(e=>s.jsxs("div",{className:"rated-card",children:[s.jsxs("div",{className:"rated-info",children:[s.jsx("h4",{children:e.kurs_name}),s.jsxs("div",{className:"rated-details",children:[s.jsx("span",{children:e.trainer_name}),s.jsx("span",{children:B(e.datum)})]})]}),s.jsxs("div",{className:"rated-status",children:[s.jsx(n,{size:16}),s.jsx("span",{children:"Bewertet"})]})]},e.id))})]}),s.jsxs("div",{className:"rating-tips",children:[s.jsx("h3",{children:"ğŸ’¡ Tipps fÃ¼r deine Bewertung"}),s.jsxs("ul",{children:[s.jsx("li",{children:"Deine Bewertung hilft uns, die Kurse zu verbessern"}),s.jsx("li",{children:"Konstruktive Kritik ist immer willkommen"}),s.jsx("li",{children:"Alle Bewertungen werden anonym an die Trainer weitergegeben"}),s.jsx("li",{children:"Du kannst nur Kurse bewerten, die du besucht hast"})]})]})]})})]})};export{o as default};
