import{a as e,j as n}from"./query-Caj74EYQ.js";import{D as r,a as t}from"./index-Bcs73ipe.js";import"./vendor-router-Co3o87Zc.js";import"./icons-DiLw-1i5.js";import"./charts-C1Gv3M_c.js";const s=()=>{const{stile:s,gruppen:l,ladeAlleDaten:a}=e.useContext(r);(s||[]).filter(e=>0!==e.aktiv&&!1!==e.aktiv);const i=l||[],[c,o]=e.useState(""),[u,p]=e.useState(""),[h,d]=e.useState(null),[g,m]=e.useState(""),[b,j]=e.useState(null),[x,v]=e.useState(""),[f,N]=e.useState([]),[k,y]=e.useState([]),w=()=>{j(null),v("")},C=async(e,n)=>{const r="up"===n?e-1:e+1;if(r<0||r>=i.length)return;const s=i[e],l=i[r];try{await Promise.all([t.put(`/gruppen/${s.gruppen_id}`,{name:s.name,reihenfolge:l.reihenfolge||r}),t.put(`/gruppen/${l.gruppen_id}`,{name:l.name,reihenfolge:s.reihenfolge||e})]),a()}catch(c){console.error("Fehler beim Verschieben der Gruppe:",c),alert("Fehler beim Verschieben.")}};return n.jsxs("div",{className:"app-container",children:[n.jsx("div",{className:"page-header",children:n.jsx("h1",{className:"page-title",children:"GRUPPEN VERWALTEN"})}),n.jsx("div",{className:"verwaltung-container",children:n.jsxs("div",{className:"glass-card",children:[n.jsx("h3",{className:"card-title",children:"GRUPPEN"}),0===i.length&&n.jsx("p",{children:"Keine Gruppen vorhanden."}),n.jsx("ul",{className:"verwaltung-liste",children:i.map((e,r)=>n.jsx("li",{className:"verwaltung-eintrag",children:b===e.gruppen_id?n.jsxs(n.Fragment,{children:[n.jsx("input",{className:"verwaltung-bearbeiten-input",type:"text",value:x,onChange:e=>v(e.target.value)}),n.jsx("button",{className:"btn btn-success",onClick:()=>(async e=>{if(x.trim())try{await t.put(`/gruppen/${e}`,{name:x.trim()}),w(),a()}catch(n){console.error("Fehler beim Bearbeiten von Gruppe:",n),alert("Fehler beim Bearbeiten der Gruppe.")}})(e.gruppen_id),children:"üíæ"}),n.jsx("button",{className:"btn btn-secondary",onClick:w,children:"‚úï"})]}):n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"checkbox",checked:k.includes(e.gruppen_id),onChange:()=>{y(n=>n.includes(e.gruppen_id)?n.filter(n=>n!==e.gruppen_id):[...n,e.gruppen_id])}}),n.jsxs("div",{className:"sort-buttons",children:[n.jsx("button",{className:"sort-btn",onClick:()=>C(r,"up"),disabled:0===r,children:"‚ñ≤"}),n.jsx("button",{className:"sort-btn",onClick:()=>C(r,"down"),disabled:r===i.length-1,children:"‚ñº"})]}),n.jsx("span",{children:e.name}),n.jsx("button",{className:"btn btn-primary",onClick:()=>(e=>{j(e.gruppen_id),v(e.name)})(e),children:"‚úèÔ∏è"}),n.jsx("button",{className:"btn btn-danger",onClick:()=>(async(e,n)=>{var r,s,l;if(console.log("L√∂schen aufgerufen:",{id:e,typ:n}),!confirm("M√∂chten Sie diesen diese Gruppe wirklich l√∂schen?"))return void console.log("L√∂schen abgebrochen durch Benutzer");try{const r=await t.delete(`/gruppen/${e}`);console.log("‚úÖ Erfolgreich gel√∂scht:",r.data),a(),alert(("stil"===n?"Stil":"Gruppe")+" wurde erfolgreich gel√∂scht (deaktiviert)!")}catch(i){if(console.error(`‚ùå Fehler beim L√∂schen von ${n}:`,i),409===(null==(r=i.response)?void 0:r.status)){const e=i.response.data.mitglieder_anzahl||"mehrere";alert(`Gruppe kann nicht gel√∂scht werden!\n\nEs sind noch ${e} aktive Mitglieder zugeordnet.\n\nBitte weisen Sie die Mitglieder einem anderen Gruppe zu oder deaktivieren Sie diese zuerst.`)}else{const e=(null==(l=null==(s=i.response)?void 0:s.data)?void 0:l.error)||i.message||"Unbekannter Fehler";alert(`Fehler beim L√∂schen: ${e}`)}}})(e.gruppen_id,"gruppe"),children:"üóëÔ∏è"})]})},e.gruppen_id))}),n.jsxs("div",{className:"verwaltung-formular",children:[n.jsx("input",{type:"text",placeholder:"Neue Gruppe eingeben",value:u,onChange:e=>p(e.target.value)}),n.jsx("button",{className:"btn btn-primary",onClick:()=>(async e=>{const n=u;if(!n.trim())return;try{await t.post("/gruppen",{name:n.trim()}),"stil"===e?o(""):p(""),a()}catch(r){console.error(`Fehler beim Hinzuf√ºgen von ${e}:`,r),alert("Fehler beim Hinzuf√ºgen.")}})("gruppe"),children:"Hinzuf√ºgen"})]}),i.length>0&&n.jsxs("div",{className:"bulk-actions",children:[n.jsx("button",{className:"btn btn-secondary",onClick:()=>{k.length===i.length?y([]):y(i.map(e=>e.gruppen_id))},children:k.length===i.length?"Alle abw√§hlen":"Alle ausw√§hlen"}),k.length>0&&n.jsxs("button",{className:"btn btn-danger",onClick:async()=>{if(0!==k.length&&confirm(`${k.length} Gruppen wirklich l√∂schen?`))try{await Promise.all(k.map(e=>t.delete(`/gruppen/${e}`))),y([]),a()}catch(e){console.error("Fehler beim L√∂schen:",e),alert("Fehler beim L√∂schen einiger Gruppen.")}},children:[k.length," l√∂schen"]})]})]})})]})};export{s as default};
