import{j as e}from"./animation-1wuIdCBS.js";import{r as s}from"./vendor-router-BhMXg4Z-.js";import{k as n,c as a,a as r}from"./index-DUnH23_2.js";import{_ as l,P as i,$ as t,N as c,a4 as o,K as d,bf as m,o as h,d as u,c as b,a as x,b as p,l as j,i as g}from"./icons-D7rg4pDH.js";const v=()=>{const[r,u]=s.useState([]),[b,x]=s.useState(!0),[p,j]=s.useState(null),[g,v]=s.useState(!1),[f,N]=s.useState({name:"",beschreibung:"",groesse:"",kapazitaet:"",farbe:"#4F46E5",aktiv:!0}),y=async()=>{try{x(!0);const e=await n(`${a.apiBaseUrl}/raeume`),s=await e.json();s.success?u(s.data):console.error("Fehler beim Laden der RÃ¤ume:",s)}catch(e){console.error("Fehler beim Laden der RÃ¤ume:",e)}finally{x(!1)}};s.useEffect(()=>{y()},[]);const k=(e,s,n)=>{u(r.map(a=>a.raum_id===e?{...a,[s]:n}:a))};return b?e.jsxs("div",{className:"raum-verwaltung loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"RÃ¤ume werden geladen..."})]}):e.jsxs("div",{className:"raum-verwaltung",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx(l,{className:"header-icon"}),e.jsxs("div",{children:[e.jsx("h2",{children:"Raumverwaltung"}),e.jsx("p",{children:"Verwalten Sie die TrainingsrÃ¤ume Ihres Dojos"})]})]}),e.jsxs("button",{className:"btn-primary",onClick:()=>v(!0),disabled:g,children:[e.jsx(i,{size:16}),"Raum hinzufÃ¼gen"]})]}),g&&e.jsxs("div",{className:"room-form-card",children:[e.jsxs("div",{className:"form-header",children:[e.jsx("h3",{children:"Neuen Raum hinzufÃ¼gen"}),e.jsx("button",{className:"btn-icon",onClick:()=>v(!1),children:e.jsx(t,{size:16})})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Raumname *"}),e.jsx("input",{type:"text",value:f.name,onChange:e=>N({...f,name:e.target.value}),placeholder:"z.B. Hauptraum, Nebenraum...",className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Beschreibung"}),e.jsx("input",{type:"text",value:f.beschreibung,onChange:e=>N({...f,beschreibung:e.target.value}),placeholder:"Kurze Beschreibung des Raums",className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"GrÃ¶ÃŸe"}),e.jsx("input",{type:"text",value:f.groesse,onChange:e=>N({...f,groesse:e.target.value}),placeholder:"z.B. 120 mÂ², GroÃŸ, Klein...",className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"KapazitÃ¤t"}),e.jsx("input",{type:"number",value:f.kapazitaet,onChange:e=>N({...f,kapazitaet:e.target.value}),placeholder:"Max. Anzahl Personen",className:"form-input",min:"1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Farbe"}),e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{type:"color",value:f.farbe,onChange:e=>N({...f,farbe:e.target.value}),className:"color-input"}),e.jsx("span",{className:"color-value",children:f.farbe})]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:f.aktiv,onChange:e=>N({...f,aktiv:e.target.checked})}),"Raum ist aktiv"]})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>v(!1),children:"Abbrechen"}),e.jsxs("button",{className:"btn-primary",onClick:async()=>{if(f.name.trim())try{const e=await n(`${a.apiBaseUrl}/raeume`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}),s=await e.json();s.success?(N({name:"",beschreibung:"",groesse:"",kapazitaet:"",farbe:"#4F46E5",aktiv:!0}),v(!1),y()):alert("Fehler beim HinzufÃ¼gen des Raums: "+s.error)}catch(e){console.error("Fehler beim HinzufÃ¼gen des Raums:",e),alert("Fehler beim HinzufÃ¼gen des Raums")}else alert("Bitte geben Sie einen Raumnamen ein")},children:[e.jsx(c,{size:16}),"Raum hinzufÃ¼gen"]})]})]}),e.jsxs("div",{className:"rooms-grid",children:[r.map(s=>e.jsxs("div",{className:`room-card ${s.aktiv?"":"inactive"} ${p===s.raum_id?"editing":""}`,children:[e.jsxs("div",{className:"room-header",children:[e.jsx("div",{className:"room-color",style:{backgroundColor:s.farbe}}),p===s.raum_id?e.jsx("input",{type:"text",value:s.name,onChange:e=>k(s.raum_id,"name",e.target.value),className:"room-name-input"}):e.jsx("h3",{className:"room-name",children:s.name}),e.jsx("div",{className:"room-actions",children:p===s.raum_id?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-icon success",onClick:()=>(async e=>{if(e.name.trim())try{const s=await n(`${a.apiBaseUrl}/raeume/${e.raum_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,beschreibung:e.beschreibung,groesse:e.groesse,kapazitaet:e.kapazitaet,farbe:e.farbe,aktiv:e.aktiv})}),r=await s.json();r.success?(j(null),y()):alert("Fehler beim Speichern des Raums: "+r.error)}catch(s){console.error("Fehler beim Speichern des Raums:",s),alert("Fehler beim Speichern des Raums")}else alert("Bitte geben Sie einen Raumnamen ein")})(s),children:e.jsx(c,{size:16})}),e.jsx("button",{className:"btn-icon",onClick:()=>j(null),children:e.jsx(t,{size:16})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-icon",onClick:()=>j(s.raum_id),children:e.jsx(o,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:()=>(async(e,s)=>{if(confirm(`MÃ¶chten Sie den Raum "${s}" wirklich lÃ¶schen?`))try{const s=await n(`${a.apiBaseUrl}/raeume/${e}`,{method:"DELETE"}),r=await s.json();r.success?y():alert("Fehler beim LÃ¶schen des Raums: "+r.error)}catch(r){console.error("Fehler beim LÃ¶schen des Raums:",r),alert("Fehler beim LÃ¶schen des Raums")}})(s.raum_id,s.name),children:e.jsx(d,{size:16})})]})})]}),p===s.raum_id?e.jsxs("div",{className:"room-edit-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Beschreibung"}),e.jsx("input",{type:"text",value:s.beschreibung||"",onChange:e=>k(s.raum_id,"beschreibung",e.target.value),className:"form-input"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"GrÃ¶ÃŸe"}),e.jsx("input",{type:"text",value:s.groesse||"",onChange:e=>k(s.raum_id,"groesse",e.target.value),className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"KapazitÃ¤t"}),e.jsx("input",{type:"number",value:s.kapazitaet||"",onChange:e=>k(s.raum_id,"kapazitaet",e.target.value),className:"form-input",min:"1"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Farbe"}),e.jsx("input",{type:"color",value:s.farbe||"#4F46E5",onChange:e=>k(s.raum_id,"farbe",e.target.value),className:"color-input"})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.aktiv,onChange:e=>k(s.raum_id,"aktiv",e.target.checked)}),"Aktiv"]})})]})]}):e.jsxs("div",{className:"room-details",children:[s.beschreibung&&e.jsx("p",{className:"room-description",children:s.beschreibung}),e.jsxs("div",{className:"room-info",children:[s.groesse&&e.jsxs("div",{className:"room-info-item",children:[e.jsx(m,{size:14}),e.jsx("span",{children:s.groesse})]}),s.kapazitaet&&e.jsxs("div",{className:"room-info-item",children:[e.jsx(h,{size:14}),e.jsxs("span",{children:[s.kapazitaet," Personen"]})]})]}),!s.aktiv&&e.jsx("div",{className:"room-status inactive",children:"Inaktiv"})]})]},s.raum_id)),0===r.length&&e.jsxs("div",{className:"empty-state",children:[e.jsx(l,{size:48}),e.jsx("h3",{children:"Keine RÃ¤ume vorhanden"}),e.jsx("p",{children:"FÃ¼gen Sie Ihren ersten Trainingsraum hinzu"}),e.jsxs("button",{className:"btn-primary",onClick:()=>v(!0),children:[e.jsx(i,{size:16}),"Ersten Raum hinzufÃ¼gen"]})]})]})]})},f=({value:n,onChange:a,placeholder:l="Finanzamt suchen...",className:i="",disabled:t=!1})=>{const[c,o]=s.useState([]),[d,m]=s.useState([]),[h,u]=s.useState(""),[b,x]=s.useState(!1),[p,j]=s.useState(!1),[g,v]=s.useState([]),[f,N]=s.useState(""),[y,k]=s.useState(!1),[z,w]=s.useState({name:"",ort:"",bundesland:"",plz:"",strasse:"",telefon:"",email:"",finanzamtnummer:""}),C=s.useRef(null),S=s.useRef(null);s.useEffect(()=>{F(),B()},[]),s.useEffect(()=>{P()},[h,f,c]),s.useEffect(()=>{const e=e=>{C.current&&!C.current.contains(e.target)&&(x(!1),k(!1))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),s.useEffect(()=>{n&&"object"==typeof n?u(`${n.name}, ${n.ort}`):"string"==typeof n&&u(n)},[n]);const F=async()=>{try{j(!0);const e=await r.get("/finanzaemter");o(e.data)}catch(e){console.error("Fehler beim Laden der FinanzÃ¤mter:",e)}finally{j(!1)}},B=async()=>{try{const e=await r.get("/finanzaemter/bundeslaender");v(e.data)}catch(e){console.error("Fehler beim Laden der BundeslÃ¤nder:",e)}},P=()=>{let e=c;if(f&&(e=e.filter(e=>e.bundesland===f)),h){const s=h.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(s)||e.ort.toLowerCase().includes(s)||e.bundesland.toLowerCase().includes(s))}m(e.slice(0,50))},R=e=>{u(`${e.name}, ${e.ort}`),a(e),x(!1),k(!1)};return e.jsxs("div",{className:`finanzamt-selector ${i}`,ref:C,children:[e.jsxs("div",{className:"finanzamt-input-container",children:[e.jsx("input",{ref:S,type:"text",value:h,onChange:e=>{const s=e.target.value;u(s),x(!0),k(!1),s||a(null)},onFocus:()=>x(!0),onKeyDown:e=>{"Escape"===e.key&&(x(!1),k(!1))},placeholder:l,disabled:t,className:"finanzamt-input"}),e.jsx("div",{className:"finanzamt-filters",children:e.jsxs("select",{value:f,onChange:e=>N(e.target.value),className:"bundesland-filter",children:[e.jsx("option",{value:"",children:"Alle BundeslÃ¤nder"}),g.map(s=>e.jsx("option",{value:s,children:s},s))]})})]}),b&&e.jsx("div",{className:"finanzamt-dropdown",children:p?e.jsx("div",{className:"loading",children:"Lade FinanzÃ¤mter..."}):e.jsxs(e.Fragment,{children:[d.length>0?e.jsx("div",{className:"finanzamt-list",children:d.map(s=>e.jsxs("div",{className:"finanzamt-item",onClick:()=>R(s),children:[e.jsx("div",{className:"finanzamt-name",children:s.name}),e.jsxs("div",{className:"finanzamt-details",children:[s.ort,", ",s.bundesland,s.finanzamtnummer&&e.jsxs("span",{className:"finanzamt-nummer",children:[" (#",s.finanzamtnummer,")"]})]})]},s.id))}):e.jsx("div",{className:"no-results",children:e.jsx("p",{children:"Keine FinanzÃ¤mter gefunden"})}),e.jsx("div",{className:"finanzamt-actions",children:e.jsx("button",{type:"button",className:"create-finanzamt-btn",onClick:()=>k(!y),children:"+ Finanzamt nicht vorhanden? Anlegen"})}),y&&e.jsxs("div",{className:"create-finanzamt-form",children:[e.jsx("h4",{children:"Neues Finanzamt anlegen"}),e.jsxs("form",{onSubmit:async e=>{var s,n;e.preventDefault();try{j(!0);const e=(await r.post("/finanzaemter",z)).data.finanzamt;o(s=>[...s,e]),R(e),w({name:"",ort:"",bundesland:"",plz:"",strasse:"",telefon:"",email:"",finanzamtnummer:""}),alert("Finanzamt erfolgreich angelegt!")}catch(a){console.error("Fehler beim Anlegen des Finanzamts:",a),alert("Fehler beim Anlegen des Finanzamts: "+((null==(n=null==(s=a.response)?void 0:s.data)?void 0:n.error)||a.message))}finally{j(!1)}},children:[e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Name des Finanzamts *",value:z.name,onChange:e=>w(s=>({...s,name:e.target.value})),required:!0}),e.jsx("input",{type:"text",placeholder:"Ort *",value:z.ort,onChange:e=>w(s=>({...s,ort:e.target.value})),required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("select",{value:z.bundesland,onChange:e=>w(s=>({...s,bundesland:e.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Bundesland auswÃ¤hlen *"}),g.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx("input",{type:"text",placeholder:"PLZ",value:z.plz,onChange:e=>w(s=>({...s,plz:e.target.value}))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"StraÃŸe und Hausnummer",value:z.strasse,onChange:e=>w(s=>({...s,strasse:e.target.value}))}),e.jsx("input",{type:"text",placeholder:"Telefon",value:z.telefon,onChange:e=>w(s=>({...s,telefon:e.target.value}))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"email",placeholder:"E-Mail",value:z.email,onChange:e=>w(s=>({...s,email:e.target.value}))}),e.jsx("input",{type:"text",placeholder:"Finanzamt-Nummer",value:z.finanzamtnummer,onChange:e=>w(s=>({...s,finanzamtnummer:e.target.value}))})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"save-btn",disabled:p,children:p?"Wird angelegt...":"Finanzamt anlegen"}),e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>k(!1),children:"Abbrechen"})]})]})]})]})})]})},N=()=>{const[r,l]=s.useState("admin"),[i,t]=s.useState([]),[c,m]=s.useState(!1),[v,f]=s.useState({text:"",type:""}),[N,y]=s.useState({admin:!0,supervisor:!0,trainer:!0,verkauf:!0}),[k,z]=s.useState(!1),[w,C]=s.useState(!1),[S,F]=s.useState(null),[B,P]=s.useState({username:"",email:"",role:""}),[R,E]=s.useState({newPassword:"",confirmPassword:""}),$=[{key:"admin",label:"Admin",icon:"ðŸ‘¨â€ðŸ’¼",color:"#3b82f6"},{key:"supervisor",label:"Supervisor",icon:"ðŸ‘”",color:"#8b5cf6"},{key:"trainer",label:"Trainer",icon:"ðŸ¥‹",color:"#10b981"},{key:"verkauf",label:"Verkauf",icon:"ðŸ’°",color:"#f59e0b"}],L=[{key:"mitglieder",label:"Mitglieder",icon:"ðŸ‘¥"},{key:"vertraege",label:"VertrÃ¤ge",icon:"ðŸ“"},{key:"finanzen",label:"Finanzen",icon:"ðŸ’°"},{key:"pruefungen",label:"PrÃ¼fungen",icon:"ðŸ¥‹"},{key:"stundenplan",label:"Stundenplan",icon:"ðŸ“…"},{key:"verkauf",label:"Verkauf/Kasse",icon:"ðŸ›’"},{key:"berichte",label:"Berichte",icon:"ðŸ“ˆ"},{key:"einstellungen",label:"Einstellungen",icon:"âš™ï¸"}],[T,U]=s.useState({admin:{mitglieder:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!0},vertraege:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!0},finanzen:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!0},pruefungen:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!0},stundenplan:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!0},verkauf:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!0},berichte:{lesen:!0,exportieren:!0},einstellungen:{lesen:!0,bearbeiten:!0}},supervisor:{mitglieder:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!1},vertraege:{lesen:!0,erstellen:!1,bearbeiten:!0,loeschen:!1},finanzen:{lesen:!0,erstellen:!1,bearbeiten:!1,loeschen:!1},pruefungen:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!1},stundenplan:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!1},verkauf:{lesen:!0,erstellen:!0,bearbeiten:!1,loeschen:!1},berichte:{lesen:!0,exportieren:!1},einstellungen:{lesen:!0,bearbeiten:!1}},trainer:{mitglieder:{lesen:!0,erstellen:!1,bearbeiten:!1,loeschen:!1},vertraege:{lesen:!1,erstellen:!1,bearbeiten:!1,loeschen:!1},finanzen:{lesen:!1,erstellen:!1,bearbeiten:!1,loeschen:!1},pruefungen:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!1},stundenplan:{lesen:!0,erstellen:!1,bearbeiten:!1,loeschen:!1},verkauf:{lesen:!1,erstellen:!1,bearbeiten:!1,loeschen:!1},berichte:{lesen:!1,exportieren:!1},einstellungen:{lesen:!1,bearbeiten:!1}},verkauf:{mitglieder:{lesen:!0,erstellen:!1,bearbeiten:!1,loeschen:!1},vertraege:{lesen:!1,erstellen:!1,bearbeiten:!1,loeschen:!1},finanzen:{lesen:!1,erstellen:!1,bearbeiten:!1,loeschen:!1},pruefungen:{lesen:!1,erstellen:!1,bearbeiten:!1,loeschen:!1},stundenplan:{lesen:!0,erstellen:!1,bearbeiten:!1,loeschen:!1},verkauf:{lesen:!0,erstellen:!0,bearbeiten:!0,loeschen:!1},berichte:{lesen:!1,exportieren:!1},einstellungen:{lesen:!1,bearbeiten:!1}}});s.useEffect(()=>{_()},[]);const _=async()=>{m(!0);try{const e=await n(`${a.apiBaseUrl}/auth/users`);if(!e.ok)throw new Error("Fehler beim Laden");const s=await e.json();t(s)}catch(e){A("Fehler beim Laden der Benutzer: "+e.message,"error")}finally{m(!1)}},A=(e,s="info")=>{f({text:e,type:s}),setTimeout(()=>f({text:"",type:""}),5e3)},K=async()=>{m(!0);try{if(!(await n(`${a.apiBaseUrl}/permissions`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({permissions:T})})).ok)throw new Error("Fehler beim Speichern");A("Berechtigungen erfolgreich gespeichert!","success")}catch(e){A("Fehler beim Speichern: "+e.message,"error")}finally{m(!1)}},M=e=>i.filter(s=>s.role===e);return e.jsxs("div",{className:"admin-verwaltung",children:[e.jsx("div",{className:"page-header",children:e.jsxs("div",{className:"header-left",children:[e.jsx(u,{size:32,className:"header-icon"}),e.jsxs("div",{children:[e.jsx("h1",{children:"Benutzerverwaltung & Berechtigungen"}),e.jsx("p",{children:"Verwalten Sie Benutzer nach Rollen und definieren Sie Zugriffsrechte"})]})]})}),v.text&&e.jsx("div",{className:`message message-${v.type}`,children:v.text}),e.jsxs("div",{className:"tabs-container",children:[$.map(s=>e.jsxs("button",{className:"tab-button "+(r===s.key?"active":""),onClick:()=>l(s.key),style:r===s.key?{borderBottomColor:s.color}:{},children:[e.jsx("span",{className:"tab-icon",children:s.icon}),s.label,e.jsx("span",{className:"tab-count",children:M(s.key).length})]},s.key)),e.jsxs("button",{className:"tab-button "+("rechte"===r?"active":""),onClick:()=>l("rechte"),children:[e.jsx(b,{size:18,className:"tab-icon"}),"Rechtezuweisung"]})]}),e.jsx("div",{className:"tab-content",children:"rechte"===r?e.jsxs("div",{className:"rechte-container",children:[e.jsxs("div",{className:"rechte-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Rechtezuweisung"}),e.jsx("p",{children:"Definiere hier die Berechtigungen fÃ¼r jede Rolle. Alle Benutzer in einer Rolle erhalten automatisch diese Rechte."})]}),e.jsxs("button",{className:"btn btn-primary",onClick:K,disabled:c,children:[e.jsx(u,{size:18}),c?"Speichern...":"Berechtigungen speichern"]})]}),$.map(s=>e.jsxs("div",{className:"rolle-section",children:[e.jsxs("div",{className:"rolle-header clickable",style:{borderLeftColor:s.color},onClick:()=>{return e=s.key,void y(s=>({...s,[e]:!s[e]}));var e},children:[e.jsx("span",{className:"rolle-icon",children:s.icon}),e.jsx("h3",{children:s.label}),e.jsx("div",{className:"rolle-toggle",children:N[s.key]?e.jsx(x,{size:20}):e.jsx(p,{size:20})})]}),N[s.key]&&e.jsx("div",{className:"berechtigungen-grid",children:L.map(n=>e.jsxs("div",{className:"berechtigungs-card",children:[e.jsxs("div",{className:"bereich-header",children:[e.jsx("span",{className:"bereich-icon",children:n.icon}),e.jsx("h4",{children:n.label})]}),e.jsx("div",{className:"aktionen-checkboxes",children:["lesen","erstellen","bearbeiten","loeschen","exportieren"].map(a=>{var r,l;if("berichte"===n.key&&!["lesen","exportieren"].includes(a))return null;if("einstellungen"===n.key&&!["lesen","bearbeiten"].includes(a))return null;const i=(null==(l=null==(r=T[s.key])?void 0:r[n.key])?void 0:l[a])||!1;return e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:e=>((e,s,n,a)=>{U(r=>({...r,[e]:{...r[e],[s]:{...r[e][s],[n]:a}}}))})(s.key,n.key,a,e.target.checked)}),e.jsx("span",{children:a.charAt(0).toUpperCase()+a.slice(1)})]},a)})})]},n.key))})]},s.key))]}):(s=>{const r=M(s),l=$.find(e=>e.key===s);return e.jsxs("div",{className:"users-container",children:[e.jsxs("div",{className:"users-header",children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{color:l.color},children:[l.icon," ",l.label]}),e.jsxs("p",{children:[r.length," Benutzer mit dieser Rolle"]})]}),e.jsxs("button",{className:"btn btn-primary",children:[e.jsx(j,{size:18}),"Benutzer hinzufÃ¼gen"]})]}),0===r.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(h,{size:48}),e.jsxs("p",{children:['Keine Benutzer mit der Rolle "',l.label,'"']})]}):e.jsx("div",{className:"users-grid",children:r.map(s=>{var r,i;return e.jsxs("div",{className:"user-card",children:[e.jsx("div",{className:"user-avatar",style:{background:l.color},children:((null==(r=s.vorname)?void 0:r[0])||(null==(i=s.username)?void 0:i[0])||"U").toUpperCase()}),e.jsxs("div",{className:"user-info",children:[e.jsxs("h3",{children:[s.vorname," ",s.nachname]}),e.jsxs("p",{className:"username",children:["@",s.username]}),e.jsx("p",{className:"email",children:s.email})]}),e.jsxs("div",{className:"user-actions",children:[e.jsx("button",{className:"btn-icon",title:"Bearbeiten",onClick:()=>(e=>{F(e),P({username:e.username,email:e.email,role:e.role}),z(!0)})(s),children:e.jsx(o,{size:16})}),e.jsx("button",{className:"btn-icon",title:"Passwort Ã¤ndern",onClick:()=>(e=>{F(e),E({newPassword:"",confirmPassword:""}),C(!0)})(s),children:e.jsx(g,{size:16})}),e.jsx("button",{className:"btn-icon btn-danger",title:"LÃ¶schen",onClick:()=>(async e=>{if(1===e.id)return void A("Super-Admin kann nicht gelÃ¶scht werden","error");if(window.confirm(`MÃ¶chten Sie den Benutzer "${e.username}" (${e.email}) wirklich lÃ¶schen?\n\nDieser Vorgang kann nicht rÃ¼ckgÃ¤ngig gemacht werden!`)){m(!0);try{const s=await n(`${a.apiBaseUrl}/auth/users/${e.id}`,{method:"DELETE"}),r=await s.json();if(!s.ok)throw new Error(r.error||"Fehler beim LÃ¶schen");A(r.message||"Benutzer erfolgreich gelÃ¶scht","success"),_()}catch(s){A(s.message,"error")}finally{m(!1)}}})(s),children:e.jsx(d,{size:16})})]})]},s.id)})})]})})(r)}),k&&e.jsx("div",{className:"modal-overlay",onClick:()=>z(!1),children:e.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Benutzer bearbeiten"}),e.jsx("button",{className:"modal-close",onClick:()=>z(!1),children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Benutzername"}),e.jsx("input",{type:"text",value:B.username,onChange:e=>P({...B,username:e.target.value}),placeholder:"Benutzername"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"E-Mail"}),e.jsx("input",{type:"email",value:B.email,onChange:e=>P({...B,email:e.target.value}),placeholder:"E-Mail"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Rolle"}),e.jsxs("select",{value:B.role,onChange:e=>P({...B,role:e.target.value}),children:[e.jsx("option",{value:"",children:"Rolle wÃ¤hlen..."}),$.map(s=>e.jsxs("option",{value:s.key,children:[s.icon," ",s.label]},s.key))]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>z(!1),children:"Abbrechen"}),e.jsx("button",{className:"btn btn-primary",onClick:async()=>{if(B.username&&B.email&&B.role){m(!0);try{const e=await n(`${a.apiBaseUrl}/auth/users/${S.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)}),s=await e.json();if(!e.ok)throw new Error(s.error||"Fehler beim Speichern");A(s.message||"Benutzer erfolgreich aktualisiert","success"),z(!1),_()}catch(e){A(e.message,"error")}finally{m(!1)}}else A("Bitte alle Felder ausfÃ¼llen","error")},disabled:c,children:c?"Speichern...":"Speichern"})]})]})}),w&&e.jsx("div",{className:"modal-overlay",onClick:()=>C(!1),children:e.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Passwort zurÃ¼cksetzen"}),e.jsx("button",{className:"modal-close",onClick:()=>C(!1),children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{className:"modal-info",children:["Passwort fÃ¼r: ",e.jsx("strong",{children:null==S?void 0:S.username})," (",null==S?void 0:S.email,")"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Neues Passwort"}),e.jsx("input",{type:"password",value:R.newPassword,onChange:e=>E({...R,newPassword:e.target.value}),placeholder:"Mindestens 6 Zeichen"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Passwort wiederholen"}),e.jsx("input",{type:"password",value:R.confirmPassword,onChange:e=>E({...R,confirmPassword:e.target.value}),placeholder:"Passwort wiederholen"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>C(!1),children:"Abbrechen"}),e.jsx("button",{className:"btn btn-primary",onClick:async()=>{if(R.newPassword&&R.confirmPassword)if(R.newPassword===R.confirmPassword)if(R.newPassword.length<6)A("Passwort muss mindestens 6 Zeichen lang sein","error");else{m(!0);try{const e=await n(`${a.apiBaseUrl}/auth/users/${S.id}/password`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({newPassword:R.newPassword})}),s=await e.json();if(!e.ok)throw new Error(s.error||"Fehler beim ZurÃ¼cksetzen");A(s.message||"Passwort erfolgreich zurÃ¼ckgesetzt","success"),C(!1),E({newPassword:"",confirmPassword:""})}catch(e){A(e.message,"error")}finally{m(!1)}}else A("PasswÃ¶rter stimmen nicht Ã¼berein","error");else A("Bitte beide Felder ausfÃ¼llen","error")},disabled:c,children:c?"ZurÃ¼cksetzen...":"Passwort zurÃ¼cksetzen"})]})]})})]})};export{N as A,f as F,v as R};
