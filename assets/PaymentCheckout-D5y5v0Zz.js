import{b as e,a as n,j as t}from"./query-Caj74EYQ.js";import{u as r,a,c as o}from"./index-DJzZu8AC.js";import{P as s}from"./index-DQBxRuql.js";import{q as i,k as c,a0 as l,_ as u,as as d,g as p,i as f}from"./icons-DiLw-1i5.js";import{e as h,f as m,u as y}from"./vendor-router-Co3o87Zc.js";import"./charts-C1Gv3M_c.js";function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var g,b="clover",j="https://js.stripe.com",x="".concat(j,"/").concat(b,"/stripe.js"),E=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,S=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,w=function(e){return E.test(e)||S.test(e)},N=function(e){var n=document.createElement("script");n.src="".concat(x).concat("");var t=document.head||document.body;if(!t)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return t.appendChild(n),n},P=null,k=null,O=null,C=function(e){return null!==P?P:(P=new Promise(function(n,t){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe)n(window.Stripe);else try{var r=function(){for(var e=document.querySelectorAll('script[src^="'.concat(j,'"]')),n=0;n<e.length;n++){var t=e[n];if(w(t.src))return t}return null}();if(r&&e);else if(r){if(r&&null!==O&&null!==k){var a;r.removeEventListener("load",O),r.removeEventListener("error",k),null===(a=r.parentNode)||void 0===a||a.removeChild(r),r=N()}}else r=N();O=function(e,n){return function(){window.Stripe?e(window.Stripe):n(new Error("Stripe.js not available"))}}(n,t),k=function(e){return function(n){e(new Error("Failed to load Stripe.js",{cause:n}))}}(t),r.addEventListener("load",O),r.addEventListener("error",k)}catch(o){return void t(o)}else n(null)})).catch(function(e){return P=null,Promise.reject(e)})},I=!1,A=function(){return g||(g=C(null).catch(function(e){return g=null,Promise.reject(e)}))};Promise.resolve().then(function(){return A()}).catch(function(e){I||console.warn(e)});var R=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];I=!0;var r=Date.now();return A().then(function(e){return function(e,n,t){if(null===e)return null;var r=n[0];if("string"!=typeof r)throw new Error("Expected publishable key to be of type string, got type ".concat(v(r)," instead."));var a=r.match(/^pk_test/),o=function(e){return 3===e?"v3":e}(e.version),s=b;a&&o!==s&&console.warn("Stripe.js@".concat(o," was loaded on the page, but @stripe/stripe-js@").concat("8.7.0"," expected Stripe.js@").concat(s,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var i=e.apply(void 0,n);return function(e,n){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"8.7.0",startTime:n})}(i,t),i}(e,n,r)})};function T(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function D(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?T(Object(t),!0).forEach(function(n){L(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):T(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function B(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}function F(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==t)return;var r,a,o=[],s=!0,i=!1;try{for(t=t.call(e);!(s=(r=t.next()).done)&&(o.push(r.value),!n||o.length!==n);s=!0);}catch(c){i=!0,a=c}finally{try{s||null==t.return||t.return()}finally{if(i)throw a}}return o}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return _(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var U=function(n,t,r){var a=!!r,o=e.useRef(r);e.useEffect(function(){o.current=r},[r]),e.useEffect(function(){if(!a||!n)return function(){};var e=function(){o.current&&o.current.apply(o,arguments)};return n.on(t,e),function(){n.off(t,e)}},[a,t,n,o])},$=function(n){var t=e.useRef(n);return e.useEffect(function(){t.current=n},[n]),t.current},Z=function(e){return null!==e&&"object"===z(e)},M="[object Object]",q=function e(n,t){if(!Z(n)||!Z(t))return n===t;var r=Array.isArray(n);if(r!==Array.isArray(t))return!1;var a=Object.prototype.toString.call(n)===M;if(a!==(Object.prototype.toString.call(t)===M))return!1;if(!a&&!r)return n===t;var o=Object.keys(n),s=Object.keys(t);if(o.length!==s.length)return!1;for(var i={},c=0;c<o.length;c+=1)i[o[c]]=!0;for(var l=0;l<s.length;l+=1)i[s[l]]=!0;var u=Object.keys(i);if(u.length!==o.length)return!1;var d=n,p=t;return u.every(function(n){return e(d[n],p[n])})},G=function(e,n,t){return Z(e)?Object.keys(e).reduce(function(r,a){var o=!Z(n)||!q(e[a],n[a]);return t.includes(a)?(o&&console.warn("Unsupported prop change: options.".concat(a," is not a mutable property.")),r):o?D(D({},r||{}),{},L({},a,e[a])):r},null):null},K="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",V=function(e){var n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K;if(null===e||Z(n=e)&&"function"==typeof n.elements&&"function"==typeof n.createToken&&"function"==typeof n.createPaymentMethod&&"function"==typeof n.confirmCardPayment)return e;throw new Error(t)},Y=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K;if(function(e){return Z(e)&&"function"==typeof e.then}(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(e){return V(e,n)})};var t=V(e,n);return null===t?{tag:"empty"}:{tag:"sync",stripe:t}},J=e.createContext(null);J.displayName="ElementsContext";var W=function(e,n){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(n," in an <Elements> provider."));return e},H=function(n){var t=n.stripe,r=n.options,a=n.children,o=e.useMemo(function(){return Y(t)},[t]),s=F(e.useState(function(){return{stripe:"sync"===o.tag?o.stripe:null,elements:"sync"===o.tag?o.stripe.elements(r):null}}),2),i=s[0],c=s[1];e.useEffect(function(){var e=!0,n=function(e){c(function(n){return n.stripe?n:{stripe:e,elements:e.elements(r)}})};return"async"!==o.tag||i.stripe?"sync"!==o.tag||i.stripe||n(o.stripe):o.stripePromise.then(function(t){t&&e&&n(t)}),function(){e=!1}},[o,i,r]);var l=$(t);e.useEffect(function(){null!==l&&l!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[l,t]);var u=$(r);return e.useEffect(function(){if(i.elements){var e=G(r,u,["clientSecret","fonts"]);e&&i.elements.update(e)}},[r,u,i.elements]),e.useEffect(function(){var e;(e=i.stripe)&&e._registerWrapper&&e.registerAppInfo&&(e._registerWrapper({name:"react-stripe-js",version:"5.6.0"}),e.registerAppInfo({name:"react-stripe-js",version:"5.6.0",url:"https://stripe.com/docs/stripe-js/react"}))},[i.stripe]),e.createElement(J.Provider,{value:i},a)};H.propTypes={stripe:s.any,options:s.object};var X=function(){var n,t;return(n="calls useElements()",t=e.useContext(J),W(t,n)).elements};s.func.isRequired;var Q=e.createContext(null);Q.displayName="CheckoutContext",s.any,s.shape({clientSecret:s.oneOfType([s.string,s.instanceOf(Promise)]).isRequired,elementsOptions:s.object}).isRequired;var ee=function(n){var t=e.useContext(Q),r=e.useContext(J);if(t){if(r)throw new Error("You cannot wrap the part of your app that ".concat(n," in both <CheckoutProvider> and <Elements> providers."));return t}return W(r,n)},ne=["mode"],te=function(n,t){var r,a="".concat((r=n).charAt(0).toUpperCase()+r.slice(1),"Element"),o=t?function(n){ee("mounts <".concat(a,">"));var t=n.id,r=n.className;return e.createElement("div",{id:t,className:r})}:function(t){var r,o=t.id,s=t.className,i=t.options,c=void 0===i?{}:i,l=t.onBlur,u=t.onFocus,d=t.onReady,p=t.onChange,f=t.onEscape,h=t.onClick,m=t.onLoadError,y=t.onLoaderStart,v=t.onNetworksChange,g=t.onConfirm,b=t.onCancel,j=t.onShippingAddressChange,x=t.onShippingRateChange,E=t.onSavedPaymentMethodRemove,S=t.onSavedPaymentMethodUpdate,w=ee("mounts <".concat(a,">")),N="elements"in w?w.elements:null,P="checkoutState"in w?w.checkoutState:null,k="success"===(null==P?void 0:P.type)||"loading"===(null==P?void 0:P.type)?P.sdk:null,O=F(e.useState(null),2),C=O[0],I=O[1],A=e.useRef(null),R=e.useRef(null);U(C,"blur",l),U(C,"focus",u),U(C,"escape",f),U(C,"click",h),U(C,"loaderror",m),U(C,"loaderstart",y),U(C,"networkschange",v),U(C,"confirm",g),U(C,"cancel",b),U(C,"shippingaddresschange",j),U(C,"shippingratechange",x),U(C,"savedpaymentmethodremove",E),U(C,"savedpaymentmethodupdate",S),U(C,"change",p),d&&(r="expressCheckout"===n?d:function(){d(C)}),U(C,"ready",r),e.useLayoutEffect(function(){if(null===A.current&&null!==R.current&&(N||k)){var e=null;if(k)switch(n){case"paymentForm":e=k.createPaymentFormElement(c);break;case"payment":e=k.createPaymentElement(c);break;case"address":if(!("mode"in c))throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");var t=c.mode,r=B(c,ne);if("shipping"===t)e=k.createShippingAddressElement(r);else{if("billing"!==t)throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.");e=k.createBillingAddressElement(r)}break;case"expressCheckout":e=k.createExpressCheckoutElement(c);break;case"currencySelector":e=k.createCurrencySelectorElement();break;case"taxId":e=k.createTaxIdElement(c);break;default:throw new Error("Invalid Element type ".concat(a,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else N&&(e=N.create(n,c));A.current=e,I(e),e&&e.mount(R.current)}},[N,k,c]);var T=$(c);return e.useEffect(function(){if(A.current){var e=G(c,T,["paymentRequest"]);e&&"update"in A.current&&A.current.update(e)}},[c,T]),e.useLayoutEffect(function(){return function(){if(A.current&&"function"==typeof A.current.destroy)try{A.current.destroy(),A.current=null}catch(e){}}},[]),e.createElement("div",{id:o,className:s,ref:R})};return o.propTypes={id:s.string,className:s.string,onChange:s.func,onBlur:s.func,onFocus:s.func,onReady:s.func,onEscape:s.func,onClick:s.func,onLoadError:s.func,onLoaderStart:s.func,onNetworksChange:s.func,onConfirm:s.func,onCancel:s.func,onShippingAddressChange:s.func,onShippingRateChange:s.func,onSavedPaymentMethodRemove:s.func,onSavedPaymentMethodUpdate:s.func,options:s.object},o.displayName=a,o.__elementType=n,o},re="undefined"==typeof window;e.createContext(null).displayName="EmbeddedCheckoutProviderContext";te("auBankAccount",re),te("card",re),te("cardNumber",re),te("cardExpiry",re),te("cardCvc",re),te("iban",re);var ae=te("payment",re);te("expressCheckout",re),te("paymentRequestButton",re),te("linkAuthentication",re),te("address",re),te("shippingAddress",re),te("paymentMethodMessaging",re),te("taxId",re);let oe=null;const se=({amount:e,currency:r,rechnungId:a,onSuccess:o,onError:s})=>{const u=ee("calls useStripe()").stripe,d=X(),[p,f]=n.useState(!1),[h,m]=n.useState(null);return t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),u&&d){f(!0),m(null);try{const{error:e}=await d.submit();if(e)return m(e.message),void f(!1);const{error:n,paymentIntent:t}=await u.confirmPayment({elements:d,confirmParams:{return_url:`${window.location.origin}/zahlung/${a}?status=success`},redirect:"if_required"});n?(m(n.message),null==s||s(n)):t&&"succeeded"===t.status&&(null==o||o({id:t.id,status:t.status}))}catch(n){console.error("Stripe Error:",n),m(n.message),null==s||s(n)}finally{f(!1)}}},className:"stripe-form",children:[t.jsx("div",{className:"stripe-element-container",children:t.jsx(ae,{options:{layout:"tabs",paymentMethodOrder:["card","sepa_debit"],defaultValues:{billingDetails:{address:{country:"DE"}}}}})}),h&&t.jsxs("div",{className:"stripe-error",children:[t.jsx(c,{size:16}),t.jsx("span",{children:h})]}),t.jsx("button",{type:"submit",disabled:!u||p,className:"stripe-submit-btn",children:p?t.jsxs(t.Fragment,{children:[t.jsx(i,{className:"spin",size:18}),"Wird verarbeitet..."]}):t.jsxs(t.Fragment,{children:[t.jsx(l,{size:18}),e.toLocaleString("de-DE",{style:"currency",currency:r.toUpperCase()})," bezahlen"]})})]})},ie=({amount:e,currency:s="eur",rechnungId:l,onSuccess:u,onError:d})=>{const{token:p}=r(),[f,h]=n.useState(null),[m,y]=n.useState(!1),[v,g]=n.useState(!0),[b,j]=n.useState(null),[x,E]=n.useState(null);n.useEffect(()=>{S()},[]);const S=async()=>{var n,t,r;g(!0),j(null);try{const t=await(async e=>{var n,t;if(!oe)try{const r=null==(t=null==(n=(await a.get(`${o.apiBaseUrl}/payment-provider/status`,{headers:{Authorization:`Bearer ${e}`}})).data)?void 0:n.stripe)?void 0:t.publishable_key;if(!r)return console.error("Stripe publishable key nicht gefunden"),null;oe=R(r)}catch(r){return console.error("Fehler beim Laden des Stripe Keys:",r),null}return oe})(p);if(!t)return j("Stripe konnte nicht initialisiert werden. Bitte prüfen Sie die Konfiguration."),void g(!1);E(t);const r=await a.post(`${o.apiBaseUrl}/payment-provider/payment-intent`,{amount:Math.round(100*e),currency:s,rechnung_id:l,description:`Rechnung #${l}`},{headers:{Authorization:`Bearer ${p}`}});(null==(n=r.data)?void 0:n.client_secret)?(h(r.data.client_secret),y(!0)):j("Payment Intent konnte nicht erstellt werden")}catch(i){console.error("Stripe Init Error:",i),j((null==(r=null==(t=i.response)?void 0:t.data)?void 0:r.error)||"Fehler beim Initialisieren der Zahlung"),null==d||d(i)}finally{g(!1)}};if(v)return t.jsxs("div",{className:"stripe-loading",children:[t.jsx(i,{className:"spin",size:32}),t.jsx("p",{children:"Zahlungsformular wird geladen..."})]});if(b)return t.jsxs("div",{className:"stripe-init-error",children:[t.jsx(c,{size:24}),t.jsx("p",{children:b}),t.jsx("button",{onClick:S,className:"btn-retry",children:"Erneut versuchen"})]});if(!m||!f||!x)return t.jsxs("div",{className:"stripe-not-ready",children:[t.jsx(c,{size:24}),t.jsx("p",{children:"Stripe Checkout ist nicht verfügbar"})]});const w={clientSecret:f,appearance:{theme:"stripe",variables:{colorPrimary:"#FFD700",colorBackground:"#1e293b",colorText:"#ffffff",colorDanger:"#ef4444",fontFamily:"Inter, system-ui, sans-serif",borderRadius:"8px"},rules:{".Input":{backgroundColor:"#334155",border:"1px solid #475569",color:"#ffffff"},".Input:focus":{borderColor:"#FFD700",boxShadow:"0 0 0 2px rgba(255, 215, 0, 0.2)"},".Label":{color:"#94a3b8"},".Tab":{backgroundColor:"#1e293b",border:"1px solid #334155",color:"#94a3b8"},".Tab--selected":{backgroundColor:"#334155",borderColor:"#FFD700",color:"#ffffff"},".Tab:hover":{backgroundColor:"#334155"}}},locale:"de"};return t.jsx(H,{stripe:x,options:w,children:t.jsx(se,{amount:e,currency:s,rechnungId:l,onSuccess:u,onError:d})})};
/*!
 * react-paypal-js v8.9.2 (2025-10-02T20:17:55.069Z)
 * Copyright 2020-present, PayPal, Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ce,le,ue,de,pe,fe;(le=ce||(ce={})).INITIAL="initial",le.PENDING="pending",le.REJECTED="rejected",le.RESOLVED="resolved",(de=ue||(ue={})).LOADING_STATUS="setLoadingStatus",de.RESET_OPTIONS="resetOptions",de.SET_BRAINTREE_INSTANCE="braintreeInstance",(fe=pe||(pe={})).NUMBER="number",fe.CVV="cvv",fe.EXPIRATION_DATE="expirationDate",fe.EXPIRATION_MONTH="expirationMonth",fe.EXPIRATION_YEAR="expirationYear",fe.POSTAL_CODE="postalCode";var he=function(){return he=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},he.apply(this,arguments)};function me(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)n.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(t[r[a]]=e[r[a]])}return t}function ye(e,n,t){if(t||2===arguments.length)for(var r,a=0,o=n.length;a<o;a++)!r&&a in n||(r||(r=Array.prototype.slice.call(n,0,a)),r[a]=n[a]);return e.concat(r||Array.prototype.slice.call(n))}"function"==typeof SuppressedError&&SuppressedError;var ve="data-react-paypal-script-id",ge="dataJsSdkLibrary",be="react-paypal-js",je="dataNamespace",xe="dataSdkIntegrationSource",Ee="paypal";function Se(e){var n=e,t=ve;n[t];var r=me(n,[t+""]);return"react-paypal-js-".concat(function(e){for(var n="",t=0;t<e.length;t++){var r=e[t].charCodeAt(0)*t;e[t+1]&&(r+=e[t+1].charCodeAt(0)*(t-1)),n+=String.fromCharCode(97+Math.abs(r)%26)}return n}(JSON.stringify(r)))}function we(e,n){var t,r,a,o;switch(n.type){case ue.LOADING_STATUS:return"object"==typeof n.value?he(he({},e),{loadingStatus:n.value.state,loadingStatusErrorMessage:n.value.message}):he(he({},e),{loadingStatus:n.value});case ue.RESET_OPTIONS:return a=e.options[ve],(null==(o=self.document.querySelector("script[".concat(ve,'="').concat(a,'"]')))?void 0:o.parentNode)&&o.parentNode.removeChild(o),he(he({},e),{loadingStatus:ce.PENDING,options:he(he((t={},t[xe]=be,t),n.value),(r={},r[ve]="".concat(Se(n.value)),r))});case ue.SET_BRAINTREE_INSTANCE:return he(he({},e),{braintreePayPalCheckoutInstance:n.value});default:return e}}var Ne=n.createContext(null);function Pe(){var e=function(e){if("function"==typeof(null==e?void 0:e.dispatch)&&0!==e.dispatch.length)return e;throw new Error("usePayPalScriptReducer must be used within a PayPalScriptProvider")}(n.useContext(Ne));return[he(he({},e),{isInitial:e.loadingStatus===ce.INITIAL,isPending:e.loadingStatus===ce.PENDING,isResolved:e.loadingStatus===ce.RESOLVED,isRejected:e.loadingStatus===ce.REJECTED}),e.dispatch]}n.createContext({});var ke=function(t){var r,a,o,s=t.className,i=void 0===s?"":s,c=t.disabled,l=void 0!==c&&c,u=t.children,d=t.forceReRender,p=void 0===d?[]:d,f=me(t,["className","disabled","children","forceReRender"]),h=l?{opacity:.38}:{},m="".concat(i," ").concat(l?"paypal-buttons-disabled":"").trim(),y=n.useRef(null),v=n.useRef(null),g=(a=f,o=n.useRef(new Proxy({},{get:function(e,n,t){return"function"==typeof e[n]?function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e[n].apply(e,t)}:Reflect.get(e,n,t)}})),o.current=Object.assign(o.current,a),o.current),b=Pe()[0],j=b.isResolved,x=b.options,E=n.useState(null),S=E[0],w=E[1],N=n.useState(!0),P=N[0],k=N[1],O=n.useState(null)[1];function C(){null!==v.current&&v.current.close().catch(function(){})}return(null===(r=v.current)||void 0===r?void 0:r.updateProps)&&v.current.updateProps({message:f.message}),n.useEffect(function(){if(!1===j)return C;var e,n=(void 0===(e=x.dataNamespace)&&(e=Ee),window[e]);if(void 0===n||void 0===n.Buttons)return O(function(){throw new Error(function(e){var n=e.reactComponentName,t=e.sdkComponentKey,r=e.sdkRequestedComponents,a=void 0===r?"":r,o=e.sdkDataNamespace,s=void 0===o?Ee:o,i=t.charAt(0).toUpperCase().concat(t.substring(1)),c="Unable to render <".concat(n," /> because window.").concat(s,".").concat(i," is undefined."),l="string"==typeof a?a:a.join(",");if(!l.includes(t)){var u=[l,t].filter(Boolean).join();c+="\nTo fix the issue, add '".concat(t,"' to the list of components passed to the parent PayPalScriptProvider:")+"\n`<PayPalScriptProvider options={{ components: '".concat(u,"'}}>`.")}return c}({reactComponentName:ke.displayName,sdkComponentKey:"buttons",sdkRequestedComponents:x.components,sdkDataNamespace:x[je]}))}),C;try{v.current=n.Buttons(he(he({},g),{onInit:function(e,n){w(n),"function"==typeof f.onInit&&f.onInit(e,n)}}))}catch(t){return O(function(){throw new Error("Failed to render <PayPalButtons /> component. Failed to initialize:  ".concat(t))})}return!1===v.current.isEligible()?(k(!1),C):y.current?(v.current.render(y.current).catch(function(e){null!==y.current&&0!==y.current.children.length&&O(function(){throw new Error("Failed to render <PayPalButtons /> component. ".concat(e))})}),C):C},ye(ye([j],p,!0),[f.fundingSource],!1)),n.useEffect(function(){null!==S&&(!0===l?S.disable().catch(function(){}):S.enable().catch(function(){}))},[l,S]),e.createElement(e.Fragment,null,P?e.createElement("div",{ref:y,style:h,className:m}):u)};function Oe(e){var n=e.sdkBaseUrl,t=e.environment,r=function(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)n.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(t[r[a]]=e[r[a]])}return t}(e,["sdkBaseUrl","environment"]),a=n||function(e){return"sandbox"===e?"https://www.sandbox.paypal.com/sdk/js":"https://www.paypal.com/sdk/js"}(t),o=r,s=Object.keys(o).filter(function(e){return void 0!==o[e]&&null!==o[e]&&""!==o[e]}).reduce(function(e,n){var t,r=o[n].toString();return t=function(e,n){return(n?"-":"")+e.toLowerCase()},"data"===(n=n.replace(/[A-Z]+(?![a-z])|[A-Z]/g,t)).substring(0,4)||"crossorigin"===n?e.attributes[n]=r:e.queryParams[n]=r,e},{queryParams:{},attributes:{}}),i=s.queryParams,c=s.attributes;return i["merchant-id"]&&-1!==i["merchant-id"].indexOf(",")&&(c["data-merchant-id"]=i["merchant-id"],i["merchant-id"]="*"),{url:"".concat(a,"?").concat(Ce(i)),attributes:c}}function Ce(e){var n="";return Object.keys(e).forEach(function(t){0!==n.length&&(n+="&"),n+=t+"="+e[t]}),n}function Ie(e,n){void 0===n&&(n={});var t=document.createElement("script");return t.src=e,Object.keys(n).forEach(function(e){t.setAttribute(e,n[e]),"data-csp-nonce"===e&&t.setAttribute("nonce",n["data-csp-nonce"])}),t}function Ae(e,n){if(void 0===n&&(n=Promise),Te(e,n),"undefined"==typeof document)return n.resolve(null);var t=Oe(e),r=t.url,a=t.attributes,o=a["data-namespace"]||"paypal",s=Re(o);return a["data-js-sdk-library"]||(a["data-js-sdk-library"]="paypal-js"),function(e,n){var t=document.querySelector('script[src="'.concat(e,'"]'));if(null===t)return null;var r=Ie(e,n),a=t.cloneNode();if(delete a.dataset.uidAuto,Object.keys(a.dataset).length!==Object.keys(r.dataset).length)return null;var o=!0;return Object.keys(a.dataset).forEach(function(e){a.dataset[e]!==r.dataset[e]&&(o=!1)}),o?t:null}(r,a)&&s?n.resolve(s):function(e,n){void 0===n&&(n=Promise);Te(e,n);var t=e.url,r=e.attributes;if("string"!=typeof t||0===t.length)throw new Error("Invalid url.");if(void 0!==r&&"object"!=typeof r)throw new Error("Expected attributes to be an object.");return new n(function(e,n){if("undefined"==typeof document)return e();!function(e){var n=e.url,t=e.attributes,r=e.onSuccess,a=e.onError,o=Ie(n,t);o.onerror=a,o.onload=r,document.head.insertBefore(o,document.head.firstElementChild)}({url:t,attributes:r,onSuccess:function(){return e()},onError:function(){var e=new Error('The script "'.concat(t,'" failed to load. Check the HTTP status code and response body in DevTools to learn more.'));return n(e)}})})}({url:r,attributes:a},n).then(function(){var e=Re(o);if(e)return e;throw new Error("The window.".concat(o," global variable is not available."))})}function Re(e){return window[e]}function Te(e,n){if("object"!=typeof e||null===e)throw new Error("Expected an options object.");var t=e.environment;if(t&&"production"!==t&&"sandbox"!==t)throw new Error('The `environment` option must be either "production" or "sandbox".');if(void 0!==n&&"function"!=typeof n)throw new Error("Expected PromisePonyfill to be a function.")}ke.displayName="PayPalButtons","function"==typeof SuppressedError&&SuppressedError;var De=function(t){var r,a=t.options,o=void 0===a?{clientId:"test"}:a,s=t.children,i=t.deferLoading,c=void 0!==i&&i,l=n.useReducer(we,{options:he(he({},o),(r={},r[ge]=be,r[xe]=be,r[ve]="".concat(Se(o)),r)),loadingStatus:c?ce.INITIAL:ce.PENDING}),u=l[0],d=l[1];return n.useEffect(function(){if(!1===c&&u.loadingStatus===ce.INITIAL)return d({type:ue.LOADING_STATUS,value:ce.PENDING});if(u.loadingStatus===ce.PENDING){var e=!0;return Ae(u.options).then(function(){e&&d({type:ue.LOADING_STATUS,value:ce.RESOLVED})}).catch(function(n){console.error("".concat("Failed to load the PayPal JS SDK script."," ").concat(n)),e&&d({type:ue.LOADING_STATUS,value:{state:ce.REJECTED,message:String(n)}})}),function(){e=!1}}},[u.options,c,u.loadingStatus]),e.createElement(Ne.Provider,{value:he(he({},u),{dispatch:d})},s)};function ze(){}n.createContext({cardFieldsForm:null,fields:{},registerField:ze,unregisterField:ze});const Le=({amount:e,currency:s="EUR",rechnungId:l,description:u,onSuccess:d,onError:p})=>{const{token:f}=r(),[h,m]=n.useState(!0),[y,v]=n.useState(null),[g,b]=n.useState(null),[j,x]=n.useState(!0);n.useEffect(()=>{E()},[]);const E=async()=>{var e,n,t,r;m(!0),v(null);try{const s=await a.get(`${o.apiBaseUrl}/integrations/status`,{headers:{Authorization:`Bearer ${f}`}});(null==(n=null==(e=s.data)?void 0:e.paypal)?void 0:n.configured)&&(null==(r=null==(t=s.data)?void 0:t.paypal)?void 0:r.client_id)?(b(s.data.paypal.client_id),x(!1!==s.data.paypal.sandbox)):v("PayPal ist nicht konfiguriert")}catch(s){console.error("PayPal Config Error:",s),v("Fehler beim Laden der PayPal-Konfiguration")}finally{m(!1)}};if(h)return t.jsxs("div",{className:"paypal-loading",children:[t.jsx(i,{className:"spin",size:32}),t.jsx("p",{children:"PayPal wird geladen..."})]});if(y||!g)return t.jsxs("div",{className:"paypal-error",children:[t.jsx(c,{size:24}),t.jsx("p",{children:y||"PayPal ist nicht verfügbar"}),t.jsx("button",{onClick:E,className:"btn-retry",children:"Erneut versuchen"})]});const S={"client-id":g,currency:s,intent:"capture",locale:"de_DE","disable-funding":"credit,card"};return t.jsx("div",{className:"paypal-checkout",children:t.jsxs(De,{options:S,children:[t.jsxs("div",{className:"paypal-amount-info",children:[t.jsx("p",{children:"Zahlungsbetrag:"}),t.jsx("strong",{children:e.toLocaleString("de-DE",{style:"currency",currency:s})})]}),t.jsx("div",{className:"paypal-buttons-container",children:t.jsx(ke,{style:{layout:"vertical",color:"gold",shape:"rect",label:"pay",height:45},createOrder:async()=>{var n;try{const t=await a.post(`${o.apiBaseUrl}/integrations/paypal/create-order`,{amount:e,currency:s,rechnung_id:l,description:u||`Zahlung für Rechnung #${l}`},{headers:{Authorization:`Bearer ${f}`}});if(null==(n=t.data)?void 0:n.order_id)return t.data.order_id;throw new Error("Keine Order-ID erhalten")}catch(t){throw console.error("Create Order Error:",t),null==p||p(t),t}},onApprove:async e=>{var n,t;try{const r=await a.post(`${o.apiBaseUrl}/integrations/paypal/capture-order/${e.orderID}`,{},{headers:{Authorization:`Bearer ${f}`}});if(!(null==(n=r.data)?void 0:n.success))throw new Error((null==(t=r.data)?void 0:t.error)||"Zahlung konnte nicht abgeschlossen werden");null==d||d({orderId:e.orderID,status:"completed",details:r.data})}catch(r){console.error("Capture Order Error:",r),null==p||p(r)}},onCancel:()=>{console.log("PayPal Zahlung abgebrochen")},onError:e=>{console.error("PayPal Error:",e),v("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut."),null==p||p(e)},forceReRender:[e,s]})}),t.jsx("div",{className:"paypal-info",children:t.jsx("p",{children:"Sie werden zu PayPal weitergeleitet, um die Zahlung abzuschließen."})}),j&&t.jsxs("div",{className:"paypal-sandbox-notice",children:[t.jsx(c,{size:14}),t.jsx("span",{children:"Sandbox-Modus aktiv (Testumgebung)"})]})]})})},Be=()=>{var e;const{rechnungId:s}=h(),[v]=m(),g=y(),{token:b,user:j}=r(),[x,E]=n.useState(!0),[S,w]=n.useState(""),[N,P]=n.useState(null),[k,O]=n.useState(null),[C,I]=n.useState(null),[A,R]=n.useState(null),[T,D]=n.useState(!1),[z,L]=n.useState(!1);n.useEffect(()=>{B()},[s]),n.useEffect(()=>{const e=v.get("status");"success"===e?R("success"):"cancelled"===e&&R("cancelled")},[v]);const B=async()=>{var e,n,t,r,i,c;E(!0),w("");try{const[i,c]=await Promise.all([a.get(`${o.apiBaseUrl}/rechnungen/${s}`,{headers:{Authorization:`Bearer ${b}`}}),a.get(`${o.apiBaseUrl}/integrations/status`,{headers:{Authorization:`Bearer ${b}`}})]);if(!i.data.success)return void w("Rechnung nicht gefunden");P(i.data.rechnung);const l=c.data;D((null==(e=null==l?void 0:l.stripe)?void 0:e.configured)||!1),L((null==(n=null==l?void 0:l.paypal)?void 0:n.configured)||!1),(null==(t=null==l?void 0:l.stripe)?void 0:t.configured)?I("stripe"):(null==(r=null==l?void 0:l.paypal)?void 0:r.configured)&&I("paypal")}catch(l){console.error("Fehler beim Laden:",l),w((null==(c=null==(i=l.response)?void 0:i.data)?void 0:c.error)||"Fehler beim Laden der Daten")}finally{E(!1)}},F=async e=>{R("success");try{await a.post(`${o.apiBaseUrl}/rechnungen/${s}/zahlung`,{betrag:N.gesamtbetrag,zahlungsart:"stripe"===C?"kreditkarte":"paypal",referenz:e.id||e.orderId},{headers:{Authorization:`Bearer ${b}`}})}catch(n){console.error("Fehler beim Aktualisieren der Rechnung:",n)}},_=e=>{console.error("Payment Error:",e),R("error"),w(e.message||"Zahlung fehlgeschlagen")};return x?t.jsx("div",{className:"payment-checkout",children:t.jsxs("div",{className:"payment-loading",children:[t.jsx(i,{className:"spin",size:48}),t.jsx("p",{children:"Lade Zahlungsdaten..."})]})}):S&&!N?t.jsx("div",{className:"payment-checkout",children:t.jsxs("div",{className:"payment-error-full",children:[t.jsx(u,{size:48}),t.jsx("h2",{children:"Fehler"}),t.jsx("p",{children:S}),t.jsxs("button",{onClick:()=>g(-1),className:"btn-back",children:[t.jsx(d,{size:16}),"Zurück"]})]})}):"success"===A?t.jsx("div",{className:"payment-checkout",children:t.jsxs("div",{className:"payment-success",children:[t.jsx(p,{size:64}),t.jsx("h2",{children:"Zahlung erfolgreich!"}),t.jsx("p",{children:"Ihre Zahlung wurde erfolgreich verarbeitet."}),t.jsxs("div",{className:"payment-success-details",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Rechnungsnummer:"})," ",null==N?void 0:N.rechnungsnummer]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Betrag:"})," ",parseFloat((null==N?void 0:N.gesamtbetrag)||0).toLocaleString("de-DE",{style:"currency",currency:"EUR"})]})]}),t.jsx("button",{onClick:()=>g("/rechnungen"),className:"btn-primary",children:"Zu meinen Rechnungen"})]})}):"cancelled"===A?t.jsx("div",{className:"payment-checkout",children:t.jsxs("div",{className:"payment-cancelled",children:[t.jsx(c,{size:64}),t.jsx("h2",{children:"Zahlung abgebrochen"}),t.jsx("p",{children:"Sie haben die Zahlung abgebrochen."}),t.jsxs("div",{className:"payment-actions",children:[t.jsx("button",{onClick:()=>R(null),className:"btn-primary",children:"Erneut versuchen"}),t.jsx("button",{onClick:()=>g("/rechnungen"),className:"btn-secondary",children:"Zurück zu Rechnungen"})]})]})}):T||z?t.jsxs("div",{className:"payment-checkout",children:[t.jsxs("div",{className:"payment-header",children:[t.jsxs("button",{onClick:()=>g(-1),className:"btn-back-link",children:[t.jsx(d,{size:18}),"Zurück"]}),t.jsxs("h1",{children:[t.jsx(l,{size:28}),"Rechnung bezahlen"]})]}),t.jsxs("div",{className:"payment-content",children:[t.jsxs("div",{className:"payment-invoice-summary",children:[t.jsx("h2",{children:"Rechnungsdetails"}),t.jsxs("div",{className:"invoice-info",children:[t.jsxs("div",{className:"invoice-row",children:[t.jsx("span",{children:"Rechnungsnummer:"}),t.jsx("strong",{children:null==N?void 0:N.rechnungsnummer})]}),t.jsxs("div",{className:"invoice-row",children:[t.jsx("span",{children:"Datum:"}),t.jsx("span",{children:new Date(null==N?void 0:N.rechnungsdatum).toLocaleDateString("de-DE")})]}),null==(e=null==N?void 0:N.positionen)?void 0:e.map((e,n)=>t.jsxs("div",{className:"invoice-position",children:[t.jsx("span",{children:e.beschreibung}),t.jsx("span",{children:parseFloat(e.betrag).toLocaleString("de-DE",{style:"currency",currency:"EUR"})})]},n)),t.jsxs("div",{className:"invoice-total",children:[t.jsx("span",{children:"Gesamtbetrag:"}),t.jsx("strong",{children:parseFloat((null==N?void 0:N.gesamtbetrag)||0).toLocaleString("de-DE",{style:"currency",currency:"EUR"})})]})]})]}),t.jsxs("div",{className:"payment-methods",children:[t.jsx("h2",{children:"Zahlungsmethode wählen"}),t.jsxs("div",{className:"payment-method-tabs",children:[T&&t.jsxs("button",{className:"method-tab "+("stripe"===C?"active":""),onClick:()=>I("stripe"),children:[t.jsx(l,{size:20}),t.jsx("span",{children:"Kreditkarte / SEPA"})]}),z&&t.jsxs("button",{className:"method-tab "+("paypal"===C?"active":""),onClick:()=>I("paypal"),children:[t.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:t.jsx("path",{d:"M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944 3.72a.77.77 0 0 1 .757-.629h6.774c2.236 0 3.833.585 4.744 1.74.873 1.106 1.096 2.58.661 4.388-.04.17-.078.326-.124.493a8.591 8.591 0 0 1-.266.89c-.93 2.753-3.16 4.148-6.632 4.148h-1.58a.953.953 0 0 0-.94.804l-.897 5.683-.163.1z"})}),t.jsx("span",{children:"PayPal"})]})]}),t.jsxs("div",{className:"payment-form-container",children:["stripe"===C&&T&&t.jsx(ie,{amount:parseFloat((null==N?void 0:N.gesamtbetrag)||0),currency:"eur",rechnungId:s,onSuccess:F,onError:_}),"paypal"===C&&z&&t.jsx(Le,{amount:parseFloat((null==N?void 0:N.gesamtbetrag)||0),currency:"EUR",rechnungId:s,description:`Rechnung ${null==N?void 0:N.rechnungsnummer}`,onSuccess:F,onError:_})]})]}),t.jsxs("div",{className:"payment-security",children:[t.jsx(f,{size:16}),t.jsx("span",{children:"Sichere Verbindung - Ihre Daten werden verschlüsselt übertragen"})]}),S&&t.jsxs("div",{className:"payment-error",children:[t.jsx(c,{size:16}),t.jsx("span",{children:S})]})]})]}):t.jsx("div",{className:"payment-checkout",children:t.jsxs("div",{className:"payment-not-available",children:[t.jsx(c,{size:48}),t.jsx("h2",{children:"Online-Zahlung nicht verfügbar"}),t.jsx("p",{children:"Derzeit sind keine Online-Zahlungsmethoden konfiguriert."}),t.jsx("p",{children:"Bitte kontaktieren Sie uns für alternative Zahlungsmöglichkeiten."}),t.jsxs("button",{onClick:()=>g(-1),className:"btn-back",children:[t.jsx(d,{size:16}),"Zurück"]})]})})};export{Be as default};
