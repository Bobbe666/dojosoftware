import{j as e}from"./animation-1wuIdCBS.js";import{u as a,r as n}from"./vendor-router-BhMXg4Z-.js";import{e as i,b as s,k as c,c as t}from"./index-DUnH23_2.js";import{p as l,ae as r,af as o,F as d,o as h,ag as f,C as m,ah as u,ai as p,z as x,k as b,aj as j,ak as k,al as g,D as z,v as _}from"./icons-D7rg4pDH.js";import{R as v,f as N,C as y,X as w,Y as E,T as $,L as R,g as F,P as A,c as C,d as T,B as D,b as B}from"./charts-CuVbSI8O.js";import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";const S=["#f59e0b","#10b981","#3b82f6","#ef4444","#8b5cf6","#f97316"],L=()=>{const L=a(),{updateTrigger:V}=i(),{getDojoFilterParam:K,activeDojo:M,filter:Z}=s(),[P,U]=n.useState(!0),[O,q]=n.useState("month"),[W,I]=n.useState(null),[J,Q]=n.useState([]),[G,X]=n.useState([]);n.useEffect(()=>{Y(),H(),ee()},[V,O,M,Z]);const Y=async()=>{try{U(!0);const e=K(),a=e?"&":"",n=await c(`${t.apiBaseUrl}/finanzcockpit/stats?period=${O}${a}${e}`);if(!n.ok)throw new Error("Fehler beim Laden der Finanzstatistiken");const i=await n.json();if(!i.success)throw new Error(i.error||"Fehler beim Laden der Daten");I(i.data),U(!1)}catch(e){console.error("Fehler beim Laden der Finanzstatistiken:",e),I(null),U(!1)}},H=async()=>{try{const e=K(),a="month"===O?3:"quarter"===O?6:12,n=e?"&":"",i=await c(`${t.apiBaseUrl}/finanzcockpit/timeline?period=${O}&months=${a}${n}${e}`);if(i.ok){const e=await i.json();if(e.success&&e.data){const a=e.data||[],n=a.length;if(n>1){let e=0,i=0,s=0,c=0;a.forEach((a,n)=>{e+=n,i+=a.umsatz||0,s+=n*(a.umsatz||0),c+=n*n});const t=n*c-e*e;if(0!==t){const c=(n*s-e*i)/t,l=(i-c*e)/n,r=a.map((e,a)=>({...e,trend:c*a+l}));Q(r)}else Q(a.map(e=>({...e,trend:e.umsatz||0})))}else Q(a)}else Q([])}else Q([])}catch(e){console.error("Fehler beim Laden der Timeline-Daten:",e),Q([])}},ee=async()=>{try{const e=K(),a=await c(`${t.apiBaseUrl}/finanzcockpit/tarif-breakdown?${e}`);if(a.ok){const e=await a.json();e.success&&X(e.data)}}catch(e){console.error("Fehler beim Laden der Tarif-Daten:",e)}},ae=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e||0),ne=e=>{try{return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:1,notation:"compact"}).format(e||0).replace(/\u00a0/g," ")}catch(a){const n=Math.abs(e||0),i=n>=1e6?" Mio":n>=1e3?" Tsd":"";return`${ae((e||0)/(n>=1e6?1e6:n>=1e3?1e3:1))}${i}`}},ie=e=>new Intl.NumberFormat("de-DE").format(e||0),se=e=>{if(!e)return"-";try{return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(e))}catch(a){return e}},ce={month:"Aktueller Monat",quarter:"Aktuelles Quartal",year:"Aktuelles Jahr"}[O]||"Zeitraum",te=({active:a,payload:n,label:i})=>a&&n&&n.length?e.jsxs("div",{style:{backgroundColor:"var(--bg-modal)",border:"1px solid var(--border-primary)",borderRadius:"12px",color:"var(--text-primary)",padding:"12px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("p",{style:{margin:"0 0 8px 0",fontWeight:"600",fontSize:"0.9rem"},children:[i,": ",ae(n[0].value)]}),"Vertr√§ge"===i&&G.length>0&&e.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:"8px",marginTop:"4px"},children:[e.jsx("p",{style:{margin:"0 0 6px 0",fontSize:"0.8rem",color:"#FFD700",fontWeight:"600"},children:"Aufschl√ºsselung nach Tarifen:"}),G.map(a=>e.jsxs("div",{style:{fontSize:"0.75rem",padding:"3px 0",display:"flex",justifyContent:"space-between",gap:"12px",borderBottom:"1px solid rgba(255, 255, 255, 0.05)"},children:[e.jsx("span",{style:{color:"rgba(255, 255, 255, 0.9)"},children:a.name}),e.jsxs("span",{style:{color:"#10b981",fontWeight:"500"},children:[ae(a.value)," (",a.count,")"]})]},a.name))]})]}):null,le=W?[{name:"Bar",value:W.barEinnahmen||0},{name:"Karte",value:W.kartenEinnahmen||0},{name:"Lastschrift",value:W.lastschriftEinnahmen||0}].filter(e=>e.value>0):[],re=W?[{name:"Vertr√§ge",value:W.monatlicheEinnahmen||0},{name:"Verk√§ufe",value:W.verkaeufeEinnahmen||0},{name:"Rechnungen",value:W.rechnungenEinnahmen||0},{name:"Zahlungen",value:W.zahlungenEinnahmen||0},{name:"Zahll√§ufe",value:W.zahllaeufeEinnahmen||0}].filter(e=>e.value>0):[],oe=(null==W?void 0:W.anzahlVerkaeufe)>0?(W.verkaeufeEinnahmen||0)/W.anzahlVerkaeufe:0,de=W?[{id:"revenue",icon:l,label:"Gesamteinnahmen",value:ae(W.gesamteinnahmen),detail:`${W.einnahmenTrend>0?"+":""}${(W.einnahmenTrend??0).toFixed(1)}% vs. Vorperiode`,tone:W.einnahmenTrend>=0?"positive":"negative"},{id:"expenses",icon:r,label:"Gesamtausgaben",value:ae(W.gesamteAusgaben),detail:0!==W.ausgabenTrend?`${W.ausgabenTrend>0?"+":""}${(W.ausgabenTrend??0).toFixed(1)}% vs. Vorperiode`:"Trenddaten folgen",tone:W.gesamteAusgaben>0?"warning":"neutral"},{id:"cashflow",icon:o,label:"Cashflow",value:ae(W.cashflow),detail:`${W.cashflowProzent>0?"+":""}${(W.cashflowProzent??0).toFixed(1)}% Marge`,tone:W.cashflow>=0?"positive":"negative"},{id:"open-invoices",icon:d,label:"Offene Rechnungen",value:ie(W.offeneRechnungen),detail:`${ae(W.offeneRechnungenBetrag)} offen`,tone:W.offeneRechnungen>0?"warning":"positive"},{id:"contracts",icon:h,label:"Aktive Vertr√§ge",value:ie(W.anzahlVertraege),detail:`${ae(W.monatlicheEinnahmen)} pro Monat`,tone:"neutral"},{id:"sales",icon:f,label:"Verk√§ufe",value:ie(W.anzahlVerkaeufe),detail:`${ae(W.verkaeufeEinnahmen)} Umsatz`,tone:"neutral"}]:[],he=W?[{id:"period",icon:m,title:"Auswertungszeitraum",description:`${se(W.dateStart)} ‚Äì ${se(W.dateEnd)}`},{id:"cashflow",icon:W.cashflow>=0?u:p,title:W.cashflow>=0?"Positiver Cashflow":"Cashflow unter Null",description:W.cashflow>=0?`√úberschuss von ${ae(W.cashflow)} nach Ausgaben`:`Defizit von ${ae(Math.abs(W.cashflow))} nach Ausgaben`},{id:"average-sale",icon:x,title:"√ò Umsatz pro Verkauf",description:`${ae(oe)} bei ${ie(W.anzahlVerkaeufe)} Verk√§ufen`},{id:"open-postings",icon:W.offeneRechnungen>0?b:j,title:W.offeneRechnungen>0?"Offene Forderungen":"Keine offenen Rechnungen",description:W.offeneRechnungen>0?`${ie(W.offeneRechnungen)} Rechnungen √ºber ${ae(W.offeneRechnungenBetrag)}`:"Alle Rechnungen sind beglichen"}]:[],fe=W?[{label:"Monatlich",value:ae(W.monatlicheEinnahmen)},{label:"Quartal",value:ae(W.quartalsEinnahmen)},{label:"Jahr",value:ae(W.jahresEinnahmen)},{label:"Trend",value:`${Math.abs((W.einnahmenTrend??0).toFixed(1))}%`,tone:W.einnahmenTrend>=0?"positive":"negative",icon:W.einnahmenTrend>=0?u:p}]:[],me=W?[{label:"Bar",value:ae(W.barEinnahmen)},{label:"Karte",value:ae(W.kartenEinnahmen)},{label:"Lastschrift",value:ae(W.lastschriftEinnahmen)}]:[],ue=W?[{label:"Offener Betrag",value:ae(W.offeneRechnungenBetrag),tone:W.offeneRechnungenBetrag>0?"warning":"positive"},{label:"Offene Rechnungen",value:ie(W.offeneRechnungen),tone:W.offeneRechnungen>0?"warning":"positive"},{label:"√úberf√§llig",value:W.ueberfaelligeRechnungen>0?ie(W.ueberfaelligeRechnungen):"Keine",tone:W.ueberfaelligeRechnungen>0?"negative":"positive"},{label:"Ausstehende Beitr√§ge",value:ae(W.ausstehendeZahlungenBetrag),sublabel:`${ie(W.ausstehendeZahlungen)} Vertr√§ge`}]:[],pe=W?[{label:"Zahll√§ufe",value:ie(W.anzahlZahllaeufe),sublabel:`${ae(W.zahllaeufeEinnahmen)} abgeschlossen`},{label:"Zahlungen",value:ie(W.anzahlZahlungen),sublabel:ae(W.zahlungenEinnahmen)},{label:"Rechnungen (bezahlt)",value:ae(W.rechnungenEinnahmen)},{label:"Ausgaben",value:ae(W.gesamteAusgaben),sublabel:`${ie(W.anzahlAusgaben)} Buchungen`}]:[];return P?e.jsx("div",{className:"finanzcockpit",children:e.jsxs("div",{className:"finanzcockpit-card finanzcockpit__state",children:[e.jsx("div",{className:"finanzcockpit__spinner"}),e.jsx("p",{children:"Finanzdaten werden geladen‚Ä¶"})]})}):W?e.jsxs("div",{className:"finanzcockpit",children:[e.jsx("header",{className:"finanzcockpit-card finanzcockpit__header",children:e.jsxs("div",{className:"finanzcockpit__header-top",children:[e.jsxs("div",{className:"finanzcockpit__headline",children:[e.jsx("span",{className:"finanzcockpit__eyebrow",children:"Finanzen"}),e.jsxs("div",{className:"finanzcockpit__title-row",children:[e.jsx("h1",{className:"finanzcockpit__title",children:"Finanzcockpit"}),e.jsx("span",{className:"finanzcockpit__badge",children:ce})]}),e.jsx("p",{className:"finanzcockpit__subtitle",children:"Alle Kennzahlen und Bewegungen auf einen Blick ‚Äì inklusive Cashflow, offenen Posten und Zahlungsarten."})]}),e.jsxs("div",{className:"finanzcockpit__controls",children:[e.jsxs("div",{className:"finanzcockpit__period-selector",children:[e.jsx("button",{className:"month"===O?"is-active":"",onClick:()=>q("month"),children:"Monat"}),e.jsx("button",{className:"quarter"===O?"is-active":"",onClick:()=>q("quarter"),children:"Quartal"}),e.jsx("button",{className:"year"===O?"is-active":"",onClick:()=>q("year"),children:"Jahr"})]}),e.jsxs("div",{className:"finanzcockpit__period-info",children:[e.jsx(m,{size:16}),e.jsxs("span",{children:[se(W.dateStart)," ‚Äì ",se(W.dateEnd)]})]})]})]})}),e.jsx("section",{className:"finanzcockpit__kpi-grid",children:de.map(({id:a,icon:n,label:i,value:s,detail:c,tone:t})=>e.jsxs("div",{className:`finanzcockpit-card finanzcockpit__kpi-card finanzcockpit__kpi-card--${t}`,children:[e.jsxs("div",{className:"finanzcockpit__kpi-meta",children:[e.jsx("div",{className:"finanzcockpit__kpi-icon",children:e.jsx(n,{size:18})}),e.jsx("span",{className:"finanzcockpit__kpi-label",children:i})]}),e.jsx("div",{className:"finanzcockpit__kpi-value",children:s}),e.jsx("span",{className:"finanzcockpit__kpi-detail",children:c})]},a))}),e.jsxs("section",{className:"finanzcockpit__layout",children:[e.jsxs("div",{className:"finanzcockpit__main",children:[e.jsxs("div",{className:"finanzcockpit-card finanzcockpit__chart-card",children:[e.jsx("div",{className:"finanzcockpit__card-header",children:e.jsxs("div",{children:[e.jsx("span",{className:"finanzcockpit__card-eyebrow",children:"Performance"}),e.jsx("h3",{children:"Umsatz-Entwicklung"})]})}),e.jsx(v,{width:"100%",height:320,children:e.jsxs(N,{data:J,children:[e.jsx(y,{strokeDasharray:"3 3",stroke:"rgba(255, 255, 255, 0.08)"}),e.jsx(w,{dataKey:"label",stroke:"rgba(255, 255, 255, 0.7)",style:{fontSize:"0.75rem"}}),e.jsx(E,{stroke:"rgba(255, 255, 255, 0.7)",style:{fontSize:"0.75rem"},tickFormatter:ne}),e.jsx($,{contentStyle:{backgroundColor:"var(--bg-modal)",border:"1px solid var(--border-primary)",borderRadius:"12px",color:"var(--text-primary)"},formatter:e=>ae(e)}),e.jsx(R,{}),e.jsx(F,{type:"monotone",dataKey:"umsatz",stroke:"#f59e0b",strokeWidth:2,name:"Umsatz",dot:{fill:"#f59e0b",r:4},activeDot:{r:6}}),e.jsx(F,{type:"monotone",dataKey:"trend",stroke:"#10b981",strokeWidth:2,strokeDasharray:"5 5",name:"Trend",dot:!1})]})})]}),e.jsxs("div",{className:"finanzcockpit__dual-grid",children:[le.length>0&&e.jsxs("div",{className:"finanzcockpit-card finanzcockpit__chart-card",children:[e.jsxs("div",{className:"finanzcockpit__card-header",children:[e.jsxs("div",{children:[e.jsx("span",{className:"finanzcockpit__card-eyebrow",children:"Zahlungsarten"}),e.jsx("h3",{children:"Verteilung der Einnahmen"})]}),e.jsx(k,{size:18})]}),e.jsx(v,{width:"100%",height:280,children:e.jsxs(A,{children:[e.jsx(C,{data:le,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:a})=>`${e}: ${(100*a).toFixed(0)}%`,outerRadius:100,dataKey:"value",children:le.map((a,n)=>e.jsx(T,{fill:S[n%S.length]},`cell-${n}`))}),e.jsx($,{contentStyle:{backgroundColor:"var(--bg-modal)",border:"1px solid var(--border-primary)",borderRadius:"12px",color:"var(--text-primary)"},formatter:e=>ae(e)})]})})]}),re.length>0&&e.jsxs("div",{className:"finanzcockpit-card finanzcockpit__chart-card",children:[e.jsxs("div",{className:"finanzcockpit__card-header",children:[e.jsxs("div",{children:[e.jsx("span",{className:"finanzcockpit__card-eyebrow",children:"Einnahmen"}),e.jsx("h3",{children:"Aufschl√ºsselung"})]}),e.jsx(x,{size:18})]}),e.jsx(v,{width:"100%",height:280,children:e.jsxs(D,{data:re,children:[e.jsx(y,{strokeDasharray:"3 3",stroke:"rgba(255, 255, 255, 0.08)"}),e.jsx(w,{dataKey:"name",stroke:"rgba(255, 255, 255, 0.7)",style:{fontSize:"0.75rem"}}),e.jsx(E,{stroke:"rgba(255, 255, 255, 0.7)",style:{fontSize:"0.75rem"},tickFormatter:ne}),e.jsx($,{content:e.jsx(te,{})}),e.jsx(B,{dataKey:"value",fill:"#f59e0b",radius:[10,10,0,0]})]})})]})]})]}),e.jsx("aside",{className:"finanzcockpit__sidebar",children:e.jsxs("div",{className:"finanzcockpit-card finanzcockpit__insights",children:[e.jsx("div",{className:"finanzcockpit__card-header",children:e.jsxs("div",{children:[e.jsx("span",{className:"finanzcockpit__card-eyebrow",children:"Insights"}),e.jsx("h3",{children:"Schnelle Einsch√§tzungen"})]})}),e.jsx("ul",{className:"finanzcockpit__insight-list",children:he.map(({id:a,icon:n,title:i,description:s})=>e.jsxs("li",{children:[e.jsx("div",{className:"finanzcockpit__insight-icon",children:e.jsx(n,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"finanzcockpit__insight-title",children:i}),e.jsx("p",{className:"finanzcockpit__insight-description",children:s})]})]},a))})]})})]}),e.jsxs("section",{className:"finanzcockpit__details",children:[e.jsxs("div",{className:"finanzcockpit-card finanzcockpit__detail-card",children:[e.jsxs("div",{className:"finanzcockpit__detail-header",children:[e.jsx(l,{size:18}),e.jsxs("div",{children:[e.jsx("h3",{children:"Einnahmen-√úbersicht"}),e.jsx("p",{children:"Regelm√§√üige und variable Ums√§tze"})]})]}),e.jsx("div",{className:"finanzcockpit__metrics-list",children:fe.map(a=>{const n=a.icon;return e.jsxs("div",{className:"finanzcockpit__metric-row",children:[e.jsx("span",{className:"finanzcockpit__metric-label",children:a.label}),e.jsxs("span",{className:"finanzcockpit__metric-value "+(a.tone?`is-${a.tone}`:""),children:[n&&e.jsx(n,{size:14}),a.value]})]},a.label)})})]}),e.jsxs("div",{className:"finanzcockpit-card finanzcockpit__detail-card",children:[e.jsxs("div",{className:"finanzcockpit__detail-header",children:[e.jsx(k,{size:18}),e.jsxs("div",{children:[e.jsx("h3",{children:"Zahlungsarten"}),e.jsx("p",{children:"Wie Mitglieder und Kunden zahlen"})]})]}),e.jsx("div",{className:"finanzcockpit__metrics-list",children:me.map(a=>e.jsxs("div",{className:"finanzcockpit__metric-row",children:[e.jsx("span",{className:"finanzcockpit__metric-label",children:a.label}),e.jsx("span",{className:"finanzcockpit__metric-value",children:a.value})]},a.label))})]}),e.jsxs("div",{className:"finanzcockpit-card finanzcockpit__detail-card",children:[e.jsxs("div",{className:"finanzcockpit__detail-header",children:[e.jsx(d,{size:18}),e.jsxs("div",{children:[e.jsx("h3",{children:"Offene Posten"}),e.jsx("p",{children:"Forderungen und offene Beitr√§ge"})]})]}),e.jsx("div",{className:"finanzcockpit__metrics-list",children:ue.map(a=>e.jsxs("div",{className:"finanzcockpit__metric-row",children:[e.jsx("span",{className:"finanzcockpit__metric-label",children:a.label}),e.jsxs("span",{className:"finanzcockpit__metric-value "+(a.tone?`is-${a.tone}`:""),children:[a.value,a.sublabel&&e.jsx("small",{children:a.sublabel})]})]},a.label))})]}),e.jsxs("div",{className:"finanzcockpit-card finanzcockpit__detail-card",children:[e.jsxs("div",{className:"finanzcockpit__detail-header",children:[e.jsx(x,{size:18}),e.jsxs("div",{children:[e.jsx("h3",{children:"Aktivit√§t"}),e.jsx("p",{children:"Operative Kennzahlen der Periode"})]})]}),e.jsx("div",{className:"finanzcockpit__metrics-list",children:pe.map(a=>e.jsxs("div",{className:"finanzcockpit__metric-row",children:[e.jsx("span",{className:"finanzcockpit__metric-label",children:a.label}),e.jsxs("span",{className:"finanzcockpit__metric-value",children:[a.value,a.sublabel&&e.jsx("small",{children:a.sublabel})]})]},a.label))})]})]}),e.jsxs("section",{className:"finanzcockpit__actions",children:[e.jsx("h3",{children:"Direkte Aktionen"}),e.jsxs("div",{className:"finanzcockpit__actions-grid",children:[e.jsxs("button",{className:"finanzcockpit__action-button",onClick:()=>L("/dashboard/euer"),style:{borderLeft:"3px solid #10b981"},children:[e.jsx(g,{size:20}),"E√úR (Einnahmen-√úberschuss)"]}),e.jsxs("button",{className:"finanzcockpit__action-button",onClick:()=>L("/dashboard/ausgaben"),style:{borderLeft:"3px solid #ef4444"},children:[e.jsx(r,{size:20}),"Ausgaben erfassen"]}),e.jsxs("button",{className:"finanzcockpit__action-button",onClick:()=>L("/dashboard/beitraege"),children:[e.jsx(z,{size:20}),"Beitr√§ge verwalten"]}),e.jsxs("button",{className:"finanzcockpit__action-button",onClick:()=>L("/dashboard/rechnungen"),children:[e.jsx(d,{size:20}),"Rechnungen pr√ºfen"]}),e.jsxs("button",{className:"finanzcockpit__action-button",onClick:()=>L("/dashboard/lastschriftlauf"),children:[e.jsx(_,{size:20}),"Lastschriftlauf"]}),e.jsxs("button",{className:"finanzcockpit__action-button",onClick:()=>L("/dashboard/mahnwesen"),children:[e.jsx(b,{size:20}),"Mahnwesen starten"]})]})]}),e.jsxs("section",{className:"finanzcockpit__actions",children:[e.jsx("h3",{children:"üìä Mitglieder-Analysen"}),e.jsxs("div",{className:"finanzcockpit__actions-grid",children:[e.jsxs("button",{className:"finanzcockpit__action-button",onClick:()=>L("/dashboard/mitglieder-filter/ohne-sepa"),style:{borderLeft:"3px solid #ef4444"},children:[e.jsx(b,{size:20}),"Ohne SEPA-Mandat"]}),e.jsxs("button",{className:"finanzcockpit__action-button",onClick:()=>L("/dashboard/mitglieder-filter/ohne-vertrag"),style:{borderLeft:"3px solid #f59e0b"},children:[e.jsx(d,{size:20}),"Ohne Vertrag"]}),e.jsxs("button",{className:"finanzcockpit__action-button",onClick:()=>L("/dashboard/mitglieder-filter/tarif-abweichung"),style:{borderLeft:"3px solid #8b5cf6"},children:[e.jsx(b,{size:20}),"Tarif-Abweichungen"]}),e.jsxs("button",{className:"finanzcockpit__action-button",onClick:()=>L("/dashboard/mitglieder-filter/zahlungsweisen"),style:{borderLeft:"3px solid #3b82f6"},children:[e.jsx(_,{size:20}),"Nach Zahlungsweise"]})]})]})]}):e.jsx("div",{className:"finanzcockpit",children:e.jsxs("div",{className:"finanzcockpit-card finanzcockpit__state is-error",children:[e.jsx(b,{size:48}),e.jsx("h3",{children:"Fehler beim Laden der Daten"}),e.jsx("p",{children:"Bitte versuchen Sie es sp√§ter erneut."})]})})};export{L as default};
