import{j as e}from"./animation-1wuIdCBS.js";import{u as s,r as a}from"./vendor-router-BhMXg4Z-.js";import{u as n,a as r,c as t}from"./index-DUnH23_2.js";import{j as i}from"./index-CkXcCt97.js";/* empty css             */import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";import"./icons-D7rg4pDH.js";function l({embedded:l=!1}){const c=s(),{token:d}=n(),[o,h]=a.useState([]),[m,u]=a.useState(!0),[w,b]=a.useState(""),[j,N]=a.useState("alle"),[f,v]=a.useState(null),x=()=>{try{if(d){const e=i(d);return 1===e.id||1===e.user_id||"admin"===e.username}}catch(e){console.error("Token decode error:",e)}return!1};a.useEffect(()=>{l||x()?(async()=>{var e,s;u(!0),b("");try{const e=new URLSearchParams;"alle"!==j&&e.append("status",j);const s=await r.get(`${t.apiBaseUrl}/news?${e.toString()}`,{headers:{Authorization:`Bearer ${d}`}});h(s.data.news||[])}catch(a){console.error("Fehler beim Laden der News:",a),b("Fehler beim Laden der News: "+((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.error)||a.message))}finally{u(!1)}})():c("/dashboard")},[d,j]);const p=s=>{switch(s){case"veroeffentlicht":return e.jsx("span",{className:"news-status-badge published",children:"VerÃ¶ffentlicht"});case"entwurf":return e.jsx("span",{className:"news-status-badge draft",children:"Entwurf"});case"archiviert":return e.jsx("span",{className:"news-status-badge archived",children:"Archiviert"});default:return e.jsx("span",{className:"news-status-badge",children:s})}},g=e=>e?new Date(e).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return x()?e.jsxs("div",{className:"news-verwaltung "+(l?"embedded":""),children:[e.jsxs("div",{className:"news-header",children:[e.jsxs("div",{className:"news-header-left",children:[!l&&e.jsx("button",{className:"btn-back",onClick:()=>c("/dashboard"),children:"â† ZurÃ¼ck"}),e.jsx("h1",{children:"ðŸ“° News verwalten"})]}),e.jsx("button",{className:"btn-create-news",onClick:()=>c("/dashboard/news/neu"),children:"+ Neue News erstellen"})]}),w&&e.jsx("div",{className:"news-error",children:w}),e.jsxs("div",{className:"news-filter",children:[e.jsx("button",{className:"filter-btn "+("alle"===j?"active":""),onClick:()=>N("alle"),children:"Alle"}),e.jsx("button",{className:"filter-btn "+("entwurf"===j?"active":""),onClick:()=>N("entwurf"),children:"EntwÃ¼rfe"}),e.jsx("button",{className:"filter-btn "+("veroeffentlicht"===j?"active":""),onClick:()=>N("veroeffentlicht"),children:"VerÃ¶ffentlicht"}),e.jsx("button",{className:"filter-btn "+("archiviert"===j?"active":""),onClick:()=>N("archiviert"),children:"Archiviert"})]}),m?e.jsx("div",{className:"news-loading",children:"LÃ¤dt News..."}):0===o.length?e.jsxs("div",{className:"news-empty",children:[e.jsx("p",{children:"Keine News vorhanden."}),e.jsx("button",{className:"btn-create-news",onClick:()=>c("/dashboard/news/neu"),children:"Erste News erstellen"})]}):e.jsx("div",{className:"news-list",children:o.map(s=>{return e.jsxs("div",{className:"news-card",children:[e.jsxs("div",{className:"news-card-header",children:[e.jsx("h3",{className:"news-title",children:s.titel}),e.jsxs("div",{className:"news-badges",children:[p(s.status),(a=s.zielgruppe,"homepage"===a?e.jsx("span",{className:"news-zielgruppe-badge homepage",children:"Nur Homepage"}):e.jsx("span",{className:"news-zielgruppe-badge all-dojos",children:"Alle Dojos"}))]})]}),s.kurzbeschreibung&&e.jsx("p",{className:"news-description",children:s.kurzbeschreibung}),e.jsxs("div",{className:"news-card-footer",children:[e.jsxs("div",{className:"news-meta",children:[e.jsxs("span",{className:"news-date",children:["Erstellt: ",g(s.created_at)]}),s.veroeffentlicht_am&&e.jsxs("span",{className:"news-date",children:["VerÃ¶ffentlicht: ",g(s.veroeffentlicht_am)]})]}),e.jsxs("div",{className:"news-actions",children:[e.jsx("button",{className:"btn-edit",onClick:()=>c(`/dashboard/news/bearbeiten/${s.id}`),children:"Bearbeiten"}),f===s.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-delete-confirm",onClick:()=>(async e=>{var s,a;try{await r.delete(`${t.apiBaseUrl}/news/${e}`,{headers:{Authorization:`Bearer ${d}`}}),h(o.filter(s=>s.id!==e)),v(null)}catch(n){console.error("Fehler beim LÃ¶schen:",n),b("Fehler beim LÃ¶schen: "+((null==(a=null==(s=n.response)?void 0:s.data)?void 0:a.error)||n.message))}})(s.id),children:"BestÃ¤tigen"}),e.jsx("button",{className:"btn-cancel",onClick:()=>v(null),children:"Abbrechen"})]}):e.jsx("button",{className:"btn-delete",onClick:()=>v(s.id),children:"LÃ¶schen"})]})]})]},s.id);var a})})]}):null}export{l as default};
