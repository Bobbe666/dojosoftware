import{a as e,j as s}from"./query-Caj74EYQ.js";import{f as n,c as t}from"./index-BuAcXaay.js";import{a2 as i,F as a,C as r,Q as l,a3 as c,a5 as o,o as d,br as h,D as m,p as u,A as j}from"./icons-eh0tbLFx.js";import"./vendor-router-B2AaIOtG.js";import"./charts-QHQg_ypW.js";const x=()=>{const[x,b]=e.useState([]),[f,w]=e.useState("all"),[p,g]=e.useState(!1),[k,v]=e.useState(""),[N,y]=e.useState(!1),D=[{id:"all",label:"Alle Dokumente",icon:s.jsx(a,{size:18})},{id:"vertrag",label:"Mitgliedschaftsvertrag",icon:s.jsx(a,{size:18}),color:"#DC2626",featured:!0},{id:"mitgliederliste",label:"Mitgliederliste",icon:s.jsx(d,{size:18}),color:"#3B82F6"},{id:"anwesenheit",label:"Anwesenheitsberichte",icon:s.jsx(h,{size:18}),color:"#10B981"},{id:"beitraege",label:"BeitragsÃ¼bersicht",icon:s.jsx(m,{size:18}),color:"#F59E0B"},{id:"statistiken",label:"Statistiken",icon:s.jsx(u,{size:18}),color:"#8B5CF6"},{id:"pruefungen",label:"PrÃ¼fungsurkunden",icon:s.jsx(j,{size:18}),color:"#EF4444"},{id:"custom",label:"Benutzerdefiniert",icon:s.jsx(a,{size:18}),color:"#6B7280"}];e.useEffect(()=>{z()},[]);const z=async()=>{g(!0);try{const e=await n(`${t.apiBaseUrl}/dokumente?status=erstellt`);if(!e.ok)throw new Error("Fehler beim Laden der Dokumente");const s=(await e.json()).map(e=>({id:e.id,name:e.name,type:e.typ,created:new Date(e.erstellt_am).toLocaleDateString("de-DE"),size:B(e.dateigroesse),format:e.dateityp,downloads:e.downloads}));b(s)}catch(e){v("âŒ Fehler beim Laden der Dokumente"),console.error(e)}finally{g(!1)}},B=e=>{if(!e)return"0 KB";const s=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,s)*100)/100+" "+["Bytes","KB","MB","GB"][s]},S="all"===f?x:x.filter(e=>e.type===f),C=e=>{const n=D.find(s=>s.id===e);return(null==n?void 0:n.icon)||s.jsx(a,{size:18})};return s.jsxs("div",{className:"berichte-dokumente",children:[s.jsxs("div",{className:"page-header",children:[s.jsx("h1",{children:"ğŸ“„ Berichte & Dokumente"}),s.jsx("p",{children:"PDF-Berichte erstellen, verwalten und herunterladen"})]}),k&&s.jsx("div",{className:"message "+(k.includes("âœ…")?"success":k.includes("âŒ")?"error":"info"),children:k}),s.jsxs("div",{className:"quick-create-section",children:[s.jsx("h2",{children:"âš¡ Neues Dokument erstellen"}),s.jsx("div",{className:"quick-create-grid",children:D.filter(e=>"all"!==e.id).map(e=>s.jsxs("div",{className:"quick-create-card "+(e.featured?"featured":""),onClick:()=>(async e=>{const s=D.find(s=>s.label===e);if(s){v(`âœ¨ PDF-Erstellung fÃ¼r "${e}" wird gestartet...`),g(!0);try{const i=(new Date).toISOString().split("T")[0],a=`${e}_${i}`,r=await n(`${t.apiBaseUrl}/dokumente/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({typ:s.id,name:a,parameter:{generatedAt:(new Date).toISOString()}})});if(!r.ok){const e=await r.json();throw new Error(e.error||"Fehler bei der PDF-Generierung")}await r.json(),v(`âœ… ${e} erfolgreich erstellt!`),await z(),y(!1)}catch(i){v(`âŒ Fehler: ${i.message}`),console.error(i)}finally{g(!1)}}})(e.label),style:{borderLeftColor:e.color},children:[s.jsx("div",{className:"quick-create-icon",style:{color:e.color},children:e.icon}),s.jsxs("div",{className:"quick-create-content",children:[s.jsx("h3",{children:e.label}),s.jsxs("button",{className:"btn-create",children:[s.jsx(i,{size:16}),"Erstellen"]})]})]},e.id))})]}),s.jsxs("div",{className:"document-filter",children:[s.jsx("h2",{children:"ğŸ“š Gespeicherte Dokumente"}),s.jsx("div",{className:"filter-buttons",children:D.map(e=>s.jsxs("button",{className:"filter-btn "+(f===e.id?"active":""),onClick:()=>w(e.id),children:[e.icon,s.jsx("span",{children:e.label})]},e.id))})]}),s.jsx("div",{className:"documents-list",children:p?s.jsxs("div",{className:"loading-state",children:[s.jsx("div",{className:"spinner"}),s.jsx("p",{children:"Laden..."})]}):0===S.length?s.jsxs("div",{className:"empty-state",children:[s.jsx(a,{size:64}),s.jsx("h3",{children:"Keine Dokumente vorhanden"}),s.jsx("p",{children:"Erstellen Sie Ihr erstes Dokument mit den Schnellaktionen oben."})]}):s.jsx("div",{className:"documents-grid",children:S.map(e=>s.jsxs("div",{className:"document-card",children:[s.jsxs("div",{className:"document-header",children:[s.jsx("div",{className:"document-icon",children:C(e.type)}),s.jsxs("div",{className:"document-info",children:[s.jsx("h3",{children:e.name}),s.jsxs("div",{className:"document-meta",children:[s.jsxs("span",{children:[s.jsx(r,{size:14})," ",e.created]}),s.jsxs("span",{children:["â€¢ ",e.size]}),s.jsxs("span",{children:["â€¢ ",e.format]})]})]})]}),s.jsxs("div",{className:"document-actions",children:[s.jsx("button",{className:"btn-action btn-download",onClick:()=>(async e=>{v(`ğŸ“¥ Download "${e.name}" wird gestartet...`);try{const s=await n(`/dokumente/${e.id}/download`);if(!s.ok)throw new Error("Download fehlgeschlagen");const t=await s.blob(),i=window.URL.createObjectURL(t),a=document.createElement("a");a.href=i,a.download=`${e.name}.pdf`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(i),document.body.removeChild(a),v(`âœ… "${e.name}" erfolgreich heruntergeladen`),await z()}catch(s){v(`âŒ Download-Fehler: ${s.message}`),console.error(s)}})(e),title:"Herunterladen",children:s.jsx(l,{size:18})}),s.jsx("button",{className:"btn-action btn-edit",onClick:()=>v(`âœï¸ Bearbeiten von "${e.name}" wird vorbereitet...`),title:"Bearbeiten",children:s.jsx(c,{size:18})}),s.jsx("button",{className:"btn-action btn-delete",onClick:()=>(async e=>{if(window.confirm("MÃ¶chten Sie dieses Dokument wirklich lÃ¶schen?")){g(!0);try{if(!(await n(`/dokumente/${e}`,{method:"DELETE"})).ok)throw new Error("LÃ¶schen fehlgeschlagen");v("âœ… Dokument erfolgreich gelÃ¶scht"),await z()}catch(s){v(`âŒ Fehler beim LÃ¶schen: ${s.message}`),console.error(s)}finally{g(!1)}}})(e.id),title:"LÃ¶schen",children:s.jsx(o,{size:18})})]})]},e.id))})}),N&&s.jsx("div",{className:"modal-overlay",onClick:()=>y(!1),children:s.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[s.jsx("h2",{children:"ğŸ“„ Dokument erstellen"}),s.jsx("p",{children:"Diese Funktion wird in KÃ¼rze verfÃ¼gbar sein."}),s.jsx("div",{className:"modal-actions",children:s.jsx("button",{className:"btn-secondary",onClick:()=>y(!1),children:"SchlieÃŸen"})})]})})]})};export{x as default};
