import{b as e,a as t,j as r}from"./query-Caj74EYQ.js";import{P as n}from"./index-DQBxRuql.js";import{b as o,a,c as i}from"./index-B0gO-Ppw.js";import{V as s,k as c,K as u}from"./icons-eh0tbLFx.js";function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var d,p="clover",f="https://js.stripe.com",y="".concat(f,"/").concat(p,"/stripe.js"),m=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,h=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,v=function(e){return m.test(e)||h.test(e)},b=function(e){var t=document.createElement("script");t.src="".concat(y).concat("");var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(t),t},g=null,E=null,S=null,j=function(e){return null!==g?g:(g=new Promise(function(t,r){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe)t(window.Stripe);else try{var n=function(){for(var e=document.querySelectorAll('script[src^="'.concat(f,'"]')),t=0;t<e.length;t++){var r=e[t];if(v(r.src))return r}return null}();if(n&&e);else if(n){if(n&&null!==S&&null!==E){var o;n.removeEventListener("load",S),n.removeEventListener("error",E),null===(o=n.parentNode)||void 0===o||o.removeChild(n),n=b()}}else n=b();S=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,r),E=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}}(r),n.addEventListener("load",S),n.addEventListener("error",E)}catch(a){return void r(a)}else t(null)})).catch(function(e){return g=null,Promise.reject(e)})},w=!1,P=function(){return d||(d=j(null).catch(function(e){return d=null,Promise.reject(e)}))};Promise.resolve().then(function(){return P()}).catch(function(e){w||console.warn(e)});var x=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];w=!0;var n=Date.now();return P().then(function(e){return function(e,t,r){if(null===e)return null;var n=t[0];if("string"!=typeof n)throw new Error("Expected publishable key to be of type string, got type ".concat(l(n)," instead."));var o=n.match(/^pk_test/),a=function(e){return 3===e?"v3":e}(e.version),i=p;o&&a!==i&&console.warn("Stripe.js@".concat(a," was loaded on the page, but @stripe/stripe-js@").concat("8.7.0"," expected Stripe.js@").concat(i,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var s=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"8.7.0",startTime:t})}(s,r),s}(e,t,n)})};function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach(function(t){k(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function I(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==r)return;var n,o,a=[],i=!0,s=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(c){s=!0,o=c}finally{try{i||null==r.return||r.return()}finally{if(s)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var R=function(t,r,n){var o=!!n,a=e.useRef(n);e.useEffect(function(){a.current=n},[n]),e.useEffect(function(){if(!o||!t)return function(){};var e=function(){a.current&&a.current.apply(a,arguments)};return t.on(r,e),function(){t.off(r,e)}},[o,r,t,a])},D=function(t){var r=e.useRef(t);return e.useEffect(function(){r.current=t},[t]),r.current},_=function(e){return null!==e&&"object"===N(e)},L="[object Object]",B=function e(t,r){if(!_(t)||!_(r))return t===r;var n=Array.isArray(t);if(n!==Array.isArray(r))return!1;var o=Object.prototype.toString.call(t)===L;if(o!==(Object.prototype.toString.call(r)===L))return!1;if(!o&&!n)return t===r;var a=Object.keys(t),i=Object.keys(r);if(a.length!==i.length)return!1;for(var s={},c=0;c<a.length;c+=1)s[a[c]]=!0;for(var u=0;u<i.length;u+=1)s[i[u]]=!0;var l=Object.keys(s);if(l.length!==a.length)return!1;var d=t,p=r;return l.every(function(t){return e(d[t],p[t])})},F=function(e,t,r){return _(e)?Object.keys(e).reduce(function(n,o){var a=!_(t)||!B(e[o],t[o]);return r.includes(o)?(a&&console.warn("Unsupported prop change: options.".concat(o," is not a mutable property.")),n):a?C(C({},n||{}),{},k({},o,e[o])):n},null):null},U="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",z=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;if(null===e||_(t=e)&&"function"==typeof t.elements&&"function"==typeof t.createToken&&"function"==typeof t.createPaymentMethod&&"function"==typeof t.confirmCardPayment)return e;throw new Error(r)},$=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;if(function(e){return _(e)&&"function"==typeof e.then}(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(e){return z(e,t)})};var r=z(e,t);return null===r?{tag:"empty"}:{tag:"sync",stripe:r}},M=e.createContext(null);M.displayName="ElementsContext";var q=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},G=function(t){var r=t.stripe,n=t.options,o=t.children,a=e.useMemo(function(){return $(r)},[r]),i=A(e.useState(function(){return{stripe:"sync"===a.tag?a.stripe:null,elements:"sync"===a.tag?a.stripe.elements(n):null}}),2),s=i[0],c=i[1];e.useEffect(function(){var e=!0,t=function(e){c(function(t){return t.stripe?t:{stripe:e,elements:e.elements(n)}})};return"async"!==a.tag||s.stripe?"sync"!==a.tag||s.stripe||t(a.stripe):a.stripePromise.then(function(r){r&&e&&t(r)}),function(){e=!1}},[a,s,n]);var u=D(r);e.useEffect(function(){null!==u&&u!==r&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[u,r]);var l=D(n);return e.useEffect(function(){if(s.elements){var e=F(n,l,["clientSecret","fonts"]);e&&s.elements.update(e)}},[n,l,s.elements]),e.useEffect(function(){var e;(e=s.stripe)&&e._registerWrapper&&e.registerAppInfo&&(e._registerWrapper({name:"react-stripe-js",version:"5.6.0"}),e.registerAppInfo({name:"react-stripe-js",version:"5.6.0",url:"https://stripe.com/docs/stripe-js/react"}))},[s.stripe]),e.createElement(M.Provider,{value:s},o)};G.propTypes={stripe:n.any,options:n.object};var Z=function(){var t,r;return(t="calls useElements()",r=e.useContext(M),q(r,t)).elements};n.func.isRequired;var K=e.createContext(null);K.displayName="CheckoutContext",n.any,n.shape({clientSecret:n.oneOfType([n.string,n.instanceOf(Promise)]).isRequired,elementsOptions:n.object}).isRequired;var V=function(t){var r=e.useContext(K),n=e.useContext(M);if(r){if(n)throw new Error("You cannot wrap the part of your app that ".concat(t," in both <CheckoutProvider> and <Elements> providers."));return r}return q(n,t)},Y=["mode"],J=function(t,r){var o,a="".concat((o=t).charAt(0).toUpperCase()+o.slice(1),"Element"),i=r?function(t){V("mounts <".concat(a,">"));var r=t.id,n=t.className;return e.createElement("div",{id:r,className:n})}:function(r){var n,o=r.id,i=r.className,s=r.options,c=void 0===s?{}:s,u=r.onBlur,l=r.onFocus,d=r.onReady,p=r.onChange,f=r.onEscape,y=r.onClick,m=r.onLoadError,h=r.onLoaderStart,v=r.onNetworksChange,b=r.onConfirm,g=r.onCancel,E=r.onShippingAddressChange,S=r.onShippingRateChange,j=r.onSavedPaymentMethodRemove,w=r.onSavedPaymentMethodUpdate,P=V("mounts <".concat(a,">")),x="elements"in P?P.elements:null,O="checkoutState"in P?P.checkoutState:null,C="success"===(null==O?void 0:O.type)||"loading"===(null==O?void 0:O.type)?O.sdk:null,N=A(e.useState(null),2),k=N[0],T=N[1],_=e.useRef(null),L=e.useRef(null);R(k,"blur",u),R(k,"focus",l),R(k,"escape",f),R(k,"click",y),R(k,"loaderror",m),R(k,"loaderstart",h),R(k,"networkschange",v),R(k,"confirm",b),R(k,"cancel",g),R(k,"shippingaddresschange",E),R(k,"shippingratechange",S),R(k,"savedpaymentmethodremove",j),R(k,"savedpaymentmethodupdate",w),R(k,"change",p),d&&(n="expressCheckout"===t?d:function(){d(k)}),R(k,"ready",n),e.useLayoutEffect(function(){if(null===_.current&&null!==L.current&&(x||C)){var e=null;if(C)switch(t){case"paymentForm":e=C.createPaymentFormElement(c);break;case"payment":e=C.createPaymentElement(c);break;case"address":if(!("mode"in c))throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");var r=c.mode,n=I(c,Y);if("shipping"===r)e=C.createShippingAddressElement(n);else{if("billing"!==r)throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.");e=C.createBillingAddressElement(n)}break;case"expressCheckout":e=C.createExpressCheckoutElement(c);break;case"currencySelector":e=C.createCurrencySelectorElement();break;case"taxId":e=C.createTaxIdElement(c);break;default:throw new Error("Invalid Element type ".concat(a,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else x&&(e=x.create(t,c));_.current=e,T(e),e&&e.mount(L.current)}},[x,C,c]);var B=D(c);return e.useEffect(function(){if(_.current){var e=F(c,B,["paymentRequest"]);e&&"update"in _.current&&_.current.update(e)}},[c,B]),e.useLayoutEffect(function(){return function(){if(_.current&&"function"==typeof _.current.destroy)try{_.current.destroy(),_.current=null}catch(e){}}},[]),e.createElement("div",{id:o,className:i,ref:L})};return i.propTypes={id:n.string,className:n.string,onChange:n.func,onBlur:n.func,onFocus:n.func,onReady:n.func,onEscape:n.func,onClick:n.func,onLoadError:n.func,onLoaderStart:n.func,onNetworksChange:n.func,onConfirm:n.func,onCancel:n.func,onShippingAddressChange:n.func,onShippingRateChange:n.func,onSavedPaymentMethodRemove:n.func,onSavedPaymentMethodUpdate:n.func,options:n.object},i.displayName=a,i.__elementType=t,i},W="undefined"==typeof window;e.createContext(null).displayName="EmbeddedCheckoutProviderContext";J("auBankAccount",W),J("card",W),J("cardNumber",W),J("cardExpiry",W),J("cardCvc",W),J("iban",W);var X=J("payment",W);J("expressCheckout",W),J("paymentRequestButton",W),J("linkAuthentication",W),J("address",W),J("shippingAddress",W),J("paymentMethodMessaging",W),J("taxId",W);let H=null;const Q=({amount:e,currency:n,rechnungId:o,onSuccess:a,onError:i})=>{const l=V("calls useStripe()").stripe,d=Z(),[p,f]=t.useState(!1),[y,m]=t.useState(null);return r.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),l&&d){f(!0),m(null);try{const{error:e}=await d.submit();if(e)return m(e.message),void f(!1);const{error:t,paymentIntent:r}=await l.confirmPayment({elements:d,confirmParams:{return_url:`${window.location.origin}/zahlung/${o}?status=success`},redirect:"if_required"});t?(m(t.message),null==i||i(t)):r&&"succeeded"===r.status&&(null==a||a({id:r.id,status:r.status}))}catch(t){console.error("Stripe Error:",t),m(t.message),null==i||i(t)}finally{f(!1)}}},className:"stripe-form",children:[r.jsx("div",{className:"stripe-element-container",children:r.jsx(X,{options:{layout:"tabs",paymentMethodOrder:["card","sepa_debit"],defaultValues:{billingDetails:{address:{country:"DE"}}}}})}),y&&r.jsxs("div",{className:"stripe-error",children:[r.jsx(c,{size:16}),r.jsx("span",{children:y})]}),r.jsx("button",{type:"submit",disabled:!l||p,className:"stripe-submit-btn",children:p?r.jsxs(r.Fragment,{children:[r.jsx(s,{className:"spin",size:18}),"Wird verarbeitet..."]}):r.jsxs(r.Fragment,{children:[r.jsx(u,{size:18}),e.toLocaleString("de-DE",{style:"currency",currency:n.toUpperCase()})," bezahlen"]})})]})},ee=({amount:e,currency:n="eur",rechnungId:u,onSuccess:l,onError:d})=>{const{token:p}=o(),[f,y]=t.useState(null),[m,h]=t.useState(!1),[v,b]=t.useState(!0),[g,E]=t.useState(null),[S,j]=t.useState(null);t.useEffect(()=>{w()},[]);const w=async()=>{var t,r,o;b(!0),E(null);try{const r=await(async e=>{var t,r;if(!H)try{const n=null==(r=null==(t=(await a.get(`${i.apiBaseUrl}/payment-provider/status`,{headers:{Authorization:`Bearer ${e}`}})).data)?void 0:t.stripe)?void 0:r.publishable_key;if(!n)return console.error("Stripe publishable key nicht gefunden"),null;H=x(n)}catch(n){return console.error("Fehler beim Laden des Stripe Keys:",n),null}return H})(p);if(!r)return E("Stripe konnte nicht initialisiert werden. Bitte prüfen Sie die Konfiguration."),void b(!1);j(r);const o=await a.post(`${i.apiBaseUrl}/payment-provider/payment-intent`,{amount:Math.round(100*e),currency:n,rechnung_id:u,description:`Rechnung #${u}`},{headers:{Authorization:`Bearer ${p}`}});(null==(t=o.data)?void 0:t.client_secret)?(y(o.data.client_secret),h(!0)):E("Payment Intent konnte nicht erstellt werden")}catch(s){console.error("Stripe Init Error:",s),E((null==(o=null==(r=s.response)?void 0:r.data)?void 0:o.error)||"Fehler beim Initialisieren der Zahlung"),null==d||d(s)}finally{b(!1)}};if(v)return r.jsxs("div",{className:"stripe-loading",children:[r.jsx(s,{className:"spin",size:32}),r.jsx("p",{children:"Zahlungsformular wird geladen..."})]});if(g)return r.jsxs("div",{className:"stripe-init-error",children:[r.jsx(c,{size:24}),r.jsx("p",{children:g}),r.jsx("button",{onClick:w,className:"btn-retry",children:"Erneut versuchen"})]});if(!m||!f||!S)return r.jsxs("div",{className:"stripe-not-ready",children:[r.jsx(c,{size:24}),r.jsx("p",{children:"Stripe Checkout ist nicht verfügbar"})]});const P={clientSecret:f,appearance:{theme:"stripe",variables:{colorPrimary:"#FFD700",colorBackground:"#1e293b",colorText:"#ffffff",colorDanger:"#ef4444",fontFamily:"Inter, system-ui, sans-serif",borderRadius:"8px"},rules:{".Input":{backgroundColor:"#334155",border:"1px solid #475569",color:"#ffffff"},".Input:focus":{borderColor:"#FFD700",boxShadow:"0 0 0 2px rgba(255, 215, 0, 0.2)"},".Label":{color:"#94a3b8"},".Tab":{backgroundColor:"#1e293b",border:"1px solid #334155",color:"#94a3b8"},".Tab--selected":{backgroundColor:"#334155",borderColor:"#FFD700",color:"#ffffff"},".Tab:hover":{backgroundColor:"#334155"}}},locale:"de"};return r.jsx(G,{stripe:S,options:P,children:r.jsx(Q,{amount:e,currency:n,rechnungId:u,onSuccess:l,onError:d})})};
/*!
 * react-paypal-js v8.9.2 (2025-10-02T20:17:55.069Z)
 * Copyright 2020-present, PayPal, Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var te,re,ne,oe,ae,ie;(re=te||(te={})).INITIAL="initial",re.PENDING="pending",re.REJECTED="rejected",re.RESOLVED="resolved",(oe=ne||(ne={})).LOADING_STATUS="setLoadingStatus",oe.RESET_OPTIONS="resetOptions",oe.SET_BRAINTREE_INSTANCE="braintreeInstance",(ie=ae||(ae={})).NUMBER="number",ie.CVV="cvv",ie.EXPIRATION_DATE="expirationDate",ie.EXPIRATION_MONTH="expirationMonth",ie.EXPIRATION_YEAR="expirationYear",ie.POSTAL_CODE="postalCode";var se=function(){return se=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},se.apply(this,arguments)};function ce(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}function ue(e,t,r){if(r||2===arguments.length)for(var n,o=0,a=t.length;o<a;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var le="data-react-paypal-script-id",de="dataJsSdkLibrary",pe="react-paypal-js",fe="dataNamespace",ye="dataSdkIntegrationSource",me="paypal";function he(e){var t=e,r=le;t[r];var n=ce(t,[r+""]);return"react-paypal-js-".concat(function(e){for(var t="",r=0;r<e.length;r++){var n=e[r].charCodeAt(0)*r;e[r+1]&&(n+=e[r+1].charCodeAt(0)*(r-1)),t+=String.fromCharCode(97+Math.abs(n)%26)}return t}(JSON.stringify(n)))}function ve(e,t){var r,n,o,a;switch(t.type){case ne.LOADING_STATUS:return"object"==typeof t.value?se(se({},e),{loadingStatus:t.value.state,loadingStatusErrorMessage:t.value.message}):se(se({},e),{loadingStatus:t.value});case ne.RESET_OPTIONS:return o=e.options[le],(null==(a=self.document.querySelector("script[".concat(le,'="').concat(o,'"]')))?void 0:a.parentNode)&&a.parentNode.removeChild(a),se(se({},e),{loadingStatus:te.PENDING,options:se(se((r={},r[ye]=pe,r),t.value),(n={},n[le]="".concat(he(t.value)),n))});case ne.SET_BRAINTREE_INSTANCE:return se(se({},e),{braintreePayPalCheckoutInstance:t.value});default:return e}}var be=t.createContext(null);function ge(){var e=function(e){if("function"==typeof(null==e?void 0:e.dispatch)&&0!==e.dispatch.length)return e;throw new Error("usePayPalScriptReducer must be used within a PayPalScriptProvider")}(t.useContext(be));return[se(se({},e),{isInitial:e.loadingStatus===te.INITIAL,isPending:e.loadingStatus===te.PENDING,isResolved:e.loadingStatus===te.RESOLVED,isRejected:e.loadingStatus===te.REJECTED}),e.dispatch]}t.createContext({});var Ee=function(r){var n,o,a,i=r.className,s=void 0===i?"":i,c=r.disabled,u=void 0!==c&&c,l=r.children,d=r.forceReRender,p=void 0===d?[]:d,f=ce(r,["className","disabled","children","forceReRender"]),y=u?{opacity:.38}:{},m="".concat(s," ").concat(u?"paypal-buttons-disabled":"").trim(),h=t.useRef(null),v=t.useRef(null),b=(o=f,a=t.useRef(new Proxy({},{get:function(e,t,r){return"function"==typeof e[t]?function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e[t].apply(e,r)}:Reflect.get(e,t,r)}})),a.current=Object.assign(a.current,o),a.current),g=ge()[0],E=g.isResolved,S=g.options,j=t.useState(null),w=j[0],P=j[1],x=t.useState(!0),O=x[0],C=x[1],N=t.useState(null)[1];function k(){null!==v.current&&v.current.close().catch(function(){})}return(null===(n=v.current)||void 0===n?void 0:n.updateProps)&&v.current.updateProps({message:f.message}),t.useEffect(function(){if(!1===E)return k;var e,t=(void 0===(e=S.dataNamespace)&&(e=me),window[e]);if(void 0===t||void 0===t.Buttons)return N(function(){throw new Error(function(e){var t=e.reactComponentName,r=e.sdkComponentKey,n=e.sdkRequestedComponents,o=void 0===n?"":n,a=e.sdkDataNamespace,i=void 0===a?me:a,s=r.charAt(0).toUpperCase().concat(r.substring(1)),c="Unable to render <".concat(t," /> because window.").concat(i,".").concat(s," is undefined."),u="string"==typeof o?o:o.join(",");if(!u.includes(r)){var l=[u,r].filter(Boolean).join();c+="\nTo fix the issue, add '".concat(r,"' to the list of components passed to the parent PayPalScriptProvider:")+"\n`<PayPalScriptProvider options={{ components: '".concat(l,"'}}>`.")}return c}({reactComponentName:Ee.displayName,sdkComponentKey:"buttons",sdkRequestedComponents:S.components,sdkDataNamespace:S[fe]}))}),k;try{v.current=t.Buttons(se(se({},b),{onInit:function(e,t){P(t),"function"==typeof f.onInit&&f.onInit(e,t)}}))}catch(r){return N(function(){throw new Error("Failed to render <PayPalButtons /> component. Failed to initialize:  ".concat(r))})}return!1===v.current.isEligible()?(C(!1),k):h.current?(v.current.render(h.current).catch(function(e){null!==h.current&&0!==h.current.children.length&&N(function(){throw new Error("Failed to render <PayPalButtons /> component. ".concat(e))})}),k):k},ue(ue([E],p,!0),[f.fundingSource],!1)),t.useEffect(function(){null!==w&&(!0===u?w.disable().catch(function(){}):w.enable().catch(function(){}))},[u,w]),e.createElement(e.Fragment,null,O?e.createElement("div",{ref:h,style:y,className:m}):l)};function Se(e){var t=e.sdkBaseUrl,r=e.environment,n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}(e,["sdkBaseUrl","environment"]),o=t||function(e){return"sandbox"===e?"https://www.sandbox.paypal.com/sdk/js":"https://www.paypal.com/sdk/js"}(r),a=n,i=Object.keys(a).filter(function(e){return void 0!==a[e]&&null!==a[e]&&""!==a[e]}).reduce(function(e,t){var r,n=a[t].toString();return r=function(e,t){return(t?"-":"")+e.toLowerCase()},"data"===(t=t.replace(/[A-Z]+(?![a-z])|[A-Z]/g,r)).substring(0,4)||"crossorigin"===t?e.attributes[t]=n:e.queryParams[t]=n,e},{queryParams:{},attributes:{}}),s=i.queryParams,c=i.attributes;return s["merchant-id"]&&-1!==s["merchant-id"].indexOf(",")&&(c["data-merchant-id"]=s["merchant-id"],s["merchant-id"]="*"),{url:"".concat(o,"?").concat(je(s)),attributes:c}}function je(e){var t="";return Object.keys(e).forEach(function(r){0!==t.length&&(t+="&"),t+=r+"="+e[r]}),t}function we(e,t){void 0===t&&(t={});var r=document.createElement("script");return r.src=e,Object.keys(t).forEach(function(e){r.setAttribute(e,t[e]),"data-csp-nonce"===e&&r.setAttribute("nonce",t["data-csp-nonce"])}),r}function Pe(e,t){if(void 0===t&&(t=Promise),Oe(e,t),"undefined"==typeof document)return t.resolve(null);var r=Se(e),n=r.url,o=r.attributes,a=o["data-namespace"]||"paypal",i=xe(a);return o["data-js-sdk-library"]||(o["data-js-sdk-library"]="paypal-js"),function(e,t){var r=document.querySelector('script[src="'.concat(e,'"]'));if(null===r)return null;var n=we(e,t),o=r.cloneNode();if(delete o.dataset.uidAuto,Object.keys(o.dataset).length!==Object.keys(n.dataset).length)return null;var a=!0;return Object.keys(o.dataset).forEach(function(e){o.dataset[e]!==n.dataset[e]&&(a=!1)}),a?r:null}(n,o)&&i?t.resolve(i):function(e,t){void 0===t&&(t=Promise);Oe(e,t);var r=e.url,n=e.attributes;if("string"!=typeof r||0===r.length)throw new Error("Invalid url.");if(void 0!==n&&"object"!=typeof n)throw new Error("Expected attributes to be an object.");return new t(function(e,t){if("undefined"==typeof document)return e();!function(e){var t=e.url,r=e.attributes,n=e.onSuccess,o=e.onError,a=we(t,r);a.onerror=o,a.onload=n,document.head.insertBefore(a,document.head.firstElementChild)}({url:r,attributes:n,onSuccess:function(){return e()},onError:function(){var e=new Error('The script "'.concat(r,'" failed to load. Check the HTTP status code and response body in DevTools to learn more.'));return t(e)}})})}({url:n,attributes:o},t).then(function(){var e=xe(a);if(e)return e;throw new Error("The window.".concat(a," global variable is not available."))})}function xe(e){return window[e]}function Oe(e,t){if("object"!=typeof e||null===e)throw new Error("Expected an options object.");var r=e.environment;if(r&&"production"!==r&&"sandbox"!==r)throw new Error('The `environment` option must be either "production" or "sandbox".');if(void 0!==t&&"function"!=typeof t)throw new Error("Expected PromisePonyfill to be a function.")}Ee.displayName="PayPalButtons","function"==typeof SuppressedError&&SuppressedError;var Ce=function(r){var n,o=r.options,a=void 0===o?{clientId:"test"}:o,i=r.children,s=r.deferLoading,c=void 0!==s&&s,u=t.useReducer(ve,{options:se(se({},a),(n={},n[de]=pe,n[ye]=pe,n[le]="".concat(he(a)),n)),loadingStatus:c?te.INITIAL:te.PENDING}),l=u[0],d=u[1];return t.useEffect(function(){if(!1===c&&l.loadingStatus===te.INITIAL)return d({type:ne.LOADING_STATUS,value:te.PENDING});if(l.loadingStatus===te.PENDING){var e=!0;return Pe(l.options).then(function(){e&&d({type:ne.LOADING_STATUS,value:te.RESOLVED})}).catch(function(t){console.error("".concat("Failed to load the PayPal JS SDK script."," ").concat(t)),e&&d({type:ne.LOADING_STATUS,value:{state:te.REJECTED,message:String(t)}})}),function(){e=!1}}},[l.options,c,l.loadingStatus]),e.createElement(be.Provider,{value:se(se({},l),{dispatch:d})},i)};function Ne(){}t.createContext({cardFieldsForm:null,fields:{},registerField:Ne,unregisterField:Ne});const ke=({amount:e,currency:n="EUR",rechnungId:u,description:l,onSuccess:d,onError:p})=>{const{token:f}=o(),[y,m]=t.useState(!0),[h,v]=t.useState(null),[b,g]=t.useState(null),[E,S]=t.useState(!0);t.useEffect(()=>{j()},[]);const j=async()=>{var e,t,r,n;m(!0),v(null);try{const o=await a.get(`${i.apiBaseUrl}/integrations/status`,{headers:{Authorization:`Bearer ${f}`}});(null==(t=null==(e=o.data)?void 0:e.paypal)?void 0:t.configured)&&(null==(n=null==(r=o.data)?void 0:r.paypal)?void 0:n.client_id)?(g(o.data.paypal.client_id),S(!1!==o.data.paypal.sandbox)):v("PayPal ist nicht konfiguriert")}catch(o){console.error("PayPal Config Error:",o),v("Fehler beim Laden der PayPal-Konfiguration")}finally{m(!1)}};if(y)return r.jsxs("div",{className:"paypal-loading",children:[r.jsx(s,{className:"spin",size:32}),r.jsx("p",{children:"PayPal wird geladen..."})]});if(h||!b)return r.jsxs("div",{className:"paypal-error",children:[r.jsx(c,{size:24}),r.jsx("p",{children:h||"PayPal ist nicht verfügbar"}),r.jsx("button",{onClick:j,className:"btn-retry",children:"Erneut versuchen"})]});const w={"client-id":b,currency:n,intent:"capture",locale:"de_DE","disable-funding":"credit,card"};return r.jsx("div",{className:"paypal-checkout",children:r.jsxs(Ce,{options:w,children:[r.jsxs("div",{className:"paypal-amount-info",children:[r.jsx("p",{children:"Zahlungsbetrag:"}),r.jsx("strong",{children:e.toLocaleString("de-DE",{style:"currency",currency:n})})]}),r.jsx("div",{className:"paypal-buttons-container",children:r.jsx(Ee,{style:{layout:"vertical",color:"gold",shape:"rect",label:"pay",height:45},createOrder:async()=>{var t;try{const r=await a.post(`${i.apiBaseUrl}/integrations/paypal/create-order`,{amount:e,currency:n,rechnung_id:u,description:l||`Zahlung für Rechnung #${u}`},{headers:{Authorization:`Bearer ${f}`}});if(null==(t=r.data)?void 0:t.order_id)return r.data.order_id;throw new Error("Keine Order-ID erhalten")}catch(r){throw console.error("Create Order Error:",r),null==p||p(r),r}},onApprove:async e=>{var t,r;try{const n=await a.post(`${i.apiBaseUrl}/integrations/paypal/capture-order/${e.orderID}`,{},{headers:{Authorization:`Bearer ${f}`}});if(!(null==(t=n.data)?void 0:t.success))throw new Error((null==(r=n.data)?void 0:r.error)||"Zahlung konnte nicht abgeschlossen werden");null==d||d({orderId:e.orderID,status:"completed",details:n.data})}catch(n){console.error("Capture Order Error:",n),null==p||p(n)}},onCancel:()=>{console.log("PayPal Zahlung abgebrochen")},onError:e=>{console.error("PayPal Error:",e),v("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut."),null==p||p(e)},forceReRender:[e,n]})}),r.jsx("div",{className:"paypal-info",children:r.jsx("p",{children:"Sie werden zu PayPal weitergeleitet, um die Zahlung abzuschließen."})}),E&&r.jsxs("div",{className:"paypal-sandbox-notice",children:[r.jsx(c,{size:14}),r.jsx("span",{children:"Sandbox-Modus aktiv (Testumgebung)"})]})]})})};export{ke as P,ee as S};
