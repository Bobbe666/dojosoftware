import{a as e,j as t}from"./query-Caj74EYQ.js";import{u as r,c as s,f as n}from"./index-B0gO-Ppw.js";import{u as a,a2 as i,az as l,a0 as o,_ as d,X as c,aB as g,a5 as m,aF as u,aG as h,aH as b,w as x,aD as p,ak as y,aI as j,a1 as f,d as v,aJ as k,aK as S,o as w,H as B}from"./icons-eh0tbLFx.js";import"./vendor-router-B2AaIOtG.js";import"./charts-QHQg_ypW.js";const z={miete:B,personal:w,material:S,marketing:k,versicherung:v,gebuehren:f,fahrtkosten:j,telefon:y,software:p,fortbildung:x,reparatur:b,buero:h,sonstiges:u},A={miete:"Miete & Nebenkosten",personal:"Personalkosten",material:"Material & Ausstattung",marketing:"Marketing & Werbung",versicherung:"Versicherungen",gebuehren:"Gebühren & Beiträge",fahrtkosten:"Fahrtkosten",telefon:"Telefon & Internet",software:"Software & Lizenzen",fortbildung:"Fortbildung & Seminare",reparatur:"Reparaturen & Wartung",buero:"Büromaterial",sonstiges:"Sonstige Ausgaben"},C=()=>{const{activeDojo:h}=r(),[b,x]=e.useState(!0),[p,y]=e.useState([]),[j,f]=e.useState({anzahl:0,gesamt:0}),[v,k]=e.useState((new Date).getFullYear()),[S,w]=e.useState(null),[B,C]=e.useState(null),[N,W]=e.useState(!1),[D,I]=e.useState(null),[F,_]=e.useState({datum:(new Date).toISOString().split("T")[0],betrag:"",beschreibung:"",beleg_nummer:"",kategorie:"sonstiges"});e.useEffect(()=>{h&&E()},[h,v,S,B]);const E=async()=>{try{x(!0);const e=(null==h?void 0:h.dojo_id)||(null==h?void 0:h.id);let t=`${s.apiBaseUrl}/ausgaben?dojo_id=${e}&jahr=${v}`;S&&(t+=`&monat=${S}`),B&&(t+=`&kategorie=${B}`);const r=await n(t),a=await r.json();a.success&&(y(a.ausgaben),f(a.summen))}catch(e){console.error("Fehler beim Laden:",e)}finally{x(!1)}},T=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e||0),$=({kategorie:e})=>{const r=z[e]||u;return t.jsx(r,{size:16})};return t.jsxs("div",{className:"ausgaben-verwaltung",style:{padding:"1.5rem"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1.5rem",flexWrap:"wrap",gap:"1rem"},children:[t.jsxs("div",{children:[t.jsxs("h2",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(a,{size:24}),"Ausgaben erfassen"]}),t.jsx("p",{style:{margin:"0.5rem 0 0 0",color:"var(--text-secondary)"},children:"Betriebsausgaben für die EÜR verwalten"})]}),t.jsxs("button",{onClick:()=>{W(!0),I(null),_({datum:(new Date).toISOString().split("T")[0],betrag:"",beschreibung:"",beleg_nummer:"",kategorie:"sonstiges"})},className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(i,{size:18}),"Neue Ausgabe"]})]}),t.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"1.5rem",flexWrap:"wrap",alignItems:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("button",{onClick:()=>k(e=>e-1),className:"btn btn-icon",children:t.jsx(l,{size:18})}),t.jsx("span",{style:{fontWeight:"600",minWidth:"50px",textAlign:"center"},children:v}),t.jsx("button",{onClick:()=>k(e=>e+1),className:"btn btn-icon",disabled:v>=(new Date).getFullYear(),children:t.jsx(o,{size:18})})]}),t.jsx("select",{value:S||"",onChange:e=>w(e.target.value?parseInt(e.target.value):null),className:"form-select",style:{minWidth:"150px"},children:["Alle Monate","Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"].map((e,r)=>t.jsx("option",{value:0===r?"":r,children:e},r))}),t.jsxs("select",{value:B||"",onChange:e=>C(e.target.value||null),className:"form-select",style:{minWidth:"180px"},children:[t.jsx("option",{value:"",children:"Alle Kategorien"}),Object.entries(A).map(([e,r])=>t.jsx("option",{value:e,children:r},e))]})]}),t.jsxs("div",{style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",marginBottom:"1.5rem",border:"1px solid var(--border-primary)",display:"flex",gap:"2rem",flexWrap:"wrap"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Anzahl Ausgaben"}),t.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700"},children:j.anzahl})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Gesamt"}),t.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"var(--error)"},children:T(j.gesamt)})]})]}),N&&t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:t.jsxs("div",{style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.5rem",width:"100%",maxWidth:"500px",margin:"1rem"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[t.jsx("h3",{style:{margin:0},children:D?"Ausgabe bearbeiten":"Neue Ausgabe"}),t.jsx("button",{onClick:()=>W(!1),className:"btn btn-icon",children:t.jsx(d,{size:20})})]}),t.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),F.betrag&&F.beschreibung)try{const e=(null==h?void 0:h.dojo_id)||(null==h?void 0:h.id),t=D?`${s.apiBaseUrl}/ausgaben/${D}`:`${s.apiBaseUrl}/ausgaben`,r=D?"PUT":"POST",a=await n(t,{method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify({...F,dojo_id:e})}),i=await a.json();i.success?(W(!1),I(null),_({datum:(new Date).toISOString().split("T")[0],betrag:"",beschreibung:"",beleg_nummer:"",kategorie:"sonstiges"}),E()):alert(i.error||"Fehler beim Speichern")}catch(t){console.error("Fehler:",t),alert("Fehler beim Speichern")}else alert("Bitte Betrag und Beschreibung eingeben")},children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontSize:"0.9rem"},children:"Datum *"}),t.jsx("input",{type:"date",value:F.datum,onChange:e=>_({...F,datum:e.target.value}),className:"form-input",required:!0,style:{width:"100%"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontSize:"0.9rem"},children:"Betrag (EUR) *"}),t.jsx("input",{type:"number",step:"0.01",min:"0",value:F.betrag,onChange:e=>_({...F,betrag:e.target.value}),className:"form-input",placeholder:"0,00",required:!0,style:{width:"100%"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontSize:"0.9rem"},children:"Kategorie"}),t.jsx("select",{value:F.kategorie,onChange:e=>_({...F,kategorie:e.target.value}),className:"form-select",style:{width:"100%"},children:Object.entries(A).map(([e,r])=>t.jsx("option",{value:e,children:r},e))})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontSize:"0.9rem"},children:"Beschreibung *"}),t.jsx("input",{type:"text",value:F.beschreibung,onChange:e=>_({...F,beschreibung:e.target.value}),className:"form-input",placeholder:"z.B. Miete Januar 2026",required:!0,style:{width:"100%"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontSize:"0.9rem"},children:"Belegnummer (optional)"}),t.jsx("input",{type:"text",value:F.beleg_nummer,onChange:e=>_({...F,beleg_nummer:e.target.value}),className:"form-input",placeholder:"z.B. RE-2026-001",style:{width:"100%"}})]}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem"},children:[t.jsx("button",{type:"button",onClick:()=>W(!1),className:"btn btn-secondary",style:{flex:1},children:"Abbrechen"}),t.jsxs("button",{type:"submit",className:"btn btn-primary",style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[t.jsx(c,{size:18}),"Speichern"]})]})]})})]})}),t.jsx("div",{style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",border:"1px solid var(--border-primary)",overflow:"hidden"},children:b?t.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[t.jsx("div",{className:"loading-spinner"}),t.jsx("p",{children:"Lade Ausgaben..."})]}):0===p.length?t.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--text-secondary)"},children:[t.jsx(a,{size:48,style:{opacity:.3,marginBottom:"1rem"}}),t.jsx("p",{children:"Keine Ausgaben für den gewählten Zeitraum"})]}):t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:"var(--bg-secondary)"},children:[t.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Datum"}),t.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Kategorie"}),t.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Beschreibung"}),t.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Beleg"}),t.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600"},children:"Betrag"}),t.jsx("th",{style:{padding:"0.75rem",textAlign:"center",fontWeight:"600"},children:"Aktionen"})]})}),t.jsx("tbody",{children:p.map(e=>{return t.jsxs("tr",{style:{borderBottom:"1px solid var(--border-secondary)"},children:[t.jsx("td",{style:{padding:"0.75rem"},children:(r=e.datum,r?new Date(r).toLocaleDateString("de-DE"):"-")}),t.jsx("td",{style:{padding:"0.75rem"},children:t.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx($,{kategorie:e.kategorie}),A[e.kategorie]||e.kategorie]})}),t.jsx("td",{style:{padding:"0.75rem"},children:e.beschreibung}),t.jsx("td",{style:{padding:"0.75rem",color:"var(--text-secondary)"},children:e.beleg_nummer||"-"}),t.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600",color:"var(--error)"},children:T(e.betrag)}),t.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:t.jsxs("div",{style:{display:"flex",gap:"0.25rem",justifyContent:"center"},children:[t.jsx("button",{onClick:()=>(e=>{var t,r;_({datum:(null==(t=e.datum)?void 0:t.split("T")[0])||"",betrag:(null==(r=e.betrag)?void 0:r.toString())||"",beschreibung:e.beschreibung||"",beleg_nummer:e.beleg_nummer||"",kategorie:e.kategorie||"sonstiges"}),I(e.id),W(!0)})(e),className:"btn btn-icon",title:"Bearbeiten",children:t.jsx(g,{size:16})}),t.jsx("button",{onClick:()=>(async e=>{if(confirm("Ausgabe wirklich löschen?"))try{const t=await n(`${s.apiBaseUrl}/ausgaben/${e}`,{method:"DELETE"}),r=await t.json();r.success?E():alert(r.error||"Fehler beim Löschen")}catch(t){console.error("Fehler:",t),alert("Fehler beim Löschen")}})(e.id),className:"btn btn-icon",title:"Löschen",style:{color:"var(--error)"},children:t.jsx(m,{size:16})})]})})]},e.id);var r})})]})})})]})};export{C as default};
