import{a as e,j as s}from"./query-Caj74EYQ.js";import{u as n,r as t}from"./vendor-router-B2AaIOtG.js";import{u as a,b as i,e as r,f as l,c as o}from"./index-lGWqIYMX.js";import{b as c,a7 as d,d as h,N as m,c as u,aj as j,a9 as p,l as x,_ as g,M as b,C as f,ak as v,K as N,t as w,q as y,T as z,g as k}from"./icons-C9nQ4cWf.js";const S=()=>{const{dojos:r,activeDojo:l,switchDojo:o,loading:j,filter:p,setFilter:x}=a(),{user:g}=i(),b=n(),[f,v]=e.useState(!1),[N,w]=e.useState(""),[y,z]=e.useState({top:0,left:0}),k=e.useRef(null),S=e.useRef(null),A="all"===p;if(e.useEffect(()=>{f&&S.current&&setTimeout(()=>{var e;return null==(e=S.current)?void 0:e.focus()},100),f&&E()},[f]),e.useEffect(()=>{const e=e=>{f&&"Escape"===e.key&&v(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[f]),j)return s.jsx("div",{className:"dojo-switcher loading",children:s.jsx("div",{className:"spinner-small"})});if(!l)return s.jsx("div",{className:"dojo-switcher loading",children:s.jsx("div",{style:{color:"#ff6b35",fontSize:"0.85rem",padding:"10px"},children:"Kein Dojo gefunden"})});if(!r||0===r.length)return s.jsx("div",{className:"dojo-switcher loading",children:s.jsx("div",{style:{color:"#ff6b35",fontSize:"0.85rem",padding:"10px"},children:"Keine Dojos verfÃ¼gbar"})});const D=("admin"===(null==g?void 0:g.rolle)||"admin"===(null==g?void 0:g.role))&&null===(null==g?void 0:g.dojo_id),_="super-admin"===l,C="verband"===l,F="support"===l,T=Array.isArray(r)?r.filter(e=>{var s;return null==(s=e.dojoname)?void 0:s.toLowerCase().includes(N.toLowerCase())}):[],E=()=>{if(k.current){const e=k.current.getBoundingClientRect();z({top:e.bottom+8,left:e.left})}},I=F?{icon:"ðŸŽ«",label:"Support Center",color:"#10b981"}:C?{icon:"ðŸŒ",label:"TDA Verband",color:"#3B82F6"}:_?{icon:"ðŸ¢",label:"TDA Int'l Org",color:"#DAA520"}:A?{icon:"ðŸ“Š",label:"Alle Dojos",color:"#FF6B35"}:{icon:"ðŸ¥‹",label:(null==l?void 0:l.dojoname)||"Dojo",color:(null==l?void 0:l.farbe)||"#FFD700"},$=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e||0);return s.jsxs("div",{className:"dojo-switcher",children:[s.jsxs("button",{ref:k,className:"dojo-switcher-trigger",onClick:e=>{e.preventDefault(),e.stopPropagation(),v(!f),f||w("")},title:"Workspace wechseln",type:"button",children:[s.jsx("div",{className:"dojo-switcher-indicator",style:{borderColor:I.color}}),s.jsxs("span",{className:"dojo-switcher-name",children:[I.icon," ",I.label]}),s.jsx(c,{size:14,className:"chevron "+(f?"open":"")})]}),f&&t.createPortal(s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"dojo-switcher-overlay",onClick:e=>{e.preventDefault(),e.stopPropagation(),v(!1)}}),s.jsxs("div",{className:"dojo-switcher-dropdown",style:{top:`${y.top}px`,left:`${y.left}px`},children:[s.jsxs("div",{className:"dropdown-search",children:[s.jsx(d,{size:14,className:"search-icon"}),s.jsx("input",{ref:S,type:"text",placeholder:"Suchen...",value:N,onChange:e=>w(e.target.value),onClick:e=>e.stopPropagation()})]}),s.jsxs("div",{className:"dropdown-list",children:[D&&!N&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"dropdown-section-header",children:[s.jsx(h,{size:12}),"Administration"]}),s.jsxs("button",{type:"button",className:"dropdown-item compact "+(_?"active":""),onClick:e=>{e.preventDefault(),e.stopPropagation(),o("super-admin"),x("current"),v(!1),w(""),b("/dashboard",{replace:!0})},style:{"--accent-color":"#DAA520"},children:[s.jsx("span",{className:"item-icon",children:"ðŸ¢"}),s.jsx("span",{className:"item-name",children:"TDA Int'l Org"}),s.jsx("span",{className:"item-badge gold",children:"Admin"})]}),s.jsxs("button",{type:"button",className:"dropdown-item compact "+(C?"active":""),onClick:e=>{e.preventDefault(),e.stopPropagation(),o("verband"),x("current"),v(!1),w(""),b("/dashboard",{replace:!0})},style:{"--accent-color":"#3B82F6"},children:[s.jsx("span",{className:"item-icon",children:"ðŸŒ"}),s.jsx("span",{className:"item-name",children:"TDA Verband"}),s.jsx("span",{className:"item-badge blue",children:"Verband"})]}),s.jsxs("button",{type:"button",className:"dropdown-item compact "+(F?"active":""),onClick:e=>{e.preventDefault(),e.stopPropagation(),o("support"),x("current"),v(!1),w(""),b("/dashboard",{replace:!0})},style:{"--accent-color":"#10b981"},children:[s.jsx("span",{className:"item-icon",children:"ðŸŽ«"}),s.jsx("span",{className:"item-name",children:"Support Center"}),s.jsx("span",{className:"item-badge green",children:"Support"})]}),s.jsxs("button",{type:"button",className:"dropdown-item compact "+(A?"active":""),onClick:e=>{e.preventDefault(),e.stopPropagation(),(()=>{if(r.length>0){const e=r.find(e=>e.ist_hauptdojo)||r[0];o(e)}x("all"),v(!1),w(""),b("/dashboard",{replace:!0})})()},style:{"--accent-color":"#FF6B35"},children:[s.jsx("span",{className:"item-icon",children:"ðŸ“Š"}),s.jsx("span",{className:"item-name",children:"Alle Dojos"}),s.jsx("span",{className:"item-badge orange",children:"Gesamt"})]})]}),T.length>0&&s.jsxs(s.Fragment,{children:[!N&&s.jsxs("div",{className:"dropdown-section-header",children:[s.jsx(m,{size:12}),"Dojos"]}),T.map(e=>{const n=(e=>{if("kleinunternehmer"===e.steuer_status){const s=e.jahresumsatz_aktuell||0,n=e.kleinunternehmer_grenze||22e3,t=Math.round(s/n*100);return{text:`${$(s)} / ${$(n)}`,percent:t,color:t>=90?"#ef4444":t>=75?"#f59e0b":"#22c55e"}}return{text:"Regelbesteuert",percent:null,color:"#6b7280"}})(e);return s.jsxs("button",{type:"button",className:"dropdown-item with-info "+(A||(null==l?void 0:l.id)!==e.id?"":"active"),onClick:s=>{s.preventDefault(),s.stopPropagation(),(e=>{o(e),x("current"),v(!1),w(""),b("/dashboard",{replace:!0})})(e)},style:{"--accent-color":e.farbe||"#FFD700"},children:[s.jsx("span",{className:"item-icon",children:"ðŸ¥‹"}),s.jsxs("div",{className:"item-content",children:[s.jsxs("div",{className:"item-row",children:[s.jsx("span",{className:"item-name",children:e.dojoname}),!!e.ist_hauptdojo&&s.jsx("span",{className:"item-badge primary",children:"Haupt"})]}),s.jsxs("div",{className:"item-info",style:{color:n.color},children:[n.text,null!==n.percent&&s.jsxs("span",{className:"item-percent",children:["(",n.percent,"%)"]})]})]})]},e.id)})]}),N&&0===T.length&&s.jsxs("div",{className:"dropdown-empty",children:['Keine Ergebnisse fÃ¼r "',N,'"']})]}),s.jsxs("div",{className:"dropdown-footer",children:[s.jsxs("a",{href:"/dashboard/dojos",className:"footer-link",onClick:()=>v(!1),children:[s.jsx(u,{size:12}),"Dojos verwalten"]}),s.jsx("span",{className:"footer-hint",children:"ESC zum SchlieÃŸen"})]})]})]}),document.body)]})},A=()=>{const{standorte:n,activeStandort:t,currentStandort:a,switchStandort:i,loading:l,hasMultipleLocations:o}=r(),[d,h]=e.useState(!1),[u,x]=e.useState({top:0,left:0}),g=e.useRef(null);if(!o)return null;if(e.useEffect(()=>{d&&f()},[d]),l)return s.jsx("div",{className:"standort-switcher loading",children:s.jsx("div",{className:"spinner-small"})});if(!n||0===n.length)return null;const b=e=>{i(e),h(!1)},f=()=>{if(g.current){const e=g.current.getBoundingClientRect(),s={top:e.bottom+8,left:e.left};x(s)}};return e.useEffect(()=>{const e=e=>{g.current&&!g.current.contains(e.target)&&h(!1)};return d&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[d]),s.jsxs("div",{className:"standort-switcher",children:[s.jsxs("button",{ref:g,className:"standort-switcher-trigger",onClick:e=>{e.preventDefault(),e.stopPropagation(),h(!d)},title:"Zwischen Standorten wechseln",type:"button",children:["all"===t?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"standort-color-indicator",style:{background:"linear-gradient(135deg, #10B981 0%, #3B82F6 100%)"}}),s.jsxs("div",{className:"standort-switcher-content",children:[s.jsx("div",{className:"standort-switcher-label",children:"Standort:"}),s.jsx("div",{className:"standort-switcher-name",children:"Alle Standorte"})]})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"standort-color-indicator",style:{background:(null==a?void 0:a.farbe)||"#4F46E5"}}),s.jsxs("div",{className:"standort-switcher-content",children:[s.jsx("div",{className:"standort-switcher-label",children:"Standort:"}),s.jsxs("div",{className:"standort-switcher-name",children:[(null==a?void 0:a.name)||"Unbekannt",(null==a?void 0:a.ist_hauptstandort)&&s.jsx("span",{className:"standort-badge",children:"Haupt"})]})]})]}),s.jsx(c,{size:16,className:"chevron "+(d?"open":"")})]}),d&&s.jsxs("div",{className:"standort-switcher-dropdown",style:{position:"fixed",top:`${u.top}px`,left:`${u.left}px`,zIndex:1e4},children:[s.jsxs("div",{className:"dropdown-header",children:[s.jsx(j,{size:14}),s.jsx("span",{children:"Standorte"})]}),s.jsxs("button",{className:"standort-option "+("all"===t?"active":""),onClick:()=>b("all"),children:[s.jsx("div",{className:"standort-option-indicator",style:{background:"linear-gradient(135deg, #10B981 0%, #3B82F6 100%)"}}),s.jsxs("div",{className:"standort-option-content",children:[s.jsxs("div",{className:"standort-option-name",children:[s.jsx(m,{size:14,style:{marginRight:"6px"}}),"Alle Standorte"]}),s.jsxs("div",{className:"standort-option-stats",children:[n.length," Standort",1!==n.length?"e":""]})]}),"all"===t&&s.jsx(p,{size:16,className:"check-icon"})]}),s.jsx("div",{className:"dropdown-divider"}),n.sort((e,s)=>e.ist_hauptstandort&&!s.ist_hauptstandort?-1:!e.ist_hauptstandort&&s.ist_hauptstandort?1:e.sortierung!==s.sortierung?e.sortierung-s.sortierung:(e.name||"").localeCompare(s.name||"")).map(e=>s.jsxs("button",{className:"standort-option "+(t===e.standort_id?"active":""),onClick:()=>b(e.standort_id),children:[s.jsx("div",{className:"standort-option-indicator",style:{background:e.farbe||"#4F46E5"}}),s.jsxs("div",{className:"standort-option-content",children:[s.jsxs("div",{className:"standort-option-name",children:[s.jsx(j,{size:14,style:{marginRight:"6px"}}),e.name,e.ist_hauptstandort&&s.jsx("span",{className:"standort-badge-small",children:"Haupt"})]}),s.jsxs("div",{className:"standort-option-stats",children:[e.anzahl_kurse||0," Kurse Â· ",e.anzahl_raeume||0," RÃ¤ume"]})]}),t===e.standort_id&&s.jsx(p,{size:16,className:"check-icon"})]},e.standort_id))]})]})},D=()=>{const[n,t]=e.useState([]),[a,i]=e.useState(!1),[r,c]=e.useState(null);e.useEffect(()=>{const e=async()=>{try{console.log("ðŸ” Checking for new registrations...");const e=await l(`${o.apiBaseUrl}/notifications/admin/unread`);console.log("ðŸ“¡ Response status:",e.status);const s=await e.json();if(console.log("ðŸ“¦ Response data:",s),s.success&&s.notifications&&s.notifications.length>0){console.log("âœ… Found notifications:",s.notifications.length);const e=s.notifications.filter(e=>"admin_alert"===e.type);console.log("ðŸš¨ Admin alerts found:",e.length),e.length>0&&(console.log("ðŸŽ‰ Showing popup with notification:",e[0]),t(e),c(e[0]),i(!0))}else console.log("â„¹ï¸ No new notifications")}catch(e){console.error("âŒ Fehler beim Abrufen der Benachrichtigungen:",e)}};console.log("ðŸš€ Starting notification checker..."),e();const s=setInterval(e,1e4);return()=>{console.log("ðŸ›‘ Stopping notification checker"),clearInterval(s)}},[]);const d=async()=>{if(r)try{await l(`/notifications/admin/${r.id}/read`,{method:"PUT"});const e=n.filter(e=>e.id!==r.id);t(e),e.length>0?c(e[0]):(i(!1),c(null))}catch(e){console.error("Fehler beim SchlieÃŸen der Benachrichtigung:",e),i(!1)}};if(!a||!r)return null;const h=(e=>{const s={};return e.split("<br>").forEach(e=>{const n=e.match(/<strong>(.*?):<\/strong>\s*(.*)/);if(n){const e=n[1].trim(),t=n[2].trim();s[e]=t}}),s})(r.message);return s.jsx("div",{className:"admin-registration-popup-overlay",children:s.jsxs("div",{className:"admin-registration-popup",children:[s.jsxs("div",{className:"popup-header",children:[s.jsxs("div",{className:"header-content",children:[s.jsx(x,{size:28,className:"header-icon"}),s.jsxs("div",{children:[s.jsx("h2",{children:r.subject}),s.jsx("p",{className:"timestamp",children:new Date(r.created_at).toLocaleString("de-DE")})]})]}),s.jsx("button",{className:"close-btn",onClick:d,children:s.jsx(g,{size:24})})]}),s.jsxs("div",{className:"popup-content",children:[s.jsx("div",{className:"notification-badge",children:n.length>1&&s.jsxs("span",{className:"badge",children:[n.length," neue Registrierung",n.length>1?"en":""]})}),s.jsxs("div",{className:"member-info-grid",children:[h.Name&&s.jsxs("div",{className:"info-item",children:[s.jsx(x,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Name"}),s.jsx("p",{children:h.Name})]})]}),h.Email&&s.jsxs("div",{className:"info-item",children:[s.jsx(b,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Email"}),s.jsx("p",{children:h.Email})]})]}),h.Geburtsdatum&&"N/A"!==h.Geburtsdatum&&s.jsxs("div",{className:"info-item",children:[s.jsx(f,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Geburtsdatum"}),s.jsx("p",{children:h.Geburtsdatum})]})]}),h.Telefon&&"N/A"!==h.Telefon&&s.jsxs("div",{className:"info-item",children:[s.jsx(v,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Telefon"}),s.jsx("p",{children:h.Telefon})]})]}),h.Adresse&&s.jsxs("div",{className:"info-item full-width",children:[s.jsx(j,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Adresse"}),s.jsx("p",{children:h.Adresse})]})]}),h.Tarif&&"N/A"!==h.Tarif&&s.jsxs("div",{className:"info-item full-width",children:[s.jsx(N,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"GewÃ¤hlter Tarif"}),s.jsx("p",{children:h.Tarif})]})]}),h.Vertragsbeginn&&"N/A"!==h.Vertragsbeginn&&s.jsxs("div",{className:"info-item",children:[s.jsx(f,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Vertragsbeginn"}),s.jsx("p",{children:h.Vertragsbeginn})]})]}),h.Zahlungszyklus&&"N/A"!==h.Zahlungszyklus&&s.jsxs("div",{className:"info-item",children:[s.jsx(N,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Zahlungszyklus"}),s.jsx("p",{children:h.Zahlungszyklus})]})]}),h.Zahlungsmethode&&"N/A"!==h.Zahlungsmethode&&s.jsxs("div",{className:"info-item",children:[s.jsx(N,{size:20}),s.jsxs("div",{children:[s.jsx("label",{children:"Zahlungsmethode"}),s.jsx("p",{children:h.Zahlungsmethode})]})]})]})]}),s.jsx("div",{className:"popup-footer",children:s.jsx("button",{className:"btn-primary",onClick:d,children:"OK, verstanden"})})]})})},_=({stats:e})=>{if(!e||!e.subscription_status)return null;const{subscription_status:n,trial_days_remaining:t,subscription_days_remaining:a,subscription_plan:i}=e;if("trial"===n){if(null===t||t<0)return null;let e="info",n=s.jsx(y,{size:24}),a="",i=!1;return 0===t?(e="danger",n=s.jsx(z,{size:24}),a="â° Ihre Testphase lÃ¤uft heute ab! SchlieÃŸen Sie jetzt ein Abonnement ab.",i=!0):1===t?(e="danger",n=s.jsx(z,{size:24}),a="â° Ihre Testphase lÃ¤uft morgen ab! SchlieÃŸen Sie jetzt ein Abonnement ab.",i=!0):t<=3?(e="warning",n=s.jsx(z,{size:24}),a=`âš ï¸ Ihre Testphase lÃ¤uft in ${t} Tagen ab. Sichern Sie sich jetzt Ihren Zugang.`,i=!0):t<=7?(e="warning",n=s.jsx(y,{size:24}),a=`Ihre Testphase lÃ¤uft noch ${t} Tage.`,i=!1):(e="info",n=s.jsx(k,{size:24}),a=`âœ“ Testphase aktiv - Noch ${t} Tage verbleibend.`,i=!1),s.jsxs("div",{className:`trial-banner trial-banner-${e}`,children:[s.jsx("div",{className:"trial-banner-icon",children:n}),s.jsx("div",{className:"trial-banner-content",children:s.jsx("div",{className:"trial-banner-message",children:a})}),i&&s.jsx("a",{href:"mailto:abo@tda-intl.org",className:"trial-banner-button",children:"Jetzt Abo abschlieÃŸen"})]})}if("active"===n){if(null!==a&&a<=14){let e=a<=3?"danger":"warning",n=a<=3?s.jsx(z,{size:24}):s.jsx(y,{size:24}),t=0===a?"â° Ihr Abonnement lÃ¤uft heute ab!":1===a?"â° Ihr Abonnement lÃ¤uft morgen ab!":`Ihr ${i||"Abonnement"} lÃ¤uft in ${a} Tagen ab.`;return s.jsxs("div",{className:`trial-banner trial-banner-${e}`,children:[s.jsx("div",{className:"trial-banner-icon",children:n}),s.jsx("div",{className:"trial-banner-content",children:s.jsx("div",{className:"trial-banner-message",children:t})}),s.jsx("a",{href:"mailto:abo@tda-intl.org",className:"trial-banner-button",children:"Jetzt verlÃ¤ngern"})]})}}else if("expired"===n)return s.jsxs("div",{className:"trial-banner trial-banner-expired",children:[s.jsx("div",{className:"trial-banner-icon",children:s.jsx(w,{size:24})}),s.jsx("div",{className:"trial-banner-content",children:s.jsx("div",{className:"trial-banner-message",children:"âŒ Ihr Zugang ist abgelaufen. Bitte schlieÃŸen Sie ein Abonnement ab."})}),s.jsx("a",{href:"mailto:abo@tda-intl.org",className:"trial-banner-button",children:"Jetzt Abo abschlieÃŸen"})]});return null};export{D as A,S as D,A as S,_ as T};
