import{j as e}from"./animation-1wuIdCBS.js";import{u as n,r as a}from"./vendor-router-BhMXg4Z-.js";import{k as s,c as t}from"./index-DUnH23_2.js";import{V as r,P as i,N as l,k as h,b as c,F as g,K as u,c as o,C as d,D as m,M as f}from"./icons-D7rg4pDH.js";import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";const x=()=>{const x=n(),[b,j]=a.useState(!0),[p,v]=a.useState(!1),[k,M]=a.useState({}),[z,N]=a.useState([{stufe:1,bezeichnung:"1. Mahnung (Zahlungserinnerung)",tage_nach_faelligkeit:14,mahngebuehr:5,email_betreff:"Zahlungserinnerung - Offener Beitrag",email_text:"Sehr geehrte/r {vorname} {nachname},\n\nwir möchten Sie freundlich daran erinnern, dass folgender Beitrag noch offen ist:\n\nBetrag: {betrag} €\nFällig seit: {faelligkeitsdatum}\n\nBitte überweisen Sie den Betrag zeitnah auf unser Konto.\n\nMit freundlichen Grüßen\nIhr Dojo-Team",aktiv:!0},{stufe:2,bezeichnung:"2. Mahnung (Erste Mahnung)",tage_nach_faelligkeit:28,mahngebuehr:10,email_betreff:"2. Mahnung - Dringend: Offener Beitrag",email_text:"Sehr geehrte/r {vorname} {nachname},\n\nleider haben wir bisher keine Zahlung erhalten. Dies ist Ihre 2. Mahnung.\n\nBetrag: {betrag} €\nFällig seit: {faelligkeitsdatum}\nMahngebühr: {mahngebuehr} €\nGesamtbetrag: {gesamtbetrag} €\n\nBitte begleichen Sie den Betrag umgehend.\n\nMit freundlichen Grüßen\nIhr Dojo-Team",aktiv:!0},{stufe:3,bezeichnung:"3. Mahnung (Letzte Mahnung)",tage_nach_faelligkeit:42,mahngebuehr:15,email_betreff:"3. Mahnung - LETZTE ZAHLUNGSAUFFORDERUNG",email_text:"Sehr geehrte/r {vorname} {nachname},\n\ntrotz mehrfacher Aufforderung ist der fällige Betrag noch nicht eingegangen. Dies ist unsere letzte Mahnung vor rechtlichen Schritten.\n\nBetrag: {betrag} €\nFällig seit: {faelligkeitsdatum}\nMahngebühr: {mahngebuehr} €\nGesamtbetrag: {gesamtbetrag} €\n\nBitte zahlen Sie SOFORT, um weitere Maßnahmen zu vermeiden.\n\nMit freundlichen Grüßen\nIhr Dojo-Team",aktiv:!0}]);a.useEffect(()=>{y()},[]);const y=async()=>{try{j(!0);const e=await s(`${t.apiBaseUrl}/mahnwesen/mahnstufen-einstellungen`);if(e.ok){const n=await e.json();n.success&&n.data.length>0&&N(n.data)}j(!1)}catch(e){console.error("Fehler beim Laden der Mahnstufen-Einstellungen:",e),j(!1)}},_=async()=>{if(window.confirm("Mahnstufen-Einstellungen speichern?"))try{v(!0);if(!(await s(`${t.apiBaseUrl}/mahnwesen/mahnstufen-einstellungen`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mahnstufen:z})})).ok)throw new Error("Fehler beim Speichern");alert("Mahnstufen-Einstellungen erfolgreich gespeichert!"),v(!1)}catch(e){console.error("Fehler beim Speichern:",e),alert("Fehler beim Speichern der Einstellungen"),v(!1)}},S=(e,n,a)=>{const s=[...z];s[e][n]=a,N(s)};return b?e.jsx("div",{className:"mahnstufen-container",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Lade Mahnstufen-Einstellungen..."})]})}):e.jsxs("div",{className:"mahnstufen-container",children:[e.jsxs("div",{className:"mahnstufen-header",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:()=>x("/dashboard/beitraege"),children:[e.jsx(r,{size:20}),"Zurück"]}),e.jsxs("div",{children:[e.jsx("h1",{children:"⚙️ Mahnstufen-Einstellungen"}),e.jsx("p",{children:"Konfiguriere die automatischen Mahnprozesse und Gebühren"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("button",{className:"btn btn-success",onClick:()=>{const e=z.length+1,n={stufe:e,bezeichnung:`${e}. Mahnung`,tage_nach_faelligkeit:14*e,mahngebuehr:5*e,email_betreff:`${e}. Mahnung`,email_text:"Sehr geehrte/r {vorname} {nachname},\n\n...\n\nMit freundlichen Grüßen\nIhr Dojo-Team",aktiv:!0};N([...z,n])},children:[e.jsx(i,{size:20}),"Mahnstufe hinzufügen"]}),e.jsxs("button",{className:"btn btn-primary",onClick:_,disabled:p,children:[e.jsx(l,{size:20}),p?"Speichere...":"Speichern"]})]})]}),e.jsxs("div",{className:"info-box",children:[e.jsx(h,{size:24}),e.jsxs("div",{children:[e.jsx("h3",{children:"Verfügbare Platzhalter für Email-Texte:"}),e.jsxs("p",{children:[e.jsx("strong",{children:"{vorname}"})," - Vorname des Mitglieds |",e.jsx("strong",{children:" {nachname}"})," - Nachname |",e.jsx("strong",{children:" {betrag}"})," - Offener Betrag |",e.jsx("strong",{children:" {faelligkeitsdatum}"})," - Fälligkeitsdatum |",e.jsx("strong",{children:" {mahngebuehr}"})," - Mahngebühr |",e.jsx("strong",{children:" {gesamtbetrag}"})," - Gesamt (Betrag + Gebühr)"]})]})]}),z.map((n,a)=>e.jsxs("div",{className:"mahnstufe-card",children:[e.jsxs("div",{className:"mahnstufe-header collapsible",onClick:()=>{return e=n.stufe,void M(n=>({...n,[e]:!n[e]}));var e},style:{cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{transform:k[n.stufe]?"rotate(-90deg)":"rotate(0deg)",transition:"transform 0.3s ease"},children:e.jsx(c,{size:20})}),e.jsxs("h2",{children:[e.jsx(g,{size:20}),"Mahnstufe ",n.stufe," - ",n.bezeichnung]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},onClick:e=>e.stopPropagation(),children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:n.aktiv,onChange:e=>S(a,"aktiv",e.target.checked)}),"Aktiv"]}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:e=>{e.stopPropagation(),(e=>{if(!window.confirm("Mahnstufe wirklich löschen?"))return;const n=z.filter((n,a)=>a!==e);n.forEach((e,n)=>{e.stufe=n+1}),N(n)})(a)},title:"Mahnstufe löschen",children:e.jsx(u,{size:16})})]})]}),!k[n.stufe]&&e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group full-width",children:[e.jsxs("label",{children:[e.jsx(o,{size:16}),"Bezeichnung"]}),e.jsx("input",{type:"text",value:n.bezeichnung,onChange:e=>S(a,"bezeichnung",e.target.value),placeholder:"z.B. 1. Mahnung (Zahlungserinnerung)"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(d,{size:16}),"Tage nach Fälligkeit"]}),e.jsx("input",{type:"number",value:n.tage_nach_faelligkeit,onChange:e=>S(a,"tage_nach_faelligkeit",parseInt(e.target.value)),min:"1",placeholder:"14"}),e.jsx("small",{children:"Nach wie vielen Tagen die Mahnung erstellt wird"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(m,{size:16}),"Mahngebühr (€)"]}),e.jsx("input",{type:"number",step:"0.01",value:n.mahngebuehr,onChange:e=>S(a,"mahngebuehr",parseFloat(e.target.value)),min:"0",placeholder:"5.00"}),e.jsx("small",{children:"Gebühr für diese Mahnstufe"})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsxs("label",{children:[e.jsx(f,{size:16}),"Email-Betreff"]}),e.jsx("input",{type:"text",value:n.email_betreff,onChange:e=>S(a,"email_betreff",e.target.value),placeholder:"Zahlungserinnerung - Offener Beitrag"})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsxs("label",{children:[e.jsx(g,{size:16}),"Email-Text"]}),e.jsx("textarea",{value:n.email_text,onChange:e=>S(a,"email_text",e.target.value),rows:"10",placeholder:"Text der Email-Mahnung..."})]})]})]},n.stufe)),e.jsx("div",{className:"save-footer",children:e.jsxs("button",{className:"btn btn-primary btn-large",onClick:_,disabled:p,children:[e.jsx(l,{size:20}),p?"Speichere Einstellungen...":"Alle Einstellungen speichern"]})})]})};export{x as default};
