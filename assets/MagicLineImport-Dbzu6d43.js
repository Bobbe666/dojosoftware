import{a as e,j as s}from"./query-Caj74EYQ.js";import{bv as t,F as r,a4 as a,bq as l,k as i,g as n,o as d,K as o}from"./icons-C9nQ4cWf.js";const c=()=>{var c;const[m,x]=e.useState(null),[g,p]=e.useState(!1),[h,u]=e.useState(null),[b,j]=e.useState(null);return s.jsx("div",{className:"container mx-auto p-6 max-w-6xl",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx(t,{className:"w-8 h-8 text-blue-600"}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"MagicLine Import"}),s.jsx("p",{className:"text-gray-600",children:"Importiere Mitglieder, VertrÃ¤ge und Dokumente aus MagicLine"})]})]}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(r,{className:"w-5 h-5 text-blue-600 mt-0.5"}),s.jsxs("div",{className:"text-sm text-blue-800",children:[s.jsx("p",{className:"font-semibold mb-2",children:"So funktioniert der Import:"}),s.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[s.jsx("li",{children:"Exportiere deine Daten aus MagicLine als ZIP-Datei"}),s.jsx("li",{children:"Lade die ZIP-Datei hier hoch"}),s.jsxs("li",{children:["Das System importiert automatisch:",s.jsxs("ul",{className:"list-disc list-inside ml-6 mt-1",children:[s.jsx("li",{children:"Mitgliederdaten (Name, Adresse, Geburtsdatum, etc.)"}),s.jsx("li",{children:"Vertragsdaten (Original-Startdatum, Laufzeit, Tarif)"}),s.jsx("li",{children:"SEPA-Mandate (Bankverbindung, Mandatsreferenz)"}),s.jsx("li",{children:"PDF-Dokumente (VertrÃ¤ge, SEPA-Mandate)"})]})]})]})]})]})}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"MagicLine Export (ZIP-Datei)"}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsx("input",{type:"file",accept:".zip",onChange:e=>{const s=e.target.files[0];s&&s.name.endsWith(".zip")?(x(s),j(null)):(j("Bitte wÃ¤hle eine ZIP-Datei aus"),x(null))},disabled:g,className:"block w-full text-sm text-gray-500\n                  file:mr-4 file:py-2 file:px-4\n                  file:rounded-lg file:border-0\n                  file:text-sm file:font-semibold\n                  file:bg-blue-50 file:text-blue-700\n                  hover:file:bg-blue-100\n                  disabled:opacity-50 disabled:cursor-not-allowed"})}),s.jsx("button",{onClick:async()=>{if(!m)return void j("Bitte wÃ¤hle zuerst eine Datei aus");console.log("ðŸš€ Starting import...",{fileName:m.name,fileSize:`${(m.size/1024/1024).toFixed(2)} MB`,fileType:m.type}),p(!0),j(null);const e=new FormData;e.append("zipFile",m);try{const s=localStorage.getItem("dojo_auth_token");console.log("ðŸ“¤ Uploading to /api/magicline-import/upload...");const t=await fetch("/api/magicline-import/upload",{method:"POST",headers:{Authorization:`Bearer ${s}`},body:e});console.log("ðŸ“¥ Response received:",{status:t.status,statusText:t.statusText,contentType:t.headers.get("content-type")});const r=t.headers.get("content-type");if(!r||!r.includes("application/json")){const e=await t.text();throw console.error("âŒ Non-JSON response:",e.substring(0,500)),new Error(`Server-Fehler: ${e.substring(0,200)}`)}const a=await t.json();if(console.log("âœ… Import data:",a),!t.ok)throw new Error(a.error||"Import fehlgeschlagen");u(a.results),x(null)}catch(s){console.error("âŒ Import error:",s),j(s.message)}finally{p(!1)}},disabled:!m||g,className:"px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold\n                hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed\n                flex items-center gap-2 transition-colors",children:g?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Importiere..."]}):s.jsxs(s.Fragment,{children:[s.jsx(a,{className:"w-5 h-5"}),"Import starten"]})})]}),m&&!g&&s.jsxs("p",{className:"mt-2 text-sm text-green-600 flex items-center gap-2",children:[s.jsx(l,{className:"w-4 h-4"}),"Datei ausgewÃ¤hlt: ",m.name," (",(m.size/1024/1024).toFixed(2)," MB)"]})]}),b&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:s.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[s.jsx(i,{className:"w-5 h-5"}),s.jsx("p",{className:"font-semibold",children:b})]})}),h&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-green-800 mb-3",children:[s.jsx(n,{className:"w-5 h-5"}),s.jsx("p",{className:"font-semibold",children:"Import erfolgreich abgeschlossen!"})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[s.jsxs("div",{className:"bg-white rounded-lg p-3 border border-green-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(d,{className:"w-4 h-4 text-blue-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Mitglieder"})]}),s.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[h.successful," / ",h.totalMembers]})]}),s.jsxs("div",{className:"bg-white rounded-lg p-3 border border-green-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(r,{className:"w-4 h-4 text-purple-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"VertrÃ¤ge"})]}),s.jsx("p",{className:"text-2xl font-bold text-gray-800",children:h.logs.filter(e=>{var s;return null==(s=e.imported)?void 0:s.contract}).length})]}),s.jsxs("div",{className:"bg-white rounded-lg p-3 border border-green-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(o,{className:"w-4 h-4 text-green-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"SEPA-Mandate"})]}),s.jsx("p",{className:"text-2xl font-bold text-gray-800",children:h.logs.filter(e=>{var s;return null==(s=e.imported)?void 0:s.sepaMandate}).length})]}),s.jsxs("div",{className:"bg-white rounded-lg p-3 border border-green-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(l,{className:"w-4 h-4 text-orange-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Dokumente"})]}),s.jsx("p",{className:"text-2xl font-bold text-gray-800",children:h.logs.reduce((e,s)=>{var t;return e+((null==(t=s.imported)?void 0:t.documents)||0)},0)})]}),s.jsxs("div",{className:"bg-white rounded-lg p-3 border border-green-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(o,{className:"w-4 h-4 text-indigo-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Zahlungen"})]}),s.jsx("p",{className:"text-2xl font-bold text-gray-800",children:h.logs.reduce((e,s)=>{var t;return e+((null==(t=s.imported)?void 0:t.payments)||0)},0)})]})]}),s.jsxs("p",{className:"text-sm text-gray-600 mt-3",children:["Dauer: ",null==(c=h.duration)?void 0:c.toFixed(1)," Sekunden"]})]}),s.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[s.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Import-Details"}),s.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:h.logs.map((e,t)=>{var r,a,l,d,o;return s.jsxs("div",{className:"p-3 rounded-lg border "+(e.success?"bg-white border-green-200":"bg-red-50 border-red-200"),children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[e.success?s.jsx(n,{className:"w-4 h-4 text-green-600"}):s.jsx(i,{className:"w-4 h-4 text-red-600"}),s.jsx("span",{className:"font-medium text-gray-800",children:e.memberNumber})]}),s.jsxs("div",{className:"flex gap-2 text-xs flex-wrap",children:[(null==(r=e.imported)?void 0:r.member)&&s.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded",children:"Mitglied"}),(null==(a=e.imported)?void 0:a.contract)&&s.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 rounded",children:"Vertrag"}),(null==(l=e.imported)?void 0:l.sepaMandate)&&s.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded",children:"SEPA"}),(null==(d=e.imported)?void 0:d.payments)>0&&s.jsxs("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-700 rounded",children:[e.imported.payments," Zahl."]}),(null==(o=e.imported)?void 0:o.documents)>0&&s.jsxs("span",{className:"px-2 py-1 bg-orange-100 text-orange-700 rounded",children:[e.imported.documents," Dok."]})]})]}),e.errors&&e.errors.length>0&&s.jsx("div",{className:"mt-2 text-sm text-red-600",children:e.errors.map((e,t)=>s.jsxs("p",{children:["â€¢ ",e]},t))}),e.warnings&&e.warnings.length>0&&s.jsx("div",{className:"mt-2 text-sm text-yellow-600",children:e.warnings.map((e,t)=>s.jsxs("p",{children:["â€¢ ",e]},t))})]},t)})})]}),s.jsx("button",{onClick:()=>u(null),className:"w-full py-2 bg-gray-100 text-gray-700 rounded-lg font-medium\n                hover:bg-gray-200 transition-colors",children:"Neuen Import starten"})]})]})})};export{c as default};
