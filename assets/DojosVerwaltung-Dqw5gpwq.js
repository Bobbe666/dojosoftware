import{a as e,j as s}from"./query-Caj74EYQ.js";import{f as a,c as t}from"./index-Bcs73ipe.js";import{P as r,r as i,a2 as n,t as l}from"./icons-DiLw-1i5.js";import{u as d}from"./vendor-router-Co3o87Zc.js";import"./charts-C1Gv3M_c.js";const c=()=>{const c=d(),[o,h]=e.useState([]),[j,m]=e.useState(!1),[u,x]=e.useState(""),[g,v]=e.useState(null);e.useEffect(()=>{N(),p()},[]);const N=async()=>{m(!0);try{const e=await a(`${t.apiBaseUrl}/admin/dojos?filter=managed`);if(!e.ok)throw new Error("Fehler beim Laden der Dojos");const s=await e.json();h(s.dojos||s)}catch(e){x("Fehler beim Laden der Dojos"),console.error(e)}finally{m(!1)}},p=async()=>{try{const e=await a(`${t.apiBaseUrl}/admin/dojos?filter=managed`);if(!e.ok)throw new Error("Fehler beim Laden der Dojos");const s=await e.json(),r=s.dojos||s,i={dojos_anzahl:r.length,mitglieder_gesamt:r.reduce((e,s)=>e+(s.mitglieder_anzahl||0),0),umsatz_gesamt:r.reduce((e,s)=>e+(s.jahresumsatz_aktuell||0),0),ust_gesamt:r.reduce((e,s)=>{const a=s.jahresumsatz_aktuell||0;return e+("regelbesteuert"===s.steuer_status?.19*a:0)},0)};v(i)}catch(e){console.error("Fehler beim Laden der Statistiken:",e)}},b=e=>{if("kleinunternehmer"===e.steuer_status){const a=e.jahresumsatz_aktuell/e.kleinunternehmer_grenze*100;return a>=100?s.jsx("span",{className:"badge badge-danger",children:"Grenze Ã¼berschritten"}):a>=80?s.jsxs("span",{className:"badge badge-warning",children:[a.toFixed(0),"% erreicht"]}):s.jsx("span",{className:"badge badge-success",children:"Kleinunternehmer"})}return s.jsxs("span",{className:"badge badge-info",children:["USt-pflichtig (",e.ust_satz,"%)"]})};return s.jsxs("div",{className:"dojos-verwaltung",children:[s.jsxs("div",{className:"page-header",children:[s.jsx("h1",{children:"Multi-Dojo-Verwaltung"}),s.jsx("p",{children:"Verwalten Sie mehrere GeschÃ¤fte mit separater Steuerverwaltung"}),s.jsxs("button",{className:"btn-primary",onClick:()=>c("/dashboard/dojos/new"),children:[s.jsx(r,{size:20}),"Neues Dojo hinzufÃ¼gen"]})]}),u&&s.jsx("div",{className:"message "+(u.includes("erfolgreich")?"success":"error"),children:u}),g&&s.jsxs("div",{className:"gesamt-statistiken",children:[s.jsx("h2",{children:"Gesamt-Ãœbersicht (alle Dojos)"}),s.jsxs("div",{className:"stats-grid",children:[s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon",children:"ðŸ¢"}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-value",children:g.dojos_anzahl}),s.jsx("div",{className:"stat-label",children:"Aktive Dojos"})]})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon",children:"ðŸ‘¥"}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-value",children:g.mitglieder_gesamt}),s.jsx("div",{className:"stat-label",children:"Mitglieder gesamt"})]})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon",children:"ðŸ’°"}),s.jsxs("div",{className:"stat-content",children:[s.jsxs("div",{className:"stat-value",children:[parseFloat(g.umsatz_gesamt||0).toLocaleString("de-DE")," EUR"]}),s.jsxs("div",{className:"stat-label",children:["Gesamtumsatz ",(new Date).getFullYear()]})]})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon",children:"ðŸ§¾"}),s.jsxs("div",{className:"stat-content",children:[s.jsxs("div",{className:"stat-value",children:[parseFloat(g.ust_gesamt||0).toLocaleString("de-DE")," EUR"]}),s.jsx("div",{className:"stat-label",children:"USt zu zahlen"})]})]})]})]}),s.jsxs("div",{className:"dojos-list",children:[s.jsx("h2",{children:"Ihre Dojos"}),j?s.jsx("div",{className:"loading",children:"Laden..."}):0===o.length?s.jsxs("div",{className:"empty-state",children:[s.jsx(i,{size:64}),s.jsx("p",{children:"Noch keine Dojos vorhanden"})]}):s.jsx("div",{className:"dojos-grid",children:o.map(e=>s.jsxs("div",{className:"dojo-card",style:{borderLeftColor:e.farbe},children:[s.jsxs("div",{className:"dojo-header",children:[s.jsx("div",{className:"dojo-icon",style:{backgroundColor:e.farbe},children:"ðŸ¢"}),s.jsxs("div",{className:"dojo-info",children:[s.jsx("h3",{children:e.dojoname}),s.jsx("p",{className:"dojo-inhaber",children:e.inhaber}),e.ist_hauptdojo&&s.jsx("span",{className:"badge badge-primary",children:"Haupt-Dojo"}),b(e)]})]}),s.jsxs("div",{className:"dojo-details",children:[s.jsxs("div",{className:"detail-row",children:[s.jsx("span",{children:"ðŸ“"}),s.jsxs("span",{children:[e.strasse," ",e.hausnummer,", ",e.plz," ",e.ort]})]}),s.jsxs("div",{className:"detail-row",children:[s.jsx("span",{children:"ðŸ“§"}),s.jsx("span",{children:e.email})]}),s.jsxs("div",{className:"detail-row",children:[s.jsx("span",{children:"ðŸ’°"}),s.jsxs("span",{children:["Umsatz ",(new Date).getFullYear(),": ",parseFloat(e.jahresumsatz_aktuell||0).toLocaleString("de-DE")," EUR"]})]}),"kleinunternehmer"===e.steuer_status&&s.jsxs("div",{className:"detail-row",children:[s.jsx("span",{children:"ðŸ“Š"}),s.jsxs("span",{children:["Grenze: ",parseFloat(e.kleinunternehmer_grenze||0).toLocaleString("de-DE")," EUR (",(e.jahresumsatz_aktuell/e.kleinunternehmer_grenze*100).toFixed(1),"%)"]})]})]}),s.jsxs("div",{className:"dojo-actions",children:[s.jsxs("button",{className:"btn-action btn-edit",onClick:()=>c(`/dashboard/dojos/edit/${e.id}`),children:[s.jsx(n,{size:18}),"Bearbeiten"]}),!e.ist_hauptdojo&&s.jsxs("button",{className:"btn-action btn-delete",onClick:()=>(async e=>{if(window.confirm("MÃ¶chten Sie dieses Dojo wirklich deaktivieren?"))try{const s=await a(`${t.apiBaseUrl}/admin/dojos/${e}`,{method:"DELETE"});if(!s.ok){const e=await s.json();throw new Error(e.error)}x("Dojo erfolgreich deaktiviert"),N()}catch(s){x(`Fehler: ${s.message}`)}})(e.id),children:[s.jsx(l,{size:18}),"Deaktivieren"]})]})]},e.id))})]})]})};export{c as default};
