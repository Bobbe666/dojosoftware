import{a as e,j as s}from"./query-Caj74EYQ.js";import{b as n,a,u as t,c as i}from"./index-Bcs73ipe.js";import{g as l,k as r,b2 as c,bk as d,P as o,bl as h,bm as m,af as u,bn as g,bo as p,t as x,w as j,R as v,aG as b,bp as f,o as N,C as k}from"./icons-DiLw-1i5.js";/* empty css                  */import"./vendor-router-Co3o87Zc.js";import"./charts-C1Gv3M_c.js";const y=()=>{const{activeDojo:t}=n(),[i,N]=e.useState(!0),[k,y]=e.useState([]),[w,_]=e.useState([]),[E,S]=e.useState(!1),[C,F]=e.useState({type:"",text:""}),[A,z]=e.useState(!1),[D,$]=e.useState(""),[L,G]=e.useState(""),[I,P]=e.useState([]),[B,T]=e.useState(""),[M,V]=e.useState(!1),U=e.useRef(null);e.useEffect(()=>{O()},[t]);const O=async()=>{var e;try{N(!0);const e=await a.get("/marketing-aktionen/status");S(e.data.configured);const s=await a.get("/marketing-aktionen/accounts");y(s.data);const n=await a.get("/marketing-aktionen/posts");_(n.data)}catch(s){console.error("Fehler beim Laden:",s),401!==(null==(e=s.response)?void 0:e.status)&&J("error","Fehler beim Laden der Daten")}finally{N(!1)}},R=async()=>{var e,s;try{const e=await a.get("/marketing-aktionen/accounts/connect");e.data.authUrl&&(window.location.href=e.data.authUrl)}catch(n){console.error("Fehler beim Verbinden:",n),J("error",(null==(s=null==(e=n.response)?void 0:e.data)?void 0:s.message)||"Fehler beim Verbinden")}},W=async(e=!1)=>{var s,n;if(!D.trim())return void J("error","Bitte gib einen Text ein");if(!L)return void J("error","Bitte w√§hle einen Account aus");const t=k.find(e=>e.id===parseInt(L));if("instagram"!==(null==t?void 0:t.platform)||0!==I.length)try{V(!0);const s=new FormData;s.append("content",D),s.append("social_account_id",L),B&&s.append("scheduled_at",B),I.forEach(e=>{s.append("media",e)}),s.append("post_type",I.length>0?"image":"text");const n=await a.post("/marketing-aktionen/posts",s,{headers:{"Content-Type":"multipart/form-data"}});e?(await a.post(`/marketing-aktionen/posts/${n.data.postId}/publish`),J("success","Post erfolgreich ver√∂ffentlicht!")):J("success",B?"Post geplant!":"Post als Entwurf gespeichert"),$(""),G(""),P([]),T(""),z(!1),O()}catch(i){console.error("Fehler beim Erstellen:",i),J("error",(null==(n=null==(s=i.response)?void 0:s.data)?void 0:n.details)||"Fehler beim Erstellen des Posts")}finally{V(!1)}else J("error","Instagram Posts ben√∂tigen mindestens ein Bild")},J=(e,s)=>{F({type:e,text:s}),setTimeout(()=>F({type:"",text:""}),5e3)},K=e=>"facebook"===e?s.jsx(h,{size:18}):s.jsx(f,{size:18}),q=e=>{const n={draft:{class:"status-draft",text:"Entwurf"},scheduled:{class:"status-scheduled",text:"Geplant"},published:{class:"status-published",text:"Ver√∂ffentlicht"},failed:{class:"status-failed",text:"Fehlgeschlagen"}}[e]||{class:"",text:e};return s.jsx("span",{className:`post-status-badge ${n.class}`,children:n.text})};return e.useEffect(()=>{const e=new URLSearchParams(window.location.search),s=e.get("success"),n=e.get("error");if("connected"===s)J("success","Social Media Account erfolgreich verbunden!"),window.history.replaceState({},"",window.location.pathname);else if(n){J("error",{oauth_denied:"Autorisierung wurde abgelehnt",invalid_callback:"Ung√ºltiger Callback",invalid_state:"Ung√ºltiger State Token",connection_failed:"Verbindung fehlgeschlagen"}[n]||"Ein Fehler ist aufgetreten"),window.history.replaceState({},"",window.location.pathname)}},[]),i?s.jsxs("div",{className:"marketing-loading",children:[s.jsx("div",{className:"spinner"}),s.jsx("p",{children:"Wird geladen..."})]}):s.jsxs("div",{className:"marketing-aktionen",children:[C.text&&s.jsxs("div",{className:`marketing-message ${C.type}`,children:["success"===C.type?s.jsx(l,{size:20}):s.jsx(r,{size:20}),s.jsx("span",{children:C.text})]}),!E&&s.jsxs("div",{className:"marketing-warning",children:[s.jsx(r,{size:24}),s.jsxs("div",{children:[s.jsx("strong",{children:"Meta API nicht konfiguriert"}),s.jsx("p",{children:"Um Social Media Funktionen zu nutzen, m√ºssen META_APP_ID, META_APP_SECRET und META_REDIRECT_URI in der .env Datei gesetzt werden."}),s.jsxs("a",{href:"https://developers.facebook.com/",target:"_blank",rel:"noopener noreferrer",children:["Meta Developer Portal ",s.jsx(c,{size:14})]})]})]}),s.jsxs("div",{className:"marketing-section",children:[s.jsxs("div",{className:"section-header",children:[s.jsxs("h3",{children:[s.jsx(d,{size:20})," Verbundene Accounts"]}),E&&s.jsxs("button",{className:"btn btn-primary btn-sm",onClick:R,children:[s.jsx(o,{size:16})," Account verbinden"]})]}),0===k.length?s.jsxs("div",{className:"empty-accounts",children:[s.jsx("p",{children:"Keine Social Media Accounts verbunden."}),E&&s.jsxs("button",{className:"btn btn-primary",onClick:R,children:[s.jsx(h,{size:18})," Facebook / Instagram verbinden"]})]}):s.jsx("div",{className:"accounts-grid",children:k.map(e=>s.jsxs("div",{className:`account-card ${e.platform}`,children:[s.jsx("div",{className:"account-icon",children:K(e.platform)}),s.jsxs("div",{className:"account-info",children:[s.jsx("strong",{children:e.account_name}),e.page_name&&s.jsx("span",{className:"page-name",children:e.page_name}),s.jsx("span",{className:"token-status "+(e.token_valid?"valid":"expired"),children:e.token_valid?e.token_expires_soon?"Token l√§uft bald ab":"Verbunden":"Token abgelaufen"})]}),s.jsx("button",{className:"btn btn-icon btn-danger",onClick:()=>(async e=>{if(window.confirm("M√∂chtest du diesen Account wirklich trennen?"))try{await a.delete(`/marketing-aktionen/accounts/${e}`),J("success","Account erfolgreich getrennt"),O()}catch(s){console.error("Fehler beim Trennen:",s),J("error","Fehler beim Trennen des Accounts")}})(e.id),title:"Trennen",children:s.jsx(m,{size:16})})]},e.id))})]}),k.length>0&&s.jsxs("div",{className:"marketing-section",children:[s.jsxs("div",{className:"section-header",children:[s.jsxs("h3",{children:[s.jsx(u,{size:20})," Neuer Post"]}),!A&&s.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>z(!0),children:[s.jsx(o,{size:16})," Post erstellen"]})]}),A&&s.jsxs("div",{className:"post-form",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Account ausw√§hlen"}),s.jsxs("select",{value:L,onChange:e=>G(e.target.value),className:"form-select",children:[s.jsx("option",{value:"",children:"-- Account w√§hlen --"}),k.map(e=>s.jsxs("option",{value:e.id,children:["facebook"===e.platform?"üìò":"üì∏"," ",e.account_name,e.page_name?` (${e.page_name})`:""]},e.id))]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Inhalt"}),s.jsx("textarea",{value:D,onChange:e=>$(e.target.value),placeholder:"Was m√∂chtest du teilen?",rows:4,className:"form-textarea",maxLength:2200}),s.jsxs("span",{className:"char-count",children:[D.length," / 2200"]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Medien (optional f√ºr Facebook, erforderlich f√ºr Instagram)"}),s.jsx("input",{type:"file",ref:U,onChange:e=>{const s=Array.from(e.target.files);s.length+I.length>10?J("error","Maximal 10 Dateien erlaubt"):P([...I,...s])},accept:"image/jpeg,image/png,image/gif,image/webp,video/mp4",multiple:!0,style:{display:"none"}}),s.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>{var e;return null==(e=U.current)?void 0:e.click()},children:[s.jsx(g,{size:16})," Bild/Video hinzuf√ºgen"]}),I.length>0&&s.jsx("div",{className:"media-preview",children:I.map((e,n)=>s.jsxs("div",{className:"media-item",children:[e.type.startsWith("video")?s.jsx(p,{size:24}):s.jsx("img",{src:URL.createObjectURL(e),alt:""}),s.jsx("button",{className:"remove-media",onClick:()=>(e=>{P(I.filter((s,n)=>n!==e))})(n),children:s.jsx(x,{size:14})}),s.jsx("span",{className:"media-name",children:e.name})]},n))})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Zeitplanung (optional)"}),s.jsx("input",{type:"datetime-local",value:B,onChange:e=>T(e.target.value),className:"form-input",min:(new Date).toISOString().slice(0,16)})]}),s.jsxs("div",{className:"form-actions",children:[s.jsx("button",{className:"btn btn-secondary",onClick:()=>{z(!1),$(""),G(""),P([]),T("")},children:"Abbrechen"}),s.jsxs("button",{className:"btn btn-outline",onClick:()=>W(!1),disabled:M,children:[B?s.jsx(j,{size:16}):s.jsx(u,{size:16}),B?"Planen":"Als Entwurf speichern"]}),s.jsxs("button",{className:"btn btn-primary",onClick:()=>W(!0),disabled:M,children:[M?s.jsx(v,{size:16,className:"spinning"}):s.jsx(b,{size:16}),"Jetzt ver√∂ffentlichen"]})]})]})]}),s.jsxs("div",{className:"marketing-section",children:[s.jsxs("div",{className:"section-header",children:[s.jsxs("h3",{children:[s.jsx(b,{size:20})," Posts (",w.length,")"]}),s.jsx("button",{className:"btn btn-icon",onClick:O,title:"Aktualisieren",children:s.jsx(v,{size:16})})]}),0===w.length?s.jsx("div",{className:"empty-posts",children:s.jsx("p",{children:"Noch keine Posts erstellt."})}):s.jsx("div",{className:"posts-list",children:w.map(e=>s.jsxs("div",{className:`post-card ${e.status}`,children:[s.jsxs("div",{className:"post-header",children:[s.jsxs("div",{className:"post-platform",children:[K(e.platform),s.jsx("span",{children:e.account_name})]}),q(e.status)]}),s.jsxs("div",{className:"post-content",children:[s.jsx("p",{children:e.content}),e.media_urls&&JSON.parse(e.media_urls).length>0&&s.jsxs("div",{className:"post-media-count",children:[s.jsx(g,{size:14}),s.jsxs("span",{children:[JSON.parse(e.media_urls).length," Medien"]})]})]}),e.error_message&&s.jsxs("div",{className:"post-error",children:[s.jsx(r,{size:14}),s.jsx("span",{children:e.error_message})]}),s.jsxs("div",{className:"post-footer",children:[s.jsx("span",{className:"post-date",children:e.published_at?`Ver√∂ffentlicht: ${new Date(e.published_at).toLocaleString("de-DE")}`:e.scheduled_at?`Geplant: ${new Date(e.scheduled_at).toLocaleString("de-DE")}`:`Erstellt: ${new Date(e.created_at).toLocaleString("de-DE")}`}),s.jsxs("div",{className:"post-actions",children:[("draft"===e.status||"failed"===e.status)&&s.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>(async e=>{var s,n;try{V(!0),await a.post(`/marketing-aktionen/posts/${e}/publish`),J("success","Post erfolgreich ver√∂ffentlicht!"),O()}catch(t){console.error("Fehler beim Ver√∂ffentlichen:",t),J("error",(null==(n=null==(s=t.response)?void 0:s.data)?void 0:n.details)||"Fehler beim Ver√∂ffentlichen")}finally{V(!1)}})(e.id),disabled:M,children:[s.jsx(b,{size:14})," Ver√∂ffentlichen"]}),"published"!==e.status&&s.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>(async e=>{if(window.confirm("Post wirklich l√∂schen?"))try{await a.delete(`/marketing-aktionen/posts/${e}`),J("success","Post gel√∂scht"),O()}catch(s){console.error("Fehler beim L√∂schen:",s),J("error","Fehler beim L√∂schen")}})(e.id),children:s.jsx(x,{size:14})}),"published"===e.status&&e.external_post_id&&s.jsxs("a",{href:"facebook"===e.platform?`https://facebook.com/${e.external_post_id}`:`https://instagram.com/p/${e.external_post_id}`,target:"_blank",rel:"noopener noreferrer",className:"btn btn-sm btn-outline",children:[s.jsx(c,{size:14})," Ansehen"]})]})]})]},e.id))})]})]})},w=()=>{var n,a,l;const{token:r}=t(),[c,d]=e.useState("gruppen"),[o,h]=e.useState([]),[m,u]=e.useState(null),[g,p]=e.useState(!0),[x,j]=e.useState(""),[v,b]=e.useState(!1),[f,w]=e.useState(""),[_,E]=e.useState("alle"),[S,C]=e.useState(!1),[F,A]=e.useState(!1);e.useEffect(()=>{z()},[]);const z=async()=>{try{p(!0),j("");const e=await fetch(`${i.apiBaseUrl}/buddy/groups`,{headers:{Authorization:`Bearer ${r}`}});if(!e.ok)throw new Error("Fehler beim Laden der Buddy-Gruppen");const s=await e.json();h(s)}catch(e){console.error("Fehler beim Laden der Buddy-Gruppen:",e),j("Fehler beim Laden der Daten")}finally{p(!1)}},D=async e=>{try{b(!0);const s=await fetch(`/buddy/groups/${e}`,{headers:{Authorization:`Bearer ${r}`}});if(!s.ok)throw new Error("Fehler beim Laden der Gruppendetails");const n=await s.json();u(n),C(!0)}catch(s){console.error("Fehler beim Laden der Gruppendetails:",s),j("Fehler beim Laden der Gruppendetails")}finally{b(!1)}},$=async(e,s)=>{try{b(!0);const n=await fetch(`${i.apiBaseUrl}/buddy/send-invitations`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({groupId:e,invitationIds:s})}),a=await n.json();if(!n.ok)throw new Error(a.error||"Fehler beim Versenden der Einladungen");alert(`‚úÖ ${a.sent} Einladungen versendet, ${a.failed} fehlgeschlagen`),m&&m.id===e&&await D(e),await z()}catch(n){console.error("Fehler beim Versenden der Einladungen:",n),alert(`‚ùå Fehler: ${n.message}`)}finally{b(!1)}},L=o.filter(e=>{var s;const n=!f||(null==(s=e.gruppe_name)?void 0:s.toLowerCase().includes(f.toLowerCase()))||e.id.toString().includes(f),a="alle"===_||e.status===_;return n&&a}),G=e=>{const n={aktiv:{class:"status-active",text:"Aktiv"},inaktiv:{class:"status-inactive",text:"Inaktiv"},geloescht:{class:"status-deleted",text:"Gel√∂scht"}}[e]||{class:"status-unknown",text:e};return s.jsx("span",{className:`status-badge ${n.class}`,children:n.text})},I=e=>{const n={eingeladen:{class:"invitation-pending",text:"Eingeladen"},email_gesendet:{class:"invitation-sent",text:"Email gesendet"},registriert:{class:"invitation-registered",text:"Registriert"},aktiviert:{class:"invitation-active",text:"Aktiviert"},abgelehnt:{class:"invitation-declined",text:"Abgelehnt"},abgelaufen:{class:"invitation-expired",text:"Abgelaufen"}}[e]||{class:"invitation-unknown",text:e};return s.jsx("span",{className:`invitation-badge ${n.class}`,children:n.text})};return g?s.jsxs("div",{className:"loading-container",children:[s.jsx("div",{className:"loading-spinner-large"}),s.jsx("p",{children:"Buddy-Gruppen werden geladen..."})]}):s.jsxs("div",{className:"buddy-verwaltung",children:[s.jsxs("div",{className:"page-header",children:[s.jsxs("h1",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",position:"relative",backgroundImage:"none !important",WebkitBackgroundClip:"unset !important",WebkitTextFillColor:"unset !important",backgroundClip:"unset !important",color:"transparent"},children:[s.jsx("span",{style:{fontSize:"1.8rem",filter:"drop-shadow(0 2px 8px rgba(255, 215, 0, 0.3))",position:"relative",zIndex:1e3,lineHeight:1,display:"inline-block",flexShrink:0,textShadow:"none",WebkitTextFillColor:"unset",backgroundImage:"none",WebkitBackgroundClip:"unset",backgroundClip:"unset"},children:"üë•"}),s.jsx("span",{style:{WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",color:"#FFD700",WebkitTextFillColor:"#FFD700",backgroundImage:"none",WebkitBackgroundClip:"unset",backgroundClip:"unset",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",position:"relative",zIndex:1},children:"Buddy-Gruppen Verwaltung"})]}),s.jsx("p",{children:"Verwalte Freunde-Gruppen, Einladungen und Marketing-Aktionen"})]}),s.jsxs("div",{className:"buddy-tabs",children:[s.jsxs("button",{className:"buddy-tab "+("gruppen"===c?"active":""),onClick:()=>d("gruppen"),children:[s.jsx(N,{size:18}),"Buddy-Gruppen"]}),s.jsxs("button",{className:"buddy-tab "+("aktionen"===c?"active":""),onClick:()=>d("aktionen"),children:[s.jsx(k,{size:18}),"Marketing-Aktionen"]})]}),"aktionen"===c?s.jsx(y,{}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"filter-section",children:s.jsxs("div",{className:"filter-row",children:[s.jsx("div",{className:"search-box",children:s.jsx("input",{type:"text",placeholder:"Gruppe suchen (Name oder ID)...",value:f,onChange:e=>w(e.target.value),className:"search-input"})}),s.jsxs("div",{className:"filter-controls",children:[s.jsxs("select",{value:_,onChange:e=>E(e.target.value),className:"filter-select",children:[s.jsx("option",{value:"alle",children:"Alle Status"}),s.jsx("option",{value:"aktiv",children:"Aktiv"}),s.jsx("option",{value:"inaktiv",children:"Inaktiv"}),s.jsx("option",{value:"geloescht",children:"Gel√∂scht"})]}),s.jsx("button",{onClick:z,className:"logout-button",disabled:g,children:"üîÑ Aktualisieren"})]})]})}),x&&s.jsxs("div",{className:"error-message",children:[s.jsx("strong",{children:"Fehler:"})," ",x]}),s.jsxs("div",{className:"stats-grid",children:[s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon",children:"üë•"}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-number",children:o.length}),s.jsx("div",{className:"stat-label",children:"Gesamt Gruppen"})]})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon",children:"‚úÖ"}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-number",children:o.filter(e=>"aktiv"===e.status).length}),s.jsx("div",{className:"stat-label",children:"Aktive Gruppen"})]})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon",children:"üìß"}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-number",children:o.reduce((e,s)=>e+(s.pending_einladungen||0),0)}),s.jsx("div",{className:"stat-label",children:"Offene Einladungen"})]})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon",children:"üéØ"}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-number",children:o.reduce((e,s)=>e+(s.aktive_mitglieder||0),0)}),s.jsx("div",{className:"stat-label",children:"Aktive Mitglieder"})]})]})]}),s.jsxs("div",{className:"groups-section",children:[s.jsxs("h2",{children:["üìã Buddy-Gruppen (",L.length,")"]}),0===L.length?s.jsxs("div",{className:"empty-state",children:[s.jsx("p",{children:"Keine Buddy-Gruppen gefunden."}),f&&s.jsx("button",{onClick:()=>w(""),className:"btn btn-secondary",children:"Filter zur√ºcksetzen"})]}):s.jsx("div",{className:"groups-grid",children:L.map(e=>s.jsxs("div",{className:"group-card",children:[s.jsxs("div",{className:"group-header",children:[s.jsx("h3",{children:e.gruppe_name||`Gruppe #${e.id}`}),G(e.status)]}),s.jsxs("div",{className:"group-info",children:[s.jsxs("div",{className:"info-row",children:[s.jsx("span",{children:"ID:"}),s.jsxs("span",{children:["#",e.id]})]}),s.jsxs("div",{className:"info-row",children:[s.jsx("span",{children:"Erstellt:"}),s.jsx("span",{children:new Date(e.erstellt_am).toLocaleDateString("de-DE")})]}),s.jsxs("div",{className:"info-row",children:[s.jsx("span",{children:"Mitglieder:"}),s.jsxs("span",{children:[e.aktive_mitglieder||0,"/",e.max_mitglieder]})]}),s.jsxs("div",{className:"info-row",children:[s.jsx("span",{children:"Einladungen:"}),s.jsxs("span",{children:[e.gesamt_einladungen||0," gesamt,"," ",e.pending_einladungen||0," offen"]})]})]}),s.jsxs("div",{className:"group-actions",children:[s.jsx("button",{onClick:()=>D(e.id),className:"btn btn-primary btn-sm",disabled:v,children:"üìÑ Details"}),e.pending_einladungen>0&&s.jsx("button",{onClick:()=>(async e=>{try{b(!0);const s=await fetch(`/buddy/groups/${e}/resend-invitations`,{method:"POST",headers:{Authorization:`Bearer ${r}`}}),n=await s.json();if(!s.ok)throw new Error(n.error||"Fehler beim Versenden der Erinnerungen");alert(`üîî ${n.remindersSent} Erinnerungen versendet`),m&&m.id===e&&await D(e)}catch(s){console.error("Fehler beim Versenden der Erinnerungen:",s),alert(`‚ùå Fehler: ${s.message}`)}finally{b(!1)}})(e.id),className:"btn btn-secondary btn-sm",disabled:v,children:"üîî Erinnerung"})]})]},e.id))})]}),S&&m&&s.jsx("div",{className:"modal-overlay",onClick:()=>C(!1),children:s.jsxs("div",{className:"modal-content group-details-modal",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsxs("h2",{children:["üìã Gruppe: ",m.gruppe_name||`#${m.id}`]}),s.jsx("button",{onClick:()=>C(!1),className:"close-button",children:"√ó"})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{className:"group-details-section",children:[s.jsx("h3",{children:"‚ÑπÔ∏è Gruppen-Informationen"}),s.jsxs("div",{className:"details-grid",children:[s.jsxs("div",{className:"detail-item",children:[s.jsx("strong",{children:"ID:"}),s.jsxs("span",{children:["#",m.id]})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("strong",{children:"Name:"}),s.jsx("span",{children:m.gruppe_name||"Kein Name"})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("strong",{children:"Status:"}),G(m.status)]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("strong",{children:"Erstellt:"}),s.jsx("span",{children:new Date(m.erstellt_am).toLocaleString("de-DE")})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("strong",{children:"Max. Mitglieder:"}),s.jsx("span",{children:m.max_mitglieder})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("strong",{children:"Aktuelle Mitglieder:"}),s.jsx("span",{children:m.aktuelle_mitglieder})]})]})]}),s.jsxs("div",{className:"invitations-section",children:[s.jsxs("div",{className:"section-header",children:[s.jsxs("h3",{children:["üìß Einladungen (",(null==(n=m.einladungen)?void 0:n.length)||0,")"]}),(null==(a=m.einladungen)?void 0:a.some(e=>"eingeladen"===e.status))&&s.jsx("button",{onClick:()=>{const e=m.einladungen.filter(e=>"eingeladen"===e.status).map(e=>e.id);$(m.id,e)},className:"btn btn-primary btn-sm",disabled:v,children:"üì§ Alle Einladungen versenden"})]}),0===(null==(l=m.einladungen)?void 0:l.length)?s.jsx("p",{children:"Keine Einladungen vorhanden."}):s.jsx("div",{className:"invitations-list",children:m.einladungen.map(e=>s.jsxs("div",{className:"invitation-item",children:[s.jsxs("div",{className:"invitation-info",children:[s.jsxs("div",{className:"invitation-header",children:[s.jsx("strong",{children:e.freund_name}),I(e.status)]}),s.jsxs("div",{className:"invitation-details",children:[s.jsxs("div",{children:["üìß ",e.freund_email]}),e.freund_telefon&&s.jsxs("div",{children:["üìû ",e.freund_telefon]}),s.jsxs("div",{children:["üìÖ Erstellt: ",new Date(e.erstellt_am).toLocaleDateString("de-DE")]}),e.einladung_gesendet_am&&s.jsxs("div",{children:["üì§ Versendet: ",new Date(e.einladung_gesendet_am).toLocaleDateString("de-DE")]}),s.jsxs("div",{children:["‚è∞ G√ºltig bis: ",new Date(e.token_gueltig_bis).toLocaleDateString("de-DE")]})]})]}),s.jsxs("div",{className:"invitation-actions",children:["eingeladen"===e.status&&s.jsx("button",{onClick:()=>$(m.id,[e.id]),className:"btn btn-primary btn-xs",disabled:v,children:"üì§ Versenden"}),["eingeladen","email_gesendet"].includes(e.status)&&s.jsx("button",{onClick:()=>(async(e,s="Von Admin gel√∂scht")=>{if(confirm("M√∂chtest du diese Einladung wirklich l√∂schen?"))try{if(b(!0),!(await fetch(`/buddy/invitations/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({reason:s})})).ok)throw new Error("Fehler beim L√∂schen der Einladung");alert("‚úÖ Einladung gel√∂scht"),m&&await D(m.id),await z()}catch(n){console.error("Fehler beim L√∂schen der Einladung:",n),alert(`‚ùå Fehler: ${n.message}`)}finally{b(!1)}})(e.id),className:"btn btn-danger btn-xs",disabled:v,children:"üóëÔ∏è L√∂schen"})]})]},e.id))})]}),m.aktivitaeten&&m.aktivitaeten.length>0&&s.jsxs("div",{className:"activities-section",children:[s.jsxs("div",{className:"section-header",children:[s.jsxs("h3",{children:["üìà Gemeinsame Aktivit√§ten (",m.aktivitaeten.length,")"]}),s.jsx("button",{onClick:async()=>{try{const e=await fetch(`${i.apiBaseUrl}/buddy/groups/${m.id}/aktivitaeten?limit=50`,{headers:{Authorization:`Bearer ${r}`}});if(e.ok){const s=await e.json();u({...m,aktivitaeten:s.aktivitaeten})}}catch(e){console.error("Fehler beim Laden aller Aktivit√§ten:",e)}},className:"btn btn-secondary btn-sm",children:"Alle anzeigen"})]}),s.jsx("div",{className:"activities-list",children:m.aktivitaeten.slice(0,15).map(e=>{const n=e=>e.includes("erfolgreich")||e.includes("aktiviert")||e.includes("angenommen")?"#10b981":e.includes("abgelehnt")||e.includes("abgelaufen")?"#ef4444":e.includes("versendet")||e.includes("registriert")?"#3b82f6":"#94a3b8";return s.jsxs("div",{className:"activity-item-enhanced",children:[s.jsx("div",{className:"activity-icon-wrapper",style:{backgroundColor:`${n(e.aktivitaet_typ)}20`,borderColor:n(e.aktivitaet_typ)},children:s.jsx("span",{className:"activity-icon",children:(e.aktivitaet_typ,{einladung_versendet:"üìß",einladung_angenommen:"‚úÖ",einladung_abgelehnt:"‚ùå",einladung_abgelaufen:"‚è∞",mitglied_registriert:"üë§",mitglied_aktiviert:"üéâ",gemeinsames_training:"ü•ã",pruefung_erfolgreich:"üèÜ",gruppen_erstellt:"üë•"}[e.aktivitaet_typ]||"üìã")})}),s.jsxs("div",{className:"activity-content-enhanced",children:[s.jsxs("div",{className:"activity-header-enhanced",children:[s.jsx("strong",{className:"activity-type",children:e.aktivitaet_typ.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),s.jsx("span",{className:"activity-time-enhanced",children:new Date(e.erstellt_am).toLocaleString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.beschreibung&&s.jsx("p",{className:"activity-description-enhanced",children:e.beschreibung}),(e.freund_name||e.mitglied_vorname)&&s.jsxs("div",{className:"activity-participant",children:[e.freund_name&&s.jsxs("span",{children:["üë§ ",e.freund_name]}),e.mitglied_vorname&&s.jsxs("span",{children:["üë§ ",e.mitglied_vorname," ",e.mitglied_nachname]})]})]})]},e.id)})}),m.aktivitaeten.length>15&&s.jsx("div",{className:"activities-footer",children:s.jsxs("p",{children:["... und ",m.aktivitaeten.length-15," weitere Aktivit√§ten"]})})]})]}),s.jsx("div",{className:"modal-footer",children:s.jsx("button",{onClick:()=>C(!1),className:"btn btn-secondary",children:"Schlie√üen"})})]})}),v&&s.jsxs("div",{className:"action-loading-overlay",children:[s.jsx("div",{className:"loading-spinner-large"}),s.jsx("p",{children:"Aktion wird ausgef√ºhrt..."})]})]})]})};export{w as default};
