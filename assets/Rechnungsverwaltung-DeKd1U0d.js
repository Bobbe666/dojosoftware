import{a as e,j as s}from"./query-Caj74EYQ.js";import{d as i,f as n,c as a}from"./index-Bcs73ipe.js";import{as as t,P as c,F as l,w as r,g as d,k as o,aH as h,s as m,j as u,t as j,D as x}from"./icons-DiLw-1i5.js";import{u as v}from"./vendor-router-Co3o87Zc.js";import"./charts-C1Gv3M_c.js";const b=()=>{const{t:b}=i(["finance","common"]),g=v(),[p,N]=e.useState(!0),[f,y]=e.useState("alle"),[z,k]=e.useState(""),[w,_]=e.useState([]),[C,S]=e.useState([]),[D,T]=e.useState(!1),[F,E]=e.useState(null),[L,P]=e.useState("details"),[U,$]=e.useState({gesamt_rechnungen:0,offene_rechnungen:0,bezahlte_rechnungen:0,ueberfaellige_rechnungen:0,offene_summe:0,bezahlte_summe:0,ueberfaellige_summe:0,gesamt_summe:0});e.useEffect(()=>{I()},[]),e.useEffect(()=>{B()},[f,z,w]);const I=async()=>{try{N(!0);const[e,s]=await Promise.all([n(`${a.apiBaseUrl}/rechnungen`),n(`${a.apiBaseUrl}/rechnungen/statistiken`)]);if(e.ok){const s=await e.json();_(s.data||[])}if(s.ok){const e=await s.json();$(e.data||U)}N(!1)}catch(e){console.error("Fehler beim Laden der Daten:",e),N(!1)}},B=()=>{let e=[...w];switch(f){case"offen":e=e.filter(e=>"offen"===e.status&&0===e.archiviert);break;case"bezahlt":e=e.filter(e=>"bezahlt"===e.status&&0===e.archiviert);break;case"ueberfaellig":e=e.filter(e=>{const s=new Date(e.faelligkeitsdatum),i=new Date;return("offen"===e.status||"ueberfaellig"===e.status)&&s<i&&0===e.archiviert});break;case"archiv":e=e.filter(e=>1===e.archiviert);break;default:e=e.filter(e=>0===e.archiviert)}if(z){const s=z.toLowerCase();e=e.filter(e=>{var i;return e.rechnungsnummer.toLowerCase().includes(s)||e.mitglied_name.toLowerCase().includes(s)||(null==(i=e.beschreibung)?void 0:i.toLowerCase().includes(s))})}S(e)},q=async(e,s)=>{if(window.confirm(b(s?"invoices.confirmArchive":"invoices.confirmUnarchive")))try{(await n(`${a.apiBaseUrl}/rechnungen/${e}/archivieren`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({archiviert:s})})).ok&&(alert(b(s?"invoices.archived":"invoices.unarchived")),I())}catch(i){console.error("Fehler beim Archivieren:",i),alert(b("errors.savingError"))}},A=()=>{T(!1),E(null),P("details")},R=e=>{const i=new Date(e.faelligkeitsdatum),n=new Date;return"bezahlt"===e.status?s.jsx("span",{className:"badge badge-success",children:b("invoices.status.paid")}):"teilweise_bezahlt"===e.status?s.jsx("span",{className:"badge badge-warning",children:b("invoices.status.partiallyPaid")}):i<n?s.jsx("span",{className:"badge badge-danger",children:b("invoices.status.overdue")}):s.jsx("span",{className:"badge badge-info",children:b("invoices.status.open")})},G=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e||0),H=e=>e?new Date(e).toLocaleDateString("de-DE"):"-";return p?s.jsx("div",{className:"rechnungen-container",children:s.jsxs("div",{className:"loading-state",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:b("common:messages.loading")})]})}):s.jsxs("div",{className:"rechnungen-container",children:[s.jsxs("div",{className:"rechnungen-header",children:[s.jsxs("button",{className:"btn btn-secondary",onClick:()=>g("/dashboard/beitraege"),children:[s.jsx(t,{size:20}),b("common:buttons.back")]}),s.jsxs("div",{children:[s.jsxs("h1",{children:["ðŸ“„ ",b("invoices.title")]}),s.jsx("p",{children:b("invoices.subtitle")})]}),s.jsxs("button",{className:"btn btn-primary",onClick:()=>g("/dashboard/rechnung-erstellen"),children:[s.jsx(c,{size:20}),b("invoices.create")]})]}),s.jsxs("div",{className:"stats-grid",children:[s.jsxs("div",{className:"stat-card info",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(l,{size:32})}),s.jsxs("div",{className:"stat-info",children:[s.jsx("h3",{children:b("cockpit.totalInvoices","Gesamt Rechnungen")}),s.jsx("p",{className:"stat-value",children:U.gesamt_rechnungen}),s.jsx("span",{className:"stat-trend",children:G(U.gesamt_summe)})]})]}),s.jsxs("div",{className:"stat-card warning",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(r,{size:32})}),s.jsxs("div",{className:"stat-info",children:[s.jsx("h3",{children:b("cockpit.openInvoices")}),s.jsx("p",{className:"stat-value",children:U.offene_rechnungen}),s.jsx("span",{className:"stat-trend",children:G(U.offene_summe)})]})]}),s.jsxs("div",{className:"stat-card success",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(d,{size:32})}),s.jsxs("div",{className:"stat-info",children:[s.jsx("h3",{children:b("cockpit.paidInvoices")}),s.jsx("p",{className:"stat-value",children:U.bezahlte_rechnungen}),s.jsx("span",{className:"stat-trend",children:G(U.bezahlte_summe)})]})]}),s.jsxs("div",{className:"stat-card danger",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(o,{size:32})}),s.jsxs("div",{className:"stat-info",children:[s.jsx("h3",{children:b("cockpit.overdueInvoices")}),s.jsx("p",{className:"stat-value",children:U.ueberfaellige_rechnungen}),s.jsx("span",{className:"stat-trend",children:G(U.ueberfaellige_summe)})]})]})]}),s.jsxs("div",{className:"view-tabs",children:[s.jsxs("button",{className:"tab "+("alle"===f?"active":""),onClick:()=>y("alle"),children:[s.jsx(l,{size:18}),b("invoices.filters.all")]}),s.jsxs("button",{className:"tab "+("offen"===f?"active":""),onClick:()=>y("offen"),children:[s.jsx(r,{size:18}),b("invoices.filters.open")]}),s.jsxs("button",{className:"tab "+("bezahlt"===f?"active":""),onClick:()=>y("bezahlt"),children:[s.jsx(d,{size:18}),b("invoices.filters.paid")]}),s.jsxs("button",{className:"tab "+("ueberfaellig"===f?"active":""),onClick:()=>y("ueberfaellig"),children:[s.jsx(o,{size:18}),b("invoices.filters.overdue")]}),s.jsxs("button",{className:"tab "+("archiv"===f?"active":""),onClick:()=>y("archiv"),children:[s.jsx(h,{size:18}),b("invoices.filters.archive")]})]}),s.jsxs("div",{className:"search-bar",children:[s.jsx(m,{size:20}),s.jsx("input",{type:"text",placeholder:b("invoices.searchPlaceholder"),value:z,onChange:e=>k(e.target.value)})]}),s.jsx("div",{className:"rechnungen-table-container",children:0===C.length?s.jsxs("div",{className:"empty-state",children:[s.jsx(l,{size:64}),s.jsx("h3",{children:b("invoices.noInvoices")}),s.jsxs("p",{children:["alle"===f&&b("invoices.emptyStates.all"),"offen"===f&&b("invoices.emptyStates.open"),"bezahlt"===f&&b("invoices.emptyStates.paid"),"ueberfaellig"===f&&b("invoices.emptyStates.overdue"),"archiv"===f&&b("invoices.emptyStates.archive")]})]}):s.jsxs("table",{className:"rechnungen-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:b("invoices.columns.invoiceNumber")}),s.jsx("th",{children:b("invoices.columns.member")}),s.jsx("th",{children:b("invoices.columns.date")}),s.jsx("th",{children:b("invoices.columns.dueDate")}),s.jsx("th",{children:b("common:labels.type","Art")}),s.jsx("th",{children:b("invoices.columns.amount")}),s.jsx("th",{children:b("invoices.columns.status")}),s.jsx("th",{children:b("invoices.columns.actions")})]})}),s.jsx("tbody",{children:C.map(e=>s.jsxs("tr",{children:[s.jsx("td",{children:s.jsx("strong",{children:e.rechnungsnummer})}),s.jsx("td",{children:e.mitglied_name}),s.jsx("td",{children:H(e.datum)}),s.jsx("td",{children:H(e.faelligkeitsdatum)}),s.jsx("td",{children:s.jsxs("span",{className:"badge badge-neutral",children:["mitgliedsbeitrag"===e.art&&b("invoices.types.membershipFee"),"pruefungsgebuehr"===e.art&&b("invoices.types.examFee"),"kursgebuehr"===e.art&&b("invoices.types.courseFee"),"ausruestung"===e.art&&b("invoices.types.equipment"),"sonstiges"===e.art&&b("invoices.types.other")]})}),s.jsx("td",{children:s.jsx("strong",{children:G(e.betrag)})}),s.jsx("td",{children:R(e)}),s.jsx("td",{children:s.jsxs("div",{className:"action-buttons",children:[s.jsx("button",{className:"btn-icon btn-info",onClick:()=>(async e=>{try{const s=await n(`${a.apiBaseUrl}/rechnungen/${e}`);if(s.ok){const e=await s.json();E(e.data),P("details"),T(!0)}}catch(s){console.error("Fehler beim Laden der Rechnung:",s),alert("Fehler beim Laden der Rechnung")}})(e.rechnung_id),title:b("invoices.tooltips.viewDetails"),children:s.jsx(u,{size:16})}),0===e.archiviert?s.jsx("button",{className:"btn-icon btn-secondary",onClick:()=>q(e.rechnung_id,!0),title:b("invoices.tooltips.archive"),children:s.jsx(h,{size:16})}):s.jsx("button",{className:"btn-icon btn-success",onClick:()=>q(e.rechnung_id,!1),title:b("invoices.tooltips.restore"),children:s.jsx(h,{size:16})}),s.jsx("button",{className:"btn-icon btn-danger",onClick:()=>(async e=>{if(window.confirm(b("invoices.confirmDelete")))try{(await n(`${a.apiBaseUrl}/rechnungen/${e}`,{method:"DELETE"})).ok&&(alert(b("invoices.deleted")),I())}catch(s){console.error("Fehler beim LÃ¶schen:",s),alert(b("errors.savingError"))}})(e.rechnung_id),title:b("invoices.tooltips.delete"),children:s.jsx(j,{size:16})})]})})]},e.rechnung_id))})]})}),D&&F&&s.jsx("div",{className:"modal-overlay",onClick:A,children:s.jsxs("div",{className:"modal-content extra-large",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h2",{className:"modal-title",children:b("invoices.details")}),s.jsx("button",{className:"close-btn",onClick:A,title:b("common:buttons.close"),children:"Ã—"})]}),s.jsxs("div",{className:"tabs-container",children:[s.jsxs("button",{className:"tab "+("details"===L?"active":""),onClick:()=>P("details"),children:[s.jsx(l,{size:18,className:"tab-icon"}),s.jsx("span",{className:"tab-label",children:b("invoices.tabs.details")})]}),s.jsxs("button",{className:"tab "+("positionen"===L?"active":""),onClick:()=>P("positionen"),children:[s.jsx(x,{size:18,className:"tab-icon"}),s.jsx("span",{className:"tab-label",children:b("invoices.tabs.positions")})]}),s.jsxs("button",{className:"tab "+("zahlungen"===L?"active":""),onClick:()=>P("zahlungen"),children:[s.jsx(d,{size:18,className:"tab-icon"}),s.jsx("span",{className:"tab-label",children:b("invoices.tabs.payments")})]})]}),s.jsxs("div",{className:"modal-body",children:["details"===L&&s.jsx("div",{className:"detail-section",children:s.jsxs("div",{className:"detail-grid",children:[s.jsxs("div",{className:"detail-item",children:[s.jsx("label",{children:b("invoices.columns.invoiceNumber")}),s.jsx("div",{className:"detail-value",children:s.jsx("strong",{children:F.rechnungsnummer})})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("label",{children:b("invoices.columns.member")}),s.jsx("div",{className:"detail-value",children:F.mitglied_name})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("label",{children:b("invoices.columns.date")}),s.jsx("div",{className:"detail-value",children:H(F.datum)})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("label",{children:b("invoices.columns.dueDate")}),s.jsx("div",{className:"detail-value",children:H(F.faelligkeitsdatum)})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("label",{children:b("common:labels.type","Art")}),s.jsxs("div",{className:"detail-value",children:["mitgliedsbeitrag"===F.art&&b("invoices.types.membershipFee"),"pruefungsgebuehr"===F.art&&b("invoices.types.examFee"),"kursgebuehr"===F.art&&b("invoices.types.courseFee"),"ausruestung"===F.art&&b("invoices.types.equipment"),"sonstiges"===F.art&&b("invoices.types.other")]})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("label",{children:b("invoices.columns.status")}),s.jsx("div",{className:"detail-value",children:R(F)})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("label",{children:b("invoices.columns.amount")}),s.jsx("div",{className:"detail-value",children:s.jsx("strong",{children:G(F.betrag)})})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("label",{children:b("invoices.form.description")}),s.jsx("div",{className:"detail-value",children:F.beschreibung||"-"})]})]})}),"positionen"===L&&s.jsxs("div",{className:"detail-section",children:[s.jsx("h3",{children:b("invoices.tabs.positions")}),F.positionen&&F.positionen.length>0?s.jsxs("table",{className:"rechnungen-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:b("invoices.positionsTable.position")}),s.jsx("th",{children:b("invoices.positionsTable.description")}),s.jsx("th",{children:b("invoices.positionsTable.quantity")}),s.jsx("th",{children:b("invoices.positionsTable.unitPrice")}),s.jsx("th",{children:b("invoices.positionsTable.total")})]})}),s.jsx("tbody",{children:F.positionen.map((e,i)=>s.jsxs("tr",{children:[s.jsx("td",{children:e.position_nr}),s.jsx("td",{children:e.bezeichnung}),s.jsx("td",{children:e.menge}),s.jsx("td",{children:G(e.einzelpreis)}),s.jsx("td",{children:s.jsx("strong",{children:G(e.gesamtpreis||e.menge*e.einzelpreis)})})]},i))})]}):s.jsx("p",{className:"info-text",children:b("invoices.positionsTable.noPositions")})]}),"zahlungen"===L&&s.jsxs("div",{className:"detail-section",children:[s.jsx("h3",{children:b("invoices.paymentsTable.title")}),F.zahlungen&&F.zahlungen.length>0?s.jsxs("table",{className:"rechnungen-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:b("invoices.paymentsTable.date")}),s.jsx("th",{children:b("invoices.paymentsTable.amount")}),s.jsx("th",{children:b("invoices.paymentsTable.method")}),s.jsx("th",{children:b("invoices.paymentsTable.note")})]})}),s.jsx("tbody",{children:F.zahlungen.map((e,i)=>s.jsxs("tr",{children:[s.jsx("td",{children:H(e.zahlungsdatum)}),s.jsx("td",{children:s.jsx("strong",{children:G(e.betrag)})}),s.jsx("td",{children:e.zahlungsmethode}),s.jsx("td",{children:e.notiz||"-"})]},i))})]}):s.jsx("p",{className:"info-text",children:b("invoices.paymentsTable.noPayments")})]})]}),s.jsx("div",{className:"modal-footer",children:s.jsx("button",{className:"btn btn-secondary",onClick:A,children:b("common:buttons.close")})})]})})]})};export{b as default};
