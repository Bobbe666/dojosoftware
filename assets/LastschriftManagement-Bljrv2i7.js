import{a as e,j as s,b as a}from"./query-Caj74EYQ.js";import n from"./Lastschriftlauf-qEoNBgug.js";import{f as t,c as l,u as i}from"./index-D4wQygnO.js";import{P as r,C as c,F as d,g as h,q as u,D as o,a7 as j,k as m,b as x,a0 as g,Q as b,U as p,t as f,a2 as v,R as N,ba as z,aM as _,a3 as y,a5 as k,a as w,K as S}from"./icons-eh0tbLFx.js";import{u as C}from"./vendor-router-B2AaIOtG.js";import"./charts-QHQg_ypW.js";const E=({embedded:n=!1})=>{const i=C(),[v,N]=e.useState(!0),[z,_]=e.useState([]),[y,k]=e.useState([]),[w,S]=e.useState(""),[E,A]=e.useState("all"),[L,$]=e.useState({}),[F,Z]=e.useState({}),[B,D]=e.useState({}),[T,q]=e.useState({gesamt:0,abgeschlossen:0,offen:0,gesamtbetrag:0});e.useEffect(()=>{P()},[]),e.useEffect(()=>{O()},[w,E,z]);const P=async()=>{try{N(!0);const e=await t(`${l.apiBaseUrl}/zahllaeufe`);if(!e.ok)throw new Error("Fehler beim Laden der Zahll√§ufe");const s=await e.json();_(s.data||[]),U(s.data||[]),N(!1)}catch(e){console.error("Fehler beim Laden der Zahll√§ufe:",e),alert("Fehler beim Laden: "+e.message),N(!1)}},U=e=>{const s={gesamt:e.length,abgeschlossen:e.filter(e=>"abgeschlossen"===e.status).length,offen:e.filter(e=>"offen"===e.status||"geplant"===e.status).length,gesamtbetrag:e.reduce((e,s)=>e+parseFloat(s.betrag||0),0)};q(s)},O=()=>{let e=[...z];if("all"!==E&&(e=e.filter(e=>e.status===E)),w){const s=w.toLowerCase();e=e.filter(e=>{var a,n;return(null==(a=e.buchungsnummer)?void 0:a.toLowerCase().includes(s))||(null==(n=e.zahlungsanbieter)?void 0:n.toLowerCase().includes(s))})}k(e)},V=e=>e?new Date(e).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",I=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e),M=e=>{switch(e){case"abgeschlossen":return s.jsxs("span",{className:"badge badge-success",children:[s.jsx(h,{size:14})," Abgeschlossen"]});case"offen":return s.jsxs("span",{className:"badge badge-warning",children:[s.jsx(u,{size:14})," Offen"]});case"geplant":return s.jsxs("span",{className:"badge badge-info",children:[s.jsx(c,{size:14})," Geplant"]});case"fehler":return s.jsxs("span",{className:"badge badge-danger",children:[s.jsx(m,{size:14})," Fehler"]});default:return s.jsx("span",{className:"badge badge-neutral",children:e})}},R=e=>{switch(e){case"succeeded":return s.jsxs("span",{className:"badge badge-success",children:[s.jsx(h,{size:12})," Erfolgreich"]});case"processing":return s.jsxs("span",{className:"badge badge-warning",children:[s.jsx(u,{size:12})," In Bearbeitung"]});case"failed":return s.jsxs("span",{className:"badge badge-danger",children:[s.jsx(f,{size:12})," Fehlgeschlagen"]});case"canceled":return s.jsxs("span",{className:"badge badge-neutral",children:[s.jsx(f,{size:12})," Abgebrochen"]});default:return s.jsx("span",{className:"badge badge-neutral",children:e})}},G=async(e,s)=>{D(e=>({...e,[s]:!0}));try{const a=e.quelle||"sepa",n=await t(`${l.apiBaseUrl}/zahllaeufe/${a}/${e.zahllauf_id}/transaktionen`);if(n.ok){const e=await n.json();Z(a=>({...a,[s]:e}))}else console.error("Fehler beim Laden der Transaktionen"),Z(e=>({...e,[s]:{transaktionen:[],error:"Fehler beim Laden"}}))}catch(a){console.error("Fehler:",a),Z(e=>({...e,[s]:{transaktionen:[],error:a.message}}))}finally{D(e=>({...e,[s]:!1}))}};return v?s.jsx("div",{className:"zahllaeufe-container",children:s.jsxs("div",{className:"loading-state",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Lade Zahll√§ufe..."})]})}):s.jsxs("div",{className:"zahllaeufe-container",children:[!n&&s.jsxs("div",{className:"zahllaeufe-header",children:[s.jsxs("button",{className:"btn btn-secondary",onClick:()=>i("/dashboard/beitraege"),children:[s.jsx(r,{size:20}),"Zur√ºck"]}),s.jsxs("div",{children:[s.jsx("h1",{children:"üìä Zahll√§ufe √úbersicht"}),s.jsx("p",{children:"Alle durchgef√ºhrten SEPA-Lastschriftl√§ufe im √úberblick"})]}),s.jsxs("button",{className:"btn btn-primary",onClick:()=>i("/dashboard/lastschriftlauf"),children:[s.jsx(c,{size:20}),"Neuer Zahllauf"]})]}),s.jsxs("div",{className:"info-box",children:[s.jsx(d,{size:24}),s.jsxs("div",{children:[s.jsx("h3",{children:"Zahll√§ufe Verwaltung"}),s.jsx("p",{children:"Hier sehen Sie alle durchgef√ºhrten Lastschriftl√§ufe - sowohl klassische SEPA-L√§ufe als auch Stripe SEPA-Einz√ºge. Jeder Zahllauf enth√§lt Status, Buchungen und Betr√§ge."})]})]}),s.jsxs("div",{className:"stats-grid",children:[s.jsxs("div",{className:"stat-card info",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(d,{size:16})}),s.jsxs("div",{className:"stat-info",children:[s.jsx("h3",{children:"Gesamt Zahll√§ufe"}),s.jsx("p",{className:"stat-value",children:T.gesamt}),s.jsx("span",{className:"stat-trend",children:"Alle L√§ufe"})]})]}),s.jsxs("div",{className:"stat-card success",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(h,{size:16})}),s.jsxs("div",{className:"stat-info",children:[s.jsx("h3",{children:"Abgeschlossen"}),s.jsx("p",{className:"stat-value",children:T.abgeschlossen}),s.jsx("span",{className:"stat-trend",children:"Erfolgreich durchgef√ºhrt"})]})]}),s.jsxs("div",{className:"stat-card warning",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(u,{size:16})}),s.jsxs("div",{className:"stat-info",children:[s.jsx("h3",{children:"Offen / Geplant"}),s.jsx("p",{className:"stat-value",children:T.offen}),s.jsx("span",{className:"stat-trend",children:"Noch nicht abgeschlossen"})]})]}),s.jsxs("div",{className:"stat-card primary",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(o,{size:16})}),s.jsxs("div",{className:"stat-info",children:[s.jsx("h3",{children:"Gesamtbetrag"}),s.jsx("p",{className:"stat-value",children:I(T.gesamtbetrag)}),s.jsx("span",{className:"stat-trend",children:"Alle Zahll√§ufe"})]})]})]}),s.jsxs("div",{className:"filter-bar",children:[s.jsxs("div",{className:"search-bar",children:[s.jsx(j,{size:20}),s.jsx("input",{type:"text",placeholder:"Suche nach Buchungsnummer oder Anbieter...",value:w,onChange:e=>S(e.target.value)})]}),s.jsxs("select",{value:E,onChange:e=>A(e.target.value),className:"status-filter",children:[s.jsx("option",{value:"all",children:"Alle Status"}),s.jsx("option",{value:"abgeschlossen",children:"Abgeschlossen"}),s.jsx("option",{value:"offen",children:"Offen"}),s.jsx("option",{value:"geplant",children:"Geplant"}),s.jsx("option",{value:"fehler",children:"Fehler"})]})]}),s.jsx("div",{className:"zahllaeufe-table-container",children:0===y.length?s.jsxs("div",{className:"empty-state",children:[s.jsx(m,{size:64}),s.jsx("h3",{children:"Keine Zahll√§ufe gefunden"}),s.jsxs("p",{children:["all"!==E&&`Keine Zahll√§ufe mit Status "${E}" vorhanden.`,w&&`Keine Treffer f√ºr "${w}".`,!E&&!w&&"Es wurden noch keine Zahll√§ufe erstellt."]}),s.jsx("button",{className:"btn btn-primary",onClick:()=>i("/dashboard/lastschriftlauf"),style:{marginTop:"1rem"},children:"Ersten Zahllauf erstellen"})]}):s.jsxs("table",{className:"zahllaeufe-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"40px"}}),s.jsx("th",{children:"Erstellt am"}),s.jsx("th",{children:"Forderungen bis einschl."}),s.jsx("th",{children:"Geplanter Einzug"}),s.jsx("th",{children:"Zahlungsanbieter"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Buchungsnummer"}),s.jsx("th",{children:"Buchungen"}),s.jsx("th",{children:"RLS-% (Anzahl)"}),s.jsx("th",{children:"Betrag"}),s.jsx("th",{children:"Aktionen"})]})}),s.jsx("tbody",{children:y.map(e=>{var n;const t=`${e.quelle||"sepa"}-${e.zahllauf_id}`,l=L[t],i=F[t],r=B[t];return s.jsxs(a.Fragment,{children:[s.jsxs("tr",{className:l?"row-expanded":"",children:[s.jsx("td",{children:s.jsx("button",{className:"btn-expand",onClick:()=>(async e=>{const s=`${e.quelle||"sepa"}-${e.zahllauf_id}`;L[s]?$(e=>({...e,[s]:!1})):($(e=>({...e,[s]:!0})),F[s]||await G(e,s))})(e),title:l?"Einklappen":"Details anzeigen",children:l?s.jsx(x,{size:18}):s.jsx(g,{size:18})})}),s.jsx("td",{children:(c=e.erstellt_am,c?new Date(c).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-")}),s.jsx("td",{children:V(e.forderungen_bis)}),s.jsx("td",{children:"stripe"===e.quelle?"-":V(e.geplanter_einzug)}),s.jsx("td",{children:s.jsx("span",{className:"provider-badge "+("stripe"===e.quelle?"provider-stripe":"provider-sepa"),children:"stripe"===e.quelle?"üí≥ Stripe SEPA":e.zahlungsanbieter||"SEPA"})}),s.jsx("td",{children:M(e.status)}),s.jsx("td",{children:s.jsx("code",{children:e.buchungsnummer})}),s.jsx("td",{children:s.jsx("strong",{children:e.anzahl_buchungen||0})}),s.jsxs("td",{children:[e.ruecklastschrift_prozent?`${e.ruecklastschrift_prozent}%`:"0%",e.ruecklastschrift_anzahl>0&&s.jsxs("span",{className:"rls-count",children:[" (",e.ruecklastschrift_anzahl,")"]})]}),s.jsx("td",{children:s.jsx("strong",{children:I(e.betrag)})}),s.jsx("td",{children:s.jsx("div",{className:"action-buttons",children:"stripe"!==e.quelle&&s.jsx("button",{className:"btn-icon btn-secondary",onClick:()=>alert("CSV herunterladen"),title:"CSV herunterladen",children:s.jsx(b,{size:16})})})})]}),l&&s.jsx("tr",{className:"expanded-row",children:s.jsx("td",{colSpan:"11",children:s.jsx("div",{className:"transaktionen-container",children:r?s.jsxs("div",{className:"transaktionen-loading",children:[s.jsx("div",{className:"loading-spinner-small"}),s.jsx("span",{children:"Lade Transaktionen..."})]}):(null==i?void 0:i.hinweis)?s.jsxs("div",{className:"transaktionen-hinweis",children:[s.jsx(m,{size:16}),s.jsx("span",{children:i.hinweis})]}):(null==(n=null==i?void 0:i.transaktionen)?void 0:n.length)>0?s.jsxs("div",{className:"transaktionen-liste",children:[s.jsxs("div",{className:"transaktionen-header",children:[s.jsx(p,{size:16}),s.jsxs("span",{children:[i.count," Mitglieder in diesem Zahllauf"]})]}),s.jsxs("table",{className:"transaktionen-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Mitglied"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Betrag"}),s.jsx("th",{children:"Beitr√§ge"})]})}),s.jsx("tbody",{children:i.transaktionen.map((e,a)=>s.jsxs("tr",{children:[s.jsx("td",{children:s.jsxs("div",{className:"mitglied-info",children:[s.jsxs("strong",{children:[e.vorname," ",e.nachname]}),e.mitgliedsnummer&&s.jsxs("span",{className:"mitgliedsnummer",children:["#",e.mitgliedsnummer]})]})}),s.jsxs("td",{children:[R(e.status),e.error_message&&s.jsxs("div",{className:"error-message",title:e.error_message,children:[e.error_message.substring(0,50),"..."]})]}),s.jsx("td",{children:s.jsx("strong",{children:I(e.betrag)})}),s.jsx("td",{children:e.beitraege&&e.beitraege.length>0?s.jsx("div",{className:"beitraege-liste",children:e.beitraege.map((e,a)=>s.jsxs("div",{className:"beitrag-item",children:[s.jsx("span",{className:"beitrag-datum",children:V(e.zahlungsdatum)}),s.jsx("span",{className:"beitrag-betrag",children:I(e.betrag)}),e.magicline_description&&s.jsx("span",{className:"beitrag-beschreibung",children:e.magicline_description})]},e.beitrag_id||a))}):s.jsx("span",{className:"keine-details",children:"-"})})]},e.transaktion_id||a))})]})]}):s.jsx("div",{className:"transaktionen-leer",children:s.jsx("span",{children:"Keine Transaktionsdetails verf√ºgbar"})})})})})]},t);var c})})]})})]})},A=window.API_BASE||"/api",L=({embedded:a=!1})=>{const{dojos:n,activeDojo:t}=i(),[l,r]=e.useState([]),[d,o]=e.useState(!0),[j,g]=e.useState(null),[b,p]=e.useState(!1),[S,C]=e.useState(null),[E,L]=e.useState(null),[$,F]=e.useState({}),[Z,B]=e.useState(null),[D,T]=e.useState({name:"",beschreibung:"",ausfuehrungstag:1,ausfuehrungszeit:"06:00",typen:["beitraege"],nur_faellige_bis_tag:"",aktiv:!0,dojo_id:""}),q=(null==t?void 0:t.id)||localStorage.getItem("dojo_id"),P=e.useCallback(async()=>{try{o(!0);const e=q&&"all"!==q?q:"all",s=await fetch(`${A}/lastschrift-zeitplaene?dojo_id=${e}`),a=await s.json();a.success?r(a.zeitplaene||[]):g(a.error||"Fehler beim Laden")}catch(e){g("Verbindungsfehler: "+e.message)}finally{o(!1)}},[q]);e.useEffect(()=>{P()},[P]);const U=async(e,s)=>{try{const a=await fetch(`${A}/lastschrift-zeitplaene/${e}/ausfuehrungen?dojo_id=${s}&limit=10`),n=await a.json();n.success&&F(s=>({...s,[e]:n.ausfuehrungen||[]}))}catch(a){console.error("Fehler beim Laden der Ausf√ºhrungen:",a)}},O=()=>{const e=q&&"all"!==q?q:n.length>0?n[0].id:"";T({name:"",beschreibung:"",ausfuehrungstag:1,ausfuehrungszeit:"06:00",typen:["beitraege"],nur_faellige_bis_tag:"",aktiv:!0,dojo_id:e})},V=e=>{if("all"===e||null===e||0===e||"0"===e)return"Alle Dojos";const s=n.find(s=>s.id==e);return s?s.dojoname:`Dojo ${e}`},I=e=>{const s={beitraege:"Beitr√§ge",rechnungen:"Rechnungen",verkaeufe:"Verk√§ufe",alle:"Alle"};if(e&&e.includes(",")){const a=e.split(",");return 3===a.length?"Alle":a.map(e=>s[e]||e).join(", ")}return s[e]||e},M=e=>{switch(e){case"erfolg":return s.jsx(h,{size:16,className:"text-success"});case"teilweise":return s.jsx(m,{size:16,className:"text-warning"});case"fehler":return s.jsx(f,{size:16,className:"text-danger"});default:return null}},R=e=>{if(!e)return"-";return new Date(e).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},G=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e||0);return d?s.jsxs("div",{className:"loading-container",children:[s.jsx("div",{className:"spinner"}),s.jsx("p",{children:"Lade Zeitpl√§ne..."})]}):s.jsxs("div",{className:"auto-lastschrift-container "+(a?"embedded":""),children:[s.jsxs("div",{className:"section-header",children:[s.jsxs("h2",{children:[s.jsx(c,{size:24}),"Automatische Lastschriftl√§ufe"]}),s.jsxs("button",{className:"btn btn-primary",onClick:()=>{O(),C(null),p(!0)},children:[s.jsx(v,{size:18}),"Neuer Zeitplan"]})]}),j&&s.jsxs("div",{className:"alert alert-danger",children:[j,s.jsxs("button",{onClick:P,className:"btn btn-sm btn-secondary ml-2",children:[s.jsx(N,{size:14})," Erneut versuchen"]})]}),0===l.length?s.jsxs("div",{className:"empty-state",children:[s.jsx(c,{size:48}),s.jsx("h3",{children:"Keine Zeitpl√§ne vorhanden"}),s.jsx("p",{children:"Erstellen Sie einen Zeitplan f√ºr automatische Lastschriftl√§ufe."}),s.jsxs("button",{className:"btn btn-primary",onClick:()=>{O(),p(!0)},children:[s.jsx(v,{size:18})," Zeitplan erstellen"]})]}):s.jsx("div",{className:"zeitplaene-list",children:l.map(e=>{var a;return s.jsxs("div",{className:"zeitplan-card "+(e.aktiv?"":"inactive"),children:[s.jsxs("div",{className:"zeitplan-header",children:[s.jsxs("div",{className:"zeitplan-info",children:[s.jsxs("div",{className:"zeitplan-title",children:[s.jsx(c,{size:20}),s.jsx("h3",{children:e.name}),s.jsx("span",{className:"badge "+(e.aktiv?"badge-success":"badge-secondary"),children:e.aktiv?"Aktiv":"Inaktiv"})]}),s.jsxs("div",{className:"zeitplan-meta",children:[s.jsxs("span",{children:[s.jsx(u,{size:14}),e.ausfuehrungstag,". des Monats um"," ",null==(a=e.ausfuehrungszeit)?void 0:a.substring(0,5)," Uhr"]}),s.jsx("span",{className:"badge badge-info",children:I(e.typ)}),s.jsx("span",{className:"badge badge-secondary",children:V(e.dojo_id)})]})]}),s.jsxs("div",{className:"zeitplan-actions",children:[s.jsx("button",{className:"btn btn-sm btn-icon",onClick:()=>(async e=>{try{const s=await fetch(`${A}/lastschrift-zeitplaene/${e.zeitplan_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({dojo_id:e.dojo_id,aktiv:!e.aktiv})}),a=await s.json();a.success?P():alert(a.error||"Fehler beim Aktualisieren")}catch(s){alert("Fehler: "+s.message)}})(e),title:e.aktiv?"Deaktivieren":"Aktivieren",children:e.aktiv?s.jsx(z,{size:16}):s.jsx(_,{size:16})}),s.jsx("button",{className:"btn btn-sm btn-icon",onClick:()=>(e=>{var s;C(e);let a=["beitraege"];e.typ&&(a="alle"===e.typ?["beitraege","rechnungen","verkaeufe"]:e.typ.split(",").filter(e=>e)),T({name:e.name||"",beschreibung:e.beschreibung||"",ausfuehrungstag:e.ausfuehrungstag||1,ausfuehrungszeit:(null==(s=e.ausfuehrungszeit)?void 0:s.substring(0,5))||"06:00",typen:a,nur_faellige_bis_tag:e.nur_faellige_bis_tag||"",aktiv:!1!==e.aktiv,dojo_id:null===e.dojo_id||0===e.dojo_id?"all":e.dojo_id||""}),p(!0)})(e),title:"Bearbeiten",children:s.jsx(y,{size:16})}),s.jsx("button",{className:"btn btn-sm btn-icon btn-danger",onClick:()=>(async e=>{if(window.confirm(`Zeitplan "${e.name}" wirklich l√∂schen?`))try{const s=await fetch(`${A}/lastschrift-zeitplaene/${e.zeitplan_id}?dojo_id=${e.dojo_id}`,{method:"DELETE"}),a=await s.json();a.success?P():alert(a.error||"Fehler beim L√∂schen")}catch(s){alert("Fehler: "+s.message)}})(e),title:"L√∂schen",children:s.jsx(k,{size:16})}),s.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>(async e=>{if(window.confirm(`Zeitplan "${e.name}" jetzt ausf√ºhren?`)){B(e.zeitplan_id);try{const s=await fetch(`${A}/lastschrift-zeitplaene/${e.zeitplan_id}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dojo_id:e.dojo_id})}),a=await s.json();a.success?(alert(`Lastschriftlauf erfolgreich!\n\nVerarbeitet: ${a.anzahl_verarbeitet}\nErfolgreich: ${a.anzahl_erfolgreich}\nBetrag: ${(a.gesamtbetrag||0).toFixed(2)} EUR`),P(),E===e.zeitplan_id&&U(e.zeitplan_id,e.dojo_id)):alert(a.error||"Fehler bei der Ausf√ºhrung")}catch(s){alert("Fehler: "+s.message)}finally{B(null)}}})(e),disabled:Z===e.zeitplan_id,title:"Jetzt ausf√ºhren",children:[Z===e.zeitplan_id?s.jsx(N,{size:16,className:"spinning"}):s.jsx(_,{size:16}),"Jetzt ausf√ºhren"]})]})]}),e.letzte_ausfuehrung&&s.jsxs("div",{className:"letzte-ausfuehrung",children:[s.jsx("span",{className:"label",children:"Letzte Ausf√ºhrung:"}),s.jsx("span",{className:"date",children:R(e.letzte_ausfuehrung)}),M(e.letzte_ausfuehrung_status),s.jsxs("span",{className:"count",children:[e.letzte_ausfuehrung_anzahl," Einz√ºge"]}),s.jsx("span",{className:"amount",children:G(e.letzte_ausfuehrung_betrag)})]}),s.jsx("button",{className:"expand-btn",onClick:()=>(e=>{E===e.zeitplan_id?L(null):(L(e.zeitplan_id),$[e.zeitplan_id]||U(e.zeitplan_id,e.dojo_id))})(e),children:E===e.zeitplan_id?s.jsxs(s.Fragment,{children:[s.jsx(w,{size:16})," Weniger anzeigen"]}):s.jsxs(s.Fragment,{children:[s.jsx(x,{size:16})," Historie anzeigen"]})}),E===e.zeitplan_id&&s.jsxs("div",{className:"ausfuehrungen-liste",children:[s.jsx("h4",{children:"Letzte Ausf√ºhrungen"}),$[e.zeitplan_id]?0===$[e.zeitplan_id].length?s.jsx("p",{className:"no-data",children:"Noch keine Ausf√ºhrungen"}):s.jsxs("table",{className:"table table-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Datum"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Verarbeitet"}),s.jsx("th",{children:"Erfolgreich"}),s.jsx("th",{children:"Betrag"})]})}),s.jsx("tbody",{children:$[e.zeitplan_id].map(e=>s.jsxs("tr",{children:[s.jsx("td",{children:R(e.gestartet_am)}),s.jsxs("td",{children:[M(e.status),s.jsx("span",{className:"ml-1",children:e.status})]}),s.jsx("td",{children:e.anzahl_verarbeitet}),s.jsx("td",{children:e.anzahl_erfolgreich}),s.jsx("td",{children:G(e.gesamtbetrag)})]},e.ausfuehrung_id))})]}):s.jsx("div",{className:"loading-inline",children:"Lade..."})]})]},e.zeitplan_id)})}),b&&s.jsx("div",{className:"modal-overlay",onClick:()=>p(!1),children:s.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{children:S?"Zeitplan bearbeiten":"Neuer Zeitplan"}),s.jsx("button",{className:"close-btn",onClick:()=>p(!1),children:"√ó"})]}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{const e=S?`${A}/lastschrift-zeitplaene/${S.zeitplan_id}`:`${A}/lastschrift-zeitplaene`,s=S?"PUT":"POST",a=await fetch(e,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify({...D,dojo_id:D.dojo_id,ausfuehrungszeit:D.ausfuehrungszeit+":00",nur_faellige_bis_tag:D.nur_faellige_bis_tag||null,typ:D.typen.join(",")})}),n=await a.json();n.success?(p(!1),C(null),O(),P()):alert(n.error||"Fehler beim Speichern")}catch(s){alert("Fehler: "+s.message)}},children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Dojo *"}),s.jsxs("select",{value:D.dojo_id,onChange:e=>T({...D,dojo_id:e.target.value}),required:!0,children:[s.jsx("option",{value:"",children:"-- Dojo ausw√§hlen --"}),s.jsx("option",{value:"all",children:"Alle Dojos"}),n.map(e=>s.jsx("option",{value:e.id,children:e.dojoname},e.id))]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Name *"}),s.jsx("input",{type:"text",value:D.name,onChange:e=>T({...D,name:e.target.value}),placeholder:"z.B. Monatsbeitr√§ge Anfang",required:!0})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Beschreibung"}),s.jsx("textarea",{value:D.beschreibung,onChange:e=>T({...D,beschreibung:e.target.value}),placeholder:"Optionale Beschreibung...",rows:2})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Ausf√ºhrungstag *"}),s.jsx("select",{value:D.ausfuehrungstag,onChange:e=>T({...D,ausfuehrungstag:parseInt(e.target.value)}),children:Array.from({length:28},(e,s)=>s+1).map(e=>s.jsxs("option",{value:e,children:[e,". des Monats"]},e))})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Uhrzeit *"}),s.jsx("input",{type:"time",value:D.ausfuehrungszeit,onChange:e=>T({...D,ausfuehrungszeit:e.target.value}),required:!0})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Einzugstyp * (mehrere ausw√§hlbar)"}),s.jsx("div",{className:"checkbox-group",children:[{value:"beitraege",label:"Beitr√§ge"},{value:"rechnungen",label:"Rechnungen"},{value:"verkaeufe",label:"Verk√§ufe"}].map(e=>s.jsxs("label",{className:"checkbox-option",children:[s.jsx("input",{type:"checkbox",value:e.value,checked:D.typen.includes(e.value),onChange:e=>{const s=e.target.value;e.target.checked?T({...D,typen:[...D.typen,s]}):D.typen.length>1&&T({...D,typen:D.typen.filter(e=>e!==s)})}}),s.jsx("span",{className:"checkbox-text",children:e.label})]},e.value))})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Nur Beitr√§ge f√§llig bis Tag (optional)"}),s.jsx("input",{type:"number",min:"1",max:"31",value:D.nur_faellige_bis_tag,onChange:e=>T({...D,nur_faellige_bis_tag:e.target.value}),placeholder:"z.B. 15"}),s.jsx("small",{className:"form-text",children:"Nur Beitr√§ge einziehen, die bis zu diesem Tag des Monats f√§llig sind"})]}),s.jsx("div",{className:"form-group",children:s.jsxs("label",{className:"checkbox-label",children:[s.jsx("input",{type:"checkbox",checked:D.aktiv,onChange:e=>T({...D,aktiv:e.target.checked})}),"Zeitplan aktiv"]})}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>p(!1),children:"Abbrechen"}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:S?"Speichern":"Erstellen"})]})]})]})})]})},$=()=>{const a=C(),[t,l]=e.useState("lastschriftlauf");return s.jsxs("div",{className:"lastschrift-management-container",children:[s.jsxs("div",{className:"management-header",children:[s.jsxs("button",{className:"btn btn-secondary",onClick:()=>a("/dashboard/beitraege"),children:[s.jsx(r,{size:20}),"Zur√ºck zu Beitr√§ge"]}),s.jsxs("div",{className:"sub-tabs-sidebar-style",children:[s.jsxs("button",{className:"tab-vertical-btn "+("lastschriftlauf"===t?"active":""),onClick:()=>l("lastschriftlauf"),children:[s.jsx("span",{className:"tab-icon",children:s.jsx(S,{size:20})}),s.jsx("span",{className:"tab-label",children:"Neuer Lastschriftlauf"})]}),s.jsxs("button",{className:"tab-vertical-btn "+("zahllaeufe"===t?"active":""),onClick:()=>l("zahllaeufe"),children:[s.jsx("span",{className:"tab-icon",children:s.jsx(d,{size:20})}),s.jsx("span",{className:"tab-label",children:"Zahll√§ufe-√úbersicht"})]}),s.jsxs("button",{className:"tab-vertical-btn "+("automatisch"===t?"active":""),onClick:()=>l("automatisch"),children:[s.jsx("span",{className:"tab-icon",children:s.jsx(c,{size:20})}),s.jsx("span",{className:"tab-label",children:"Automatische Einz√ºge"})]})]})]}),s.jsxs("div",{className:"tab-content",children:["lastschriftlauf"===t&&s.jsx(n,{embedded:!0}),"zahllaeufe"===t&&s.jsx(E,{embedded:!0}),"automatisch"===t&&s.jsx(L,{embedded:!0})]})]})};export{$ as default};
