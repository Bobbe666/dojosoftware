import{j as e}from"./animation-1wuIdCBS.js";import{u as s,g as r,r as a}from"./vendor-router-BhMXg4Z-.js";import{u as l,a as t,c as i}from"./index-DUnH23_2.js";import{j as n}from"./index-CkXcCt97.js";/* empty css             */import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";import"./icons-D7rg4pDH.js";function o({mode:o="create"}){const c=s(),{id:d}=r(),{token:h}=l(),[u,m]=a.useState({titel:"",kurzbeschreibung:"",inhalt:"",zielgruppe:"alle_dojos",status:"entwurf"}),[p,j]=a.useState(!1),[x,g]=a.useState(!1),[b,f]=a.useState(""),[N,v]=a.useState(""),w=()=>{try{if(h){const e=n(h);return 1===e.id||1===e.user_id||"admin"===e.username}}catch(e){console.error("Token decode error:",e)}return!1};a.useEffect(()=>{w()?"edit"===o&&d&&z():c("/dashboard")},[o,d,h]);const z=async()=>{var e,s;j(!0),f("");try{const e=(await t.get(`${i.apiBaseUrl}/news/${d}`,{headers:{Authorization:`Bearer ${h}`}})).data;m({titel:e.titel||"",kurzbeschreibung:e.kurzbeschreibung||"",inhalt:e.inhalt||"",zielgruppe:e.zielgruppe||"alle_dojos",status:e.status||"entwurf"})}catch(r){console.error("Fehler beim Laden der News:",r),f("Fehler beim Laden der News: "+((null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.error)||r.message))}finally{j(!1)}},k=e=>{const{name:s,value:r}=e.target;m(e=>({...e,[s]:r}))};return w()?p?e.jsx("div",{className:"news-formular",children:e.jsx("div",{className:"news-loading",children:"Lädt News..."})}):e.jsxs("div",{className:"news-formular",children:[e.jsx("div",{className:"news-header",children:e.jsxs("div",{className:"news-header-left",children:[e.jsx("button",{className:"btn-back",onClick:()=>c("/dashboard/news"),children:"← Zurück"}),e.jsx("h1",{children:"edit"===o?"News bearbeiten":"Neue News erstellen"})]})}),b&&e.jsx("div",{className:"news-error",children:b}),N&&e.jsx("div",{className:"news-success",children:N}),e.jsxs("form",{onSubmit:async e=>{var s,r;e.preventDefault(),g(!0),f(""),v("");try{if(!u.titel.trim())throw new Error("Titel ist erforderlich");if(!u.inhalt.trim())throw new Error("Inhalt ist erforderlich");"edit"===o&&d?(await t.put(`${i.apiBaseUrl}/news/${d}`,u,{headers:{Authorization:`Bearer ${h}`}}),v("News erfolgreich aktualisiert!")):(await t.post(`${i.apiBaseUrl}/news`,u,{headers:{Authorization:`Bearer ${h}`}}),v("News erfolgreich erstellt!")),setTimeout(()=>{c("/dashboard/news")},1500)}catch(a){console.error("Fehler beim Speichern:",a),f((null==(r=null==(s=a.response)?void 0:s.data)?void 0:r.error)||a.message||"Fehler beim Speichern")}finally{g(!1)}},className:"news-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"titel",children:"Titel *"}),e.jsx("input",{type:"text",id:"titel",name:"titel",value:u.titel,onChange:k,placeholder:"Titel der News",required:!0,className:"form-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"kurzbeschreibung",children:["Kurzbeschreibung",e.jsxs("span",{className:"char-count",children:["(",u.kurzbeschreibung.length,"/500)"]})]}),e.jsx("textarea",{id:"kurzbeschreibung",name:"kurzbeschreibung",value:u.kurzbeschreibung,onChange:k,placeholder:"Kurze Zusammenfassung für die Vorschau...",maxLength:500,rows:3,className:"form-textarea"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"inhalt",children:"Inhalt *"}),e.jsx("textarea",{id:"inhalt",name:"inhalt",value:u.inhalt,onChange:k,placeholder:"Der vollständige News-Artikel...",required:!0,rows:12,className:"form-textarea form-textarea-large"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Zielgruppe"}),e.jsxs("div",{className:"radio-group",children:[e.jsxs("label",{className:"radio-label",children:[e.jsx("input",{type:"radio",name:"zielgruppe",value:"alle_dojos",checked:"alle_dojos"===u.zielgruppe,onChange:k}),e.jsxs("span",{className:"radio-text",children:[e.jsx("strong",{children:"Alle Dojos"}),e.jsx("small",{children:"Wird allen Dojos im System angezeigt"})]})]}),e.jsxs("label",{className:"radio-label",children:[e.jsx("input",{type:"radio",name:"zielgruppe",value:"homepage",checked:"homepage"===u.zielgruppe,onChange:k}),e.jsxs("span",{className:"radio-text",children:[e.jsx("strong",{children:"Nur Homepage (TDA-VIB)"}),e.jsx("small",{children:"Wird nur auf der TDA-VIB Homepage angezeigt"})]})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:u.status,onChange:k,className:"form-select",children:[e.jsx("option",{value:"entwurf",children:"Entwurf"}),e.jsx("option",{value:"veroeffentlicht",children:"Veröffentlicht"}),e.jsx("option",{value:"archiviert",children:"Archiviert"})]}),"veroeffentlicht"===u.status&&e.jsx("small",{className:"form-hint",children:"Die News wird sofort für die Zielgruppe sichtbar sein."})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>c("/dashboard/news"),children:"Abbrechen"}),e.jsx("button",{type:"submit",className:"btn-save",disabled:x,children:x?"Speichert...":"edit"===o?"Speichern":"Erstellen"})]})]})]}):null}export{o as default};
