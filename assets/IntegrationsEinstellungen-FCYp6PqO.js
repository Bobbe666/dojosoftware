import{a as e,j as s}from"./query-Caj74EYQ.js";import{b as i,a as t}from"./index-CREwepoQ.js";import{c as l,a0 as r,F as n,b6 as a,b2 as o,E as d,j as c,R as p,u as x,g as u,k as f,bk as g}from"./icons-DiLw-1i5.js";import"./vendor-router-Co3o87Zc.js";import"./charts-C1Gv3M_c.js";const h=()=>{var u,f,g,h,m;const{activeDojo:v}=i(),[_,k]=e.useState(!0),[S,z]=e.useState(!1),[I,T]=e.useState(null),[B,C]=e.useState({}),[w,E]=e.useState({}),[D,P]=e.useState({stripe_publishable_key:"",stripe_secret_key:"",paypal_client_id:"",paypal_client_secret:"",paypal_sandbox:!0,lexoffice_api_key:"",datev_consultant_number:"",datev_client_number:""}),R=(null==v?void 0:v.id)||v;e.useEffect(()=>{R&&"super-admin"!==R&&(L(),A())},[R]);const L=async()=>{try{k(!0);const e=await t.get(`/integrations/config?dojo_id=${R}`);e.data&&P(s=>({...s,...e.data}))}catch(e){console.error("Fehler beim Laden der Konfiguration:",e)}finally{k(!1)}},A=async()=>{try{const e=await t.get(`/integrations/status?dojo_id=${R}`);T(e.data)}catch(e){console.error("Fehler beim Laden des Status:",e)}},F=async e=>{try{E(s=>({...s,[e]:{loading:!0}}));const s=await t.post(`/integrations/${e}/test?dojo_id=${R}`);E(i=>({...i,[e]:{success:s.data.success,message:s.data.message}}))}catch(s){E(i=>{var t,l;return{...i,[e]:{success:!1,message:(null==(l=null==(t=s.response)?void 0:t.data)?void 0:l.error)||"Verbindung fehlgeschlagen"}}})}},K=e=>{C(s=>({...s,[e]:!s[e]}))};return _?s.jsx("div",{style:j.container,children:s.jsx("div",{style:j.loading,children:"Lade Einstellungen..."})}):s.jsxs("div",{style:j.container,children:[s.jsxs("div",{style:j.header,children:[s.jsx(l,{size:32,color:"#ffd700"}),s.jsxs("div",{children:[s.jsx("h2",{style:j.title,children:"Integration-Einstellungen"}),s.jsx("p",{style:j.subtitle,children:"Konfiguriere PayPal, LexOffice und DATEV"})]})]}),I&&s.jsxs("div",{style:j.statusGrid,children:[s.jsx(y,{title:"Stripe",icon:s.jsx(r,{size:24}),configured:null==(u=I.stripe)?void 0:u.configured,mode:"Kreditkarte & SEPA"}),s.jsx(y,{title:"PayPal",icon:s.jsx(r,{size:24}),configured:null==(f=I.paypal)?void 0:f.configured,mode:(null==(g=I.paypal)?void 0:g.sandbox)?"Sandbox":"Live"}),s.jsx(y,{title:"LexOffice",icon:s.jsx(n,{size:24}),configured:null==(h=I.lexoffice)?void 0:h.configured}),s.jsx(y,{title:"DATEV",icon:s.jsx(a,{size:24}),configured:null==(m=I.datev)?void 0:m.configured})]}),s.jsxs("div",{style:j.section,children:[s.jsxs("div",{style:j.sectionHeader,children:[s.jsx(r,{size:24,color:"#635bff"}),s.jsx("h3",{style:j.sectionTitle,children:"Stripe"}),s.jsxs("a",{href:"https://dashboard.stripe.com/apikeys",target:"_blank",rel:"noopener noreferrer",style:j.helpLink,children:[s.jsx(o,{size:14})," API-Keys Dashboard"]})]}),s.jsx("div",{style:j.infoBox,children:s.jsx("p",{children:"Stripe ermöglicht Kreditkarten- und SEPA-Lastschrift-Zahlungen. Die API-Keys findest du im Stripe Dashboard unter Developers → API Keys."})}),s.jsx("div",{style:j.formRow,children:s.jsxs("div",{style:j.formGroup,children:[s.jsx("label",{style:j.label,children:"Publishable Key (öffentlich)"}),s.jsx("input",{type:"text",value:D.stripe_publishable_key||"",onChange:e=>P({...D,stripe_publishable_key:e.target.value}),style:j.input,placeholder:"pk_live_... oder pk_test_..."})]})}),s.jsx("div",{style:j.formRow,children:s.jsxs("div",{style:j.formGroup,children:[s.jsx("label",{style:j.label,children:"Secret Key (geheim)"}),s.jsxs("div",{style:j.secretInput,children:[s.jsx("input",{type:B.stripe?"text":"password",value:D.stripe_secret_key||"",onChange:e=>P({...D,stripe_secret_key:e.target.value}),style:{...j.input,flex:1},placeholder:"sk_live_... oder sk_test_..."}),s.jsx("button",{style:j.eyeButton,onClick:()=>K("stripe"),children:B.stripe?s.jsx(d,{size:18}):s.jsx(c,{size:18})})]})]})}),s.jsx("div",{style:{...j.infoBox,background:"rgba(99, 91, 255, 0.1)",borderColor:"rgba(99, 91, 255, 0.3)"},children:s.jsxs("p",{style:{margin:0},children:[s.jsx("strong",{children:"Hinweis:"})," Verwende für Tests die Test-Keys (pk_test_... / sk_test_...). Für Live-Zahlungen benötigst du die Live-Keys (pk_live_... / sk_live_...)."]})})]}),s.jsxs("div",{style:j.section,children:[s.jsxs("div",{style:j.sectionHeader,children:[s.jsx(r,{size:24,color:"#0070ba"}),s.jsx("h3",{style:j.sectionTitle,children:"PayPal"}),s.jsxs("a",{href:"https://developer.paypal.com/dashboard/applications",target:"_blank",rel:"noopener noreferrer",style:j.helpLink,children:[s.jsx(o,{size:14})," Entwickler-Dashboard"]})]}),s.jsx("div",{style:j.infoBox,children:s.jsx("p",{children:"Um PayPal zu nutzen, erstelle eine App im PayPal Developer Dashboard und kopiere die Client ID und das Secret hierher."})}),s.jsx("div",{style:j.formRow,children:s.jsxs("div",{style:j.formGroup,children:[s.jsx("label",{style:j.label,children:"Client ID"}),s.jsx("input",{type:"text",value:D.paypal_client_id||"",onChange:e=>P({...D,paypal_client_id:e.target.value}),style:j.input,placeholder:"AV9b8ND..."})]})}),s.jsx("div",{style:j.formRow,children:s.jsxs("div",{style:j.formGroup,children:[s.jsx("label",{style:j.label,children:"Client Secret"}),s.jsxs("div",{style:j.secretInput,children:[s.jsx("input",{type:B.paypal?"text":"password",value:D.paypal_client_secret||"",onChange:e=>P({...D,paypal_client_secret:e.target.value}),style:{...j.input,flex:1},placeholder:"EK3qE9N..."}),s.jsx("button",{style:j.eyeButton,onClick:()=>K("paypal"),children:B.paypal?s.jsx(d,{size:18}):s.jsx(c,{size:18})})]})]})}),s.jsx("div",{style:j.formRow,children:s.jsxs("label",{style:j.checkboxLabel,children:[s.jsx("input",{type:"checkbox",checked:D.paypal_sandbox,onChange:e=>P({...D,paypal_sandbox:e.target.checked})}),s.jsx("span",{children:"Sandbox-Modus (Test-Umgebung)"})]})}),s.jsx(b,{service:"paypal",onTest:()=>F("paypal"),result:w.paypal,disabled:!D.paypal_client_id||!D.paypal_client_secret})]}),s.jsxs("div",{style:j.section,children:[s.jsxs("div",{style:j.sectionHeader,children:[s.jsx(n,{size:24,color:"#0066cc"}),s.jsx("h3",{style:j.sectionTitle,children:"LexOffice"}),s.jsxs("a",{href:"https://app.lexoffice.de/addons/public-api",target:"_blank",rel:"noopener noreferrer",style:j.helpLink,children:[s.jsx(o,{size:14})," API-Schlüssel generieren"]})]}),s.jsx("div",{style:j.infoBox,children:s.jsx("p",{children:"Der API-Schlüssel wird in LexOffice unter Einstellungen → Erweiterungen → Public API generiert."})}),s.jsx("div",{style:j.formRow,children:s.jsxs("div",{style:j.formGroup,children:[s.jsx("label",{style:j.label,children:"API-Schlüssel"}),s.jsxs("div",{style:j.secretInput,children:[s.jsx("input",{type:B.lexoffice?"text":"password",value:D.lexoffice_api_key||"",onChange:e=>P({...D,lexoffice_api_key:e.target.value}),style:{...j.input,flex:1},placeholder:"a1b2c3d4-e5f6-..."}),s.jsx("button",{style:j.eyeButton,onClick:()=>K("lexoffice"),children:B.lexoffice?s.jsx(d,{size:18}):s.jsx(c,{size:18})})]})]})}),s.jsx(b,{service:"lexoffice",onTest:()=>F("lexoffice"),result:w.lexoffice,disabled:!D.lexoffice_api_key})]}),s.jsxs("div",{style:j.section,children:[s.jsxs("div",{style:j.sectionHeader,children:[s.jsx(a,{size:24,color:"#006633"}),s.jsx("h3",{style:j.sectionTitle,children:"DATEV"})]}),s.jsx("div",{style:j.infoBox,children:s.jsx("p",{children:"Die Beraternummer und Mandantennummer werden vom Steuerberater bereitgestellt und sind für den DATEV-Export erforderlich."})}),s.jsxs("div",{style:j.formRow,children:[s.jsxs("div",{style:j.formGroup,children:[s.jsx("label",{style:j.label,children:"Beraternummer"}),s.jsx("input",{type:"text",value:D.datev_consultant_number||"",onChange:e=>P({...D,datev_consultant_number:e.target.value}),style:j.input,placeholder:"12345",maxLength:7})]}),s.jsxs("div",{style:j.formGroup,children:[s.jsx("label",{style:j.label,children:"Mandantennummer"}),s.jsx("input",{type:"text",value:D.datev_client_number||"",onChange:e=>P({...D,datev_client_number:e.target.value}),style:j.input,placeholder:"10001",maxLength:5})]})]}),s.jsxs("div",{style:j.datevInfo,children:[s.jsx("h4",{style:{color:"#ffd700",margin:"0 0 8px 0"},children:"DATEV-Export Formate:"}),s.jsxs("ul",{style:{margin:0,paddingLeft:"20px",color:"#aaa"},children:[s.jsx("li",{children:"Buchungsstapel (Rechnungen) - EXTF Format"}),s.jsx("li",{children:"Zahlungen - EXTF Format"}),s.jsx("li",{children:"Debitoren-Stammdaten - ASCII Format"})]})]})]}),s.jsx("div",{style:j.footer,children:s.jsx("button",{style:j.saveButton,onClick:async()=>{var e,s;try{z(!0),await t.put("/integrations/config",{...D,dojo_id:R}),alert("Einstellungen gespeichert!"),A()}catch(i){console.error("Fehler beim Speichern:",i),alert((null==(s=null==(e=i.response)?void 0:e.data)?void 0:s.error)||"Fehler beim Speichern")}finally{z(!1)}},disabled:S,children:S?s.jsxs(s.Fragment,{children:[s.jsx(p,{size:18,className:"spinning"})," Speichern..."]}):s.jsxs(s.Fragment,{children:[s.jsx(x,{size:18})," Einstellungen speichern"]})})})]})},y=({title:e,icon:i,configured:t,mode:l})=>s.jsxs("div",{style:{...j.statusCard,borderColor:t?"rgba(34, 197, 94, 0.5)":"rgba(255, 255, 255, 0.1)"},children:[s.jsx("div",{style:j.statusIcon,children:i}),s.jsxs("div",{style:j.statusInfo,children:[s.jsx("strong",{children:e}),s.jsxs("span",{style:{color:t?"#22c55e":"#ef4444",fontSize:"12px"},children:[t?"Konfiguriert":"Nicht konfiguriert",l&&t&&` (${l})`]})]}),t?s.jsx(u,{size:20,color:"#22c55e"}):s.jsx(f,{size:20,color:"#666"})]}),b=({service:e,onTest:i,result:t,disabled:l})=>s.jsxs("div",{style:j.testSection,children:[s.jsx("button",{style:{...j.testButton,opacity:l?.5:1},onClick:i,disabled:l||(null==t?void 0:t.loading),children:(null==t?void 0:t.loading)?s.jsxs(s.Fragment,{children:[s.jsx(p,{size:16,className:"spinning"})," Teste..."]}):s.jsxs(s.Fragment,{children:[s.jsx(g,{size:16})," Verbindung testen"]})}),t&&!t.loading&&s.jsxs("div",{style:{...j.testResult,background:t.success?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",borderColor:t.success?"#22c55e":"#ef4444"},children:[t.success?s.jsx(u,{size:16,color:"#22c55e"}):s.jsx(f,{size:16,color:"#ef4444"}),s.jsx("span",{children:t.message})]})]}),j={container:{padding:"24px",maxWidth:"900px",margin:"0 auto"},header:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"32px"},title:{color:"#ffd700",margin:0,fontSize:"24px"},subtitle:{color:"#aaa",margin:"4px 0 0 0",fontSize:"14px"},statusGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",marginBottom:"32px"},statusCard:{display:"flex",alignItems:"center",gap:"12px",padding:"16px",background:"rgba(255, 255, 255, 0.05)",border:"1px solid",borderRadius:"12px"},statusIcon:{color:"#ffd700"},statusInfo:{flex:1,display:"flex",flexDirection:"column",color:"#fff"},section:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 215, 0, 0.2)",borderRadius:"12px",padding:"24px",marginBottom:"20px"},sectionHeader:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},sectionTitle:{color:"#fff",margin:0,fontSize:"18px",flex:1},helpLink:{display:"flex",alignItems:"center",gap:"4px",color:"#ffd700",textDecoration:"none",fontSize:"13px"},infoBox:{background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:"8px",padding:"12px 16px",marginBottom:"20px",color:"#aaa",fontSize:"14px"},formRow:{display:"flex",gap:"16px",marginBottom:"16px"},formGroup:{flex:1},label:{display:"block",color:"#ffd700",marginBottom:"8px",fontSize:"14px"},input:{width:"100%",padding:"12px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid rgba(255, 215, 0, 0.3)",borderRadius:"8px",color:"#fff",fontSize:"14px",boxSizing:"border-box"},secretInput:{display:"flex",gap:"8px"},eyeButton:{background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",padding:"12px",color:"#fff",cursor:"pointer"},checkboxLabel:{display:"flex",alignItems:"center",gap:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},testSection:{display:"flex",alignItems:"center",gap:"16px",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid rgba(255, 255, 255, 0.1)"},testButton:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 16px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},testResult:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",borderRadius:"8px",border:"1px solid",fontSize:"13px"},datevInfo:{background:"rgba(0, 102, 51, 0.1)",border:"1px solid rgba(0, 102, 51, 0.3)",borderRadius:"8px",padding:"16px",marginTop:"16px"},footer:{display:"flex",justifyContent:"flex-end",marginTop:"24px"},saveButton:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 28px",background:"#ffd700",border:"none",borderRadius:"8px",color:"#1a1a2e",fontWeight:"bold",fontSize:"16px",cursor:"pointer"},loading:{textAlign:"center",padding:"60px",color:"#888"}};export{h as default};
