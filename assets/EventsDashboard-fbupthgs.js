import{a as e,j as s}from"./query-Caj74EYQ.js";import{b as a,u as n,a as t,c as l}from"./index-lGWqIYMX.js";/* empty css               */import{R as r,p as i,C as c,K as d,T as o,o as h,q as m,g as x,t as j,M as u,Q as v,F as b}from"./icons-C9nQ4cWf.js";import"./vendor-router-B2AaIOtG.js";import"./charts-QHQg_ypW.js";const p=()=>{const{token:p}=a(),{activeDojo:g}=n(),[N,f]=e.useState(!0),[y,E]=e.useState(null),[z,k]=e.useState([]),[_,w]=e.useState({});e.useEffect(()=>{(null==g?void 0:g.id)&&$()},[null==g?void 0:g.id]);const $=async()=>{f(!0);try{const e=await t.get(`${l.apiBaseUrl}/events/stats/dashboard?dojo_id=${null==g?void 0:g.id}`,{headers:{Authorization:`Bearer ${p}`}});e.data.success&&(E(e.data.stats),k(e.data.top_events||[]))}catch(e){console.error("Fehler beim Laden des Dashboards:",e)}finally{f(!1)}};return N?s.jsx("div",{className:"events-container",children:s.jsxs("div",{className:"events-loading",children:[s.jsx(r,{size:32,className:"spin"}),s.jsx("p",{children:"Lade Dashboard..."})]})}):s.jsxs("div",{className:"events-container",children:[s.jsxs("div",{className:"events-header",children:[s.jsxs("div",{children:[s.jsxs("h1",{children:[s.jsx(i,{size:28}),"Event-Dashboard"]}),s.jsx("p",{children:"Übersicht über Events, Anmeldungen und Zahlungen"})]}),s.jsxs("button",{onClick:$,className:"btn-refresh",children:[s.jsx(r,{size:16}),"Aktualisieren"]})]}),s.jsxs("div",{className:"events-stats-grid",children:[s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon",style:{background:"rgba(99, 102, 241, 0.2)",color:"#6366f1"},children:s.jsx(c,{size:24})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("span",{className:"stat-value",children:(null==y?void 0:y.aktive_events)||0}),s.jsx("span",{className:"stat-label",children:"Aktive Events"})]})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon",style:{background:"rgba(245, 158, 11, 0.2)",color:"#f59e0b"},children:s.jsx(d,{size:24})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("span",{className:"stat-value",children:(null==y?void 0:y.offene_zahlungen)||0}),s.jsx("span",{className:"stat-label",children:"Offene Zahlungen"})]})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon",style:{background:"rgba(239, 68, 68, 0.2)",color:"#ef4444"},children:s.jsx(o,{size:24})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("span",{className:"stat-value",children:((null==y?void 0:y.offene_summe)||0).toLocaleString("de-DE",{style:"currency",currency:"EUR"})}),s.jsx("span",{className:"stat-label",children:"Offener Betrag"})]})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon",style:{background:"rgba(34, 197, 94, 0.2)",color:"#22c55e"},children:s.jsx(h,{size:24})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("span",{className:"stat-value",children:(null==y?void 0:y.anmeldungen_woche)||0}),s.jsx("span",{className:"stat-label",children:"Anmeldungen (7 Tage)"})]})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon",style:{background:"rgba(139, 92, 246, 0.2)",color:"#8b5cf6"},children:s.jsx(m,{size:24})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("span",{className:"stat-value",children:(null==y?void 0:y.warteliste)||0}),s.jsx("span",{className:"stat-label",children:"Auf Warteliste"})]})]})]}),s.jsxs("div",{className:"events-section",children:[s.jsx("h2",{children:"Kommende Events mit Anmeldungen"}),s.jsx("div",{className:"events-table-container",children:s.jsxs("table",{className:"events-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Event"}),s.jsx("th",{children:"Datum"}),s.jsx("th",{children:"Teilnehmer"}),s.jsx("th",{children:"Bezahlt"}),s.jsx("th",{children:"Offen"}),s.jsx("th",{children:"Aktionen"})]})}),s.jsx("tbody",{children:0===z.length?s.jsx("tr",{children:s.jsx("td",{colSpan:"6",className:"no-data",children:"Keine aktiven Events"})}):z.map(e=>s.jsxs("tr",{children:[s.jsxs("td",{children:[s.jsx("strong",{children:e.titel}),e.teilnahmegebuehr>0&&s.jsx("span",{className:"fee-badge",children:parseFloat(e.teilnahmegebuehr).toLocaleString("de-DE",{style:"currency",currency:"EUR"})})]}),s.jsx("td",{children:new Date(e.datum).toLocaleDateString("de-DE")}),s.jsx("td",{children:s.jsxs("span",{className:"count-badge",children:[e.anmeldungen,e.max_teilnehmer&&` / ${e.max_teilnehmer}`]})}),s.jsx("td",{children:s.jsxs("span",{className:"status-badge success",children:[s.jsx(x,{size:12}),e.bezahlt||0]})}),s.jsx("td",{children:e.offen_summe>0?s.jsxs("span",{className:"status-badge warning",children:[s.jsx(j,{size:12}),parseFloat(e.offen_summe).toLocaleString("de-DE",{style:"currency",currency:"EUR"})]}):s.jsx("span",{className:"status-badge success",children:"-"})}),s.jsxs("td",{className:"actions-cell",children:[e.offen_summe>0&&s.jsx("button",{onClick:()=>(async e=>{var s,a;w(s=>({...s,[e]:!0}));try{const s=await t.post(`${l.apiBaseUrl}/events/${e}/send-reminder`,{},{headers:{Authorization:`Bearer ${p}`}});alert(s.data.message||"Erinnerungen gesendet")}catch(n){alert("Fehler beim Senden: "+((null==(a=null==(s=n.response)?void 0:s.data)?void 0:a.error)||n.message))}finally{w(s=>({...s,[e]:!1}))}})(e.event_id),disabled:_[e.event_id],className:"btn-action",title:"Zahlungserinnerung senden",children:_[e.event_id]?s.jsx(r,{size:14,className:"spin"}):s.jsx(u,{size:14})}),s.jsx("button",{onClick:()=>(async e=>{try{const s=await t.get(`${l.apiBaseUrl}/events/${e}/export/csv`,{headers:{Authorization:`Bearer ${p}`},responseType:"blob"}),a=window.URL.createObjectURL(new Blob([s.data])),n=document.createElement("a");n.href=a,n.setAttribute("download",`teilnehmer_${e}.csv`),document.body.appendChild(n),n.click(),n.remove()}catch(s){console.error("Export-Fehler:",s),alert("Fehler beim Export")}})(e.event_id),className:"btn-action",title:"CSV exportieren",children:s.jsx(v,{size:14})}),s.jsx("button",{onClick:()=>(async e=>{try{const s=await t.get(`${l.apiBaseUrl}/events/${e}/export/pdf`,{headers:{Authorization:`Bearer ${p}`},responseType:"blob"}),a=window.URL.createObjectURL(new Blob([s.data],{type:"application/pdf"})),n=document.createElement("a");n.href=a,n.setAttribute("download",`teilnehmer_${e}.pdf`),document.body.appendChild(n),n.click(),n.remove()}catch(s){console.error("Export-Fehler:",s),alert("Fehler beim Export")}})(e.event_id),className:"btn-action",title:"PDF exportieren",children:s.jsx(b,{size:14})})]})]},e.event_id))})]})})]}),s.jsxs("div",{className:"events-info-box",children:[s.jsx("h3",{children:"Hinweise"}),s.jsxs("ul",{children:[s.jsxs("li",{children:[s.jsx("strong",{children:"Zahlungserinnerungen:"})," Sendet eine Email an alle Teilnehmer mit offenen Zahlungen."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"CSV Export:"})," Exportiert die Teilnehmerliste mit allen Details."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"PDF Export:"})," Erstellt eine druckbare Liste mit Unterschriftenfeldern."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Warteliste:"})," Wenn ein Teilnehmer absagt, rückt automatisch der nächste von der Warteliste nach."]})]})]})]})};export{p as default};
