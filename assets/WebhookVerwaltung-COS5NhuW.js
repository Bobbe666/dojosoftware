import{j as e}from"./animation-1wuIdCBS.js";import{r as t}from"./vendor-router-BhMXg4Z-.js";import{b as s,a as o}from"./index-DUnH23_2.js";import{bp as i,P as r,Z as n,R as l,az as a,ad as d,K as c,g as p,k as x,q as h,E as u,j as g,$ as b}from"./icons-D7rg4pDH.js";import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";const f=()=>{const{activeDojo:f}=s(),[j,m]=t.useState([]),[v,k]=t.useState([]),[S,w]=t.useState(!0),[z,B]=t.useState(!1),[C,I]=t.useState(null),[L,R]=t.useState({}),[W,T]=t.useState(null),[D,_]=t.useState(null),[F,$]=t.useState(null),[H,N]=t.useState([]),[E,A]=t.useState({name:"",url:"",events:[],active:!0}),G=(null==f?void 0:f.id)||f;t.useEffect(()=>{G&&"super-admin"!==G&&(Z(),q())},[G]);const Z=async()=>{try{w(!0);const e=await o.get(`/webhooks?dojo_id=${G}`);m(e.data)}catch(e){console.error("Fehler beim Laden der Webhooks:",e)}finally{w(!1)}},q=async()=>{try{const e=await o.get("/webhooks/events");k(e.data.events||[])}catch(e){console.error("Fehler beim Laden der Events:",e)}};return S?e.jsx("div",{style:y.container,children:e.jsx("div",{style:y.loading,children:"Lade Webhooks..."})}):e.jsxs("div",{style:y.container,children:[e.jsxs("div",{style:y.header,children:[e.jsxs("div",{style:y.headerLeft,children:[e.jsx(i,{size:32,color:"#ffd700"}),e.jsxs("div",{children:[e.jsx("h2",{style:y.title,children:"Webhooks & Zapier"}),e.jsx("p",{style:y.subtitle,children:"Automatisiere dein Dojo mit externen Services"})]})]}),e.jsxs("button",{style:y.addButton,onClick:()=>B(!0),children:[e.jsx(r,{size:20}),"Webhook erstellen"]})]}),e.jsxs("div",{style:y.zapierCard,children:[e.jsx(n,{size:24,color:"#ff4a00"}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#ff4a00"},children:"Zapier Integration"}),e.jsx("p",{style:{margin:"4px 0 0 0",color:"#aaa",fontSize:"14px"},children:"Verbinde dein Dojo mit über 5.000 Apps wie Slack, Google Sheets, Mailchimp und mehr. Erstelle einen Webhook und nutze die URL in deinem Zapier Zap."})]})]}),0===j.length?e.jsxs("div",{style:y.emptyState,children:[e.jsx(i,{size:48,color:"#666"}),e.jsx("p",{children:"Noch keine Webhooks konfiguriert"}),e.jsx("button",{style:y.addButton,onClick:()=>B(!0),children:"Ersten Webhook erstellen"})]}):e.jsx("div",{style:y.webhookList,children:j.map(t=>e.jsxs("div",{style:y.webhookCard,children:[e.jsxs("div",{style:y.webhookHeader,children:[e.jsxs("div",{style:y.webhookInfo,children:[e.jsxs("div",{style:y.webhookStatus,children:[e.jsx("span",{style:{...y.statusDot,background:t.active?"#22c55e":"#ef4444"}}),e.jsx("h3",{style:y.webhookName,children:t.name}),t.is_zapier&&e.jsxs("span",{style:y.zapierBadge,children:[e.jsx(n,{size:12})," Zapier"]})]}),e.jsx("p",{style:y.webhookUrl,children:t.url})]}),e.jsxs("div",{style:y.webhookActions,children:[e.jsx("button",{style:y.iconButton,onClick:()=>(async e=>{try{_({id:e,loading:!0});const t=await o.post(`/webhooks/${e}/test?dojo_id=${G}`);_({id:e,...t.data}),setTimeout(()=>_(null),5e3)}catch(t){_({id:e,success:!1,error:t.message}),setTimeout(()=>_(null),5e3)}})(t.id),title:"Test senden",children:(null==D?void 0:D.id)===t.id&&D.loading?e.jsx(l,{size:18,className:"spinning"}):e.jsx(a,{size:18})}),e.jsx("button",{style:y.iconButton,onClick:()=>(e=>{I(e),A({name:e.name,url:e.url,events:e.events||[],active:e.active}),B(!0)})(t),title:"Bearbeiten",children:e.jsx(d,{size:18})}),e.jsx("button",{style:y.iconButton,onClick:()=>(async e=>{if(confirm("Webhook wirklich löschen?"))try{await o.delete(`/webhooks/${e}?dojo_id=${G}`),Z()}catch(t){console.error("Fehler beim Löschen:",t)}})(t.id),title:"Löschen",children:e.jsx(c,{size:18})})]})]}),(null==D?void 0:D.id)===t.id&&!D.loading&&e.jsx("div",{style:{...y.testResult,background:D.success?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",borderColor:D.success?"#22c55e":"#ef4444"},children:D.success?e.jsxs(e.Fragment,{children:[e.jsx(p,{size:16})," Test erfolgreich (Status: ",D.status,")"]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{size:16})," Test fehlgeschlagen: ",D.error]})}),e.jsx("div",{style:y.eventTags,children:(t.events||[]).map(t=>e.jsx("span",{style:y.eventTag,children:t},t))}),e.jsxs("div",{style:y.webhookStats,children:[e.jsxs("div",{style:y.stat,children:[e.jsx(p,{size:14,color:"#22c55e"}),e.jsxs("span",{children:[t.success_count||0," erfolgreich"]})]}),e.jsxs("div",{style:y.stat,children:[e.jsx(x,{size:14,color:"#ef4444"}),e.jsxs("span",{children:[t.failed_count||0," fehlgeschlagen"]})]}),e.jsxs("div",{style:y.stat,children:[e.jsx(h,{size:14,color:"#aaa"}),e.jsx("span",{children:t.last_triggered?new Date(t.last_triggered).toLocaleString("de-DE"):"Noch nie"})]}),e.jsx("button",{style:y.linkButton,onClick:()=>(async e=>{try{const t=await o.get(`/webhooks/${e}/deliveries?dojo_id=${G}`);N(t.data.deliveries||[]),$(e)}catch(t){console.error("Fehler beim Laden der Deliveries:",t)}})(t.id),children:"Verlauf anzeigen"})]}),e.jsxs("div",{style:y.secretBox,children:[e.jsx("span",{style:{color:"#888"},children:"Secret:"}),e.jsx("code",{style:y.secretCode,children:L[t.id]?t.secret:"••••••••"}),e.jsx("button",{style:y.tinyButton,onClick:()=>R(e=>({...e,[t.id]:!e[t.id]})),children:L[t.id]?e.jsx(u,{size:14}):e.jsx(g,{size:14})}),e.jsx("button",{style:y.tinyButton,onClick:()=>(async e=>{if(confirm("Neues Secret generieren? Das alte Secret wird ungültig!"))try{const t=await o.post(`/webhooks/${e}/regenerate-secret?dojo_id=${G}`);alert(`Neues Secret:\n${t.data.secret}\n\nBitte speichern Sie dieses Secret sicher!`),Z()}catch(t){console.error("Fehler:",t)}})(t.id),children:e.jsx(l,{size:14})})]})]},t.id))}),z&&e.jsx("div",{style:y.modalOverlay,onClick:()=>B(!1),children:e.jsxs("div",{style:y.modal,onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{style:y.modalHeader,children:[e.jsx("h3",{children:C?"Webhook bearbeiten":"Neuer Webhook"}),e.jsx("button",{style:y.closeButton,onClick:()=>B(!1),children:e.jsx(b,{size:20})})]}),e.jsxs("form",{onSubmit:async e=>{var t,s,i;e.preventDefault();try{if(C)await o.put(`/webhooks/${C.id}?dojo_id=${G}`,E);else{const e=await o.post("/webhooks",{...E,dojo_id:G});(null==(t=e.data.webhook)?void 0:t.secret)&&alert(`Webhook erstellt!\n\nSecret (nur einmal sichtbar):\n${e.data.webhook.secret}\n\nBitte speichern Sie dieses Secret sicher!`)}B(!1),I(null),A({name:"",url:"",events:[],active:!0}),Z()}catch(r){console.error("Fehler beim Speichern:",r),alert((null==(i=null==(s=r.response)?void 0:s.data)?void 0:i.error)||"Fehler beim Speichern")}},children:[e.jsxs("div",{style:y.formGroup,children:[e.jsx("label",{style:y.label,children:"Name"}),e.jsx("input",{type:"text",value:E.name,onChange:e=>A({...E,name:e.target.value}),style:y.input,placeholder:"z.B. Slack Benachrichtigung",required:!0})]}),e.jsxs("div",{style:y.formGroup,children:[e.jsx("label",{style:y.label,children:"Webhook URL"}),e.jsx("input",{type:"url",value:E.url,onChange:e=>A({...E,url:e.target.value}),style:y.input,placeholder:"https://hooks.zapier.com/...",required:!0})]}),e.jsxs("div",{style:y.formGroup,children:[e.jsx("label",{style:y.label,children:"Events auswählen"}),e.jsx("div",{style:y.eventGrid,children:v.map(({event:t,description:s})=>e.jsxs("label",{style:y.eventCheckbox,children:[e.jsx("input",{type:"checkbox",checked:E.events.includes(t),onChange:()=>{return e=t,void A(t=>({...t,events:t.events.includes(e)?t.events.filter(t=>t!==e):[...t.events,e]}));var e}}),e.jsxs("span",{style:y.eventLabel,children:[e.jsx("strong",{children:t}),e.jsx("small",{children:s})]})]},t))})]}),e.jsx("div",{style:y.formGroup,children:e.jsxs("label",{style:y.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:E.active,onChange:e=>A({...E,active:e.target.checked})}),"Webhook aktiv"]})}),e.jsxs("div",{style:y.modalFooter,children:[e.jsx("button",{type:"button",style:y.cancelButton,onClick:()=>B(!1),children:"Abbrechen"}),e.jsx("button",{type:"submit",style:y.submitButton,children:C?"Speichern":"Erstellen"})]})]})]})}),F&&e.jsx("div",{style:y.modalOverlay,onClick:()=>$(null),children:e.jsxs("div",{style:{...y.modal,maxWidth:"700px"},onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{style:y.modalHeader,children:[e.jsx("h3",{children:"Webhook Verlauf"}),e.jsx("button",{style:y.closeButton,onClick:()=>$(null),children:e.jsx(b,{size:20})})]}),e.jsx("div",{style:y.deliveryList,children:0===H.length?e.jsx("p",{style:{textAlign:"center",color:"#888"},children:"Noch keine Zustellungen"}):H.map((t,s)=>e.jsxs("div",{style:y.deliveryItem,children:[e.jsx("div",{style:y.deliveryStatus,children:"success"===t.status?e.jsx(p,{size:16,color:"#22c55e"}):e.jsx(x,{size:16,color:"#ef4444"})}),e.jsxs("div",{style:y.deliveryInfo,children:[e.jsx("strong",{children:t.event_type}),e.jsx("span",{style:{color:"#888",fontSize:"12px"},children:new Date(t.created_at).toLocaleString("de-DE")})]}),e.jsxs("div",{style:y.deliveryHttp,children:["HTTP ",t.http_status||"-"]})]},s))})]})})]})},y={container:{padding:"24px",maxWidth:"1000px",margin:"0 auto"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},headerLeft:{display:"flex",alignItems:"center",gap:"16px"},title:{color:"#ffd700",margin:0,fontSize:"24px"},subtitle:{color:"#aaa",margin:"4px 0 0 0",fontSize:"14px"},addButton:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",background:"#ffd700",border:"none",borderRadius:"8px",color:"#1a1a2e",fontWeight:"bold",cursor:"pointer"},zapierCard:{display:"flex",alignItems:"flex-start",gap:"16px",background:"rgba(255, 74, 0, 0.1)",border:"1px solid rgba(255, 74, 0, 0.3)",borderRadius:"12px",padding:"20px",marginBottom:"24px"},emptyState:{textAlign:"center",padding:"60px 20px",color:"#666"},webhookList:{display:"flex",flexDirection:"column",gap:"16px"},webhookCard:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 215, 0, 0.2)",borderRadius:"12px",padding:"20px"},webhookHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},webhookInfo:{flex:1},webhookStatus:{display:"flex",alignItems:"center",gap:"8px"},statusDot:{width:"8px",height:"8px",borderRadius:"50%"},webhookName:{color:"#fff",margin:0,fontSize:"16px"},zapierBadge:{display:"flex",alignItems:"center",gap:"4px",background:"rgba(255, 74, 0, 0.2)",color:"#ff4a00",padding:"2px 8px",borderRadius:"4px",fontSize:"11px"},webhookUrl:{color:"#888",margin:"4px 0 0 0",fontSize:"13px",fontFamily:"monospace"},webhookActions:{display:"flex",gap:"8px"},iconButton:{background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"6px",padding:"8px",color:"#fff",cursor:"pointer"},testResult:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",borderRadius:"6px",border:"1px solid",marginTop:"12px",fontSize:"13px"},eventTags:{display:"flex",flexWrap:"wrap",gap:"6px",marginTop:"12px"},eventTag:{background:"rgba(59, 130, 246, 0.2)",color:"#3b82f6",padding:"4px 8px",borderRadius:"4px",fontSize:"12px"},webhookStats:{display:"flex",alignItems:"center",gap:"20px",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid rgba(255, 255, 255, 0.1)"},stat:{display:"flex",alignItems:"center",gap:"6px",color:"#aaa",fontSize:"13px"},linkButton:{marginLeft:"auto",background:"none",border:"none",color:"#ffd700",cursor:"pointer",fontSize:"13px",textDecoration:"underline"},secretBox:{display:"flex",alignItems:"center",gap:"8px",marginTop:"12px",padding:"8px 12px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"6px",fontSize:"12px"},secretCode:{color:"#ffd700",fontFamily:"monospace"},tinyButton:{background:"none",border:"none",color:"#888",cursor:"pointer",padding:"4px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},modal:{background:"#1a1a2e",border:"2px solid #ffd700",borderRadius:"16px",width:"100%",maxWidth:"500px",maxHeight:"90vh",overflow:"auto"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid rgba(255, 215, 0, 0.2)"},closeButton:{background:"none",border:"none",color:"#fff",cursor:"pointer"},formGroup:{padding:"0 20px",marginBottom:"16px"},label:{display:"block",color:"#ffd700",marginBottom:"8px",fontSize:"14px"},input:{width:"100%",padding:"12px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid rgba(255, 215, 0, 0.3)",borderRadius:"8px",color:"#fff",fontSize:"14px",boxSizing:"border-box"},eventGrid:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"8px",maxHeight:"200px",overflowY:"auto"},eventCheckbox:{display:"flex",alignItems:"flex-start",gap:"8px",padding:"8px",background:"rgba(0, 0, 0, 0.2)",borderRadius:"6px",cursor:"pointer"},eventLabel:{display:"flex",flexDirection:"column",fontSize:"12px",color:"#fff"},checkboxLabel:{display:"flex",alignItems:"center",gap:"8px",color:"#fff",cursor:"pointer"},modalFooter:{display:"flex",justifyContent:"flex-end",gap:"12px",padding:"20px",borderTop:"1px solid rgba(255, 215, 0, 0.2)"},cancelButton:{padding:"10px 20px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"#fff",cursor:"pointer"},submitButton:{padding:"10px 20px",background:"#ffd700",border:"none",borderRadius:"8px",color:"#1a1a2e",fontWeight:"bold",cursor:"pointer"},deliveryList:{padding:"20px",maxHeight:"400px",overflowY:"auto"},deliveryItem:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",background:"rgba(0, 0, 0, 0.2)",borderRadius:"8px",marginBottom:"8px"},deliveryStatus:{flexShrink:0},deliveryInfo:{flex:1,display:"flex",flexDirection:"column",gap:"2px"},deliveryHttp:{color:"#888",fontSize:"12px",fontFamily:"monospace"},loading:{textAlign:"center",padding:"60px",color:"#888"}};export{f as default};
