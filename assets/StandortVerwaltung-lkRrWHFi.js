import{a as e,j as s}from"./query-Caj74EYQ.js";import{e as a,D as n,a as t}from"./index-1YdTwRLp.js";import{P as i,O as l,a6 as r,o as d,a as o,b as c,ar as h,Y as u,a8 as m,M as x,q as j,a7 as g,_ as f}from"./icons-UlaFLuKM.js";import"./vendor-router-B2AaIOtG.js";import"./charts-QHQg_ypW.js";const v=()=>{const{standorte:v,loadStandorte:p}=a(),{trainer:N}=e.useContext(n),[b,z]=e.useState(!1),[y,k]=e.useState(""),[S,_]=e.useState(!1),[w,C]=e.useState(null),[F,O]=e.useState(null),[$,D]=e.useState({}),[E,B]=e.useState("basis"),[K,I]=e.useState({name:"",ist_hauptstandort:!1,farbe:"#4F46E5",strasse:"",hausnummer:"",plz:"",ort:"",land:"Deutschland",telefon:"",email:"",notizen:"",ist_aktiv:!0,sortierung:0,oeffnungszeiten:{regular:{monday:{open:"09:00",close:"21:00",closed:!1},tuesday:{open:"09:00",close:"21:00",closed:!1},wednesday:{open:"09:00",close:"21:00",closed:!1},thursday:{open:"09:00",close:"21:00",closed:!1},friday:{open:"09:00",close:"21:00",closed:!1},saturday:{open:"10:00",close:"18:00",closed:!1},sunday:{closed:!0}},exceptions:[],vacation:null}}),L={monday:"Montag",tuesday:"Dienstag",wednesday:"Mittwoch",thursday:"Donnerstag",friday:"Freitag",saturday:"Samstag",sunday:"Sonntag"};e.useEffect(()=>{M()},[v]);const M=async()=>{try{const e={};for(const s of v){const a=await t.get(`/standorte/${s.standort_id}/stats`);e[s.standort_id]=a.data.data}D(e)}catch(e){console.error("Fehler beim Laden der Statistiken:",e)}},A=(e=null)=>{e?(C(e),I({name:e.name||"",ist_hauptstandort:e.ist_hauptstandort||!1,farbe:e.farbe||"#4F46E5",strasse:e.strasse||"",hausnummer:e.hausnummer||"",plz:e.plz||"",ort:e.ort||"",land:e.land||"Deutschland",telefon:e.telefon||"",email:e.email||"",notizen:e.notizen||"",ist_aktiv:!1!==e.ist_aktiv,sortierung:e.sortierung||0,oeffnungszeiten:e.oeffnungszeiten?"string"==typeof e.oeffnungszeiten?JSON.parse(e.oeffnungszeiten):e.oeffnungszeiten:K.oeffnungszeiten})):(C(null),I({name:"",ist_hauptstandort:!1,farbe:"#4F46E5",strasse:"",hausnummer:"",plz:"",ort:"",land:"Deutschland",telefon:"",email:"",notizen:"",ist_aktiv:!0,sortierung:v.length,oeffnungszeiten:{regular:{monday:{open:"09:00",close:"21:00",closed:!1},tuesday:{open:"09:00",close:"21:00",closed:!1},wednesday:{open:"09:00",close:"21:00",closed:!1},thursday:{open:"09:00",close:"21:00",closed:!1},friday:{open:"09:00",close:"21:00",closed:!1},saturday:{open:"10:00",close:"18:00",closed:!1},sunday:{closed:!0}},exceptions:[],vacation:null}})),_(!0)},J=()=>{_(!1),C(null),k(""),B("basis")},H=(e,s,a)=>{I(n=>({...n,oeffnungszeiten:{...n.oeffnungszeiten,regular:{...n.oeffnungszeiten.regular,[e]:{...n.oeffnungszeiten.regular[e],[s]:a}}}}))},G=e=>{if(!e)return"Keine Ã–ffnungszeiten";const s="string"==typeof e?JSON.parse(e):e;if(!s.regular)return"Keine Ã–ffnungszeiten";const a=Object.entries(s.regular).filter(([e,s])=>!s.closed).map(([e,s])=>`${L[e]}: ${s.open}-${s.close}`);return a.length>0?a.slice(0,2).join(", ")+(a.length>2?"...":""):"Geschlossen"};return s.jsxs("div",{className:"standortverwaltung-container",children:[s.jsxs("div",{className:"standortverwaltung-header",children:[s.jsxs("div",{className:"header-left",children:[s.jsx("h2",{children:"ðŸ“ Standort-Verwaltung"}),s.jsx("p",{className:"subtitle",children:"Verwalten Sie alle Standorte Ihres Dojos"})]}),s.jsxs("button",{className:"btn-primary",onClick:()=>A(),children:[s.jsx(i,{size:18}),s.jsx("span",{children:"Neuer Standort"})]})]}),s.jsxs("div",{className:"stats-grid",children:[s.jsxs("div",{className:"stat-card-large",children:[s.jsx("div",{className:"stat-icon",style:{background:"linear-gradient(135deg, #10B981 0%, #059669 100%)"},children:s.jsx(l,{size:24})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-value",children:v.length}),s.jsx("div",{className:"stat-label",children:"Standorte gesamt"})]})]}),s.jsxs("div",{className:"stat-card-large",children:[s.jsx("div",{className:"stat-icon",style:{background:"linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)"},children:s.jsx(r,{size:24})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-value",children:v.filter(e=>e.ist_aktiv).length}),s.jsx("div",{className:"stat-label",children:"Aktive Standorte"})]})]}),s.jsxs("div",{className:"stat-card-large",children:[s.jsx("div",{className:"stat-icon",style:{background:"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)"},children:s.jsx(d,{size:24})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-value",children:Object.values($).reduce((e,s)=>e+((null==s?void 0:s.anzahl_kurse)||0),0)}),s.jsx("div",{className:"stat-label",children:"Kurse gesamt"})]})]})]}),s.jsx("div",{className:"standorte-grid",children:v.sort((e,s)=>e.ist_hauptstandort&&!s.ist_hauptstandort?-1:!e.ist_hauptstandort&&s.ist_hauptstandort?1:(e.sortierung||0)-(s.sortierung||0)).map(e=>s.jsxs("div",{className:`standort-card ${e.ist_aktiv?"":"inactive"} ${F===e.standort_id?"expanded":""}`,children:[s.jsxs("div",{className:"standort-card-header",children:[s.jsxs("div",{className:"header-left-section",children:[s.jsx("div",{className:"color-indicator",style:{background:e.farbe||"#4F46E5"}}),s.jsxs("div",{className:"standort-info",children:[s.jsx("h3",{children:e.name}),s.jsxs("div",{className:"badges",children:[e.ist_hauptstandort&&s.jsx("span",{className:"badge badge-haupt",children:"Hauptstandort"}),!e.ist_aktiv&&s.jsx("span",{className:"badge badge-inactive",children:"Inaktiv"})]})]})]}),s.jsxs("div",{className:"header-actions",children:[s.jsx("button",{className:"btn-icon",onClick:()=>{return s=e.standort_id,void O(F===s?null:s);var s},title:F===e.standort_id?"Weniger anzeigen":"Mehr anzeigen",children:F===e.standort_id?s.jsx(o,{size:18}):s.jsx(c,{size:18})}),s.jsx("button",{className:"btn-icon btn-edit",onClick:()=>A(e),title:"Bearbeiten",children:s.jsx(h,{size:18})}),s.jsx("button",{className:"btn-icon btn-delete",onClick:()=>(async e=>{var s,a;if(window.confirm("MÃ¶chten Sie diesen Standort wirklich lÃ¶schen?")){z(!0);try{await t.delete(`/standorte/${e}`),alert("Standort erfolgreich gelÃ¶scht!"),await p(),await M()}catch(n){console.error("Fehler beim LÃ¶schen:",n),alert((null==(a=null==(s=n.response)?void 0:s.data)?void 0:a.error)||"Fehler beim LÃ¶schen des Standorts")}finally{z(!1)}}})(e.standort_id),title:"LÃ¶schen",children:s.jsx(u,{size:18})})]})]}),s.jsxs("div",{className:"standort-card-body",children:[(e.strasse||e.ort)&&s.jsxs("div",{className:"info-row",children:[s.jsx(r,{size:16,className:"icon"}),s.jsxs("span",{children:[e.strasse," ",e.hausnummer,", ",e.plz," ",e.ort]})]}),e.telefon&&s.jsxs("div",{className:"info-row",children:[s.jsx(m,{size:16,className:"icon"}),s.jsx("span",{children:e.telefon})]}),e.email&&s.jsxs("div",{className:"info-row",children:[s.jsx(x,{size:16,className:"icon"}),s.jsx("span",{children:e.email})]}),s.jsxs("div",{className:"info-row",children:[s.jsx(j,{size:16,className:"icon"}),s.jsx("span",{children:G(e.oeffnungszeiten)})]}),$[e.standort_id]&&s.jsxs("div",{className:"standort-stats",children:[s.jsxs("div",{className:"stat-item",children:[s.jsx("span",{className:"stat-number",children:$[e.standort_id].anzahl_kurse||0}),s.jsx("span",{className:"stat-text",children:"Kurse"})]}),s.jsxs("div",{className:"stat-item",children:[s.jsx("span",{className:"stat-number",children:$[e.standort_id].anzahl_raeume||0}),s.jsx("span",{className:"stat-text",children:"RÃ¤ume"})]}),s.jsxs("div",{className:"stat-item",children:[s.jsx("span",{className:"stat-number",children:$[e.standort_id].anzahl_trainer||0}),s.jsx("span",{className:"stat-text",children:"Trainer"})]})]}),F===e.standort_id&&s.jsxs("div",{className:"expanded-details",children:[e.oeffnungszeiten&&s.jsxs("div",{className:"detail-section",children:[s.jsx("h4",{children:"Ã–ffnungszeiten"}),s.jsx("div",{className:"oeffnungszeiten-list",children:Object.entries(("string"==typeof e.oeffnungszeiten?JSON.parse(e.oeffnungszeiten):e.oeffnungszeiten).regular||{}).map(([e,a])=>s.jsxs("div",{className:"oeffnungszeit-row",children:[s.jsx("span",{className:"day-name",children:L[e]}),s.jsx("span",{className:"time-range",children:a.closed?"Geschlossen":`${a.open} - ${a.close}`})]},e))})]}),e.notizen&&s.jsxs("div",{className:"detail-section",children:[s.jsx("h4",{children:"Notizen"}),s.jsx("p",{children:e.notizen})]}),s.jsx("div",{className:"detail-section",children:s.jsx("button",{className:"btn-toggle "+(e.ist_aktiv?"active":"inactive"),onClick:()=>(async e=>{try{await t.put(`/standorte/${e.standort_id}`,{...e,ist_aktiv:!e.ist_aktiv,oeffnungszeiten:"string"==typeof e.oeffnungszeiten?e.oeffnungszeiten:JSON.stringify(e.oeffnungszeiten||K.oeffnungszeiten)}),await p(),await M()}catch(s){console.error("Fehler beim Aktivieren/Deaktivieren:",s),alert("Fehler beim Ã„ndern des Status")}})(e),children:e.ist_aktiv?"Standort deaktivieren":"Standort aktivieren"})})]})]})]},e.standort_id))}),0===v.length&&s.jsxs("div",{className:"empty-state",children:[s.jsx(l,{size:64,className:"empty-icon"}),s.jsx("h3",{children:"Keine Standorte vorhanden"}),s.jsx("p",{children:"Erstellen Sie Ihren ersten Standort, um zu beginnen."}),s.jsxs("button",{className:"btn-primary",onClick:()=>A(),children:[s.jsx(i,{size:18}),s.jsx("span",{children:"Ersten Standort erstellen"})]})]}),S&&s.jsx("div",{className:"modal-overlay",onClick:J,children:s.jsxs("div",{className:"modal-content-large",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{children:w?"Standort bearbeiten":"Neuer Standort"}),s.jsx("button",{className:"btn-close",onClick:J,children:s.jsx(g,{size:20})})]}),s.jsxs("div",{className:"modal-tabs",children:[s.jsx("button",{className:"modal-tab "+("basis"===E?"active":""),onClick:()=>B("basis"),children:"Basis"}),s.jsx("button",{className:"modal-tab "+("adresse"===E?"active":""),onClick:()=>B("adresse"),children:"Adresse"}),s.jsx("button",{className:"modal-tab "+("kontakt"===E?"active":""),onClick:()=>B("kontakt"),children:"Kontakt"}),s.jsx("button",{className:"modal-tab "+("oeffnungszeiten"===E?"active":""),onClick:()=>B("oeffnungszeiten"),children:"Ã–ffnungszeiten"}),s.jsx("button",{className:"modal-tab "+("notizen"===E?"active":""),onClick:()=>B("notizen"),children:"Notizen"})]}),s.jsxs("div",{className:"modal-body",children:[y&&s.jsx("div",{className:"error-message",children:y}),"basis"===E&&s.jsxs("div",{className:"form-section",children:[s.jsx("h4",{children:"Basis-Informationen"}),s.jsxs("div",{className:"form-grid",children:[s.jsxs("div",{className:"form-group full-width",children:[s.jsx("label",{children:"Name *"}),s.jsx("input",{type:"text",value:K.name,onChange:e=>I({...K,name:e.target.value}),placeholder:"z.B. Hauptstandort, Filiale Nord"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Farbe"}),s.jsxs("div",{className:"color-picker-wrapper",children:[s.jsx("input",{type:"color",value:K.farbe,onChange:e=>I({...K,farbe:e.target.value})}),s.jsx("span",{className:"color-value",children:K.farbe})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Sortierung"}),s.jsx("input",{type:"number",value:K.sortierung,onChange:e=>I({...K,sortierung:parseInt(e.target.value)||0})})]}),s.jsx("div",{className:"form-group checkbox-group full-width",children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:K.ist_hauptstandort,onChange:e=>I({...K,ist_hauptstandort:e.target.checked})}),s.jsx("span",{children:"Dies ist der Hauptstandort"})]})})]})]}),"adresse"===E&&s.jsxs("div",{className:"form-section",children:[s.jsx("h4",{children:"Adresse"}),s.jsxs("div",{className:"form-grid",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"StraÃŸe"}),s.jsx("input",{type:"text",value:K.strasse,onChange:e=>I({...K,strasse:e.target.value})})]}),s.jsxs("div",{className:"form-group",style:{maxWidth:"150px"},children:[s.jsx("label",{children:"Hausnummer"}),s.jsx("input",{type:"text",value:K.hausnummer,onChange:e=>I({...K,hausnummer:e.target.value})})]}),s.jsxs("div",{className:"form-group",style:{maxWidth:"150px"},children:[s.jsx("label",{children:"PLZ"}),s.jsx("input",{type:"text",value:K.plz,onChange:e=>I({...K,plz:e.target.value})})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Ort"}),s.jsx("input",{type:"text",value:K.ort,onChange:e=>I({...K,ort:e.target.value})})]}),s.jsxs("div",{className:"form-group full-width",children:[s.jsx("label",{children:"Land"}),s.jsx("input",{type:"text",value:K.land,onChange:e=>I({...K,land:e.target.value})})]})]})]}),"kontakt"===E&&s.jsxs("div",{className:"form-section",children:[s.jsx("h4",{children:"Kontakt"}),s.jsxs("div",{className:"form-grid",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Telefon"}),s.jsx("input",{type:"tel",value:K.telefon,onChange:e=>I({...K,telefon:e.target.value}),placeholder:"+49 123 456789"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"E-Mail"}),s.jsx("input",{type:"email",value:K.email,onChange:e=>I({...K,email:e.target.value}),placeholder:"standort@dojo.de"})]})]})]}),"oeffnungszeiten"===E&&s.jsxs("div",{className:"form-section",children:[s.jsx("h4",{children:"Ã–ffnungszeiten"}),s.jsx("div",{className:"oeffnungszeiten-editor",children:Object.entries(L).map(([e,a])=>{var n,t,i,l,r;return s.jsxs("div",{className:"oeffnungszeit-row-editor",children:[s.jsx("div",{className:"day-label",children:a}),s.jsxs("div",{className:"time-inputs",children:[s.jsx("input",{type:"time",value:(null==(n=K.oeffnungszeiten.regular[e])?void 0:n.open)||"09:00",onChange:s=>H(e,"open",s.target.value),disabled:null==(t=K.oeffnungszeiten.regular[e])?void 0:t.closed}),s.jsx("span",{children:"bis"}),s.jsx("input",{type:"time",value:(null==(i=K.oeffnungszeiten.regular[e])?void 0:i.close)||"21:00",onChange:s=>H(e,"close",s.target.value),disabled:null==(l=K.oeffnungszeiten.regular[e])?void 0:l.closed})]}),s.jsxs("label",{className:"checkbox-inline",children:[s.jsx("input",{type:"checkbox",checked:(null==(r=K.oeffnungszeiten.regular[e])?void 0:r.closed)||!1,onChange:s=>H(e,"closed",s.target.checked)}),s.jsx("span",{children:"Geschlossen"})]})]},e)})})]}),"notizen"===E&&s.jsxs("div",{className:"form-section",children:[s.jsx("h4",{children:"Notizen"}),s.jsx("div",{className:"form-group full-width",children:s.jsx("textarea",{value:K.notizen,onChange:e=>I({...K,notizen:e.target.value}),rows:4,placeholder:"ZusÃ¤tzliche Informationen zum Standort..."})})]})]}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{className:"btn-secondary",onClick:J,children:"Abbrechen"}),s.jsxs("button",{className:"btn-primary",onClick:async()=>{var e,s;if(K.name.trim()){z(!0),k("");try{const e={...K,oeffnungszeiten:JSON.stringify(K.oeffnungszeiten)};w?(await t.put(`/standorte/${w.standort_id}`,e),alert("Standort erfolgreich aktualisiert!")):(await t.post("/standorte",e),alert("Standort erfolgreich erstellt!")),await p(),await M(),J()}catch(a){console.error("Fehler beim Speichern:",a),k((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.error)||"Fehler beim Speichern des Standorts")}finally{z(!1)}}else k("Bitte geben Sie einen Namen ein.")},disabled:b,children:[s.jsx(f,{size:18}),s.jsx("span",{children:b?"Speichern...":"Speichern"})]})]})]})})]})};export{v as default};
