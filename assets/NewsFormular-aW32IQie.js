import{a as e,j as s}from"./query-Caj74EYQ.js";import{b as r,a,c as l}from"./index-D4wQygnO.js";import{j as t}from"./index-CkXcCt97.js";/* empty css             */import{u as i,f as n}from"./vendor-router-B2AaIOtG.js";import"./icons-eh0tbLFx.js";import"./charts-QHQg_ypW.js";function o({mode:o="create"}){const c=i(),{id:d}=n(),{token:h}=r(),[u,m]=e.useState({titel:"",kurzbeschreibung:"",inhalt:"",zielgruppe:"alle_dojos",status:"entwurf"}),[p,j]=e.useState(!1),[x,b]=e.useState(!1),[g,f]=e.useState(""),[N,w]=e.useState(""),v=()=>{try{if(h){const e=t(h);return 1===e.id||1===e.user_id||"admin"===e.username}}catch(e){console.error("Token decode error:",e)}return!1};e.useEffect(()=>{v()?"edit"===o&&d&&z():c("/dashboard")},[o,d,h]);const z=async()=>{var e,s;j(!0),f("");try{const e=(await a.get(`${l.apiBaseUrl}/news/${d}`,{headers:{Authorization:`Bearer ${h}`}})).data;m({titel:e.titel||"",kurzbeschreibung:e.kurzbeschreibung||"",inhalt:e.inhalt||"",zielgruppe:e.zielgruppe||"alle_dojos",status:e.status||"entwurf"})}catch(r){console.error("Fehler beim Laden der News:",r),f("Fehler beim Laden der News: "+((null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.error)||r.message))}finally{j(!1)}},k=e=>{const{name:s,value:r}=e.target;m(e=>({...e,[s]:r}))};return v()?p?s.jsx("div",{className:"news-formular",children:s.jsx("div",{className:"news-loading",children:"Lädt News..."})}):s.jsxs("div",{className:"news-formular",children:[s.jsx("div",{className:"news-header",children:s.jsxs("div",{className:"news-header-left",children:[s.jsx("button",{className:"btn-back",onClick:()=>c("/dashboard/news"),children:"← Zurück"}),s.jsx("h1",{children:"edit"===o?"News bearbeiten":"Neue News erstellen"})]})}),g&&s.jsx("div",{className:"news-error",children:g}),N&&s.jsx("div",{className:"news-success",children:N}),s.jsxs("form",{onSubmit:async e=>{var s,r;e.preventDefault(),b(!0),f(""),w("");try{if(!u.titel.trim())throw new Error("Titel ist erforderlich");if(!u.inhalt.trim())throw new Error("Inhalt ist erforderlich");"edit"===o&&d?(await a.put(`${l.apiBaseUrl}/news/${d}`,u,{headers:{Authorization:`Bearer ${h}`}}),w("News erfolgreich aktualisiert!")):(await a.post(`${l.apiBaseUrl}/news`,u,{headers:{Authorization:`Bearer ${h}`}}),w("News erfolgreich erstellt!")),setTimeout(()=>{c("/dashboard/news")},1500)}catch(t){console.error("Fehler beim Speichern:",t),f((null==(r=null==(s=t.response)?void 0:s.data)?void 0:r.error)||t.message||"Fehler beim Speichern")}finally{b(!1)}},className:"news-form",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"titel",children:"Titel *"}),s.jsx("input",{type:"text",id:"titel",name:"titel",value:u.titel,onChange:k,placeholder:"Titel der News",required:!0,className:"form-input"})]}),s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{htmlFor:"kurzbeschreibung",children:["Kurzbeschreibung",s.jsxs("span",{className:"char-count",children:["(",u.kurzbeschreibung.length,"/500)"]})]}),s.jsx("textarea",{id:"kurzbeschreibung",name:"kurzbeschreibung",value:u.kurzbeschreibung,onChange:k,placeholder:"Kurze Zusammenfassung für die Vorschau...",maxLength:500,rows:3,className:"form-textarea"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"inhalt",children:"Inhalt *"}),s.jsx("textarea",{id:"inhalt",name:"inhalt",value:u.inhalt,onChange:k,placeholder:"Der vollständige News-Artikel...",required:!0,rows:12,className:"form-textarea form-textarea-large"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Zielgruppe"}),s.jsxs("div",{className:"radio-group",children:[s.jsxs("label",{className:"radio-label",children:[s.jsx("input",{type:"radio",name:"zielgruppe",value:"alle_dojos",checked:"alle_dojos"===u.zielgruppe,onChange:k}),s.jsxs("span",{className:"radio-text",children:[s.jsx("strong",{children:"Alle Dojos"}),s.jsx("small",{children:"Wird allen Dojos im System angezeigt"})]})]}),s.jsxs("label",{className:"radio-label",children:[s.jsx("input",{type:"radio",name:"zielgruppe",value:"homepage",checked:"homepage"===u.zielgruppe,onChange:k}),s.jsxs("span",{className:"radio-text",children:[s.jsx("strong",{children:"Nur Homepage (TDA-VIB)"}),s.jsx("small",{children:"Wird nur auf der TDA-VIB Homepage angezeigt"})]})]})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"status",children:"Status"}),s.jsxs("select",{id:"status",name:"status",value:u.status,onChange:k,className:"form-select",children:[s.jsx("option",{value:"entwurf",children:"Entwurf"}),s.jsx("option",{value:"veroeffentlicht",children:"Veröffentlicht"}),s.jsx("option",{value:"archiviert",children:"Archiviert"})]}),"veroeffentlicht"===u.status&&s.jsx("small",{className:"form-hint",children:"Die News wird sofort für die Zielgruppe sichtbar sein."})]}),s.jsxs("div",{className:"form-actions",children:[s.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>c("/dashboard/news"),children:"Abbrechen"}),s.jsx("button",{type:"submit",className:"btn-save",disabled:x,children:x?"Speichert...":"edit"===o?"Speichern":"Erstellen"})]})]})]}):null}export{o as default};
