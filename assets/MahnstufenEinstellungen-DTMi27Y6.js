import{a as e,j as n}from"./query-Caj74EYQ.js";import{f as a,c as s}from"./index-BuAcXaay.js";import{P as t,a2 as r,X as i,k as l,b as h,F as c,a5 as g,c as u,C as d,D as o,M as m}from"./icons-eh0tbLFx.js";import{u as f}from"./vendor-router-B2AaIOtG.js";import"./charts-QHQg_ypW.js";const x=()=>{const x=f(),[b,j]=e.useState(!0),[p,v]=e.useState(!1),[k,M]=e.useState({}),[z,N]=e.useState([{stufe:1,bezeichnung:"1. Mahnung (Zahlungserinnerung)",tage_nach_faelligkeit:14,mahngebuehr:5,email_betreff:"Zahlungserinnerung - Offener Beitrag",email_text:"Sehr geehrte/r {vorname} {nachname},\n\nwir möchten Sie freundlich daran erinnern, dass folgender Beitrag noch offen ist:\n\nBetrag: {betrag} €\nFällig seit: {faelligkeitsdatum}\n\nBitte überweisen Sie den Betrag zeitnah auf unser Konto.\n\nMit freundlichen Grüßen\nIhr Dojo-Team",aktiv:!0},{stufe:2,bezeichnung:"2. Mahnung (Erste Mahnung)",tage_nach_faelligkeit:28,mahngebuehr:10,email_betreff:"2. Mahnung - Dringend: Offener Beitrag",email_text:"Sehr geehrte/r {vorname} {nachname},\n\nleider haben wir bisher keine Zahlung erhalten. Dies ist Ihre 2. Mahnung.\n\nBetrag: {betrag} €\nFällig seit: {faelligkeitsdatum}\nMahngebühr: {mahngebuehr} €\nGesamtbetrag: {gesamtbetrag} €\n\nBitte begleichen Sie den Betrag umgehend.\n\nMit freundlichen Grüßen\nIhr Dojo-Team",aktiv:!0},{stufe:3,bezeichnung:"3. Mahnung (Letzte Mahnung)",tage_nach_faelligkeit:42,mahngebuehr:15,email_betreff:"3. Mahnung - LETZTE ZAHLUNGSAUFFORDERUNG",email_text:"Sehr geehrte/r {vorname} {nachname},\n\ntrotz mehrfacher Aufforderung ist der fällige Betrag noch nicht eingegangen. Dies ist unsere letzte Mahnung vor rechtlichen Schritten.\n\nBetrag: {betrag} €\nFällig seit: {faelligkeitsdatum}\nMahngebühr: {mahngebuehr} €\nGesamtbetrag: {gesamtbetrag} €\n\nBitte zahlen Sie SOFORT, um weitere Maßnahmen zu vermeiden.\n\nMit freundlichen Grüßen\nIhr Dojo-Team",aktiv:!0}]);e.useEffect(()=>{y()},[]);const y=async()=>{try{j(!0);const e=await a(`${s.apiBaseUrl}/mahnwesen/mahnstufen-einstellungen`);if(e.ok){const n=await e.json();n.success&&n.data.length>0&&N(n.data)}j(!1)}catch(e){console.error("Fehler beim Laden der Mahnstufen-Einstellungen:",e),j(!1)}},_=async()=>{if(window.confirm("Mahnstufen-Einstellungen speichern?"))try{v(!0);if(!(await a(`${s.apiBaseUrl}/mahnwesen/mahnstufen-einstellungen`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mahnstufen:z})})).ok)throw new Error("Fehler beim Speichern");alert("Mahnstufen-Einstellungen erfolgreich gespeichert!"),v(!1)}catch(e){console.error("Fehler beim Speichern:",e),alert("Fehler beim Speichern der Einstellungen"),v(!1)}},S=(e,n,a)=>{const s=[...z];s[e][n]=a,N(s)};return b?n.jsx("div",{className:"mahnstufen-container",children:n.jsxs("div",{className:"loading-state",children:[n.jsx("div",{className:"loading-spinner"}),n.jsx("p",{children:"Lade Mahnstufen-Einstellungen..."})]})}):n.jsxs("div",{className:"mahnstufen-container",children:[n.jsxs("div",{className:"mahnstufen-header",children:[n.jsxs("button",{className:"btn btn-secondary",onClick:()=>x("/dashboard/beitraege"),children:[n.jsx(t,{size:20}),"Zurück"]}),n.jsxs("div",{children:[n.jsx("h1",{children:"⚙️ Mahnstufen-Einstellungen"}),n.jsx("p",{children:"Konfiguriere die automatischen Mahnprozesse und Gebühren"})]}),n.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[n.jsxs("button",{className:"btn btn-success",onClick:()=>{const e=z.length+1,n={stufe:e,bezeichnung:`${e}. Mahnung`,tage_nach_faelligkeit:14*e,mahngebuehr:5*e,email_betreff:`${e}. Mahnung`,email_text:"Sehr geehrte/r {vorname} {nachname},\n\n...\n\nMit freundlichen Grüßen\nIhr Dojo-Team",aktiv:!0};N([...z,n])},children:[n.jsx(r,{size:20}),"Mahnstufe hinzufügen"]}),n.jsxs("button",{className:"btn btn-primary",onClick:_,disabled:p,children:[n.jsx(i,{size:20}),p?"Speichere...":"Speichern"]})]})]}),n.jsxs("div",{className:"info-box",children:[n.jsx(l,{size:24}),n.jsxs("div",{children:[n.jsx("h3",{children:"Verfügbare Platzhalter für Email-Texte:"}),n.jsxs("p",{children:[n.jsx("strong",{children:"{vorname}"})," - Vorname des Mitglieds |",n.jsx("strong",{children:" {nachname}"})," - Nachname |",n.jsx("strong",{children:" {betrag}"})," - Offener Betrag |",n.jsx("strong",{children:" {faelligkeitsdatum}"})," - Fälligkeitsdatum |",n.jsx("strong",{children:" {mahngebuehr}"})," - Mahngebühr |",n.jsx("strong",{children:" {gesamtbetrag}"})," - Gesamt (Betrag + Gebühr)"]})]})]}),z.map((e,a)=>n.jsxs("div",{className:"mahnstufe-card",children:[n.jsxs("div",{className:"mahnstufe-header collapsible",onClick:()=>{return n=e.stufe,void M(e=>({...e,[n]:!e[n]}));var n},style:{cursor:"pointer"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[n.jsx("span",{style:{transform:k[e.stufe]?"rotate(-90deg)":"rotate(0deg)",transition:"transform 0.3s ease"},children:n.jsx(h,{size:20})}),n.jsxs("h2",{children:[n.jsx(c,{size:20}),"Mahnstufe ",e.stufe," - ",e.bezeichnung]})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},onClick:e=>e.stopPropagation(),children:[n.jsxs("label",{className:"checkbox-label",children:[n.jsx("input",{type:"checkbox",checked:e.aktiv,onChange:e=>S(a,"aktiv",e.target.checked)}),"Aktiv"]}),n.jsx("button",{className:"btn btn-danger btn-small",onClick:e=>{e.stopPropagation(),(e=>{if(!window.confirm("Mahnstufe wirklich löschen?"))return;const n=z.filter((n,a)=>a!==e);n.forEach((e,n)=>{e.stufe=n+1}),N(n)})(a)},title:"Mahnstufe löschen",children:n.jsx(g,{size:16})})]})]}),!k[e.stufe]&&n.jsxs("div",{className:"form-grid",children:[n.jsxs("div",{className:"form-group full-width",children:[n.jsxs("label",{children:[n.jsx(u,{size:16}),"Bezeichnung"]}),n.jsx("input",{type:"text",value:e.bezeichnung,onChange:e=>S(a,"bezeichnung",e.target.value),placeholder:"z.B. 1. Mahnung (Zahlungserinnerung)"})]}),n.jsxs("div",{className:"form-group",children:[n.jsxs("label",{children:[n.jsx(d,{size:16}),"Tage nach Fälligkeit"]}),n.jsx("input",{type:"number",value:e.tage_nach_faelligkeit,onChange:e=>S(a,"tage_nach_faelligkeit",parseInt(e.target.value)),min:"1",placeholder:"14"}),n.jsx("small",{children:"Nach wie vielen Tagen die Mahnung erstellt wird"})]}),n.jsxs("div",{className:"form-group",children:[n.jsxs("label",{children:[n.jsx(o,{size:16}),"Mahngebühr (€)"]}),n.jsx("input",{type:"number",step:"0.01",value:e.mahngebuehr,onChange:e=>S(a,"mahngebuehr",parseFloat(e.target.value)),min:"0",placeholder:"5.00"}),n.jsx("small",{children:"Gebühr für diese Mahnstufe"})]}),n.jsxs("div",{className:"form-group full-width",children:[n.jsxs("label",{children:[n.jsx(m,{size:16}),"Email-Betreff"]}),n.jsx("input",{type:"text",value:e.email_betreff,onChange:e=>S(a,"email_betreff",e.target.value),placeholder:"Zahlungserinnerung - Offener Beitrag"})]}),n.jsxs("div",{className:"form-group full-width",children:[n.jsxs("label",{children:[n.jsx(c,{size:16}),"Email-Text"]}),n.jsx("textarea",{value:e.email_text,onChange:e=>S(a,"email_text",e.target.value),rows:"10",placeholder:"Text der Email-Mahnung..."})]})]})]},e.stufe)),n.jsx("div",{className:"save-footer",children:n.jsxs("button",{className:"btn btn-primary btn-large",onClick:_,disabled:p,children:[n.jsx(i,{size:20}),p?"Speichere Einstellungen...":"Alle Einstellungen speichern"]})})]})};export{x as default};
