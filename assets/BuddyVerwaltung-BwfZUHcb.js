import{j as e}from"./animation-1wuIdCBS.js";import{r as s}from"./vendor-router-BhMXg4Z-.js";import{b as n,a,u as t,c as i}from"./index-DUnH23_2.js";import{g as l,k as r,aU as c,bg as d,P as o,bh as h,bi as m,a4 as u,bj as g,bk as p,K as x,q as j,R as v,aA as b,bl as f,o as N,C as k}from"./icons-D7rg4pDH.js";/* empty css                  */import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";const y=()=>{const{activeDojo:t}=n(),[i,N]=s.useState(!0),[k,y]=s.useState([]),[w,_]=s.useState([]),[E,S]=s.useState(!1),[C,A]=s.useState({type:"",text:""}),[F,z]=s.useState(!1),[D,$]=s.useState(""),[L,I]=s.useState(""),[B,G]=s.useState([]),[P,T]=s.useState(""),[M,V]=s.useState(!1),U=s.useRef(null);s.useEffect(()=>{O()},[t]);const O=async()=>{var e;try{N(!0);const e=await a.get("/marketing-aktionen/status");S(e.data.configured);const s=await a.get("/marketing-aktionen/accounts");y(s.data);const n=await a.get("/marketing-aktionen/posts");_(n.data)}catch(s){console.error("Fehler beim Laden:",s),401!==(null==(e=s.response)?void 0:e.status)&&J("error","Fehler beim Laden der Daten")}finally{N(!1)}},R=async()=>{var e,s;try{const e=await a.get("/marketing-aktionen/accounts/connect");e.data.authUrl&&(window.location.href=e.data.authUrl)}catch(n){console.error("Fehler beim Verbinden:",n),J("error",(null==(s=null==(e=n.response)?void 0:e.data)?void 0:s.message)||"Fehler beim Verbinden")}},W=async(e=!1)=>{var s,n;if(!D.trim())return void J("error","Bitte gib einen Text ein");if(!L)return void J("error","Bitte w√§hle einen Account aus");const t=k.find(e=>e.id===parseInt(L));if("instagram"!==(null==t?void 0:t.platform)||0!==B.length)try{V(!0);const s=new FormData;s.append("content",D),s.append("social_account_id",L),P&&s.append("scheduled_at",P),B.forEach(e=>{s.append("media",e)}),s.append("post_type",B.length>0?"image":"text");const n=await a.post("/marketing-aktionen/posts",s,{headers:{"Content-Type":"multipart/form-data"}});e?(await a.post(`/marketing-aktionen/posts/${n.data.postId}/publish`),J("success","Post erfolgreich ver√∂ffentlicht!")):J("success",P?"Post geplant!":"Post als Entwurf gespeichert"),$(""),I(""),G([]),T(""),z(!1),O()}catch(i){console.error("Fehler beim Erstellen:",i),J("error",(null==(n=null==(s=i.response)?void 0:s.data)?void 0:n.details)||"Fehler beim Erstellen des Posts")}finally{V(!1)}else J("error","Instagram Posts ben√∂tigen mindestens ein Bild")},J=(e,s)=>{A({type:e,text:s}),setTimeout(()=>A({type:"",text:""}),5e3)},K=s=>"facebook"===s?e.jsx(h,{size:18}):e.jsx(f,{size:18}),q=s=>{const n={draft:{class:"status-draft",text:"Entwurf"},scheduled:{class:"status-scheduled",text:"Geplant"},published:{class:"status-published",text:"Ver√∂ffentlicht"},failed:{class:"status-failed",text:"Fehlgeschlagen"}}[s]||{class:"",text:s};return e.jsx("span",{className:`post-status-badge ${n.class}`,children:n.text})};return s.useEffect(()=>{const e=new URLSearchParams(window.location.search),s=e.get("success"),n=e.get("error");if("connected"===s)J("success","Social Media Account erfolgreich verbunden!"),window.history.replaceState({},"",window.location.pathname);else if(n){J("error",{oauth_denied:"Autorisierung wurde abgelehnt",invalid_callback:"Ung√ºltiger Callback",invalid_state:"Ung√ºltiger State Token",connection_failed:"Verbindung fehlgeschlagen"}[n]||"Ein Fehler ist aufgetreten"),window.history.replaceState({},"",window.location.pathname)}},[]),i?e.jsxs("div",{className:"marketing-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Wird geladen..."})]}):e.jsxs("div",{className:"marketing-aktionen",children:[C.text&&e.jsxs("div",{className:`marketing-message ${C.type}`,children:["success"===C.type?e.jsx(l,{size:20}):e.jsx(r,{size:20}),e.jsx("span",{children:C.text})]}),!E&&e.jsxs("div",{className:"marketing-warning",children:[e.jsx(r,{size:24}),e.jsxs("div",{children:[e.jsx("strong",{children:"Meta API nicht konfiguriert"}),e.jsx("p",{children:"Um Social Media Funktionen zu nutzen, m√ºssen META_APP_ID, META_APP_SECRET und META_REDIRECT_URI in der .env Datei gesetzt werden."}),e.jsxs("a",{href:"https://developers.facebook.com/",target:"_blank",rel:"noopener noreferrer",children:["Meta Developer Portal ",e.jsx(c,{size:14})]})]})]}),e.jsxs("div",{className:"marketing-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx(d,{size:20})," Verbundene Accounts"]}),E&&e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:R,children:[e.jsx(o,{size:16})," Account verbinden"]})]}),0===k.length?e.jsxs("div",{className:"empty-accounts",children:[e.jsx("p",{children:"Keine Social Media Accounts verbunden."}),E&&e.jsxs("button",{className:"btn btn-primary",onClick:R,children:[e.jsx(h,{size:18})," Facebook / Instagram verbinden"]})]}):e.jsx("div",{className:"accounts-grid",children:k.map(s=>e.jsxs("div",{className:`account-card ${s.platform}`,children:[e.jsx("div",{className:"account-icon",children:K(s.platform)}),e.jsxs("div",{className:"account-info",children:[e.jsx("strong",{children:s.account_name}),s.page_name&&e.jsx("span",{className:"page-name",children:s.page_name}),e.jsx("span",{className:"token-status "+(s.token_valid?"valid":"expired"),children:s.token_valid?s.token_expires_soon?"Token l√§uft bald ab":"Verbunden":"Token abgelaufen"})]}),e.jsx("button",{className:"btn btn-icon btn-danger",onClick:()=>(async e=>{if(window.confirm("M√∂chtest du diesen Account wirklich trennen?"))try{await a.delete(`/marketing-aktionen/accounts/${e}`),J("success","Account erfolgreich getrennt"),O()}catch(s){console.error("Fehler beim Trennen:",s),J("error","Fehler beim Trennen des Accounts")}})(s.id),title:"Trennen",children:e.jsx(m,{size:16})})]},s.id))})]}),k.length>0&&e.jsxs("div",{className:"marketing-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx(u,{size:20})," Neuer Post"]}),!F&&e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>z(!0),children:[e.jsx(o,{size:16})," Post erstellen"]})]}),F&&e.jsxs("div",{className:"post-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Account ausw√§hlen"}),e.jsxs("select",{value:L,onChange:e=>I(e.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"-- Account w√§hlen --"}),k.map(s=>e.jsxs("option",{value:s.id,children:["facebook"===s.platform?"üìò":"üì∏"," ",s.account_name,s.page_name?` (${s.page_name})`:""]},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Inhalt"}),e.jsx("textarea",{value:D,onChange:e=>$(e.target.value),placeholder:"Was m√∂chtest du teilen?",rows:4,className:"form-textarea",maxLength:2200}),e.jsxs("span",{className:"char-count",children:[D.length," / 2200"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medien (optional f√ºr Facebook, erforderlich f√ºr Instagram)"}),e.jsx("input",{type:"file",ref:U,onChange:e=>{const s=Array.from(e.target.files);s.length+B.length>10?J("error","Maximal 10 Dateien erlaubt"):G([...B,...s])},accept:"image/jpeg,image/png,image/gif,image/webp,video/mp4",multiple:!0,style:{display:"none"}}),e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:()=>{var e;return null==(e=U.current)?void 0:e.click()},children:[e.jsx(g,{size:16})," Bild/Video hinzuf√ºgen"]}),B.length>0&&e.jsx("div",{className:"media-preview",children:B.map((s,n)=>e.jsxs("div",{className:"media-item",children:[s.type.startsWith("video")?e.jsx(p,{size:24}):e.jsx("img",{src:URL.createObjectURL(s),alt:""}),e.jsx("button",{className:"remove-media",onClick:()=>(e=>{G(B.filter((s,n)=>n!==e))})(n),children:e.jsx(x,{size:14})}),e.jsx("span",{className:"media-name",children:s.name})]},n))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Zeitplanung (optional)"}),e.jsx("input",{type:"datetime-local",value:P,onChange:e=>T(e.target.value),className:"form-input",min:(new Date).toISOString().slice(0,16)})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>{z(!1),$(""),I(""),G([]),T("")},children:"Abbrechen"}),e.jsxs("button",{className:"btn btn-outline",onClick:()=>W(!1),disabled:M,children:[P?e.jsx(j,{size:16}):e.jsx(u,{size:16}),P?"Planen":"Als Entwurf speichern"]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>W(!0),disabled:M,children:[M?e.jsx(v,{size:16,className:"spinning"}):e.jsx(b,{size:16}),"Jetzt ver√∂ffentlichen"]})]})]})]}),e.jsxs("div",{className:"marketing-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:[e.jsx(b,{size:20})," Posts (",w.length,")"]}),e.jsx("button",{className:"btn btn-icon",onClick:O,title:"Aktualisieren",children:e.jsx(v,{size:16})})]}),0===w.length?e.jsx("div",{className:"empty-posts",children:e.jsx("p",{children:"Noch keine Posts erstellt."})}):e.jsx("div",{className:"posts-list",children:w.map(s=>e.jsxs("div",{className:`post-card ${s.status}`,children:[e.jsxs("div",{className:"post-header",children:[e.jsxs("div",{className:"post-platform",children:[K(s.platform),e.jsx("span",{children:s.account_name})]}),q(s.status)]}),e.jsxs("div",{className:"post-content",children:[e.jsx("p",{children:s.content}),s.media_urls&&JSON.parse(s.media_urls).length>0&&e.jsxs("div",{className:"post-media-count",children:[e.jsx(g,{size:14}),e.jsxs("span",{children:[JSON.parse(s.media_urls).length," Medien"]})]})]}),s.error_message&&e.jsxs("div",{className:"post-error",children:[e.jsx(r,{size:14}),e.jsx("span",{children:s.error_message})]}),e.jsxs("div",{className:"post-footer",children:[e.jsx("span",{className:"post-date",children:s.published_at?`Ver√∂ffentlicht: ${new Date(s.published_at).toLocaleString("de-DE")}`:s.scheduled_at?`Geplant: ${new Date(s.scheduled_at).toLocaleString("de-DE")}`:`Erstellt: ${new Date(s.created_at).toLocaleString("de-DE")}`}),e.jsxs("div",{className:"post-actions",children:[("draft"===s.status||"failed"===s.status)&&e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>(async e=>{var s,n;try{V(!0),await a.post(`/marketing-aktionen/posts/${e}/publish`),J("success","Post erfolgreich ver√∂ffentlicht!"),O()}catch(t){console.error("Fehler beim Ver√∂ffentlichen:",t),J("error",(null==(n=null==(s=t.response)?void 0:s.data)?void 0:n.details)||"Fehler beim Ver√∂ffentlichen")}finally{V(!1)}})(s.id),disabled:M,children:[e.jsx(b,{size:14})," Ver√∂ffentlichen"]}),"published"!==s.status&&e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>(async e=>{if(window.confirm("Post wirklich l√∂schen?"))try{await a.delete(`/marketing-aktionen/posts/${e}`),J("success","Post gel√∂scht"),O()}catch(s){console.error("Fehler beim L√∂schen:",s),J("error","Fehler beim L√∂schen")}})(s.id),children:e.jsx(x,{size:14})}),"published"===s.status&&s.external_post_id&&e.jsxs("a",{href:"facebook"===s.platform?`https://facebook.com/${s.external_post_id}`:`https://instagram.com/p/${s.external_post_id}`,target:"_blank",rel:"noopener noreferrer",className:"btn btn-sm btn-outline",children:[e.jsx(c,{size:14})," Ansehen"]})]})]})]},s.id))})]})]})},w=()=>{var n,a,l;const{token:r}=t(),[c,d]=s.useState("gruppen"),[o,h]=s.useState([]),[m,u]=s.useState(null),[g,p]=s.useState(!0),[x,j]=s.useState(""),[v,b]=s.useState(!1),[f,w]=s.useState(""),[_,E]=s.useState("alle"),[S,C]=s.useState(!1),[A,F]=s.useState(!1);s.useEffect(()=>{z()},[]);const z=async()=>{try{p(!0),j("");const e=await fetch(`${i.apiBaseUrl}/buddy/groups`,{headers:{Authorization:`Bearer ${r}`}});if(!e.ok)throw new Error("Fehler beim Laden der Buddy-Gruppen");const s=await e.json();h(s)}catch(e){console.error("Fehler beim Laden der Buddy-Gruppen:",e),j("Fehler beim Laden der Daten")}finally{p(!1)}},D=async e=>{try{b(!0);const s=await fetch(`/buddy/groups/${e}`,{headers:{Authorization:`Bearer ${r}`}});if(!s.ok)throw new Error("Fehler beim Laden der Gruppendetails");const n=await s.json();u(n),C(!0)}catch(s){console.error("Fehler beim Laden der Gruppendetails:",s),j("Fehler beim Laden der Gruppendetails")}finally{b(!1)}},$=async(e,s)=>{try{b(!0);const n=await fetch(`${i.apiBaseUrl}/buddy/send-invitations`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({groupId:e,invitationIds:s})}),a=await n.json();if(!n.ok)throw new Error(a.error||"Fehler beim Versenden der Einladungen");alert(`‚úÖ ${a.sent} Einladungen versendet, ${a.failed} fehlgeschlagen`),m&&m.id===e&&await D(e),await z()}catch(n){console.error("Fehler beim Versenden der Einladungen:",n),alert(`‚ùå Fehler: ${n.message}`)}finally{b(!1)}},L=o.filter(e=>{var s;const n=!f||(null==(s=e.gruppe_name)?void 0:s.toLowerCase().includes(f.toLowerCase()))||e.id.toString().includes(f),a="alle"===_||e.status===_;return n&&a}),I=s=>{const n={aktiv:{class:"status-active",text:"Aktiv"},inaktiv:{class:"status-inactive",text:"Inaktiv"},geloescht:{class:"status-deleted",text:"Gel√∂scht"}}[s]||{class:"status-unknown",text:s};return e.jsx("span",{className:`status-badge ${n.class}`,children:n.text})},B=s=>{const n={eingeladen:{class:"invitation-pending",text:"Eingeladen"},email_gesendet:{class:"invitation-sent",text:"Email gesendet"},registriert:{class:"invitation-registered",text:"Registriert"},aktiviert:{class:"invitation-active",text:"Aktiviert"},abgelehnt:{class:"invitation-declined",text:"Abgelehnt"},abgelaufen:{class:"invitation-expired",text:"Abgelaufen"}}[s]||{class:"invitation-unknown",text:s};return e.jsx("span",{className:`invitation-badge ${n.class}`,children:n.text})};return g?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner-large"}),e.jsx("p",{children:"Buddy-Gruppen werden geladen..."})]}):e.jsxs("div",{className:"buddy-verwaltung",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("h1",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",position:"relative",backgroundImage:"none !important",WebkitBackgroundClip:"unset !important",WebkitTextFillColor:"unset !important",backgroundClip:"unset !important",color:"transparent"},children:[e.jsx("span",{style:{fontSize:"1.8rem",filter:"drop-shadow(0 2px 8px rgba(255, 215, 0, 0.3))",position:"relative",zIndex:1e3,lineHeight:1,display:"inline-block",flexShrink:0,textShadow:"none",WebkitTextFillColor:"unset",backgroundImage:"none",WebkitBackgroundClip:"unset",backgroundClip:"unset"},children:"üë•"}),e.jsx("span",{style:{WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",color:"#FFD700",WebkitTextFillColor:"#FFD700",backgroundImage:"none",WebkitBackgroundClip:"unset",backgroundClip:"unset",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",position:"relative",zIndex:1},children:"Buddy-Gruppen Verwaltung"})]}),e.jsx("p",{children:"Verwalte Freunde-Gruppen, Einladungen und Marketing-Aktionen"})]}),e.jsxs("div",{className:"buddy-tabs",children:[e.jsxs("button",{className:"buddy-tab "+("gruppen"===c?"active":""),onClick:()=>d("gruppen"),children:[e.jsx(N,{size:18}),"Buddy-Gruppen"]}),e.jsxs("button",{className:"buddy-tab "+("aktionen"===c?"active":""),onClick:()=>d("aktionen"),children:[e.jsx(k,{size:18}),"Marketing-Aktionen"]})]}),"aktionen"===c?e.jsx(y,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"filter-section",children:e.jsxs("div",{className:"filter-row",children:[e.jsx("div",{className:"search-box",children:e.jsx("input",{type:"text",placeholder:"Gruppe suchen (Name oder ID)...",value:f,onChange:e=>w(e.target.value),className:"search-input"})}),e.jsxs("div",{className:"filter-controls",children:[e.jsxs("select",{value:_,onChange:e=>E(e.target.value),className:"filter-select",children:[e.jsx("option",{value:"alle",children:"Alle Status"}),e.jsx("option",{value:"aktiv",children:"Aktiv"}),e.jsx("option",{value:"inaktiv",children:"Inaktiv"}),e.jsx("option",{value:"geloescht",children:"Gel√∂scht"})]}),e.jsx("button",{onClick:z,className:"logout-button",disabled:g,children:"üîÑ Aktualisieren"})]})]})}),x&&e.jsxs("div",{className:"error-message",children:[e.jsx("strong",{children:"Fehler:"})," ",x]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"üë•"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-number",children:o.length}),e.jsx("div",{className:"stat-label",children:"Gesamt Gruppen"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"‚úÖ"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-number",children:o.filter(e=>"aktiv"===e.status).length}),e.jsx("div",{className:"stat-label",children:"Aktive Gruppen"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"üìß"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-number",children:o.reduce((e,s)=>e+(s.pending_einladungen||0),0)}),e.jsx("div",{className:"stat-label",children:"Offene Einladungen"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"üéØ"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-number",children:o.reduce((e,s)=>e+(s.aktive_mitglieder||0),0)}),e.jsx("div",{className:"stat-label",children:"Aktive Mitglieder"})]})]})]}),e.jsxs("div",{className:"groups-section",children:[e.jsxs("h2",{children:["üìã Buddy-Gruppen (",L.length,")"]}),0===L.length?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"Keine Buddy-Gruppen gefunden."}),f&&e.jsx("button",{onClick:()=>w(""),className:"btn btn-secondary",children:"Filter zur√ºcksetzen"})]}):e.jsx("div",{className:"groups-grid",children:L.map(s=>e.jsxs("div",{className:"group-card",children:[e.jsxs("div",{className:"group-header",children:[e.jsx("h3",{children:s.gruppe_name||`Gruppe #${s.id}`}),I(s.status)]}),e.jsxs("div",{className:"group-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{children:"ID:"}),e.jsxs("span",{children:["#",s.id]})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{children:"Erstellt:"}),e.jsx("span",{children:new Date(s.erstellt_am).toLocaleDateString("de-DE")})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{children:"Mitglieder:"}),e.jsxs("span",{children:[s.aktive_mitglieder||0,"/",s.max_mitglieder]})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{children:"Einladungen:"}),e.jsxs("span",{children:[s.gesamt_einladungen||0," gesamt,"," ",s.pending_einladungen||0," offen"]})]})]}),e.jsxs("div",{className:"group-actions",children:[e.jsx("button",{onClick:()=>D(s.id),className:"btn btn-primary btn-sm",disabled:v,children:"üìÑ Details"}),s.pending_einladungen>0&&e.jsx("button",{onClick:()=>(async e=>{try{b(!0);const s=await fetch(`/buddy/groups/${e}/resend-invitations`,{method:"POST",headers:{Authorization:`Bearer ${r}`}}),n=await s.json();if(!s.ok)throw new Error(n.error||"Fehler beim Versenden der Erinnerungen");alert(`üîî ${n.remindersSent} Erinnerungen versendet`),m&&m.id===e&&await D(e)}catch(s){console.error("Fehler beim Versenden der Erinnerungen:",s),alert(`‚ùå Fehler: ${s.message}`)}finally{b(!1)}})(s.id),className:"btn btn-secondary btn-sm",disabled:v,children:"üîî Erinnerung"})]})]},s.id))})]}),S&&m&&e.jsx("div",{className:"modal-overlay",onClick:()=>C(!1),children:e.jsxs("div",{className:"modal-content group-details-modal",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["üìã Gruppe: ",m.gruppe_name||`#${m.id}`]}),e.jsx("button",{onClick:()=>C(!1),className:"close-button",children:"√ó"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"group-details-section",children:[e.jsx("h3",{children:"‚ÑπÔ∏è Gruppen-Informationen"}),e.jsxs("div",{className:"details-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("strong",{children:"ID:"}),e.jsxs("span",{children:["#",m.id]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("strong",{children:"Name:"}),e.jsx("span",{children:m.gruppe_name||"Kein Name"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("strong",{children:"Status:"}),I(m.status)]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("strong",{children:"Erstellt:"}),e.jsx("span",{children:new Date(m.erstellt_am).toLocaleString("de-DE")})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("strong",{children:"Max. Mitglieder:"}),e.jsx("span",{children:m.max_mitglieder})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("strong",{children:"Aktuelle Mitglieder:"}),e.jsx("span",{children:m.aktuelle_mitglieder})]})]})]}),e.jsxs("div",{className:"invitations-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:["üìß Einladungen (",(null==(n=m.einladungen)?void 0:n.length)||0,")"]}),(null==(a=m.einladungen)?void 0:a.some(e=>"eingeladen"===e.status))&&e.jsx("button",{onClick:()=>{const e=m.einladungen.filter(e=>"eingeladen"===e.status).map(e=>e.id);$(m.id,e)},className:"btn btn-primary btn-sm",disabled:v,children:"üì§ Alle Einladungen versenden"})]}),0===(null==(l=m.einladungen)?void 0:l.length)?e.jsx("p",{children:"Keine Einladungen vorhanden."}):e.jsx("div",{className:"invitations-list",children:m.einladungen.map(s=>e.jsxs("div",{className:"invitation-item",children:[e.jsxs("div",{className:"invitation-info",children:[e.jsxs("div",{className:"invitation-header",children:[e.jsx("strong",{children:s.freund_name}),B(s.status)]}),e.jsxs("div",{className:"invitation-details",children:[e.jsxs("div",{children:["üìß ",s.freund_email]}),s.freund_telefon&&e.jsxs("div",{children:["üìû ",s.freund_telefon]}),e.jsxs("div",{children:["üìÖ Erstellt: ",new Date(s.erstellt_am).toLocaleDateString("de-DE")]}),s.einladung_gesendet_am&&e.jsxs("div",{children:["üì§ Versendet: ",new Date(s.einladung_gesendet_am).toLocaleDateString("de-DE")]}),e.jsxs("div",{children:["‚è∞ G√ºltig bis: ",new Date(s.token_gueltig_bis).toLocaleDateString("de-DE")]})]})]}),e.jsxs("div",{className:"invitation-actions",children:["eingeladen"===s.status&&e.jsx("button",{onClick:()=>$(m.id,[s.id]),className:"btn btn-primary btn-xs",disabled:v,children:"üì§ Versenden"}),["eingeladen","email_gesendet"].includes(s.status)&&e.jsx("button",{onClick:()=>(async(e,s="Von Admin gel√∂scht")=>{if(confirm("M√∂chtest du diese Einladung wirklich l√∂schen?"))try{if(b(!0),!(await fetch(`/buddy/invitations/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({reason:s})})).ok)throw new Error("Fehler beim L√∂schen der Einladung");alert("‚úÖ Einladung gel√∂scht"),m&&await D(m.id),await z()}catch(n){console.error("Fehler beim L√∂schen der Einladung:",n),alert(`‚ùå Fehler: ${n.message}`)}finally{b(!1)}})(s.id),className:"btn btn-danger btn-xs",disabled:v,children:"üóëÔ∏è L√∂schen"})]})]},s.id))})]}),m.aktivitaeten&&m.aktivitaeten.length>0&&e.jsxs("div",{className:"activities-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("h3",{children:["üìà Gemeinsame Aktivit√§ten (",m.aktivitaeten.length,")"]}),e.jsx("button",{onClick:async()=>{try{const e=await fetch(`${i.apiBaseUrl}/buddy/groups/${m.id}/aktivitaeten?limit=50`,{headers:{Authorization:`Bearer ${r}`}});if(e.ok){const s=await e.json();u({...m,aktivitaeten:s.aktivitaeten})}}catch(e){console.error("Fehler beim Laden aller Aktivit√§ten:",e)}},className:"btn btn-secondary btn-sm",children:"Alle anzeigen"})]}),e.jsx("div",{className:"activities-list",children:m.aktivitaeten.slice(0,15).map(s=>{const n=e=>e.includes("erfolgreich")||e.includes("aktiviert")||e.includes("angenommen")?"#10b981":e.includes("abgelehnt")||e.includes("abgelaufen")?"#ef4444":e.includes("versendet")||e.includes("registriert")?"#3b82f6":"#94a3b8";return e.jsxs("div",{className:"activity-item-enhanced",children:[e.jsx("div",{className:"activity-icon-wrapper",style:{backgroundColor:`${n(s.aktivitaet_typ)}20`,borderColor:n(s.aktivitaet_typ)},children:e.jsx("span",{className:"activity-icon",children:(s.aktivitaet_typ,{einladung_versendet:"üìß",einladung_angenommen:"‚úÖ",einladung_abgelehnt:"‚ùå",einladung_abgelaufen:"‚è∞",mitglied_registriert:"üë§",mitglied_aktiviert:"üéâ",gemeinsames_training:"ü•ã",pruefung_erfolgreich:"üèÜ",gruppen_erstellt:"üë•"}[s.aktivitaet_typ]||"üìã")})}),e.jsxs("div",{className:"activity-content-enhanced",children:[e.jsxs("div",{className:"activity-header-enhanced",children:[e.jsx("strong",{className:"activity-type",children:s.aktivitaet_typ.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),e.jsx("span",{className:"activity-time-enhanced",children:new Date(s.erstellt_am).toLocaleString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),s.beschreibung&&e.jsx("p",{className:"activity-description-enhanced",children:s.beschreibung}),(s.freund_name||s.mitglied_vorname)&&e.jsxs("div",{className:"activity-participant",children:[s.freund_name&&e.jsxs("span",{children:["üë§ ",s.freund_name]}),s.mitglied_vorname&&e.jsxs("span",{children:["üë§ ",s.mitglied_vorname," ",s.mitglied_nachname]})]})]})]},s.id)})}),m.aktivitaeten.length>15&&e.jsx("div",{className:"activities-footer",children:e.jsxs("p",{children:["... und ",m.aktivitaeten.length-15," weitere Aktivit√§ten"]})})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{onClick:()=>C(!1),className:"btn btn-secondary",children:"Schlie√üen"})})]})}),v&&e.jsxs("div",{className:"action-loading-overlay",children:[e.jsx("div",{className:"loading-spinner-large"}),e.jsx("p",{children:"Aktion wird ausgef√ºhrt..."})]})]})]})};export{w as default};
