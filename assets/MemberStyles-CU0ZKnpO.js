import{a as e,j as s}from"./query-Caj74EYQ.js";import{b as i,f as n,c as a}from"./index-BuAcXaay.js";import r from"./MemberHeader-CHJmR2ZT.js";import{aq as d,n as l,A as t,C as c,q as u}from"./icons-eh0tbLFx.js";import"./vendor-router-B2AaIOtG.js";import"./charts-QHQg_ypW.js";/* empty css                  */const o=()=>{const{user:o}=i(),[h,m]=e.useState([]),[g,j]=e.useState({}),[x,v]=e.useState([]),[N,p]=e.useState(!0),[f,b]=e.useState(0),[_,y]=e.useState({});e.useEffect(()=>{(null==o?void 0:o.email)&&k()},[null==o?void 0:o.email]);const k=async()=>{try{const e=await n(`/mitglieder/by-email/${encodeURIComponent(o.email)}`);if(!e.ok)return;const s=await e.json();await z(),await S(s.mitglied_id)}catch(e){console.error("Fehler beim Laden der Mitgliedsdaten:",e)}finally{p(!1)}},z=async()=>{try{const e=await n(`${a.apiBaseUrl}/stile`);if(e.ok){const s=await e.json();v(s)}}catch(e){console.error("Fehler beim Laden der Stile:",e)}},S=async e=>{try{const s=await n(`/mitglieder/${e}/stile`);if(s.ok){const i=await s.json();i.success&&i.stile&&(m(i.stile),i.stile.forEach(async s=>{await w(e,s.stil_id)}))}}catch(s){console.error("Fehler beim Laden der Mitglied-Stile:",s)}},w=async(e,s)=>{try{const i=await n(`/mitglieder/${e}/stil/${s}/data`);if(i.ok){const e=await i.json();j(i=>({...i,[s]:e.data})),L(s,e.data)}}catch(i){console.error(`Fehler beim Laden stilspezifischer Daten f√ºr Stil ${s}:`,i)}},L=(e,s)=>{const i=x.find(s=>s.stil_id===e);if(!(null==i?void 0:i.graduierungen)||!s)return;const n=s.current_graduierung_id,a=i.graduierungen.findIndex(e=>e.graduierung_id===n);if(-1===a||a>=i.graduierungen.length-1)return void y(s=>({...s,[e]:null}));const r=i.graduierungen[a+1],d=s.stunden_seit_letzter_pruefung||0,l=r.min_stunden||0,t=Math.max(0,l-d);y(s=>({...s,[e]:{hoursNeeded:t,hoursCompleted:d,requiredHours:l,nextGraduation:r.name,progress:Math.min(100,d/l*100)}}))},M=e=>e?new Date(e).toLocaleDateString("de-DE"):"Nicht angegeben";return N?s.jsxs("div",{className:"dashboard-container",children:[s.jsx(r,{}),s.jsx("div",{className:"dashboard-content",children:s.jsxs("div",{className:"member-styles-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Lade Stil & Gurt Daten..."})]})})]}):s.jsxs("div",{className:"dashboard-container",children:[s.jsx(r,{}),s.jsx("div",{className:"dashboard-content",children:s.jsxs("div",{className:"member-styles",children:[s.jsxs("div",{className:"styles-header",children:[s.jsxs("h1",{children:[s.jsx(d,{size:24}),"Meine Kampfkunst-Stile"]}),s.jsx("p",{children:"Verwalte deine Stile, Graduierungen und Pr√ºfungen"})]}),Object.values(_).some(e=>null!==e)&&s.jsxs("div",{className:"training-tracker-section",children:[s.jsxs("h2",{children:[s.jsx(l,{size:20}),"Trainingsstunden-Tracker"]}),s.jsx("div",{className:"tracker-grid",children:Object.entries(_).map(([e,i])=>{if(!i)return null;const n=h.find(s=>s.stil_id===parseInt(e));return n?s.jsxs("div",{className:"tracker-card",children:[s.jsxs("div",{className:"tracker-header",children:[s.jsx("h3",{children:n.name}),s.jsxs("div",{className:"tracker-badge",children:[s.jsx("span",{children:"üéØ"}),s.jsx("span",{children:i.nextGraduation})]})]}),s.jsxs("div",{className:"tracker-progress",children:[s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-fill",style:{width:`${i.progress}%`}})}),s.jsxs("div",{className:"progress-info",children:[s.jsxs("span",{className:"progress-text",children:[i.hoursCompleted,"h / ",i.requiredHours,"h"]}),s.jsxs("span",{className:"progress-percentage",children:[Math.round(i.progress),"%"]})]})]}),s.jsx("div",{className:"tracker-details",children:i.hoursNeeded>0?s.jsxs("div",{className:"hours-needed",children:[s.jsx("span",{className:"hours-label",children:"Noch ben√∂tigt:"}),s.jsxs("span",{className:"hours-value",children:[i.hoursNeeded," Stunden"]})]}):s.jsx("div",{className:"hours-ready",children:s.jsx("span",{children:"‚úÖ Bereit f√ºr Pr√ºfung!"})})})]},e):null})})]}),0===h.length?s.jsxs("div",{className:"no-styles",children:[s.jsx(d,{size:48}),s.jsx("h3",{children:"Noch keine Stile zugewiesen"}),s.jsx("p",{children:"Wende dich an deinen Trainer, um Stile zuzuweisen."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"style-tabs",children:h.map((e,i)=>{const n=x.find(s=>s.stil_id===e.stil_id);return s.jsxs("button",{className:"style-tab "+(f===i?"active":""),onClick:()=>b(i),children:[s.jsx(d,{size:16}),(null==n?void 0:n.name)||e.name]},e.stil_id)})}),h.map((e,i)=>{var n,a;if(f!==i)return null;const r=x.find(s=>s.stil_id===e.stil_id),l=g[e.stil_id],o=(null==l?void 0:l.current_graduierung_id)?null==(n=null==r?void 0:r.graduierungen)?void 0:n.find(e=>e.graduierung_id===l.current_graduierung_id):null==(a=null==r?void 0:r.graduierungen)?void 0:a[0];return s.jsxs("div",{className:"style-content",children:[s.jsxs("div",{className:"style-header",children:[s.jsxs("div",{className:"style-info",children:[s.jsxs("h2",{children:[s.jsx(d,{size:20}),(null==r?void 0:r.name)||e.name]}),s.jsx("p",{className:"style-description",children:(null==r?void 0:r.beschreibung)||"Kampfkunst-Stil"})]}),s.jsx("div",{className:"current-graduation",children:o&&s.jsxs("div",{className:"graduation-badge",children:[s.jsx(t,{size:16}),s.jsx("span",{children:o.name})]})})]}),(null==r?void 0:r.graduierungen)&&r.graduierungen.length>0&&s.jsxs("div",{className:"graduations-section",children:[s.jsxs("h3",{children:[s.jsx(t,{size:18}),"Graduierungen"]}),s.jsx("div",{className:"graduations-list",children:r.graduierungen.map((e,i)=>s.jsxs("div",{className:"graduation-item "+((null==o?void 0:o.graduierung_id)===e.graduierung_id?"current":""),children:[s.jsxs("div",{className:"graduation-rank",children:[i+1,"."]}),s.jsxs("div",{className:"graduation-info",children:[s.jsx("span",{className:"graduation-name",children:e.name}),e.beschreibung&&s.jsx("span",{className:"graduation-description",children:e.beschreibung})]}),(null==o?void 0:o.graduierung_id)===e.graduierung_id&&s.jsx("div",{className:"current-indicator",children:"Aktuell"})]},e.graduierung_id))})]}),s.jsxs("div",{className:"exam-section",children:[s.jsxs("h3",{children:[s.jsx(c,{size:18}),"Pr√ºfungsdaten"]}),s.jsxs("div",{className:"exam-details",children:[s.jsxs("div",{className:"exam-item",children:[s.jsx("label",{children:"Letzte Pr√ºfung:"}),s.jsx("span",{children:M(null==l?void 0:l.letzte_pruefung)})]}),s.jsxs("div",{className:"exam-item",children:[s.jsx("label",{children:"N√§chste Pr√ºfung:"}),s.jsx("span",{children:M(null==l?void 0:l.naechste_pruefung)})]}),(null==l?void 0:l.anmerkungen)&&s.jsxs("div",{className:"exam-item",children:[s.jsx("label",{children:"Anmerkungen:"}),s.jsx("span",{children:l.anmerkungen})]})]})]}),s.jsxs("div",{className:"training-section",children:[s.jsxs("h3",{children:[s.jsx(u,{size:18}),"Trainingsfortschritt"]}),s.jsxs("div",{className:"training-stats",children:[s.jsxs("div",{className:"stat-item",children:[s.jsx("span",{className:"stat-label",children:"Trainingsstunden seit letzter Pr√ºfung:"}),s.jsx("span",{className:"stat-value",children:(null==l?void 0:l.stunden_seit_letzter_pruefung)||0})]}),s.jsxs("div",{className:"stat-item",children:[s.jsx("span",{className:"stat-label",children:"Empfohlene Stunden bis n√§chster Graduierung:"}),s.jsx("span",{className:"stat-value",children:(null==o?void 0:o.min_stunden)||"Nicht definiert"})]})]})]})]},e.stil_id)})]})]})})]})};export{o as default};
