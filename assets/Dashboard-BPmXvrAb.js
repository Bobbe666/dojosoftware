import{a as e,j as s,b as a}from"./query-Caj74EYQ.js";import{a as n,u as r,f as t,c as i,b as l,d,e as c,g as o,h,L as m,S as u,i as x,j as g,k as p}from"./index-lGWqIYMX.js";import{j as b}from"./index-CkXcCt97.js";/* empty css                  */import{D as j,S as v,T as f,A as N}from"./TrialBanner-D0-3e9hc.js";import y from"./MemberDashboard-CQs9WBWW.js";import{m as k,n as _,o as z,A as w,D as S,p as C,g as A,q as D,T as B,F as E,r as T,d as F,s as $,t as R,u as I,k as M,G as L,v as P,w as V,x as U,y as K,W,z as O,J as G,K as J,N as Z,O as q,L as H,C as Y,R as Q,Z as X,j as ee,P as se,Q as ae,V as ne,X as re,Y as te,_ as ie,$ as le,b as de,a0 as ce,a1 as oe,a2 as he,i as me,a3 as ue,a4 as xe,a5 as ge,a6 as pe,a7 as be,a8 as je,a as ve,a9 as fe,aa as Ne,ab as ye,ac as ke,ad as _e,ae as ze,af as we,ag as Se,ah as Ce,ai as Ae}from"./icons-C9nQ4cWf.js";import{R as De,A as Be,C as Ee,X as Te,Y as Fe,T as $e,a as Re,B as Ie,b as Me,P as Le,c as Pe,d as Ve,L as Ue,e as Ke}from"./charts-QHQg_ypW.js";import{Q as We}from"./index-wRQyZq66.js";/* empty css                          */import{Z as Oe}from"./ZieleEntwicklung-Dqivz008.js";import Ge from"./SupportTickets-BcNd_UpV.js";import{V as Je,a as Ze}from"./VerbandDashboard-DSLOeeWN.js";import qe from"./ArtikelVerwaltung-2NHdMAGc.js";import He from"./FeatureBoard-B6KePuXL.js";import{u as Ye,d as Qe,O as Xe}from"./vendor-router-B2AaIOtG.js";import{A as es}from"./AgbStatusWidget-DIiUc7a3.js";import"./MemberHeader-BH_mnfhz.js";/* empty css                      *//* empty css                         *//* empty css                       *//* empty css                                   *//* empty css                        */const ss=["#FFD700","#FFA500","#FF6B35","#4ECDC4","#45B7D1","#96CEB4"],as=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],ns=(e,s=0)=>{const a=parseFloat(e);return isNaN(a)||null==e?s>0?"0,00":"0":a.toLocaleString("de-DE",{minimumFractionDigits:s,maximumFractionDigits:s})},rs=({icon:e,title:a,subtitle:n})=>s.jsxs("div",{className:"empty-state",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px 20px",color:"rgba(255,255,255,0.5)",textAlign:"center"},children:[s.jsx(e,{size:48,style:{marginBottom:"16px",opacity:.5}}),s.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:"8px"},children:a}),s.jsx("div",{style:{fontSize:"0.9rem",opacity:.7},children:n})]}),ts=({token:a})=>{const[r,t]=e.useState(!0),[i,l]=e.useState(""),[d,c]=e.useState(null);e.useEffect(()=>{o()},[]);const o=async()=>{var e,s;t(!0),l("");try{const e=await n.get("/admin/statistics",{headers:{Authorization:`Bearer ${a}`}});c(e.data.statistics),console.log("✅ Statistiken geladen:",e.data.statistics)}catch(r){console.error("❌ Fehler beim Laden der Statistiken:",r),l((null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.message)||"Fehler beim Laden der Statistiken")}finally{t(!1)}};if(r)return s.jsxs("div",{className:"statistics-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Lade Statistiken..."})]});if(i)return s.jsxs("div",{className:"statistics-error",children:[s.jsx("p",{children:i}),s.jsx("button",{onClick:o,className:"btn btn-primary",children:"Erneut versuchen"})]});if(!d)return s.jsx("div",{className:"statistics-tab",children:s.jsx(rs,{icon:k,title:"Noch keine Statistiken verfügbar",subtitle:"Sobald Daten vorliegen, werden hier Statistiken angezeigt"})});const h=d.memberStatus||{aktiv:0,inaktiv:0},m=d.trialStats||{trial:0,active:0},u=Array.isArray(d.revenuePerDojo)?d.revenuePerDojo:[],x=(Array.isArray(d.revenueTrend)?d.revenueTrend:[]).map(e=>({monat:as[(e.monat||1)-1],umsatz:parseFloat(e.umsatz)||0})),g=(p=u,b="umsatz",Array.isArray(p)&&0!==p.length?p.reduce((e,s)=>e+(parseFloat(s[b])||0),0):0);var p,b;const j=g>0||x.some(e=>e.umsatz>0);return s.jsxs("div",{className:"statistics-tab",children:[s.jsxs("div",{className:"stats-kpi-grid",children:[s.jsxs("div",{className:"kpi-card",children:[s.jsx("div",{className:"kpi-icon success",children:s.jsx(_,{size:24})}),s.jsxs("div",{className:"kpi-content",children:[s.jsx("div",{className:"kpi-label",children:"Conversion Rate"}),s.jsxs("div",{className:"kpi-value",children:[ns(d.conversionRate||0),"%"]}),s.jsx("div",{className:"kpi-sublabel",children:"Trial → Active"})]})]}),s.jsxs("div",{className:"kpi-card",children:[s.jsx("div",{className:"kpi-icon primary",children:s.jsx(z,{size:24})}),s.jsxs("div",{className:"kpi-content",children:[s.jsx("div",{className:"kpi-label",children:"Aktive Mitglieder"}),s.jsx("div",{className:"kpi-value",children:ns(h.aktiv)}),s.jsxs("div",{className:"kpi-sublabel",children:["von ",ns((h.aktiv||0)+(h.inaktiv||0))," gesamt"]})]})]}),s.jsxs("div",{className:"kpi-card",children:[s.jsx("div",{className:"kpi-icon warning",children:s.jsx(w,{size:24})}),s.jsxs("div",{className:"kpi-content",children:[s.jsx("div",{className:"kpi-label",children:"Trial Dojos"}),s.jsx("div",{className:"kpi-value",children:ns(m.trial)}),s.jsxs("div",{className:"kpi-sublabel",children:[ns(m.active)," aktive Abos"]})]})]}),s.jsxs("div",{className:"kpi-card",children:[s.jsx("div",{className:"kpi-icon success",children:s.jsx(S,{size:24})}),s.jsxs("div",{className:"kpi-content",children:[s.jsxs("div",{className:"kpi-label",children:["Gesamt-Umsatz ",(new Date).getFullYear()]}),s.jsx("div",{className:"kpi-value",children:g>0?`${ns(g,2)} €`:"Noch keine Umsätze"}),s.jsx("div",{className:"kpi-sublabel",children:u.length>0?`${u.length} Dojos`:"Keine Daten"})]})]})]}),s.jsxs("div",{className:"charts-grid",children:[s.jsxs("div",{className:"chart-card",children:[s.jsxs("h3",{className:"chart-title",children:[s.jsx(C,{size:18}),"Umsatz-Entwicklung ",(new Date).getFullYear()]}),x.length>0&&j?s.jsx(De,{width:"100%",height:300,children:s.jsxs(Be,{data:x,children:[s.jsx("defs",{children:s.jsxs("linearGradient",{id:"colorUmsatz",x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"5%",stopColor:"#FFD700",stopOpacity:.8}),s.jsx("stop",{offset:"95%",stopColor:"#FFD700",stopOpacity:0})]})}),s.jsx(Ee,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),s.jsx(Te,{dataKey:"monat",stroke:"#fff"}),s.jsx(Fe,{stroke:"#fff"}),s.jsx($e,{contentStyle:{backgroundColor:"#1a1a2e",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"8px"},labelStyle:{color:"#FFD700"},formatter:e=>[`${ns(e,2)} €`,"Umsatz"]}),s.jsx(Re,{type:"monotone",dataKey:"umsatz",stroke:"#FFD700",fillOpacity:1,fill:"url(#colorUmsatz)"})]})}):s.jsx(rs,{icon:C,title:"Noch keine Umsätze",subtitle:"Umsatzdaten werden hier angezeigt, sobald Einnahmen verbucht werden"})]}),s.jsxs("div",{className:"chart-card",children:[s.jsxs("h3",{className:"chart-title",children:[s.jsx(S,{size:18}),"Umsatz pro Dojo"]}),u.length>0&&g>0?s.jsx(De,{width:"100%",height:300,children:s.jsxs(Ie,{data:u,children:[s.jsx(Ee,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),s.jsx(Te,{dataKey:"dojoname",stroke:"#fff",angle:-45,textAnchor:"end",height:100}),s.jsx(Fe,{stroke:"#fff"}),s.jsx($e,{contentStyle:{backgroundColor:"#1a1a2e",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"8px"},labelStyle:{color:"#FFD700"},formatter:e=>[`${ns(e,2)} €`,"Umsatz"]}),s.jsx(Me,{dataKey:"umsatz",fill:"#FFD700"})]})}):s.jsx(rs,{icon:S,title:"Noch keine Umsätze pro Dojo",subtitle:"Hier werden Umsätze nach Dojo aufgeschlüsselt"})]}),s.jsxs("div",{className:"chart-card",children:[s.jsxs("h3",{className:"chart-title",children:[s.jsx(w,{size:18}),"Subscription Status"]}),Array.isArray(d.subscriptionDistribution)&&d.subscriptionDistribution.length>0?s.jsx(De,{width:"100%",height:300,children:s.jsxs(Le,{children:[s.jsx(Pe,{data:d.subscriptionDistribution,cx:"50%",cy:"50%",labelLine:!1,label:({status:e,anzahl:s})=>`${e}: ${ns(s)}`,outerRadius:100,fill:"#8884d8",dataKey:"anzahl",nameKey:"status",children:d.subscriptionDistribution.map((e,a)=>s.jsx(Ve,{fill:ss[a%ss.length]},`cell-${a}`))}),s.jsx($e,{contentStyle:{backgroundColor:"#1a1a2e",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"8px"}})]})}):s.jsx(rs,{icon:w,title:"Keine Abonnements",subtitle:"Hier wird die Verteilung der Abo-Status angezeigt"})]}),s.jsxs("div",{className:"chart-card",children:[s.jsxs("h3",{className:"chart-title",children:[s.jsx(z,{size:18}),"Top Dojos nach Mitgliedern"]}),Array.isArray(d.topDojos)&&d.topDojos.length>0?s.jsx(De,{width:"100%",height:300,children:s.jsxs(Ie,{data:d.topDojos,layout:"vertical",children:[s.jsx(Ee,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),s.jsx(Te,{type:"number",stroke:"#fff"}),s.jsx(Fe,{dataKey:"dojoname",type:"category",stroke:"#fff",width:150}),s.jsx($e,{contentStyle:{backgroundColor:"#1a1a2e",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"8px"},labelStyle:{color:"#FFD700"}}),s.jsx(Me,{dataKey:"mitglieder",fill:"#4ECDC4"})]})}):s.jsx(rs,{icon:z,title:"Noch keine Dojos mit Mitgliedern",subtitle:"Top Dojos werden hier angezeigt, sobald Mitglieder registriert sind"})]})]})]})},is=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],ls=({token:a})=>{var r,t,i,l,d,c;const[o,h]=e.useState(!0),[m,u]=e.useState(""),[x,g]=e.useState(null);e.useEffect(()=>{p()},[]);const p=async()=>{var e,s;h(!0),u("");try{const e=await n.get("/admin/contracts",{headers:{Authorization:`Bearer ${a}`}});g(e.data.contracts),console.log("✅ Vertragsdaten geladen:",e.data.contracts)}catch(r){console.error("❌ Fehler beim Laden der Vertragsdaten:",r),u((null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.message)||"Fehler beim Laden der Vertragsdaten")}finally{h(!1)}};if(o)return s.jsxs("div",{className:"statistics-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Lade Vertragsdaten..."})]});if(m)return s.jsxs("div",{className:"statistics-error",children:[s.jsx("p",{children:m}),s.jsx("button",{onClick:p,className:"btn btn-primary",children:"Erneut versuchen"})]});if(!x)return null;const b=x.monthlyContracts.map(e=>({monat:is[e.monat-1],vertraege:e.anzahl_vertraege,aktiv:e.aktiv,abgelaufen:e.abgelaufen})),j=(null==(t=null==(r=x.contractStats)?void 0:r.active)?void 0:t.anzahl)||0,v=(null==(l=null==(i=x.contractStats)?void 0:i.trial)?void 0:l.anzahl)||0;return null==(c=null==(d=x.contractStats)?void 0:d.expired)||c.anzahl,s.jsxs("div",{className:"statistics-tab contracts-tab",children:[s.jsxs("div",{className:"stats-kpi-grid",children:[s.jsxs("div",{className:"kpi-card",children:[s.jsx("div",{className:"kpi-icon success",children:s.jsx(A,{size:24})}),s.jsxs("div",{className:"kpi-content",children:[s.jsx("div",{className:"kpi-label",children:"Aktive Verträge"}),s.jsx("div",{className:"kpi-value",children:j}),s.jsxs("div",{className:"kpi-sublabel",children:[v," in Trial-Phase"]})]})]}),s.jsxs("div",{className:"kpi-card",children:[s.jsx("div",{className:"kpi-icon warning",children:s.jsx(D,{size:24})}),s.jsxs("div",{className:"kpi-content",children:[s.jsx("div",{className:"kpi-label",children:"Ablaufend (30 Tage)"}),s.jsx("div",{className:"kpi-value",children:x.upcomingRenewals.next30Days.length}),s.jsxs("div",{className:"kpi-sublabel",children:[x.upcomingRenewals.count90Days," in 90 Tagen"]})]})]}),s.jsxs("div",{className:"kpi-card",children:[s.jsx("div",{className:"kpi-icon primary",children:s.jsx(C,{size:24})}),s.jsxs("div",{className:"kpi-content",children:[s.jsx("div",{className:"kpi-label",children:"Ø Vertragslaufzeit"}),s.jsxs("div",{className:"kpi-value",children:[Math.round(x.avgContractDuration.avg_tage/30)," Monate"]}),s.jsxs("div",{className:"kpi-sublabel",children:[x.avgContractDuration.avg_tage," Tage"]})]})]}),s.jsxs("div",{className:"kpi-card",children:[s.jsx("div",{className:"kpi-icon success",children:s.jsx(w,{size:24})}),s.jsxs("div",{className:"kpi-content",children:[s.jsx("div",{className:"kpi-label",children:"Verlängerungs-Rate"}),s.jsxs("div",{className:"kpi-value",children:[x.renewalRate,"%"]}),s.jsx("div",{className:"kpi-sublabel",children:"Verträge erneuert"})]})]})]}),s.jsx("div",{className:"charts-grid",children:s.jsxs("div",{className:"chart-card chart-wide",children:[s.jsxs("h3",{className:"chart-title",children:[s.jsx(C,{size:18}),"Vertragsabschlüsse 2026"]}),s.jsx(De,{width:"100%",height:300,children:s.jsxs(Ie,{data:b,children:[s.jsx(Ee,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),s.jsx(Te,{dataKey:"monat",stroke:"#fff"}),s.jsx(Fe,{stroke:"#fff"}),s.jsx($e,{contentStyle:{backgroundColor:"#1a1a2e",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"8px"},labelStyle:{color:"#FFD700"}}),s.jsx(Ue,{}),s.jsx(Me,{dataKey:"aktiv",fill:"#4ECDC4",name:"Aktiv"}),s.jsx(Me,{dataKey:"abgelaufen",fill:"#FF6B35",name:"Abgelaufen"})]})})]})}),x.upcomingRenewals.next30Days.length>0&&s.jsxs("div",{className:"finance-section",children:[s.jsxs("h3",{className:"section-title",children:[s.jsx(B,{size:18}),"Bald ablaufende Verträge (nächste 30 Tage)"]}),s.jsx("div",{className:"finance-table-container",children:s.jsxs("table",{className:"finance-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Dojo"}),s.jsx("th",{children:"Plan"}),s.jsx("th",{children:"Endet am"}),s.jsx("th",{children:"Verbleibend"}),s.jsx("th",{children:"Preis"})]})}),s.jsx("tbody",{children:x.upcomingRenewals.next30Days.map((e,a)=>s.jsxs("tr",{className:e.tage_bis_ende<=7?"urgent":"",children:[s.jsx("td",{className:"dojo-name",children:e.dojoname}),s.jsx("td",{children:e.subscription_plan||"Standard"}),s.jsx("td",{children:new Date(e.subscription_end).toLocaleDateString("de-DE")}),s.jsxs("td",{className:e.tage_bis_ende<=7?"urgent-text":"warning-text",children:[e.tage_bis_ende," Tage"]}),s.jsx("td",{children:e.custom_pricing?s.jsxs("span",{className:"custom-price",children:[e.custom_pricing.toFixed(2)," € (Custom)"]}):s.jsx("span",{children:"Standard"})})]},a))})]})})]}),s.jsxs("div",{className:"finance-section",children:[s.jsxs("h3",{className:"section-title",children:[s.jsx(A,{size:18}),"Aktive Verträge (",x.activeContracts.length,")"]}),s.jsx("div",{className:"finance-table-container",children:s.jsxs("table",{className:"finance-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Dojo"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Plan"}),s.jsx("th",{children:"Start"}),s.jsx("th",{children:"Ende"}),s.jsx("th",{children:"Mitglieder"}),s.jsx("th",{children:"Bemerkungen"})]})}),s.jsx("tbody",{children:x.activeContracts.map((e,a)=>s.jsxs("tr",{children:[s.jsx("td",{className:"dojo-name",children:e.dojoname}),s.jsx("td",{children:s.jsx("span",{className:"status-badge "+("trial"===e.subscription_status?"warning":"success"),children:"trial"===e.subscription_status?"Trial":"Aktiv"})}),s.jsx("td",{children:e.subscription_plan||"Standard"}),s.jsx("td",{children:e.subscription_start?new Date(e.subscription_start).toLocaleDateString("de-DE"):"-"}),s.jsx("td",{children:e.subscription_end?new Date(e.subscription_end).toLocaleDateString("de-DE"):"-"}),s.jsx("td",{className:"member-count",children:e.mitglied_count}),s.jsxs("td",{className:"notes-cell",children:[e.custom_pricing&&s.jsxs("span",{className:"custom-badge",children:["Custom: ",e.custom_pricing.toFixed(2)," €"]}),e.custom_notes&&s.jsxs("span",{className:"notes-text",title:e.custom_notes,children:[e.custom_notes.substring(0,50),e.custom_notes.length>50?"...":""]})]})]},a))})]})})]}),x.customContracts.length>0&&s.jsxs("div",{className:"finance-section",children:[s.jsxs("h3",{className:"section-title",children:[s.jsx(E,{size:18}),"Verträge mit individueller Preisgestaltung (",x.customContracts.length,")"]}),s.jsx("div",{className:"custom-contracts-grid",children:x.customContracts.map((e,a)=>s.jsxs("div",{className:"custom-contract-card",children:[s.jsxs("div",{className:"contract-header",children:[s.jsx("h4",{children:e.dojoname}),s.jsx("span",{className:"status-badge "+("active"===e.subscription_status?"success":"warning"),children:e.subscription_status})]}),s.jsxs("div",{className:"contract-details",children:[s.jsxs("div",{className:"detail-row",children:[s.jsx("span",{className:"label",children:"Plan:"}),s.jsx("span",{className:"value",children:e.subscription_plan||"Standard"})]}),s.jsxs("div",{className:"detail-row",children:[s.jsx("span",{className:"label",children:"Custom Preis:"}),s.jsxs("span",{className:"value custom-price",children:[e.custom_pricing.toFixed(2)," € / Monat"]})]}),s.jsxs("div",{className:"detail-row",children:[s.jsx("span",{className:"label",children:"Laufzeit:"}),s.jsxs("span",{className:"value",children:[new Date(e.subscription_start).toLocaleDateString("de-DE")," - ",new Date(e.subscription_end).toLocaleDateString("de-DE")]})]}),e.custom_notes&&s.jsxs("div",{className:"detail-row notes-row",children:[s.jsx("span",{className:"label",children:"Notizen:"}),s.jsx("span",{className:"value notes",children:e.custom_notes})]})]})]},a))})]}),x.trialConversions.length>0&&s.jsxs("div",{className:"finance-section",children:[s.jsxs("h3",{className:"section-title",children:[s.jsx(w,{size:18}),"Trial Conversions (Letzte 90 Tage)"]}),s.jsx("div",{className:"trial-conversions-grid",children:x.trialConversions.map((e,a)=>s.jsxs("div",{className:"trial-conversion-card",children:[s.jsx("div",{className:"conversion-dojo",children:e.dojoname}),s.jsxs("div",{className:"conversion-timeline",children:[s.jsxs("div",{className:"timeline-item",children:[s.jsx("span",{className:"timeline-label",children:"Trial Ende:"}),s.jsx("span",{className:"timeline-date",children:new Date(e.trial_end).toLocaleDateString("de-DE")})]}),s.jsx("div",{className:"timeline-arrow",children:"→"}),s.jsxs("div",{className:"timeline-item",children:[s.jsx("span",{className:"timeline-label",children:"Aktiviert:"}),s.jsx("span",{className:"timeline-date",children:new Date(e.subscription_start).toLocaleDateString("de-DE")})]})]}),s.jsxs("div",{className:"conversion-duration",children:["Trial-Dauer: ",e.trial_dauer_tage," Tage"]})]},a))})]}),x.expiredContracts.length>0&&s.jsxs("div",{className:"finance-section",children:[s.jsxs("h3",{className:"section-title",children:[s.jsx(B,{size:18}),"Abgelaufene Verträge (Letzte 90 Tage)"]}),s.jsx("div",{className:"finance-table-container",children:s.jsxs("table",{className:"finance-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Dojo"}),s.jsx("th",{children:"Plan"}),s.jsx("th",{children:"Abgelaufen am"}),s.jsx("th",{children:"Tage seit Ablauf"})]})}),s.jsx("tbody",{children:x.expiredContracts.map((e,a)=>s.jsxs("tr",{className:"expired",children:[s.jsx("td",{className:"dojo-name",children:e.dojoname}),s.jsx("td",{children:e.subscription_plan||"Standard"}),s.jsx("td",{children:new Date(e.subscription_end).toLocaleDateString("de-DE")}),s.jsxs("td",{className:"expired-days",children:[e.tage_abgelaufen," Tage"]})]},a))})]})})]})]})},ds=({token:a})=>{var r,t;const[i,l]=e.useState(!0),[d,c]=e.useState(""),[o,h]=e.useState(null);e.useEffect(()=>{m()},[]);const m=async()=>{var e,s;l(!0),c("");try{const e=await n.get("/admin/users",{headers:{Authorization:`Bearer ${a}`}});h(e.data.users),console.log("✅ Benutzerdaten geladen:",e.data.users)}catch(r){console.error("❌ Fehler beim Laden der Benutzerdaten:",r),c((null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.message)||"Fehler beim Laden der Benutzerdaten")}finally{l(!1)}};if(i)return s.jsxs("div",{className:"statistics-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Lade Benutzerdaten..."})]});if(d)return s.jsxs("div",{className:"statistics-error",children:[s.jsx("p",{children:d}),s.jsx("button",{onClick:m,className:"btn btn-primary",children:"Erneut versuchen"})]});if(!o)return null;const u={super_admin:"Super-Admin",admin:"Administrator",mitarbeiter:"Mitarbeiter",eingeschraenkt:"Eingeschränkt"};return s.jsxs("div",{className:"statistics-tab users-tab",children:[s.jsxs("div",{className:"stats-kpi-grid",children:[s.jsxs("div",{className:"kpi-card",children:[s.jsx("div",{className:"kpi-icon primary",children:s.jsx(z,{size:24})}),s.jsxs("div",{className:"kpi-content",children:[s.jsx("div",{className:"kpi-label",children:"Gesamt Benutzer"}),s.jsx("div",{className:"kpi-value",children:o.userStats.total+o.dojoUsers.length}),s.jsxs("div",{className:"kpi-sublabel",children:[o.userStats.total," Admin + ",o.dojoUsers.length," Dojo"]})]})]}),s.jsxs("div",{className:"kpi-card",children:[s.jsx("div",{className:"kpi-icon success",children:s.jsx(A,{size:24})}),s.jsxs("div",{className:"kpi-content",children:[s.jsx("div",{className:"kpi-label",children:"Aktive Benutzer"}),s.jsx("div",{className:"kpi-value",children:o.userStats.active}),s.jsxs("div",{className:"kpi-sublabel",children:[o.activeUsers.length," in letzten 7 Tagen"]})]})]}),s.jsxs("div",{className:"kpi-card",children:[s.jsx("div",{className:"kpi-icon warning",children:s.jsx(T,{size:24})}),s.jsxs("div",{className:"kpi-content",children:[s.jsx("div",{className:"kpi-label",children:"Logins (30 Tage)"}),s.jsx("div",{className:"kpi-value",children:o.loginStats.total_logins}),s.jsxs("div",{className:"kpi-sublabel",children:["Ø ",o.loginStats.avg_per_day," pro Tag"]})]})]}),s.jsxs("div",{className:"kpi-card",children:[s.jsx("div",{className:"kpi-icon primary",children:s.jsx(F,{size:24})}),s.jsxs("div",{className:"kpi-content",children:[s.jsx("div",{className:"kpi-label",children:"Super-Admins"}),s.jsx("div",{className:"kpi-value",children:(null==(r=o.userStats.byRole)?void 0:r.super_admin)||0}),s.jsxs("div",{className:"kpi-sublabel",children:[(null==(t=o.userStats.byRole)?void 0:t.admin)||0," Admins gesamt"]})]})]})]}),o.adminUsers.length>0&&s.jsxs("div",{className:"finance-section",children:[s.jsxs("h3",{className:"section-title",children:[s.jsx($,{size:18}),"Admin-Benutzer (",o.adminUsers.length,")"]}),s.jsx("div",{className:"finance-table-container",children:s.jsxs("table",{className:"finance-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Benutzername"}),s.jsx("th",{children:"Name"}),s.jsx("th",{children:"Email"}),s.jsx("th",{children:"Rolle"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Letzter Login"}),s.jsx("th",{children:"Erstellt"})]})}),s.jsx("tbody",{children:o.adminUsers.map((e,a)=>s.jsxs("tr",{className:e.aktiv?"":"inactive-user",children:[s.jsx("td",{className:"username",children:e.username}),s.jsxs("td",{children:[e.vorname," ",e.nachname]}),s.jsx("td",{className:"email-cell",children:e.email}),s.jsx("td",{children:s.jsx("span",{className:`role-badge ${e.rolle}`,children:u[e.rolle]||e.rolle})}),s.jsx("td",{children:e.aktiv?s.jsxs("span",{className:"status-badge success",children:[s.jsx(A,{size:14})," Aktiv"]}):s.jsxs("span",{className:"status-badge inactive",children:[s.jsx(R,{size:14})," Inaktiv"]})}),s.jsx("td",{children:e.letzter_login?s.jsxs(s.Fragment,{children:[new Date(e.letzter_login).toLocaleDateString("de-DE"),s.jsx("span",{className:"time-cell",children:new Date(e.letzter_login).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})})]}):s.jsx("span",{className:"no-data",children:"Noch nie"})}),s.jsx("td",{children:new Date(e.erstellt_am).toLocaleDateString("de-DE")})]},a))})]})})]}),o.activeUsers.length>0&&s.jsxs("div",{className:"finance-section",children:[s.jsxs("h3",{className:"section-title",children:[s.jsx(T,{size:18}),"Kürzlich aktive Benutzer (Letzte 7 Tage)"]}),s.jsx("div",{className:"active-users-grid",children:o.activeUsers.map((e,a)=>{var n,r;return s.jsxs("div",{className:"active-user-card",children:[s.jsxs("div",{className:"user-avatar",children:[((null==(n=e.vorname)?void 0:n[0])||"?").toUpperCase(),((null==(r=e.nachname)?void 0:r[0])||"?").toUpperCase()]}),s.jsxs("div",{className:"user-info",children:[s.jsxs("div",{className:"user-name",children:[e.vorname," ",e.nachname]}),s.jsxs("div",{className:"user-username",children:["@",e.username]}),s.jsxs("div",{className:"user-activity",children:[s.jsx(D,{size:12}),0===e.tage_seit_login?"Heute":`Vor ${e.tage_seit_login} Tagen`]})]})]},a)})})]}),o.dojoUsers.length>0&&s.jsxs("div",{className:"finance-section",children:[s.jsxs("h3",{className:"section-title",children:[s.jsx(z,{size:18}),"Dojo-Administratoren (",o.dojoUsers.length,")"]}),s.jsx("div",{className:"dojo-users-container",children:Object.entries(o.usersByDojo).map(([e,a],n)=>s.jsxs("div",{className:"dojo-users-group",children:[s.jsxs("h4",{className:"dojo-group-title",children:[e," (",a.length,")"]}),s.jsx("div",{className:"finance-table-container",children:s.jsxs("table",{className:"finance-table compact",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Benutzername"}),s.jsx("th",{children:"Email"}),s.jsx("th",{children:"Aktivität (30 Tage)"}),s.jsx("th",{children:"Erstellt"})]})}),s.jsx("tbody",{children:a.map((e,a)=>s.jsxs("tr",{children:[s.jsx("td",{className:"username",children:e.benutzername}),s.jsx("td",{className:"email-cell",children:e.email}),s.jsx("td",{className:"activity-cell",children:e.activity_last_30_days>0?s.jsxs("span",{className:"activity-badge active",children:[e.activity_last_30_days," Aktionen"]}):s.jsx("span",{className:"activity-badge inactive",children:"Keine Aktivität"})}),s.jsx("td",{children:new Date(e.created_at).toLocaleDateString("de-DE")})]},a))})]})})]},n))})]}),o.recentActivity.length>0&&s.jsxs("div",{className:"finance-section",children:[s.jsxs("h3",{className:"section-title",children:[s.jsx(T,{size:18}),"Letzte Aktivitäten (50)"]}),s.jsx("div",{className:"activity-log-container",children:o.recentActivity.map((e,a)=>s.jsxs("div",{className:"activity-log-item",children:[s.jsx("div",{className:"activity-icon",children:s.jsx(T,{size:16})}),s.jsxs("div",{className:"activity-content",children:[s.jsxs("div",{className:"activity-header",children:[s.jsx("span",{className:"activity-user",children:e.username}),s.jsx("span",{className:"activity-action",children:e.aktion}),s.jsxs("span",{className:"activity-bereich",children:["in ",e.bereich]})]}),e.beschreibung&&s.jsx("div",{className:"activity-description",children:e.beschreibung}),s.jsx("div",{className:"activity-time",children:new Date(e.erstellt_am).toLocaleString("de-DE")})]})]},a))})]})]})},cs={verband:"#3b82f6",software:"#10b981",schulen:"#f59e0b",gesamt:"#8b5cf6",positiv:"#22c55e",negativ:"#ef4444",warnung:"#f97316"},os=()=>{var a,n,l,d,c,o,h,m,u,x,g,p,b,j,v,f,N,y,k,w,A,T;const{dojos:F}=r(),[$,R]=e.useState(!0),[G,J]=e.useState(null),[Z,q]=e.useState("month"),[H,Y]=e.useState("alle"),[Q,X]=e.useState(null),[ee,se]=e.useState(null),[ae,ne]=e.useState(null),[re,te]=e.useState(null),[ie,le]=e.useState([]);e.useEffect(()=>{de()},[Z]);const de=async()=>{try{R(!0),J(null);const e=F&&F.length>0?F.map(e=>e.id).join(","):"2,3",[s,a,n,r,l]=await Promise.all([t(`${i.apiBaseUrl}/admin/finance`),t(`${i.apiBaseUrl}/admin/statistics`),t(`${i.apiBaseUrl}/admin/contracts`),t(`${i.apiBaseUrl}/finanzcockpit/stats?period=${Z}&dojo_ids=${e}`),t(`${i.apiBaseUrl}/finanzcockpit/timeline?months=12&dojo_ids=${e}`)]);if(s.ok){const e=await s.json();X(e.success?e.finance:e)}if(a.ok){const e=await a.json();se(e.success?e.statistics:e)}if(n.ok){const e=await n.json();ne(e.success?e.contracts:e)}if(r.ok){const e=await r.json();te(e.success?e.data:e)}if(l.ok){const e=await l.json();if(e.success&&e.data){const s=ce(e.data);le(s)}}R(!1)}catch(e){console.error("Fehler beim Laden der Finanzdaten:",e),J(e.message),R(!1)}},ce=e=>{if(!e||e.length<3)return e;const s=e.length;let a=0,n=0,r=0,t=0;e.forEach((e,s)=>{const i=e.umsatz||0;a+=s,n+=i,r+=s*i,t+=s*s});const i=s*t-a*a;if(0===i)return e;const l=(s*r-a*n)/i,d=(n-l*a)/s,c=e.map((e,s)=>({...e,trend:Math.max(0,l*s+d)})),o=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];for(let h=1;h<=6;h++){const e=new Date;e.setMonth(e.getMonth()+h);const a=o[e.getMonth()]+" "+e.getFullYear().toString().slice(-2),n=Math.max(0,l*(s+h-1)+d);c.push({label:a,umsatz:null,prognose:n,prognoseMin:.85*n,prognoseMax:1.15*n,isPrognose:!0})}return c},oe=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(e||0),he=e=>`${e>=0?"+":""}${(e||0).toFixed(1)}%`,me=e=>new Intl.NumberFormat("de-DE").format(e||0),ue=e.useMemo(()=>{var e,s,a,n,r,t,i,l,d,c,o,h,m,u;if(!Q&&!re)return null;const x=(null==(s=null==(e=null==Q?void 0:Q.verband)?void 0:e.einnahmen)?void 0:s.jahresbeitrag_erwartet)||0,g=x/12,p=(null==(n=null==(a=null==Q?void 0:Q.verband)?void 0:a.einnahmen)?void 0:n.bezahlt)||0,b=(null==(r=null==Q?void 0:Q.subscriptionRevenue)?void 0:r.mrr)||0,j=(null==re?void 0:re.gesamteinnahmen)||0,v=g+b+j,f=v-((null==re?void 0:re.gesamteAusgaben)||0),N=((null==(i=null==(t=null==Q?void 0:Q.verband)?void 0:t.einnahmen)?void 0:i.offen)||0)+((null==re?void 0:re.offeneRechnungenBetrag)||0),y=(null==re?void 0:re.offeneRechnungen)||0;return{gesamt:{value:v,trend:(null==re?void 0:re.einnahmenTrend)||0},verband:{value:g,jahresbeitrag:x,bezahlt:p,mitglieder:(null==(d=null==(l=null==Q?void 0:Q.verband)?void 0:l.mitglieder)?void 0:d.aktiv)||0,dojos:(null==(o=null==(c=null==Q?void 0:Q.verband)?void 0:c.mitglieder)?void 0:o.dojos)||0,einzelpersonen:(null==(m=null==(h=null==Q?void 0:Q.verband)?void 0:h.mitglieder)?void 0:m.einzelpersonen)||0},software:{value:b,arr:(null==(u=null==Q?void 0:Q.subscriptionRevenue)?void 0:u.arr)||0},schulen:{value:j,trend:(null==re?void 0:re.einnahmenTrend)||0},cashflow:{value:f,percent:v>0?f/v*100:0},offenePosten:{value:N,count:y}}},[Q,re]),xe=e.useMemo(()=>ue?[{name:"Verband",value:ue.verband.value,color:cs.verband},{name:"Software",value:ue.software.value,color:cs.software},{name:"Schulen",value:ue.schulen.value,color:cs.schulen}].filter(e=>e.value>0):[],[ue]);e.useMemo(()=>{if(!ie||ie.length<2)return[];ie.find(e=>!e.isPrognose&&null!==e.umsatz);const e=ie.length>1?ie[ie.length-8]:null;return[{name:"Aktuell",verband:0,software:(null==ue?void 0:ue.software.value)||0,schulen:(null==ue?void 0:ue.schulen.value)||0},{name:"Vormonat",verband:0,software:.95*((null==ue?void 0:ue.software.value)||0),schulen:(null==e?void 0:e.umsatz)||0}]},[ie,ue]);const ge=e.useMemo(()=>{if(!ue)return null;const e=12*ue.gesamt.value*(1+(ue.gesamt.trend||0)/100);return{konservativ:.9*e,realistisch:e,optimistisch:1.15*e}},[ue]),pe=e.useMemo(()=>{var e;const s=[];return(null==re?void 0:re.ueberfaelligeRechnungen)>0&&s.push({type:"warning",icon:B,text:`${re.ueberfaelligeRechnungen} Rechnungen überfällig (${oe(re.offeneRechnungenBetrag)})`}),(null==(e=null==ae?void 0:ae.renewals)?void 0:e.next30Days)>0&&s.push({type:"info",icon:D,text:`${ae.renewals.next30Days} Verträge laufen in 30 Tagen aus`}),(null==ue?void 0:ue.cashflow.value)<0&&s.push({type:"error",icon:I,text:`Negativer Cashflow: ${oe(ue.cashflow.value)}`}),(null==ue?void 0:ue.gesamt.trend)>10&&s.push({type:"success",icon:C,text:`Überdurchschnittliches Wachstum: ${he(ue.gesamt.trend)}`}),s},[re,ae,ue]);return $?s.jsx("div",{className:"saf",children:s.jsxs("div",{className:"saf-card saf__loading",children:[s.jsx("div",{className:"saf__spinner"}),s.jsx("p",{children:"Finanzdaten werden geladen..."})]})}):G?s.jsx("div",{className:"saf",children:s.jsxs("div",{className:"saf-card saf__error",children:[s.jsx(M,{size:48}),s.jsx("h3",{children:"Fehler beim Laden"}),s.jsx("p",{children:G}),s.jsx("button",{onClick:de,children:"Erneut versuchen"})]})}):s.jsxs("div",{className:"saf",children:[s.jsx("header",{className:"saf-card saf__header",children:s.jsxs("div",{className:"saf__header-top",children:[s.jsxs("div",{className:"saf__headline",children:[s.jsx("span",{className:"saf__eyebrow",children:"TDA Int'l Org"}),s.jsx("h1",{className:"saf__title",children:"Finanzübersicht"}),s.jsx("p",{className:"saf__subtitle",children:"Alle Geschäftsbereiche auf einen Blick - Verband, Software & Schulen"})]}),s.jsxs("div",{className:"saf__controls",children:[s.jsx("div",{className:"saf__bereich-switcher",children:["alle","verband","software","schulen"].map(e=>s.jsxs("button",{className:H===e?"active":"",onClick:()=>Y(e),children:["alle"===e&&s.jsx(L,{size:14}),"verband"===e&&s.jsx(z,{size:14}),"software"===e&&s.jsx(P,{size:14}),"schulen"===e&&s.jsx(V,{size:14}),e.charAt(0).toUpperCase()+e.slice(1)]},e))}),s.jsxs("div",{className:"saf__period-selector",children:[s.jsx("button",{className:"month"===Z?"active":"",onClick:()=>q("month"),children:"Monat"}),s.jsx("button",{className:"quarter"===Z?"active":"",onClick:()=>q("quarter"),children:"Quartal"}),s.jsx("button",{className:"year"===Z?"active":"",onClick:()=>q("year"),children:"Jahr"})]})]})]})}),ue&&s.jsxs("section",{className:`saf__kpi-grid saf__kpi-grid--${H}`,children:["alle"===H&&s.jsxs("div",{className:"saf-card saf__kpi-card saf__kpi-card--gesamt",children:[s.jsx("div",{className:"saf__kpi-icon",children:s.jsx(S,{size:20})}),s.jsxs("div",{className:"saf__kpi-content",children:[s.jsx("span",{className:"saf__kpi-label",children:"Gesamtumsatz"}),s.jsx("span",{className:"saf__kpi-value",children:oe(ue.gesamt.value)}),s.jsxs("span",{className:"saf__kpi-trend "+(ue.gesamt.trend>=0?"positive":"negative"),children:[ue.gesamt.trend>=0?s.jsx(U,{size:14}):s.jsx(K,{size:14}),he(ue.gesamt.trend)]})]})]}),("alle"===H||"verband"===H)&&s.jsxs("div",{className:"saf-card saf__kpi-card saf__kpi-card--verband "+("verband"===H?"saf__kpi-card--expanded":""),children:[s.jsx("div",{className:"saf__kpi-icon",children:s.jsx(z,{size:20})}),s.jsxs("div",{className:"saf__kpi-content",children:[s.jsx("span",{className:"saf__kpi-label",children:"Verband"}),s.jsx("span",{className:"saf__kpi-value",children:oe(ue.verband.value)}),s.jsx("span",{className:"saf__kpi-detail",children:"verband"===H?`${me(ue.verband.mitglieder)} aktive Mitglieder`:"Mitgliedsbeiträge & Events"}),"verband"===H&&s.jsx(s.Fragment,{children:s.jsxs("span",{className:"saf__kpi-detail",children:[me(ue.verband.dojos)," Dojos | ",me(ue.verband.einzelpersonen)," Einzelpersonen"]})})]})]}),("alle"===H||"software"===H)&&s.jsxs("div",{className:"saf-card saf__kpi-card saf__kpi-card--software "+("software"===H?"saf__kpi-card--expanded":""),children:[s.jsx("div",{className:"saf__kpi-icon",children:s.jsx(P,{size:20})}),s.jsxs("div",{className:"saf__kpi-content",children:[s.jsx("span",{className:"saf__kpi-label",children:"Software MRR"}),s.jsx("span",{className:"saf__kpi-value",children:oe(ue.software.value)}),s.jsxs("span",{className:"saf__kpi-detail",children:["ARR: ",oe(ue.software.arr)]}),"software"===H&&s.jsx(s.Fragment,{children:s.jsxs("span",{className:"saf__kpi-detail",children:["Aktive Abos: ",me((null==(n=null==(a=null==Q?void 0:Q.subscriptionRevenue)?void 0:a.breakdown)?void 0:n.reduce((e,s)=>e+(s.anzahl||0),0))||0)]})})]})]}),("alle"===H||"schulen"===H)&&s.jsxs("div",{className:"saf-card saf__kpi-card saf__kpi-card--schulen "+("schulen"===H?"saf__kpi-card--expanded":""),children:[s.jsx("div",{className:"saf__kpi-icon",children:s.jsx(V,{size:20})}),s.jsxs("div",{className:"saf__kpi-content",children:[s.jsx("span",{className:"saf__kpi-label",children:"Schulen"}),s.jsx("span",{className:"saf__kpi-value",children:oe(ue.schulen.value)}),s.jsxs("span",{className:"saf__kpi-trend "+(ue.schulen.trend>=0?"positive":"negative"),children:[ue.schulen.trend>=0?s.jsx(U,{size:14}):s.jsx(K,{size:14}),he(ue.schulen.trend)]}),"schulen"===H&&s.jsx(s.Fragment,{children:s.jsxs("span",{className:"saf__kpi-detail",children:[me((null==re?void 0:re.anzahlVertraege)||0)," aktive Verträge"]})})]})]}),("alle"===H||"schulen"===H)&&s.jsxs("div",{className:"saf-card saf__kpi-card "+(ue.cashflow.value>=0?"saf__kpi-card--positive":"saf__kpi-card--negative"),children:[s.jsx("div",{className:"saf__kpi-icon",children:s.jsx(W,{size:20})}),s.jsxs("div",{className:"saf__kpi-content",children:[s.jsx("span",{className:"saf__kpi-label",children:"Cashflow"}),s.jsx("span",{className:"saf__kpi-value",children:oe(ue.cashflow.value)}),s.jsxs("span",{className:"saf__kpi-detail",children:[he(ue.cashflow.percent)," Marge"]})]})]}),("alle"===H||"schulen"===H||"verband"===H)&&s.jsxs("div",{className:"saf-card saf__kpi-card "+(ue.offenePosten.count>0?"saf__kpi-card--warning":"saf__kpi-card--positive"),children:[s.jsx("div",{className:"saf__kpi-icon",children:s.jsx(E,{size:20})}),s.jsxs("div",{className:"saf__kpi-content",children:[s.jsx("span",{className:"saf__kpi-label",children:"Offene Posten"}),s.jsx("span",{className:"saf__kpi-value",children:oe(ue.offenePosten.value)}),s.jsxs("span",{className:"saf__kpi-detail",children:[ue.offenePosten.count," Rechnungen"]})]})]})]}),s.jsxs("section",{className:"saf__charts-grid "+("alle"!==H?"saf__charts-grid--single":""),children:[s.jsxs("div",{className:"saf-card saf__chart-card "+("alle"!==H?"saf__chart-card--full":"saf__chart-card--wide"),children:[s.jsxs("div",{className:"saf__card-header",children:[s.jsxs("div",{children:[s.jsx("span",{className:"saf__card-eyebrow",children:"alle"===H?"Entwicklung":`${H.charAt(0).toUpperCase()+H.slice(1)} - Entwicklung`}),s.jsxs("h3",{children:["schulen"===H?"Schulen-Umsatz & Prognose":"verband"===H?"Verband - Beiträge & Prognose":"software"===H?"Software - MRR & Prognose":"Umsatz & Prognose"," (12 + 6 Monate)"]})]}),s.jsx(C,{size:20})]}),s.jsx(De,{width:"100%",height:300,children:s.jsxs(Be,{data:ie,children:[s.jsxs("defs",{children:[s.jsxs("linearGradient",{id:"colorUmsatz",x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"5%",stopColor:cs.schulen,stopOpacity:.3}),s.jsx("stop",{offset:"95%",stopColor:cs.schulen,stopOpacity:0})]}),s.jsxs("linearGradient",{id:"colorPrognose",x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"5%",stopColor:cs.gesamt,stopOpacity:.3}),s.jsx("stop",{offset:"95%",stopColor:cs.gesamt,stopOpacity:0})]})]}),s.jsx(Ee,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),s.jsx(Te,{dataKey:"label",stroke:"rgba(255,255,255,0.6)",fontSize:12}),s.jsx(Fe,{stroke:"rgba(255,255,255,0.6)",fontSize:12,tickFormatter:e=>Math.abs(e)>=1e6?new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:1,notation:"compact"}).format(e||0):oe(e)}),s.jsx($e,{contentStyle:{backgroundColor:"rgba(15, 23, 42, 0.95)",border:"1px solid rgba(255,215,0,0.3)",borderRadius:"8px",color:"#fff"},formatter:e=>oe(e)}),s.jsx(Ue,{}),s.jsx(Re,{type:"monotone",dataKey:"umsatz",stroke:cs.schulen,fill:"url(#colorUmsatz)",strokeWidth:2,name:"Ist-Umsatz",dot:{fill:cs.schulen,r:3}}),s.jsx(Re,{type:"monotone",dataKey:"prognose",stroke:cs.gesamt,fill:"url(#colorPrognose)",strokeWidth:2,strokeDasharray:"5 5",name:"Prognose",dot:{fill:cs.gesamt,r:3}}),s.jsx(Ke,{type:"monotone",dataKey:"trend",stroke:"#22c55e",strokeWidth:2,strokeDasharray:"3 3",name:"Trend",dot:!1})]})})]}),"alle"===H&&s.jsxs("div",{className:"saf-card saf__chart-card",children:[s.jsxs("div",{className:"saf__card-header",children:[s.jsxs("div",{children:[s.jsx("span",{className:"saf__card-eyebrow",children:"Verteilung"}),s.jsx("h3",{children:"Umsatz nach Bereich"})]}),s.jsx(O,{size:20})]}),s.jsx(De,{width:"100%",height:280,children:s.jsxs(Le,{children:[s.jsx(Pe,{data:xe,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:3,dataKey:"value",label:({name:e,percent:s})=>`${e}: ${(100*s).toFixed(0)}%`,labelLine:!1,children:xe.map((e,a)=>s.jsx(Ve,{fill:e.color},`cell-${a}`))}),s.jsx($e,{contentStyle:{backgroundColor:"rgba(15, 23, 42, 0.95)",border:"1px solid rgba(255,215,0,0.3)",borderRadius:"8px",color:"#fff"},formatter:e=>oe(e)})]})}),s.jsx("div",{className:"saf__pie-legend",children:xe.map(e=>s.jsxs("div",{className:"saf__pie-legend-item",children:[s.jsx("span",{className:"saf__pie-dot",style:{backgroundColor:e.color}}),s.jsx("span",{children:e.name}),s.jsx("span",{className:"saf__pie-value",children:oe(e.value)})]},e.name))})]})]}),ge&&s.jsx("section",{className:"saf__prognose-section",children:s.jsxs("div",{className:"saf-card",children:[s.jsxs("div",{className:"saf__card-header",children:[s.jsxs("div",{children:[s.jsx("span",{className:"saf__card-eyebrow",children:"Prognose"}),s.jsxs("h3",{children:["Jahresprognose ",(new Date).getFullYear()]})]}),s.jsx(_,{size:20})]}),s.jsxs("div",{className:"saf__szenarien-grid",children:[s.jsxs("div",{className:"saf__szenario saf__szenario--konservativ",children:[s.jsx("span",{className:"saf__szenario-label",children:"Konservativ"}),s.jsx("span",{className:"saf__szenario-value",children:oe(ge.konservativ)}),s.jsx("span",{className:"saf__szenario-detail",children:"-10% vom Trend"})]}),s.jsxs("div",{className:"saf__szenario saf__szenario--realistisch",children:[s.jsx("span",{className:"saf__szenario-label",children:"Realistisch"}),s.jsx("span",{className:"saf__szenario-value",children:oe(ge.realistisch)}),s.jsx("span",{className:"saf__szenario-detail",children:"Basierend auf Trend"})]}),s.jsxs("div",{className:"saf__szenario saf__szenario--optimistisch",children:[s.jsx("span",{className:"saf__szenario-label",children:"Optimistisch"}),s.jsx("span",{className:"saf__szenario-value",children:oe(ge.optimistisch)}),s.jsx("span",{className:"saf__szenario-detail",children:"+15% vom Trend"})]})]})]})}),s.jsxs("section",{className:`saf__details-grid saf__details-grid--${H}`,children:[("alle"===H||"verband"===H)&&s.jsxs("div",{className:"saf-card saf__detail-card",children:[s.jsxs("div",{className:"saf__detail-header",children:[s.jsx(z,{size:20,style:{color:cs.verband}}),s.jsxs("div",{children:[s.jsx("h3",{children:"Verband"}),s.jsx("p",{children:"TDA International"})]})]}),s.jsxs("div",{className:"saf__detail-list",children:[s.jsxs("div",{className:"saf__detail-row",children:[s.jsx("span",{children:"Aktive Mitglieder"}),s.jsx("span",{children:me((null==(d=null==(l=null==Q?void 0:Q.verband)?void 0:l.mitglieder)?void 0:d.aktiv)||0)})]}),null==(o=null==(c=null==Q?void 0:Q.verband)?void 0:c.breakdown)?void 0:o.map(e=>s.jsxs("div",{className:"saf__detail-row saf__detail-row--sub",children:[s.jsx("span",{children:"dojo"===e.typ?"Dojos":"Einzelpersonen"}),s.jsxs("span",{children:[me(e.anzahl)," (",oe(e.durchschnitt),"/Jahr)"]})]},e.typ)),s.jsxs("div",{className:"saf__detail-row",children:[s.jsx("span",{children:"Jahresbeiträge (erwartet)"}),s.jsx("span",{children:oe((null==(m=null==(h=null==Q?void 0:Q.verband)?void 0:h.einnahmen)?void 0:m.jahresbeitrag_erwartet)||0)})]}),s.jsxs("div",{className:"saf__detail-row",children:[s.jsx("span",{children:"Bezahlt"}),s.jsx("span",{style:{color:cs.positiv},children:oe((null==(x=null==(u=null==Q?void 0:Q.verband)?void 0:u.einnahmen)?void 0:x.bezahlt)||0)})]}),s.jsxs("div",{className:"saf__detail-row",children:[s.jsx("span",{children:"Offen"}),s.jsx("span",{style:{color:((null==(p=null==(g=null==Q?void 0:Q.verband)?void 0:g.einnahmen)?void 0:p.offen)||0)>0?cs.warnung:cs.positiv},children:oe((null==(j=null==(b=null==Q?void 0:Q.verband)?void 0:b.einnahmen)?void 0:j.offen)||0)})]}),s.jsxs("div",{className:"saf__detail-row saf__detail-row--total",children:[s.jsx("span",{children:"Monatlich (anteilig)"}),s.jsx("span",{children:oe(((null==(f=null==(v=null==Q?void 0:Q.verband)?void 0:v.einnahmen)?void 0:f.jahresbeitrag_erwartet)||0)/12)})]})]})]}),("alle"===H||"software"===H)&&s.jsxs("div",{className:"saf-card saf__detail-card",children:[s.jsxs("div",{className:"saf__detail-header",children:[s.jsx(P,{size:20,style:{color:cs.software}}),s.jsxs("div",{children:[s.jsx("h3",{children:"Software"}),s.jsx("p",{children:"SaaS Subscriptions"})]})]}),s.jsxs("div",{className:"saf__detail-list",children:[s.jsxs("div",{className:"saf__detail-row",children:[s.jsx("span",{children:"MRR (Monthly)"}),s.jsx("span",{children:oe((null==(N=null==Q?void 0:Q.subscriptionRevenue)?void 0:N.mrr)||0)})]}),s.jsxs("div",{className:"saf__detail-row",children:[s.jsx("span",{children:"ARR (Annual)"}),s.jsx("span",{children:oe((null==(y=null==Q?void 0:Q.subscriptionRevenue)?void 0:y.arr)||0)})]}),s.jsxs("div",{className:"saf__detail-row",children:[s.jsx("span",{children:"Aktive Abos"}),s.jsx("span",{children:me((null==(w=null==(k=null==Q?void 0:Q.subscriptionRevenue)?void 0:k.breakdown)?void 0:w.reduce((e,s)=>e+(s.anzahl||0),0))||0)})]}),null==(T=null==(A=null==Q?void 0:Q.subscriptionRevenue)?void 0:A.breakdown)?void 0:T.map(e=>s.jsxs("div",{className:"saf__detail-row saf__detail-row--sub",children:[s.jsxs("span",{children:[e.plan," (",e.interval||"monatlich",")"]}),s.jsxs("span",{children:[e.anzahl,"x à ",oe(e.preis),"/Mo"]})]},e.plan))]})]}),("alle"===H||"schulen"===H)&&s.jsxs("div",{className:"saf-card saf__detail-card",children:[s.jsxs("div",{className:"saf__detail-header",children:[s.jsx(V,{size:20,style:{color:cs.schulen}}),s.jsxs("div",{children:[s.jsx("h3",{children:"Kampfsportschulen"}),s.jsx("p",{children:"KSS & TDA"})]})]}),s.jsxs("div",{className:"saf__detail-list",children:[s.jsxs("div",{className:"saf__detail-row",children:[s.jsx("span",{children:"Monatliche Einnahmen"}),s.jsx("span",{children:oe((null==re?void 0:re.monatlicheEinnahmen)||0)})]}),s.jsxs("div",{className:"saf__detail-row",children:[s.jsx("span",{children:"Verkäufe"}),s.jsx("span",{children:oe((null==re?void 0:re.verkaeufeEinnahmen)||0)})]}),s.jsxs("div",{className:"saf__detail-row",children:[s.jsx("span",{children:"Aktive Verträge"}),s.jsx("span",{children:me((null==re?void 0:re.anzahlVertraege)||0)})]}),s.jsxs("div",{className:"saf__detail-row",children:[s.jsx("span",{children:"Ausgaben"}),s.jsx("span",{style:{color:cs.negativ},children:oe((null==re?void 0:re.gesamteAusgaben)||0)})]}),s.jsxs("div",{className:"saf__detail-row saf__detail-row--total",children:[s.jsx("span",{children:"Gesamt"}),s.jsx("span",{children:oe((null==re?void 0:re.gesamteinnahmen)||0)})]})]})]})]}),pe.length>0&&s.jsx("section",{className:"saf__alerts-section",children:s.jsxs("div",{className:"saf-card",children:[s.jsxs("div",{className:"saf__card-header",children:[s.jsxs("div",{children:[s.jsx("span",{className:"saf__card-eyebrow",children:"Insights"}),s.jsx("h3",{children:"Warnungen & Hinweise"})]}),s.jsx(M,{size:20})]}),s.jsx("div",{className:"saf__alerts-list",children:pe.map((e,a)=>{const n=e.icon;return s.jsxs("div",{className:`saf__alert saf__alert--${e.type}`,children:[s.jsx(n,{size:18}),s.jsx("span",{children:e.text})]},a)})})]})})]})},hs=({token:a})=>{const[n,r]=e.useState("uebersicht"),t=[{id:"uebersicht",label:"Übersicht",icon:G},{id:"lastschrift",label:"Lastschrift",icon:J},{id:"fehlende-mandate",label:"Fehlende Mandate",icon:M}];return s.jsxs("div",{className:"finanzen-tab",children:[s.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1.5rem",borderBottom:"1px solid var(--border-default)",paddingBottom:"1rem"},children:t.map(e=>{const a=e.icon;return s.jsxs("button",{onClick:()=>r(e.id),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.25rem",background:n===e.id?"var(--primary)":"var(--bg-secondary)",color:n===e.id?"#000":"var(--text-primary)",border:n===e.id?"none":"1px solid var(--border-default)",borderRadius:"8px",fontWeight:n===e.id?"600":"400",cursor:"pointer",transition:"all 0.2s ease"},children:[s.jsx(a,{size:18}),e.label]},e.id)})}),"uebersicht"===n&&s.jsx(os,{}),"lastschrift"===n&&s.jsx(us,{token:a}),"fehlende-mandate"===n&&s.jsx(ms,{token:a})]})},ms=({token:a})=>{const[r,t]=e.useState(!0),[i,l]=e.useState([]),[d,c]=e.useState([]);e.useEffect(()=>{o()},[]);const o=async()=>{var e,s;t(!0);try{const[r,t]=await Promise.all([n.get("/lastschriftlauf/missing-mandates?dojo_id=2",{headers:{Authorization:`Bearer ${a}`}}),n.get("/admin/sepa/dojos-without-mandate",{headers:{Authorization:`Bearer ${a}`}})]);l((null==(e=r.data)?void 0:e.members)||[]),c((null==(s=t.data)?void 0:s.dojos)||[])}catch(r){console.error("Fehler beim Laden:",r)}finally{t(!1)}};if(r)return s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"3rem"},children:[s.jsx(H,{size:32,className:"spin"}),s.jsx("span",{style:{marginLeft:"1rem",color:"var(--text-secondary)"},children:"Lade fehlende Mandate..."})]});const h=i.length+d.length;return s.jsxs("div",{children:[s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsxs("h2",{style:{margin:0,color:"#fbbf24",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx(M,{size:24})," Fehlende SEPA-Mandate"]}),s.jsx("p",{style:{margin:"0.5rem 0 0",color:"var(--text-secondary)"},children:"Mitglieder und Dojos ohne aktives SEPA-Mandat"})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"1rem",marginBottom:"1.5rem"},children:[s.jsx("div",{style:{background:"var(--bg-secondary)",padding:"1.25rem",borderRadius:"12px",border:"1px solid var(--border-default)"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[s.jsx("div",{style:{background:"rgba(251,191,36,0.2)",padding:"0.75rem",borderRadius:"8px"},children:s.jsx(M,{size:20,color:"#fbbf24"})}),s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Gesamt fehlend"}),s.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#fbbf24"},children:h})]})]})}),s.jsx("div",{style:{background:"var(--bg-secondary)",padding:"1.25rem",borderRadius:"12px",border:"1px solid var(--border-default)"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[s.jsx("div",{style:{background:"rgba(16,185,129,0.2)",padding:"0.75rem",borderRadius:"8px"},children:s.jsx(z,{size:20,color:"#10b981"})}),s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Mitglieder"}),s.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#10b981"},children:i.length})]})]})}),s.jsx("div",{style:{background:"var(--bg-secondary)",padding:"1.25rem",borderRadius:"12px",border:"1px solid var(--border-default)"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[s.jsx("div",{style:{background:"rgba(59,130,246,0.2)",padding:"0.75rem",borderRadius:"8px"},children:s.jsx(Z,{size:20,color:"#3b82f6"})}),s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Dojos"}),s.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#3b82f6"},children:d.length})]})]})})]}),s.jsx("div",{style:{marginBottom:"1.5rem"},children:s.jsxs("button",{onClick:o,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",background:"var(--bg-secondary)",border:"1px solid var(--border-default)",borderRadius:"6px",color:"var(--text-primary)",cursor:"pointer"},children:[s.jsx(Q,{size:16})," Aktualisieren"]})}),0===h?s.jsxs("div",{style:{textAlign:"center",padding:"3rem",background:"rgba(16,185,129,0.1)",border:"1px solid rgba(16,185,129,0.3)",borderRadius:"12px"},children:[s.jsx(A,{size:48,color:"#10b981",style:{marginBottom:"1rem"}}),s.jsx("p",{style:{color:"#10b981",fontSize:"1.1rem",fontWeight:"600"},children:"Alle Mandate vorhanden!"}),s.jsx("p",{style:{color:"var(--text-secondary)"},children:"Es gibt keine fehlenden SEPA-Mandate."})]}):s.jsxs(s.Fragment,{children:[i.length>0&&s.jsxs("div",{style:{marginBottom:"2rem"},children:[s.jsxs("h3",{style:{marginBottom:"1rem",color:"#10b981",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx(z,{size:20})," Mitglieder ohne SEPA-Mandat (",i.length,")"]}),s.jsx("div",{style:{background:"var(--bg-secondary)",borderRadius:"12px",border:"1px solid var(--border-default)",overflow:"hidden"},children:s.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[s.jsx("thead",{children:s.jsxs("tr",{style:{borderBottom:"1px solid var(--border-default)"},children:[s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"Name"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"E-Mail"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"Telefon"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"center",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"Verträge"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"center",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"Aktion"})]})}),s.jsx("tbody",{children:i.map((e,a)=>s.jsxs("tr",{style:{borderBottom:a<i.length-1?"1px solid var(--border-default)":"none"},children:[s.jsxs("td",{style:{padding:"0.75rem"},children:[s.jsxs("strong",{children:[e.vorname," ",e.nachname]}),s.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["ID: ",e.mitglied_id]})]}),s.jsx("td",{style:{padding:"0.75rem",color:"var(--text-secondary)"},children:e.email||"-"}),s.jsx("td",{style:{padding:"0.75rem",color:"var(--text-secondary)"},children:e.telefon||"-"}),s.jsxs("td",{style:{padding:"0.75rem",textAlign:"center"},children:[s.jsxs("span",{style:{padding:"0.25rem 0.5rem",background:"rgba(251,191,36,0.2)",color:"#fbbf24",borderRadius:"4px",fontSize:"0.8rem"},children:[e.anzahl_vertraege," Vertrag",1!==e.anzahl_vertraege?"e":""]}),e.vertrag_namen&&s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:e.vertrag_namen})]}),s.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:s.jsxs("a",{href:`/dashboard/mitglieder/${e.mitglied_id}`,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.35rem 0.75rem",background:"var(--primary)",color:"#000",borderRadius:"6px",fontSize:"0.8rem",fontWeight:"500",textDecoration:"none"},children:[s.jsx(ee,{size:14}),"Details"]})})]},e.mitglied_id))})]})})]}),d.length>0&&s.jsxs("div",{children:[s.jsxs("h3",{style:{marginBottom:"1rem",color:"#3b82f6",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx(Z,{size:20})," Dojos ohne SEPA-Mandat (",d.length,")"]}),s.jsx("div",{style:{background:"var(--bg-secondary)",borderRadius:"12px",border:"1px solid var(--border-default)",overflow:"hidden"},children:s.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[s.jsx("thead",{children:s.jsxs("tr",{style:{borderBottom:"1px solid var(--border-default)"},children:[s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"Dojo"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"Plan"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"right",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"Monatsbeitrag"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"center",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"Zahlungsart"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"center",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"Aktion"})]})}),s.jsx("tbody",{children:d.map((e,a)=>{return s.jsxs("tr",{style:{borderBottom:a<d.length-1?"1px solid var(--border-default)":"none"},children:[s.jsxs("td",{style:{padding:"0.75rem"},children:[s.jsx("strong",{children:e.dojoname}),s.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["ID: ",e.id]})]}),s.jsx("td",{style:{padding:"0.75rem",color:"var(--text-secondary)"},children:e.plan_type||"-"}),s.jsx("td",{style:{padding:"0.75rem",textAlign:"right",color:"var(--primary)",fontWeight:"600"},children:(n=e.monthly_price,new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(n||0))}),s.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:s.jsx("span",{style:{padding:"0.25rem 0.5rem",background:"var(--bg-tertiary)",color:"var(--text-secondary)",borderRadius:"4px",fontSize:"0.8rem"},children:e.zahlungsart||"Nicht festgelegt"})}),s.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:s.jsxs("a",{href:`/dashboard/dojos/${e.id}`,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.35rem 0.75rem",background:"#3b82f6",color:"#fff",borderRadius:"6px",fontSize:"0.8rem",fontWeight:"500",textDecoration:"none"},children:[s.jsx(ee,{size:14}),"Details"]})})]},e.id);var n})})]})})]})]})]})},us=({token:a})=>{const[r,t]=e.useState(!0),[i,l]=e.useState(null),[d,c]=e.useState({count:0,amount:0,items:[]}),[o,h]=e.useState({count:0,amount:0,items:[]}),[m,u]=e.useState({count:0,amount:0,items:[]}),[x,g]=e.useState((new Date).getMonth()+1),[p,b]=e.useState((new Date).getFullYear());e.useEffect(()=>{j()},[x,p]);const j=async()=>{t(!0);try{await Promise.all([v(),f(),N()])}catch(e){console.error("Fehler beim Laden:",e)}finally{t(!1)}},v=async()=>{try{const e=await n.get(`/lastschriftlauf/preview?monat=${x}&jahr=${p}&dojo_id=2`,{headers:{Authorization:`Bearer ${a}`}});e.data&&c({count:e.data.count||0,amount:parseFloat(e.data.total_amount)||0,items:e.data.preview||[]})}catch(e){console.error("Fehler beim Laden Dojo-Mitglieder:",e)}},f=async()=>{try{const e=await n.get("/admin/sepa/mandate",{headers:{Authorization:`Bearer ${a}`}}),s=(e.data.mandate||[]).filter(e=>{var s,a,n,r;return"aktiv"===e.status&&((null==(s=e.plan_type)?void 0:s.toLowerCase().includes("software"))||(null==(a=e.plan_type)?void 0:a.toLowerCase().includes("starter"))||(null==(n=e.plan_type)?void 0:n.toLowerCase().includes("professional"))||(null==(r=e.plan_type)?void 0:r.toLowerCase().includes("enterprise"))||parseFloat(e.monthly_price)>0)});h({count:s.length,amount:s.reduce((e,s)=>e+parseFloat(s.monthly_price||0),0),items:s})}catch(e){console.error("Fehler beim Laden Software-Kunden:",e)}},N=async()=>{try{const e=await n.get("/admin/sepa/mandate",{headers:{Authorization:`Bearer ${a}`}}),s=(e.data.mandate||[]).filter(e=>{var s,a;return"aktiv"===e.status&&((null==(s=e.plan_type)?void 0:s.toLowerCase().includes("verband"))||(null==(a=e.plan_type)?void 0:a.toLowerCase().includes("mitglied")))});u({count:s.length,amount:s.reduce((e,s)=>e+parseFloat(s.monthly_price||0),0),items:s})}catch(e){console.error("Fehler beim Laden Verbandsmitglieder:",e)}},y=[{id:"dojo-mitglieder",title:"Dojo-Mitglieder",subtitle:"Mitglieder von TDA International",icon:z,color:"#10b981",bgColor:"rgba(16, 185, 129, 0.15)",data:d},{id:"software-kunden",title:"Software-Kunden",subtitle:"Dojos mit Software-Abo",icon:Z,color:"#3b82f6",bgColor:"rgba(59, 130, 246, 0.15)",data:o},{id:"verband",title:"Verbandsmitglieder",subtitle:"TDA Verband Mitglieder",icon:L,color:"#8b5cf6",bgColor:"rgba(139, 92, 246, 0.15)",data:m},{id:"gesamt",title:"Gesamt",subtitle:"Alle Lastschriften zusammen",icon:q,color:"#f59e0b",bgColor:"rgba(245, 158, 11, 0.15)",data:{count:d.count+o.count+m.count,amount:d.amount+o.amount+m.amount}}];return r?s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"3rem"},children:[s.jsx(H,{size:32,className:"spin"}),s.jsx("span",{style:{marginLeft:"1rem",color:"var(--text-secondary)"},children:"Lade Lastschrift-Daten..."})]}):i?s.jsx(xs,{category:y.find(e=>e.id===i),token:a,selectedMonth:x,selectedYear:p,setSelectedMonth:g,setSelectedYear:b,onBack:()=>l(null),onRefresh:j,dojoMitgliederData:d,softwareKundenData:o,verbandData:m}):s.jsxs("div",{children:[s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsxs("h2",{style:{margin:0,color:"var(--primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx(J,{size:24})," Lastschrift-Verwaltung"]}),s.jsx("p",{style:{margin:"0.5rem 0 0",color:"var(--text-secondary)"},children:"Wähle eine Kategorie zum Einziehen"})]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"var(--bg-secondary)",borderRadius:"12px",border:"1px solid var(--border-default)",alignItems:"center"},children:[s.jsx(Y,{size:20,color:"var(--text-secondary)"}),s.jsx("span",{style:{color:"var(--text-secondary)"},children:"Abrechnungsmonat:"}),s.jsx("select",{value:x,onChange:e=>g(parseInt(e.target.value)),style:{padding:"0.5rem 0.75rem",background:"var(--bg-primary)",border:"1px solid var(--border-default)",borderRadius:"6px",color:"var(--text-primary)"},children:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"].map((e,a)=>s.jsx("option",{value:a+1,children:e},a+1))}),s.jsxs("select",{value:p,onChange:e=>b(parseInt(e.target.value)),style:{padding:"0.5rem 0.75rem",background:"var(--bg-primary)",border:"1px solid var(--border-default)",borderRadius:"6px",color:"var(--text-primary)"},children:[s.jsx("option",{value:2024,children:"2024"}),s.jsx("option",{value:2025,children:"2025"}),s.jsx("option",{value:2026,children:"2026"})]}),s.jsxs("button",{onClick:j,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",background:"var(--bg-tertiary)",border:"1px solid var(--border-default)",borderRadius:"6px",color:"var(--text-primary)",cursor:"pointer",marginLeft:"auto"},children:[s.jsx(Q,{size:16})," Aktualisieren"]})]}),s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1.5rem"},children:y.map(e=>{const a=e.icon;return s.jsxs("div",{onClick:()=>l(e.id),style:{background:"var(--bg-secondary)",border:"1px solid var(--border-default)",borderRadius:"16px",padding:"1.5rem",cursor:"pointer",transition:"all 0.2s ease",position:"relative",overflow:"hidden"},onMouseEnter:s=>{s.currentTarget.style.borderColor=e.color,s.currentTarget.style.transform="translateY(-2px)",s.currentTarget.style.boxShadow=`0 8px 24px ${e.bgColor}`},onMouseLeave:e=>{e.currentTarget.style.borderColor="var(--border-default)",e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:[s.jsx("div",{style:{position:"absolute",top:0,right:0,width:"120px",height:"120px",background:e.bgColor,borderRadius:"0 0 0 100%",opacity:.5}}),s.jsxs("div",{style:{position:"relative",zIndex:1},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1rem"},children:[s.jsx("div",{style:{background:e.bgColor,padding:"0.75rem",borderRadius:"12px"},children:s.jsx(a,{size:28,color:e.color})}),s.jsxs("div",{children:[s.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"var(--text-primary)"},children:e.title}),s.jsx("p",{style:{margin:0,fontSize:"0.85rem",color:"var(--text-secondary)"},children:e.subtitle})]})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"},children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"0.25rem"},children:"dojo-mitglieder"===e.id?"Mitglieder":"gesamt"===e.id?"Einträge":"Dojos"}),s.jsx("div",{style:{fontSize:"2rem",fontWeight:"700",color:e.color},children:e.data.count})]}),s.jsxs("div",{style:{textAlign:"right"},children:[s.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"0.25rem"},children:"Fälliger Betrag"}),s.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"var(--primary)"},children:(n=e.data.amount,new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(n||0))})]})]}),s.jsxs("button",{style:{width:"100%",marginTop:"1.25rem",padding:"0.75rem",background:e.color,color:"#fff",border:"none",borderRadius:"8px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[s.jsx(X,{size:18}),"Einziehen"]})]})]},e.id);var n})})]})},xs=({category:a,token:r,selectedMonth:t,selectedYear:i,setSelectedMonth:l,setSelectedYear:d,onBack:c,onRefresh:o,dojoMitgliederData:h,softwareKundenData:m,verbandData:u})=>{const[x,g]=e.useState(!1),[p,b]=e.useState(null),[j,v]=e.useState(new Set),[f,N]=e.useState("xml"),[y,k]=e.useState([]),[_,z]=e.useState(null),[w,S]=e.useState(null);e.useEffect(()=>{C(),D()},[]);const C=async()=>{var e;try{const s=await n.get("/lastschriftlauf/banken?dojo_id=2",{headers:{Authorization:`Bearer ${r}`}});if(null==(e=s.data)?void 0:e.banken){k(s.data.banken);const e=s.data.banken.find(e=>e.ist_standard)||s.data.banken[0];e&&z(e.id)}}catch(s){console.error("Fehler beim Laden der Banken:",s)}},D=async()=>{try{const e=await n.get("/lastschriftlauf/stripe/status?dojo_id=2",{headers:{Authorization:`Bearer ${r}`}});S(e.data)}catch(e){console.error("Fehler beim Laden des Stripe-Status:",e)}},B=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e||0),T=()=>{switch(a.id){case"dojo-mitglieder":return h.items;case"software-kunden":return m.items;case"verband":return u.items;case"gesamt":return[...h.items.map(e=>({...e,_category:"dojo-mitglieder"})),...m.items.map(e=>({...e,_category:"software-kunden"})),...u.items.map(e=>({...e,_category:"verband"}))];default:return[]}},F=T(),$=a.icon;return s.jsxs("div",{children:[s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsxs("button",{onClick:c,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",background:"var(--bg-secondary)",border:"1px solid var(--border-default)",borderRadius:"8px",color:"var(--text-primary)",cursor:"pointer",marginBottom:"1rem"},children:[s.jsx(se,{size:18}),"Zurück zur Übersicht"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[s.jsx("div",{style:{background:a.bgColor,padding:"0.75rem",borderRadius:"12px"},children:s.jsx($,{size:28,color:a.color})}),s.jsxs("div",{children:[s.jsx("h2",{style:{margin:0,color:a.color},children:a.title}),s.jsx("p",{style:{margin:"0.25rem 0 0",color:"var(--text-secondary)"},children:a.subtitle})]})]})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"1rem",marginBottom:"1.5rem"},children:[s.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"1.25rem",borderRadius:"12px",border:"1px solid var(--border-default)"},children:[s.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Einträge"}),s.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:a.color},children:a.data.count})]}),s.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"1.25rem",borderRadius:"12px",border:"1px solid var(--border-default)"},children:[s.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Gesamtbetrag"}),s.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"var(--primary)"},children:B(a.data.amount)})]}),s.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"1.25rem",borderRadius:"12px",border:"1px solid var(--border-default)"},children:[s.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Abrechnungsmonat"}),s.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#fbbf24"},children:[(I=t,["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"][I-1])," ",i]})]})]}),s.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"12px",border:"1px solid var(--border-default)",padding:"1.25rem",marginBottom:"1.5rem"},children:[s.jsx("h3",{style:{margin:"0 0 1rem",fontSize:"1rem"},children:"Aktionen"}),s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"flex-end"},children:[s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Monat"}),s.jsx("select",{value:t,onChange:e=>l(parseInt(e.target.value)),style:{padding:"0.5rem 0.75rem",background:"var(--bg-primary)",border:"1px solid var(--border-default)",borderRadius:"6px",color:"var(--text-primary)"},children:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"].map((e,a)=>s.jsx("option",{value:a+1,children:e},a+1))})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Jahr"}),s.jsxs("select",{value:i,onChange:e=>d(parseInt(e.target.value)),style:{padding:"0.5rem 0.75rem",background:"var(--bg-primary)",border:"1px solid var(--border-default)",borderRadius:"6px",color:"var(--text-primary)"},children:[s.jsx("option",{value:2024,children:"2024"}),s.jsx("option",{value:2025,children:"2025"}),s.jsx("option",{value:2026,children:"2026"})]})]}),("dojo-mitglieder"===a.id||"gesamt"===a.id)&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Format"}),s.jsxs("select",{value:f,onChange:e=>N(e.target.value),style:{padding:"0.5rem 0.75rem",background:"var(--bg-primary)",border:"1px solid var(--border-default)",borderRadius:"6px",color:"var(--text-primary)"},children:[s.jsx("option",{value:"xml",children:"SEPA XML"}),s.jsx("option",{value:"csv",children:"CSV"})]})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Einzugsbank"}),s.jsx("select",{value:_||"",onChange:e=>z(parseInt(e.target.value)),style:{padding:"0.5rem 0.75rem",background:"var(--bg-primary)",border:"1px solid var(--border-default)",borderRadius:"6px",color:"var(--text-primary)",minWidth:"180px"},children:0===y.length?s.jsx("option",{value:"",children:"Keine Bankkonten"}):y.map(e=>s.jsxs("option",{value:e.id,children:[e.bank_name," ",e.ist_standard?"★":""]},e.id))})]}),s.jsxs("button",{onClick:()=>{if(!_)return void alert("Bitte wähle ein Bankkonto für den Einzug aus");const e="xml"===f?`/lastschriftlauf/xml?monat=${t}&jahr=${i}&bank_id=${_}&dojo_id=2`:`/lastschriftlauf?monat=${t}&jahr=${i}&bank_id=${_}&dojo_id=2`;window.open(e,"_blank")},disabled:x||0===F.length,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",background:"rgba(59,130,246,0.2)",border:"1px solid #3b82f6",borderRadius:"6px",color:"#3b82f6",cursor:"pointer"},children:[s.jsx(ae,{size:16})," Export"]}),(null==w?void 0:w.stripe_configured)&&s.jsxs("button",{onClick:async()=>{var e,s;const l=T();if(0!==l.length){if(window.confirm(`Stripe SEPA Lastschrift für ${l.length} Einträge ausführen?\n\nGesamtbetrag: ${B(a.data.amount)}`)){g(!0),b(null);try{const e=await n.post("/lastschriftlauf/stripe/execute",{dojo_id:2,monat:t,jahr:i,mitglieder:l.filter(e=>e.mitglied_id).map(e=>({mitglied_id:e.mitglied_id,name:e.name,betrag:e.betrag,beitraege:e.beitraege,offene_monate:e.offene_monate}))},{headers:{Authorization:`Bearer ${r}`}});e.data.success?(b({status:"success",message:`Erfolgreich: ${e.data.succeeded}, In Verarbeitung: ${e.data.processing||0}, Fehlgeschlagen: ${e.data.failed}`}),o()):b({status:"error",message:e.data.error})}catch(d){b({status:"error",message:(null==(s=null==(e=d.response)?void 0:e.data)?void 0:s.error)||d.message})}finally{g(!1)}}}else alert("Keine Einträge zum Einziehen vorhanden")},disabled:x||0===F.length,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",background:a.color,border:"none",borderRadius:"6px",color:"#fff",fontWeight:"600",cursor:"pointer"},children:[x?s.jsx(H,{size:16}):s.jsx(X,{size:16}),"Mit Stripe einziehen"]})]}),("software-kunden"===a.id||"verband"===a.id)&&s.jsxs("button",{onClick:async()=>{var e,s;const t=T();if(0===t.length)return void alert("Keine Einträge für den Batch vorhanden");const i=new Date;i.setDate(i.getDate()+7);const l=i.toISOString().split("T")[0];if(window.confirm(`SEPA-Lastschrift-Batch erstellen?\n\nAusführungsdatum: ${i.toLocaleDateString("de-DE")}\nAnzahl: ${t.length}\nBetrag: ${B(a.data.amount)}`)){g(!0);try{const e=await n.post("/admin/sepa/batch/create",{ausfuehrungsdatum:l},{headers:{Authorization:`Bearer ${r}`}});b({status:"success",message:`Batch erstellt: ${e.data.anzahl} Lastschriften, Gesamt: ${B(e.data.gesamtbetrag)}`}),o()}catch(d){b({status:"error",message:(null==(s=null==(e=d.response)?void 0:e.data)?void 0:s.error)||d.message})}finally{g(!1)}}},disabled:x||0===F.length,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",background:a.color,border:"none",borderRadius:"6px",color:"#fff",fontWeight:"600",cursor:"pointer"},children:[x?s.jsx(H,{size:16}):s.jsx(E,{size:16}),"SEPA-Batch erstellen"]}),s.jsxs("button",{onClick:o,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",background:"var(--bg-tertiary)",border:"1px solid var(--border-default)",borderRadius:"6px",color:"var(--text-primary)",cursor:"pointer",marginLeft:"auto"},children:[s.jsx(Q,{size:16})," Aktualisieren"]})]}),p&&s.jsx("div",{style:{marginTop:"1rem",padding:"0.75rem",borderRadius:"8px",background:"success"===p.status?"rgba(16,185,129,0.1)":"rgba(239,68,68,0.1)",border:"1px solid "+("success"===p.status?"rgba(16,185,129,0.3)":"rgba(239,68,68,0.3)")},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:["success"===p.status?s.jsx(A,{size:16,color:"#10b981"}):s.jsx(R,{size:16,color:"#ef4444"}),s.jsx("span",{children:p.message}),s.jsx("button",{onClick:()=>b(null),style:{marginLeft:"auto",background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer"},children:"×"})]})})]}),s.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"12px",border:"1px solid var(--border-default)",overflow:"hidden"},children:[s.jsx("div",{style:{padding:"1rem 1.25rem",borderBottom:"1px solid var(--border-default)"},children:s.jsxs("h3",{style:{margin:0},children:["Einträge (",F.length,")"]})}),0===F.length?s.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"var(--text-secondary)"},children:[s.jsx($,{size:48,style:{marginBottom:"1rem",opacity:.5}}),s.jsx("p",{children:"Keine Einträge für diese Kategorie"})]}):s.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[s.jsx("thead",{children:s.jsxs("tr",{style:{borderBottom:"1px solid var(--border-default)"},children:["gesamt"===a.id&&s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"Kategorie"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"dojo-mitglieder"===a.id?"Mitglied":"Dojo"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"IBAN"}),"dojo-mitglieder"!==a.id&&s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"Plan"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"right",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"Betrag"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"center",color:"var(--text-secondary)",fontSize:"0.85rem"},children:"Status"})]})}),s.jsx("tbody",{children:F.map((e,n)=>s.jsxs("tr",{style:{borderBottom:"1px solid var(--border-default)"},children:["gesamt"===a.id&&s.jsx("td",{style:{padding:"0.75rem"},children:s.jsx("span",{style:{padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",background:"dojo-mitglieder"===e._category?"rgba(16,185,129,0.2)":"software-kunden"===e._category?"rgba(59,130,246,0.2)":"rgba(139,92,246,0.2)",color:"dojo-mitglieder"===e._category?"#10b981":"software-kunden"===e._category?"#3b82f6":"#8b5cf6"},children:"dojo-mitglieder"===e._category?"Mitglied":"software-kunden"===e._category?"Software":"Verband"})}),s.jsxs("td",{style:{padding:"0.75rem"},children:[s.jsx("strong",{children:e.name||e.dojoname}),e.mitglied_id&&s.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["ID: ",e.mitglied_id]})]}),s.jsx("td",{style:{padding:"0.75rem",fontFamily:"monospace",fontSize:"0.85rem",color:"var(--text-secondary)"},children:e.iban||"-"}),"dojo-mitglieder"!==a.id&&s.jsx("td",{style:{padding:"0.75rem",color:"var(--text-secondary)"},children:e.plan_type||"-"}),s.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600",color:"var(--primary)"},children:B(e.betrag||e.monthly_price)}),s.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:s.jsx("span",{style:{padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",background:e.mandatsreferenz&&"KEIN MANDAT"!==e.mandatsreferenz||"aktiv"===e.status?"rgba(16,185,129,0.2)":"rgba(239,68,68,0.2)",color:e.mandatsreferenz&&"KEIN MANDAT"!==e.mandatsreferenz||"aktiv"===e.status?"#10b981":"#ef4444"},children:e.mandatsreferenz||e.status||"Bereit"})})]},e.mitglied_id||e.id||n))})]})]})]});var I},gs=({token:a})=>{const{token:r}=l(),t=a||r,[i,d]=e.useState("erstellen"),[c]=e.useState({id:"tda",name:"Tiger & Dragon Association International",adresse:"Ohmstr. 14, 84137 Vilsbiburg",typ:"verband"}),[o,h]=e.useState({verbandsmitglieder:[],softwareNutzer:[],dojoMitglieder:[]}),[m,u]=e.useState([]),[x,g]=e.useState(null),[p,b]=e.useState("dojo_mitglied"),[j,v]=e.useState(""),[f,N]=e.useState(!1),[y,k]=e.useState(null),[_,z]=e.useState(!1),[w,S]=e.useState(""),[C,D]=e.useState(""),[B,E]=e.useState(""),[T,F]=e.useState(""),[$]=e.useState({bank_name:"Sparkasse Niederbayern-Mitte",iban:"DE89370400440532013000",bic:"COBADEFFXXX",kontoinhaber:"Tiger & Dragon Association International"}),R=e=>{if(!e)return"";const s=new Date(e);return s.setDate(s.getDate()+7),s.toISOString().split("T")[0]},[I,M]=e.useState({rechnungsnummer:"Wird geladen...",kundennummer:"",belegdatum:(new Date).toISOString().split("T")[0],leistungsdatum:(new Date).toISOString().split("T")[0],zahlungsfrist:R((new Date).toISOString().split("T")[0]),rabatt_prozent:0,rabatt_auf_betrag:0,skonto_prozent:0,skonto_tage:0}),[L,P]=e.useState([]),[V,U]=e.useState({artikel_id:"",bezeichnung:"",artikelnummer:"",menge:1,einzelpreis:0,ust_prozent:19,ist_rabattfaehig:!1,rabatt_prozent:0}),[K,W]=e.useState(!1),[O,G]=e.useState(!1),[J,q]=e.useState(""),[H,Y]=e.useState([]),Q=()=>n.create({baseURL:"/api",headers:{Authorization:`Bearer ${t}`}});e.useEffect(()=>{t&&X()},[t]),e.useEffect(()=>{if(I.belegdatum&&I.zahlungsfrist){const e=new Date(I.belegdatum),s=new Date(I.zahlungsfrist)-e,a=Math.ceil(s/864e5);a>0&&M(e=>({...e,skonto_tage:a}))}},[I.belegdatum,I.zahlungsfrist]);const X=async()=>{var e;N(!0);try{const[s,a,n,r]=await Promise.all([Q().get("/verband-rechnungen/empfaenger"),Q().get("/verband-rechnungen/nummernkreis"),Q().get("/verband-rechnungen"),Q().get("/artikel?dojo_id=2")]);s.data.success&&h(s.data.empfaenger),a.data.success&&M(e=>({...e,rechnungsnummer:a.data.rechnungsnummer})),n.data.success&&Y(n.data.rechnungen);const t=(null==(e=r.data)?void 0:e.data)||r.data||[];u(Array.isArray(t)?t:[]),k(null)}catch(s){console.error("Fehler beim Laden:",s),k("Fehler beim Laden der Daten")}finally{N(!1)}},se=()=>{let e=[];if("verbandsmitglied"===p?e=o.verbandsmitglieder||[]:"software_nutzer"===p?e=o.softwareNutzer||[]:"dojo_mitglied"===p&&(e=o.dojoMitglieder||[]),!j)return e;const s=j.toLowerCase();return e.filter(e=>{var a,n,r;return(null==(a=e.name)?void 0:a.toLowerCase().includes(s))||(null==(n=e.email)?void 0:n.toLowerCase().includes(s))||(null==(r=e.dojo_name)?void 0:r.toLowerCase().includes(s))})},le=()=>L.reduce((e,s)=>{const a=Number(s.einzelpreis)*Number(s.menge);return e+(a-(s.ist_rabattfaehig?a*Number(s.rabatt_prozent)/100:0))},0),de=()=>{const e=le();if(I.rabatt_prozent>0){return(I.rabatt_auf_betrag||e)*I.rabatt_prozent/100}return 0},ce=()=>le()-de(),oe=()=>{const e=ce();return I.skonto_prozent>0&&I.skonto_tage>0?e*I.skonto_prozent/100:0},he=()=>19*ce()/100,me=()=>ce()+he(),ue=(e,s=0)=>{if(!e)return"";const a=new Date(e);s>0&&a.setDate(a.getDate()+s);return`${String(a.getDate()).padStart(2,"0")}.${String(a.getMonth()+1).padStart(2,"0")}.${a.getFullYear()}`},xe=e=>{var s;if(!$.iban||!$.bic||!$.kontoinhaber||!e||e<=0)return"";const a=`Rechnung ${I.rechnungsnummer||""}`.substring(0,140);return["BCD","002","1","SCT",$.bic.trim(),$.kontoinhaber.trim().substring(0,70),$.iban.replace(/\s/g,"").toUpperCase(),`EUR${Number(e).toFixed(2)}`,"",a,(null==(s=I.rechnungsnummer)?void 0:s.substring(0,35))||"","",""].join("\n")};return f?s.jsx("div",{className:"rechnung-erstellen-container",children:s.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"#ffffff"},children:[s.jsx(ne,{size:32,style:{animation:"spin 1s linear infinite"}}),s.jsx("p",{children:"Lade Daten..."})]})}):s.jsxs("div",{className:"rechnung-erstellen-container",children:[s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"0.5rem",padding:"1rem",background:"rgba(26, 26, 46, 0.95)",borderBottom:"1px solid rgba(255, 215, 0, 0.2)",marginBottom:"1rem"},children:[s.jsxs("button",{onClick:()=>d("erstellen"),style:{padding:"0.6rem 1.5rem",background:"erstellen"===i?"linear-gradient(135deg, #c9a227, #a68519)":"rgba(255, 255, 255, 0.05)",border:"erstellen"===i?"none":"1px solid rgba(255, 215, 0, 0.3)",borderRadius:"8px",color:"erstellen"===i?"#000":"#ffd700",cursor:"pointer",fontWeight:"erstellen"===i?"600":"400",transition:"all 0.3s ease",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx(re,{size:18}),"Rechnung erstellen"]}),s.jsxs("button",{onClick:()=>d("ansehen"),style:{padding:"0.6rem 1.5rem",background:"ansehen"===i?"linear-gradient(135deg, #c9a227, #a68519)":"rgba(255, 255, 255, 0.05)",border:"ansehen"===i?"none":"1px solid rgba(255, 215, 0, 0.3)",borderRadius:"8px",color:"ansehen"===i?"#000":"#ffd700",cursor:"pointer",fontWeight:"ansehen"===i?"600":"400",transition:"all 0.3s ease",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx(ee,{size:18}),"Rechnungen ansehen"]})]}),"ansehen"===i?s.jsxs("div",{style:{padding:"1rem",maxWidth:"1400px",margin:"0 auto"},children:[s.jsxs("div",{style:{background:"rgba(26, 26, 46, 0.95)",borderRadius:"12px",border:"1px solid rgba(255, 215, 0, 0.2)",overflow:"hidden"},children:[s.jsxs("div",{style:{padding:"1rem 1.5rem",borderBottom:"1px solid rgba(255, 215, 0, 0.2)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("h2",{style:{color:"#fff",margin:0,display:"flex",alignItems:"center",gap:"0.75rem"},children:[s.jsx(Z,{size:24,style:{color:"#ffd700"}}),"TDA Rechnungen"]}),s.jsxs("span",{style:{color:"rgba(255,255,255,0.6)",fontSize:"0.9rem"},children:[H.length," Rechnungen"]})]}),0===H.length?s.jsx("div",{style:{padding:"3rem",textAlign:"center",color:"rgba(255,255,255,0.6)"},children:"Keine Rechnungen vorhanden"}):s.jsx("div",{style:{overflowX:"auto"},children:s.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[s.jsx("thead",{children:s.jsxs("tr",{style:{borderBottom:"1px solid rgba(255, 215, 0, 0.2)"},children:[s.jsx("th",{style:{padding:"0.75rem 1rem",textAlign:"left",color:"#ffd700",fontWeight:"600",fontSize:"0.85rem"},children:"Rechnungs-Nr."}),s.jsx("th",{style:{padding:"0.75rem 1rem",textAlign:"left",color:"#ffd700",fontWeight:"600",fontSize:"0.85rem"},children:"Datum"}),s.jsx("th",{style:{padding:"0.75rem 1rem",textAlign:"left",color:"#ffd700",fontWeight:"600",fontSize:"0.85rem"},children:"Empfänger"}),s.jsx("th",{style:{padding:"0.75rem 1rem",textAlign:"right",color:"#ffd700",fontWeight:"600",fontSize:"0.85rem"},children:"Betrag"}),s.jsx("th",{style:{padding:"0.75rem 1rem",textAlign:"center",color:"#ffd700",fontWeight:"600",fontSize:"0.85rem"},children:"Status"}),s.jsx("th",{style:{padding:"0.75rem 1rem",textAlign:"center",color:"#ffd700",fontWeight:"600",fontSize:"0.85rem"},children:"Aktionen"})]})}),s.jsx("tbody",{children:H.map(e=>{const a=(e=>{switch(e){case"bezahlt":return{bg:"rgba(34, 197, 94, 0.2)",border:"rgba(34, 197, 94, 0.5)",text:"#22c55e"};case"offen":return{bg:"rgba(234, 179, 8, 0.2)",border:"rgba(234, 179, 8, 0.5)",text:"#eab308"};case"ueberfaellig":return{bg:"rgba(239, 68, 68, 0.2)",border:"rgba(239, 68, 68, 0.5)",text:"#ef4444"};case"storniert":return{bg:"rgba(107, 114, 128, 0.2)",border:"rgba(107, 114, 128, 0.5)",text:"#6b7280"};default:return{bg:"rgba(255, 255, 255, 0.1)",border:"rgba(255, 255, 255, 0.3)",text:"#fff"}}})(e.status);return s.jsxs("tr",{style:{borderBottom:"1px solid rgba(255, 255, 255, 0.05)"},children:[s.jsx("td",{style:{padding:"0.75rem 1rem",color:"#fff",fontFamily:"monospace"},children:e.rechnungsnummer}),s.jsx("td",{style:{padding:"0.75rem 1rem",color:"rgba(255,255,255,0.8)"},children:e.rechnungsdatum?ue(e.rechnungsdatum):"-"}),s.jsx("td",{style:{padding:"0.75rem 1rem",color:"rgba(255,255,255,0.8)"},children:e.empfaenger_name||"-"}),s.jsxs("td",{style:{padding:"0.75rem 1rem",textAlign:"right",color:"#fff",fontWeight:"500"},children:[Number(e.summe_brutto||0).toFixed(2)," €"]}),s.jsx("td",{style:{padding:"0.75rem 1rem",textAlign:"center"},children:s.jsx("span",{style:{display:"inline-block",padding:"0.25rem 0.75rem",background:a.bg,border:`1px solid ${a.border}`,borderRadius:"12px",color:a.text,fontSize:"0.8rem",fontWeight:"500",textTransform:"capitalize"},children:e.status||"offen"})}),s.jsx("td",{style:{padding:"0.75rem 1rem",textAlign:"center"},children:s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"0.35rem",flexWrap:"wrap"},children:[s.jsx("button",{onClick:()=>{return s=e.rechnung_id,void window.open(`/api/verband-rechnungen/${s}/pdf`,"_blank");var s},title:"Ansehen",style:{padding:"0.4rem",background:"rgba(255, 215, 0, 0.1)",border:"1px solid rgba(255, 215, 0, 0.3)",borderRadius:"6px",color:"#ffd700",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ee,{size:16})}),s.jsx("button",{onClick:()=>{return s=e.rechnung_id,void window.open(`/api/verband-rechnungen/${s}/pdf?print=1`,"_blank");var s},title:"Drucken/PDF",style:{padding:"0.4rem",background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.3)",borderRadius:"6px",color:"#6366f1",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(ae,{size:16})}),"bezahlt"!==e.status&&s.jsx("button",{onClick:()=>(async e=>{try{(await Q().put(`/verband-rechnungen/${e}/status`,{status:"bezahlt",bezahlt_am:(new Date).toISOString().split("T")[0]})).data.success&&(S("Rechnung als bezahlt markiert"),X())}catch(s){console.error("Fehler beim Markieren:",s),k("Fehler beim Markieren als bezahlt")}})(e.rechnung_id),title:"Als bezahlt markieren",style:{padding:"0.4rem",background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",borderRadius:"6px",color:"#22c55e",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(A,{size:16})}),!e.euer_gebucht&&s.jsx("button",{onClick:()=>(async e=>{var s,a;try{const s=await Q().post(`/verband-rechnungen/${e.rechnung_id}/euer-buchen`);s.data.success&&(S(`Rechnung ${e.rechnungsnummer} in EÜR gebucht (Beleg ${s.data.beleg_nummer})`),X())}catch(n){console.error("Fehler beim EÜR-Buchen:",n),k((null==(a=null==(s=n.response)?void 0:s.data)?void 0:a.error)||"Fehler beim Buchen in EÜR")}})(e),title:"In EÜR buchen",style:{padding:"0.4rem",background:"rgba(168, 85, 247, 0.1)",border:"1px solid rgba(168, 85, 247, 0.3)",borderRadius:"6px",color:"#a855f7",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(te,{size:16})})]})})]},e.rechnung_id)})})]})})]}),y&&s.jsx("div",{style:{background:"rgba(239, 68, 68, 0.15)",border:"1px solid rgba(239, 68, 68, 0.3)",color:"#ef4444",padding:"0.75rem 1rem",borderRadius:"8px",marginTop:"1rem",fontSize:"0.9rem"},children:y})]}):s.jsxs("div",{className:"rechnung-editor",children:[s.jsxs("div",{className:"rechnung-form",children:[s.jsx("h2",{children:"NEUE RECHNUNG ERSTELLEN"}),s.jsxs("div",{className:"form-section",children:[s.jsx("h3",{children:"KUNDE"}),s.jsx("div",{style:{display:"flex",gap:"0.25rem",marginBottom:"0.5rem",flexWrap:"wrap"},children:[{id:"dojo_mitglied",label:"Mitglieder"},{id:"verbandsmitglied",label:"Verband"},{id:"software_nutzer",label:"Software"},{id:"manuell",label:"Manuell"}].map(e=>s.jsx("button",{onClick:()=>{b(e.id),g(null)},style:{padding:"0.3rem 0.5rem",fontSize:"0.7rem",background:p===e.id?"rgba(255, 215, 0, 0.2)":"rgba(255, 255, 255, 0.05)",border:"1px solid "+(p===e.id?"#ffd700":"rgba(255, 255, 255, 0.1)"),borderRadius:"4px",color:p===e.id?"#ffd700":"#aaa",cursor:"pointer"},children:e.label},e.id))}),"manuell"!==p?s.jsxs("select",{onChange:e=>{const s=se().find(s=>s.id===parseInt(e.target.value));s&&((e,s)=>{g(e),b(s),M(s=>({...s,kundennummer:e.id||""})),v("")})(s,p)},value:(null==x?void 0:x.id)||"",children:[s.jsx("option",{value:"",children:"Bitte wählen..."}),se().map(e=>s.jsxs("option",{value:e.id,children:[e.name," ",e.dojo_name?`(${e.dojo_name})`:""]},e.id))]}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.4rem"},children:[s.jsx("input",{type:"text",value:C,onChange:e=>D(e.target.value),placeholder:"Name / Firma *"}),s.jsx("textarea",{value:B,onChange:e=>E(e.target.value),placeholder:"Adresse",rows:2,style:{resize:"none"}}),s.jsx("input",{type:"email",value:T,onChange:e=>F(e.target.value),placeholder:"E-Mail"})]})]}),s.jsxs("div",{className:"form-section",children:[s.jsx("h3",{children:"RECHNUNGSDATEN"}),s.jsxs("div",{className:"form-grid",children:[s.jsxs("div",{children:[s.jsx("label",{children:"Belegdatum"}),s.jsx("input",{type:"date",value:I.belegdatum,onChange:e=>M({...I,belegdatum:e.target.value,zahlungsfrist:R(e.target.value)})})]}),s.jsxs("div",{children:[s.jsx("label",{children:"Leistungsdatum"}),s.jsx("input",{type:"date",value:I.leistungsdatum,onChange:e=>M({...I,leistungsdatum:e.target.value})})]}),s.jsxs("div",{children:[s.jsx("label",{children:"Zahlungsfrist"}),s.jsx("input",{type:"date",value:I.zahlungsfrist,onChange:e=>M({...I,zahlungsfrist:e.target.value})})]})]})]}),s.jsxs("div",{className:"form-section",children:[s.jsx("h3",{children:"POSITION HINZUFÜGEN"}),s.jsxs("div",{className:"position-input",children:[s.jsxs("select",{onChange:e=>(e=>{const s=m.find(s=>(s.artikel_id||s.id)===parseInt(e));if(s){const e=s.verkaufspreis_cent?s.verkaufspreis_cent/100:s.preis||0;U({...V,artikel_id:s.artikel_id||s.id,bezeichnung:s.name||s.bezeichnung,artikelnummer:s.artikel_nummer||"",einzelpreis:e,ust_prozent:s.mwst_prozent||19})}})(e.target.value),value:V.artikel_id,children:[s.jsx("option",{value:"",children:"Artikel wählen..."}),m.map(e=>s.jsx("option",{value:e.artikel_id||e.id,children:e.name||e.bezeichnung},e.artikel_id||e.id))]}),s.jsx("input",{type:"number",value:V.menge,onChange:e=>U({...V,menge:parseInt(e.target.value)||1}),min:"1",style:{width:"60px"}}),s.jsx("button",{onClick:()=>{if(!V.bezeichnung||V.menge<=0)return;const e=L.findIndex(e=>e.artikel_id===V.artikel_id&&e.bezeichnung===V.bezeichnung&&Number(e.einzelpreis)===Number(V.einzelpreis));if(-1!==e){const s=[...L];s[e]={...s[e],menge:Number(s[e].menge)+Number(V.menge)},P(s)}else P([...L,{...V,pos:L.length+1,menge:Number(V.menge),einzelpreis:Number(V.einzelpreis),ust_prozent:Number(V.ust_prozent),ist_rabattfaehig:V.ist_rabattfaehig,rabatt_prozent:Number(V.rabatt_prozent)||0}]);U({artikel_id:"",bezeichnung:"",artikelnummer:"",menge:1,einzelpreis:0,ust_prozent:19,ist_rabattfaehig:!1,rabatt_prozent:0})},className:"btn-add",children:"Hinzufügen"})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"0.5rem"},children:[s.jsx("input",{type:"checkbox",id:"rabattfaehig",checked:V.ist_rabattfaehig,onChange:e=>U({...V,ist_rabattfaehig:e.target.checked}),style:{width:"14px",height:"14px"}}),s.jsx("label",{htmlFor:"rabattfaehig",className:"checkbox-label",children:"Rabattfähig"})]}),L.length>0&&s.jsx("div",{style:{marginTop:"0.75rem",maxHeight:"150px",overflowY:"auto"},children:L.map((e,a)=>s.jsxs("div",{className:"position-item",children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{className:"position-item-text",children:[s.jsx("strong",{children:e.bezeichnung})," - ",e.menge,"x ",e.einzelpreis.toFixed(2)," €",e.ist_rabattfaehig&&e.rabatt_prozent>0&&s.jsxs("span",{style:{color:"#ffd700",marginLeft:"0.5rem"},children:["(-",e.rabatt_prozent,"%)"]})]}),s.jsx("button",{onClick:()=>(e=>{const s=L.filter((s,a)=>a!==e);P(s.map((e,s)=>({...e,pos:s+1})))})(a),style:{background:"rgba(239, 68, 68, 0.2)",border:"1px solid rgba(239, 68, 68, 0.4)",borderRadius:"4px",color:"#ef4444",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"1.1rem",fontWeight:"bold",padding:0},children:"×"})]}),e.ist_rabattfaehig&&s.jsxs("div",{style:{marginTop:"0.35rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx("label",{className:"rabatt-label",children:"Rabatt %:"}),s.jsx("input",{type:"number",className:"rabatt-input",value:e.rabatt_prozent,onChange:s=>{const n=[...L];n[a]={...e,rabatt_prozent:parseFloat(s.target.value)||0},P(n)},min:"0",max:"100",step:"0.01"})]})]},a))})]}),s.jsxs("div",{className:"form-section",children:[s.jsx("h3",{children:"RABATT & SKONTO"}),s.jsxs("div",{className:"form-grid",children:[s.jsxs("div",{style:{position:"relative"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.3rem"},children:[s.jsx("label",{children:"Rabatt %"}),s.jsx("button",{type:"button",onClick:()=>W(!K),style:{background:"rgba(255, 215, 0, 0.2)",border:"1px solid rgba(255, 215, 0, 0.4)",borderRadius:"50%",color:"#ffd700",width:"14px",height:"14px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"0.65rem",fontWeight:"bold",padding:0},children:"?"})]}),s.jsx("input",{type:"number",value:I.rabatt_prozent,onChange:e=>M({...I,rabatt_prozent:parseFloat(e.target.value)||0}),min:"0",max:"100",step:"0.01"})]}),s.jsxs("div",{children:[s.jsx("label",{children:"Skonto %"}),s.jsx("input",{type:"number",value:I.skonto_prozent,onChange:e=>M({...I,skonto_prozent:parseFloat(e.target.value)||0}),min:"0",max:"100",step:"0.01"})]}),s.jsxs("div",{children:[s.jsx("label",{children:"Skonto Tage"}),s.jsx("input",{type:"number",value:I.skonto_tage,readOnly:!0,style:{backgroundColor:"rgba(255, 255, 255, 0.03)",cursor:"not-allowed"}})]})]})]}),K&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:9999,padding:"1rem",background:"rgba(255, 215, 0, 0.98)",border:"2px solid #ffd700",borderRadius:"8px",color:"#000",fontSize:"0.85rem",maxWidth:"320px",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.5)"},children:[s.jsx("strong",{children:"Globaler Rabatt:"})," Dieser Rabatt wird auf die gesamte Rechnung angewendet.",s.jsx("br",{}),s.jsx("br",{}),"Für ",s.jsx("strong",{children:"einzelne Positionen"})," können Sie den Rabatt oben in der Positionsliste festlegen.",s.jsx("button",{onClick:()=>W(!1),style:{marginTop:"0.75rem",padding:"0.4rem 0.75rem",background:"#000",color:"#ffd700",border:"none",borderRadius:"6px",cursor:"pointer",width:"100%"},children:"Verstanden"})]}),s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",zIndex:9998},onClick:()=>W(!1)})]}),y&&s.jsx("div",{style:{background:"rgba(239, 68, 68, 0.15)",border:"1px solid rgba(239, 68, 68, 0.3)",color:"#ef4444",padding:"0.5rem",borderRadius:"6px",marginTop:"0.5rem",fontSize:"0.8rem"},children:y}),s.jsx("button",{onClick:async()=>{var e,s;if(x||"manuell"===p)if("manuell"!==p||C)if(0!==L.length){z(!0),k("");try{const e={empfaenger_typ:p,empfaenger_id:(null==x?void 0:x.id)||null,empfaenger_name:"manuell"===p?C:null==x?void 0:x.name,empfaenger_adresse:"manuell"===p?B:null==x?void 0:x.adresse,empfaenger_email:"manuell"===p?T:null==x?void 0:x.email,rechnungsdatum:I.belegdatum,leistungsdatum:I.leistungsdatum,faelligkeitsdatum:I.zahlungsfrist,rabatt_prozent:I.rabatt_prozent,skonto_prozent:I.skonto_prozent,skonto_tage:I.skonto_tage,positionen:L.map(e=>({bezeichnung:e.bezeichnung,menge:e.menge,einzelpreis:e.einzelpreis,mwst_satz:e.ust_prozent,ist_rabattfaehig:e.ist_rabattfaehig,rabatt_prozent:e.rabatt_prozent}))},s=await Q().post("/verband-rechnungen",e);if(s.data.success){S(`Rechnung ${s.data.rechnungsnummer} erfolgreich erstellt!`),q(`/api/verband-rechnungen/${s.data.rechnung_id}/pdf`),G(!0),g(null),D(""),E(""),F(""),P([]);const e=await Q().get("/verband-rechnungen/nummernkreis");e.data.success&&M(s=>({...s,rechnungsnummer:e.data.rechnungsnummer})),X()}}catch(a){console.error("Fehler beim Speichern:",a),k((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.error)||"Fehler beim Speichern der Rechnung")}finally{z(!1)}}else k("Bitte fügen Sie mindestens eine Position hinzu");else k("Bitte geben Sie einen Namen ein");else k("Bitte wählen Sie einen Kunden aus")},className:"btn-save",disabled:_,children:_?"Speichern...":"Rechnung speichern"})]}),s.jsx("div",{className:"rechnung-preview",children:s.jsxs("div",{className:"invoice-page",children:[s.jsxs("div",{className:"invoice-header",children:[s.jsxs("div",{className:"company-info",children:[s.jsxs("div",{className:"company-small",children:[null==c?void 0:c.name," | ",null==c?void 0:c.adresse]}),s.jsx("div",{className:"recipient-address",children:x?s.jsxs(s.Fragment,{children:[s.jsx("div",{children:"Herrn/Frau"}),s.jsx("div",{children:x.name}),x.adresse&&x.adresse.split("\n").map((e,a)=>s.jsx("div",{children:e},a))]}):"manuell"===p&&C?s.jsxs(s.Fragment,{children:[s.jsx("div",{children:"Herrn/Frau"}),s.jsx("div",{children:C}),B&&B.split("\n").map((e,a)=>s.jsx("div",{children:e},a))]}):s.jsx("div",{style:{color:"#999"},children:"Bitte Kunde wählen"})})]}),s.jsxs("div",{className:"invoice-meta",children:[s.jsx("div",{className:"logo-placeholder",children:"TDA"}),s.jsxs("div",{className:"invoice-numbers",children:[s.jsxs("div",{children:["Rechnungs-Nr.: ",I.rechnungsnummer]}),s.jsxs("div",{children:["Kundennummer: ",I.kundennummer||"-"]}),s.jsxs("div",{children:["Belegdatum: ",I.belegdatum]}),s.jsxs("div",{children:["Liefer-/Leistungsdatum: ",I.leistungsdatum]})]})]})]}),s.jsxs("div",{className:"invoice-title",children:[s.jsx("h1",{children:"RECHNUNG"}),s.jsx("div",{className:"page-number",children:"Seite 1 von 1"})]}),s.jsxs("table",{className:"invoice-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Pos."}),s.jsx("th",{children:"Bezeichnung"}),s.jsx("th",{children:"Artikelnummer"}),s.jsx("th",{children:"Menge"}),s.jsx("th",{children:"Einheit"}),s.jsx("th",{children:"Preis"}),s.jsx("th",{children:"Rabatt %"}),s.jsx("th",{children:"USt %"}),s.jsx("th",{children:"Betrag EUR"})]})}),s.jsx("tbody",{children:L.map((e,a)=>{const n=Number(e.einzelpreis)*Number(e.menge),r=n-(e.ist_rabattfaehig?n*Number(e.rabatt_prozent)/100:0);return s.jsxs("tr",{children:[s.jsx("td",{children:e.pos}),s.jsx("td",{children:e.bezeichnung}),s.jsx("td",{children:e.artikelnummer||"-"}),s.jsx("td",{children:e.menge}),s.jsx("td",{children:"Stk."}),s.jsx("td",{children:Number(e.einzelpreis).toFixed(2)}),s.jsx("td",{children:e.ist_rabattfaehig?`${Number(e.rabatt_prozent).toFixed(2)} %`:"-"}),s.jsxs("td",{children:[Number(e.ust_prozent).toFixed(2)," %"]}),s.jsx("td",{children:r.toFixed(2)})]},a)})})]}),s.jsxs("div",{className:"invoice-totals",children:[s.jsxs("div",{className:"totals-row",children:[s.jsx("span",{children:"Zwischensumme:"}),s.jsx("span",{children:le().toFixed(2)})]}),I.rabatt_prozent>0&&s.jsxs("div",{className:"totals-row",children:[s.jsxs("span",{children:[I.rabatt_prozent.toFixed(2)," % Rabatt:"]}),s.jsxs("span",{children:["-",de().toFixed(2)]})]}),s.jsxs("div",{className:"totals-row",children:[s.jsx("span",{children:"Summe:"}),s.jsx("span",{children:ce().toFixed(2)})]}),s.jsxs("div",{className:"totals-row",children:[s.jsxs("span",{children:["19,00 % USt. auf EUR ",ce().toFixed(2),":"]}),s.jsx("span",{children:he().toFixed(2)})]}),s.jsxs("div",{className:"totals-row total-final",children:[s.jsx("span",{children:"Endbetrag:"}),s.jsx("span",{children:me().toFixed(2)})]})]}),s.jsxs("div",{style:{display:"flex",gap:"2rem",marginTop:"2rem",alignItems:"flex-start"},children:[s.jsxs("div",{className:"payment-terms",style:{flex:"1",minWidth:"300px"},children:[s.jsx("p",{children:"Bitte beachten Sie unsere Zahlungsbedingung:"}),Number(I.skonto_prozent)>0&&Number(I.skonto_tage)>0?s.jsxs("p",{children:[Number(I.skonto_prozent).toFixed(2)," % Skonto bei Zahlung innerhalb von ",I.skonto_tage," Tagen (bis zum ",ue(I.belegdatum,I.skonto_tage),").",s.jsx("br",{}),"Ohne Abzug bis zum ",ue(I.zahlungsfrist),".",s.jsx("br",{}),"Skonto-Betrag: ",oe().toFixed(2)," €",s.jsx("br",{}),"Zu überweisender Betrag: ",(me()-oe()).toFixed(2)," €"]}):s.jsxs("p",{children:["Ohne Abzug bis zum ",ue(I.zahlungsfrist),"."]})]}),me()>0&&s.jsx("div",{className:"qr-codes-section",style:{flex:"0 0 auto",display:"flex",gap:"0.5rem",justifyContent:"center",flexWrap:"nowrap",alignItems:"flex-start",width:Number(I.skonto_prozent)>0?"180px":"90px",marginRight:"5mm"},children:Number(I.skonto_prozent)>0&&Number(I.skonto_tage)>0?s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{textAlign:"center",flex:"0 0 auto",width:"90px"},children:[s.jsx("h4",{className:"qr-code-title",style:{marginBottom:"0.5rem",fontSize:"0.85rem",fontWeight:"bold",color:"#000",textTransform:"uppercase"},children:"Zahlung mit Skonto"}),s.jsx("div",{style:{padding:"0.3rem",background:"#fff",display:"inline-block",borderRadius:"4px"},children:s.jsx(We,{value:xe(me()-oe()),size:70,level:"M"})}),s.jsxs("p",{style:{marginTop:"0",fontSize:"0.75rem",color:"#000",fontWeight:"600"},children:["Betrag: ",(me()-oe()).toFixed(2)," €"]}),s.jsxs("p",{style:{marginTop:"0",fontSize:"0.7rem",color:"#000"},children:["bis zum ",ue(I.belegdatum,I.skonto_tage)]})]}),s.jsxs("div",{style:{textAlign:"center",flex:"0 0 auto",width:"90px"},children:[s.jsx("h4",{className:"qr-code-title",style:{marginBottom:"0.5rem",fontSize:"0.85rem",fontWeight:"bold",color:"#000",textTransform:"uppercase"},children:"Zahlung ohne Skonto"}),s.jsx("div",{style:{padding:"0.3rem",background:"#fff",display:"inline-block",borderRadius:"4px"},children:s.jsx(We,{value:xe(me()),size:70,level:"M"})}),s.jsxs("p",{style:{marginTop:"0",fontSize:"0.75rem",color:"#000",fontWeight:"600"},children:["Betrag: ",me().toFixed(2)," €"]}),s.jsxs("p",{style:{marginTop:"0",fontSize:"0.7rem",color:"#000"},children:["ab ",ue(I.zahlungsfrist)]})]})]}):s.jsxs("div",{style:{textAlign:"center",flex:"0 0 auto",width:"90px"},children:[s.jsx("h4",{className:"qr-code-title",style:{marginBottom:"0.5rem",fontSize:"0.85rem",fontWeight:"bold",color:"#000",textTransform:"uppercase"},children:"QR-Code für Überweisung"}),s.jsx("div",{style:{padding:"0.3rem",background:"#fff",display:"inline-block",borderRadius:"4px"},children:s.jsx(We,{value:xe(me()),size:70,level:"M"})}),s.jsxs("p",{style:{marginTop:"0",fontSize:"0.75rem",color:"#000",fontWeight:"600"},children:["Betrag: ",me().toFixed(2)," €"]}),s.jsxs("p",{style:{marginTop:"0",fontSize:"0.7rem",color:"#000"},children:["bis zum ",ue(I.zahlungsfrist)]})]})})]}),s.jsxs("div",{className:"rechnung-footer",style:{position:"absolute",bottom:"0",left:"20mm",right:"20mm",paddingTop:"0.75rem",paddingBottom:"0.5rem",borderTop:"1px solid rgba(0, 0, 0, 0.2)",fontSize:"7pt",color:"#000",lineHeight:"1.6",textAlign:"center"},children:[s.jsxs("div",{style:{marginBottom:"0.3rem"},children:[null==c?void 0:c.name," | ",null==c?void 0:c.adresse," | info@tda-intl.org | www.tda-intl.org"]}),s.jsxs("div",{children:[$.bank_name," | ",$.kontoinhaber," | ",$.iban," | ",$.bic]})]})]})})]}),O&&s.jsx("div",{className:"modal-overlay",onClick:()=>G(!1),style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:s.jsxs("div",{onClick:e=>e.stopPropagation(),style:{background:"#1a1a2e",border:"1px solid rgba(201, 162, 39, 0.3)",borderRadius:"12px",width:"900px",height:"85vh",maxWidth:"90vw",display:"flex",flexDirection:"column"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 1.25rem",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:[s.jsx("h3",{style:{color:"#fff",margin:0},children:"Rechnung erstellt"}),s.jsx("button",{onClick:()=>G(!1),style:{background:"none",border:"none",color:"#888",cursor:"pointer"},children:s.jsx(ie,{size:20})})]}),s.jsx("div",{style:{flex:1,overflow:"auto"},children:s.jsx("iframe",{src:J,title:"Rechnung Vorschau",style:{width:"100%",height:"100%",border:"none",background:"#fff"}})}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.75rem",padding:"1rem 1.25rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)"},children:[s.jsx("button",{onClick:()=>G(!1),style:{padding:"0.6rem 1rem",background:"transparent",border:"1px solid rgba(201, 162, 39, 0.5)",color:"#c9a227",borderRadius:"6px",cursor:"pointer"},children:"Schließen"}),s.jsxs("button",{onClick:()=>window.open(J+"?print=1","_blank"),style:{padding:"0.6rem 1rem",background:"linear-gradient(135deg, #c9a227, #a68519)",color:"#000",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx(ae,{size:16})," PDF herunterladen"]})]})]})}),s.jsx("style",{children:"\n        @keyframes spin {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n      "})]})},ps=({token:r})=>{var t,i,l,d,c,o;const[h,m]=e.useState("euer"),[u,x]=e.useState("alle"),[g,p]=e.useState((new Date).getFullYear()),[b,j]=e.useState(""),[v,f]=e.useState(null),[N,y]=e.useState(null),[k,_]=e.useState([]),[z,w]=e.useState(0),[S,D]=e.useState([]),[B,T]=e.useState(null),[F,$]=e.useState([]),[L,P]=e.useState(!1),[V,U]=e.useState(""),[K,W]=e.useState(""),[G,J]=e.useState({}),[Z,H]=e.useState(!1),[Y,X]=e.useState(null),[ee,se]=e.useState(!1),[ne,re]=e.useState(null),[te,_e]=e.useState(!1),[ze,we]=e.useState([]),[Se,Ce]=e.useState(0),[Ae,De]=e.useState(null),[Be,Ee]=e.useState([]),[Te,Fe]=e.useState(""),[$e,Re]=e.useState(1),[Ie,Me]=e.useState(null),[Le,Pe]=e.useState("Kampfkunstschule Schreiner"),[Ve,Ue]=e.useState(!1),[Ke,We]=e.useState(!1),[Oe,Ge]=e.useState(null),[Je,Ze]=e.useState([]),[qe,He]=e.useState(!1),[Ye,Qe]=e.useState("buchungsdatum"),[Xe,es]=e.useState("desc"),[ss,as]=e.useState(""),[ns,rs]=e.useState(30),[ts,is]=e.useState(""),[ls,ds]=e.useState(""),[cs,os]=e.useState(!1),[hs,ms]=e.useState(null),[us,xs]=e.useState(!1),[ps,bs]=e.useState([]),[js,vs]=e.useState(null),[fs,Ns]=e.useState({organisation_name:"TDA International",buchungsart:"ausgabe",beleg_datum:(new Date).toISOString().split("T")[0],buchungsdatum:(new Date).toISOString().split("T")[0],betrag_netto:"",mwst_satz:"19",kategorie:"sonstige_kosten",beschreibung:"",lieferant_kunde:"",rechnungsnummer_extern:""}),[ys,ks]=e.useState(1),[_s]=e.useState(20),zs=[],ws=(new Date).getFullYear();for(let e=ws;e>=ws-5;e--)zs.push(e);const Ss=e.useCallback(async()=>{try{const e=await n.get("/buchhaltung/kategorien",{headers:{Authorization:`Bearer ${r}`}});$(e.data)}catch(e){console.error("Kategorien laden fehlgeschlagen:",e)}},[r]),Cs=e.useCallback(async()=>{try{P(!0);const e=await n.get("/buchhaltung/dashboard",{headers:{Authorization:`Bearer ${r}`},params:{organisation:u,jahr:g}});f(e.data)}catch(e){console.error("Dashboard laden fehlgeschlagen:",e),U("Dashboard konnte nicht geladen werden")}finally{P(!1)}},[r,u,g]),As=e.useCallback(async()=>{try{P(!0);const e=await n.get("/buchhaltung/euer",{headers:{Authorization:`Bearer ${r}`},params:{organisation:u,jahr:g,quartal:b||void 0}});y(e.data)}catch(e){console.error("EÜR laden fehlgeschlagen:",e),U("EÜR konnte nicht geladen werden")}finally{P(!1)}},[r,u,g,b]),Ds=e.useCallback(async()=>{try{P(!0);const e=await n.get("/buchhaltung/belege",{headers:{Authorization:`Bearer ${r}`},params:{organisation:"alle"!==u?u:void 0,jahr:g,seite:ys,limit:_s}});_(e.data.belege),w(e.data.pagination.total)}catch(e){console.error("Belege laden fehlgeschlagen:",e),U("Belege konnten nicht geladen werden")}finally{P(!1)}},[r,u,g,ys,_s]),Bs=e.useCallback(async()=>{try{P(!0);const e=await n.get("/buchhaltung/einnahmen-auto",{headers:{Authorization:`Bearer ${r}`},params:{organisation:u,jahr:g}});D(e.data.einnahmen)}catch(e){console.error("Auto-Einnahmen laden fehlgeschlagen:",e)}finally{P(!1)}},[r,u,g]),Es=e.useCallback(async()=>{try{P(!0);const e=await n.get(`/buchhaltung/abschluss/${g}`,{headers:{Authorization:`Bearer ${r}`},params:{organisation:u}});T(e.data)}catch(e){console.error("Abschluss laden fehlgeschlagen:",e)}finally{P(!1)}},[r,u,g]),Ts=e.useCallback(async()=>{try{P(!0);const e=await n.get("/buchhaltung/bank-import/transaktionen",{headers:{Authorization:`Bearer ${r}`},params:{organisation:"alle"!==u?u:void 0,status:Te||void 0,seite:0===ns?1:$e,limit:0===ns?1e4:ns}});we(e.data.transaktionen),Ce(e.data.pagination.total)}catch(e){console.error("Bank-Transaktionen laden fehlgeschlagen:",e)}finally{P(!1)}},[r,u,Te,$e,ns]),Fs=e.useCallback(async()=>{try{const e=await n.get("/buchhaltung/bank-import/statistik",{headers:{Authorization:`Bearer ${r}`},params:{organisation:"alle"!==u?u:void 0}});De(e.data.statistik),Ee(e.data.letzteImports)}catch(e){console.error("Bank-Statistik laden fehlgeschlagen:",e)}},[r,u]),$s=e=>{Ye===e?es(e=>"asc"===e?"desc":"asc"):(Qe(e),es("asc"))},Rs=()=>{let e=[...ze];if(ss.trim()){const s=ss.toLowerCase();e=e.filter(e=>(e.auftraggeber_empfaenger||"").toLowerCase().includes(s)||(e.verwendungszweck||"").toLowerCase().includes(s)||(e.organisation_name||"").toLowerCase().includes(s)||String(e.betrag).includes(s))}return"einnahmen"===ts?e=e.filter(e=>parseFloat(e.betrag)>=0):"ausgaben"===ts&&(e=e.filter(e=>parseFloat(e.betrag)<0)),ls&&(e=e.filter(e=>e.kategorie===ls)),e.sort((e,s)=>{let a,n;switch(Ye){case"buchungsdatum":a=new Date(e.buchungsdatum),n=new Date(s.buchungsdatum);break;case"betrag":a=parseFloat(e.betrag),n=parseFloat(s.betrag);break;case"auftraggeber_empfaenger":a=(e.auftraggeber_empfaenger||"").toLowerCase(),n=(s.auftraggeber_empfaenger||"").toLowerCase();break;case"verwendungszweck":a=(e.verwendungszweck||"").toLowerCase(),n=(s.verwendungszweck||"").toLowerCase();break;case"organisation_name":a=(e.organisation_name||"").toLowerCase(),n=(s.organisation_name||"").toLowerCase();break;case"status":a=e.status||"",n=s.status||"";break;default:a=e[Ye],n=s[Ye]}return a<n?"asc"===Xe?-1:1:a>n?"asc"===Xe?1:-1:0}),e};e.useEffect(()=>{Ss()},[Ss]),e.useEffect(()=>{"euer"===h?(Cs(),As()):"belege"===h?Ds():"auto"===h?Bs():"bankimport"===h?(Ts(),Fs()):"abschluss"===h&&Es()},[h,u,g,b,ys,$e,Te,Cs,As,Ds,Bs,Ts,Fs,Es]);const Is=()=>{Ns({organisation_name:"TDA International",buchungsart:"ausgabe",beleg_datum:(new Date).toISOString().split("T")[0],buchungsdatum:(new Date).toISOString().split("T")[0],betrag_netto:"",mwst_satz:"19",kategorie:"sonstige_kosten",beschreibung:"",lieferant_kunde:"",rechnungsnummer_extern:""})},Ms=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e||0),Ls=e=>e?new Date(e).toLocaleDateString("de-DE"):"-",Ps=e=>{const s=F.find(s=>s.id===e);return(null==s?void 0:s.name)||e},Vs=[{id:"euer",label:"EÜR Übersicht",icon:s.jsx(O,{size:16})},{id:"belege",label:"Belegerfassung",icon:s.jsx(oe,{size:16})},{id:"rechnungen",label:"Rechnungen",icon:s.jsx(E,{size:16})},{id:"auto",label:"Auto. Buchungen",icon:s.jsx(Q,{size:16})},{id:"bankimport",label:"Bank-Import",icon:s.jsx(pe,{size:16})},{id:"abschluss",label:"Jahresabschluss",icon:s.jsx(ke,{size:16})}];return s.jsxs("div",{className:"buchhaltung-tab",children:[s.jsxs("div",{className:"buchhaltung-header",children:[s.jsxs("div",{className:"header-title",children:[s.jsx(le,{size:24}),s.jsx("h2",{children:"Buchhaltung - EÜR"})]}),s.jsxs("div",{className:"header-filters",children:[s.jsxs("div",{className:"filter-group",children:[s.jsx("label",{children:"Organisation:"}),s.jsxs("select",{value:u,onChange:e=>x(e.target.value),children:[s.jsx("option",{value:"alle",children:"Alle Organisationen"}),s.jsx("option",{value:"TDA International",children:"TDA International"}),s.jsx("option",{value:"Kampfkunstschule Schreiner",children:"Kampfkunstschule Schreiner"})]})]}),s.jsxs("div",{className:"filter-group",children:[s.jsx("label",{children:"Jahr:"}),s.jsx("select",{value:g,onChange:e=>p(parseInt(e.target.value)),children:zs.map(e=>s.jsx("option",{value:e,children:e},e))})]}),"euer"===h&&s.jsxs("div",{className:"filter-group",children:[s.jsx("label",{children:"Quartal:"}),s.jsxs("select",{value:b,onChange:e=>j(e.target.value),children:[s.jsx("option",{value:"",children:"Gesamtjahr"}),s.jsx("option",{value:"1",children:"Q1 (Jan-Mär)"}),s.jsx("option",{value:"2",children:"Q2 (Apr-Jun)"}),s.jsx("option",{value:"3",children:"Q3 (Jul-Sep)"}),s.jsx("option",{value:"4",children:"Q4 (Okt-Dez)"})]})]})]})]}),V&&s.jsxs("div",{className:"message error",children:[s.jsx(M,{size:16}),V,s.jsx("button",{onClick:()=>U(""),children:s.jsx(ie,{size:14})})]}),K&&s.jsxs("div",{className:"message success",children:[s.jsx(A,{size:16}),K]}),s.jsx("div",{className:"sub-tabs",children:Vs.map(e=>s.jsxs("button",{className:"sub-tab "+(h===e.id?"active":""),onClick:()=>m(e.id),children:[e.icon,s.jsx("span",{children:e.label})]},e.id))}),s.jsxs("div",{className:"sub-tab-content",children:["euer"===h&&s.jsxs("div",{className:"euer-content",children:[v&&s.jsxs("div",{className:"dashboard-cards",children:[s.jsxs("div",{className:"dash-card einnahmen",children:[s.jsx("div",{className:"card-icon",children:s.jsx(C,{size:24})}),s.jsxs("div",{className:"card-content",children:[s.jsx("span",{className:"card-label",children:"Einnahmen"}),s.jsx("span",{className:"card-value",children:Ms(null==(t=v.einnahmen)?void 0:t.gesamt)})]})]}),s.jsxs("div",{className:"dash-card ausgaben",children:[s.jsx("div",{className:"card-icon",children:s.jsx(I,{size:24})}),s.jsxs("div",{className:"card-content",children:[s.jsx("span",{className:"card-label",children:"Ausgaben"}),s.jsx("span",{className:"card-value",children:Ms(null==(i=v.ausgaben)?void 0:i.gesamt)})]})]}),s.jsxs("div",{className:"dash-card gewinn "+(v.gewinnVerlust>=0?"positiv":"negativ"),children:[s.jsx("div",{className:"card-icon",children:s.jsx(q,{size:24})}),s.jsxs("div",{className:"card-content",children:[s.jsx("span",{className:"card-label",children:"Gewinn/Verlust"}),s.jsx("span",{className:"card-value",children:Ms(v.gewinnVerlust)})]})]})]}),N&&s.jsxs("div",{className:"euer-details",children:[s.jsxs("div",{className:"euer-section",children:[s.jsxs("h3",{children:[s.jsx(C,{size:18}),"Einnahmen"]}),s.jsxs("table",{className:"euer-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Kategorie"}),s.jsx("th",{children:"Quelle"}),s.jsx("th",{className:"right",children:"Betrag"})]})}),s.jsxs("tbody",{children:[Object.entries((null==(l=N.einnahmen)?void 0:l.nachKategorie)||{}).map(([e,n])=>{var r;return s.jsxs(a.Fragment,{children:[s.jsxs("tr",{className:"kategorie-row clickable",onClick:()=>J(s=>({...s,[`ein_${e}`]:!s[`ein_${e}`]})),style:{cursor:"pointer"},children:[s.jsx("td",{colSpan:"2",children:s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[G[`ein_${e}`]?s.jsx(de,{size:14}):s.jsx(ce,{size:14}),s.jsx("strong",{children:Ps(e)})]})}),s.jsx("td",{className:"right",children:s.jsx("strong",{children:Ms(n.summe)})})]}),G[`ein_${e}`]&&(null==(r=n.details)?void 0:r.map((n,r)=>{var t,i,l;return s.jsxs(a.Fragment,{children:[s.jsxs("tr",{className:"detail-row clickable",onClick:s=>{s.stopPropagation(),J(s=>({...s,[`ein_${e}_${r}`]:!s[`ein_${e}_${r}`]}))},style:{cursor:(null==(t=n.einzelbuchungen)?void 0:t.length)>0?"pointer":"default"},children:[s.jsx("td",{}),s.jsx("td",{children:s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.3rem"},children:[(null==(i=n.einzelbuchungen)?void 0:i.length)>0&&(G[`ein_${e}_${r}`]?s.jsx(de,{size:12}):s.jsx(ce,{size:12})),n.quelle," (",n.anzahl,"x)"]})}),s.jsx("td",{className:"right",children:Ms(n.summe)})]}),G[`ein_${e}_${r}`]&&(null==(l=n.einzelbuchungen)?void 0:l.map((a,n)=>s.jsxs("tr",{className:"einzelbuchung-row",children:[s.jsx("td",{}),s.jsxs("td",{style:{paddingLeft:"2rem",fontSize:"0.85em",color:"#fff"},children:[new Date(a.datum).toLocaleDateString("de-DE")," - ",a.beschreibung||"Keine Beschreibung"]}),s.jsx("td",{className:"right",style:{fontSize:"0.85em",color:"#fff"},children:Ms(a.betrag)})]},`${e}-${r}-${n}`)))]},`${e}-${r}`)}))]},e)}),s.jsxs("tr",{className:"total-row",children:[s.jsx("td",{colSpan:"2",children:s.jsx("strong",{children:"Summe Einnahmen"})}),s.jsx("td",{className:"right",children:s.jsx("strong",{children:Ms(null==(d=N.einnahmen)?void 0:d.gesamt)})})]})]})]})]}),s.jsxs("div",{className:"euer-section",children:[s.jsxs("h3",{children:[s.jsx(I,{size:18}),"Ausgaben"]}),s.jsxs("table",{className:"euer-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Kategorie"}),s.jsx("th",{children:"Quelle"}),s.jsx("th",{className:"right",children:"Betrag"})]})}),s.jsxs("tbody",{children:[Object.entries((null==(c=N.ausgaben)?void 0:c.nachKategorie)||{}).map(([e,n])=>{var r;return s.jsxs(a.Fragment,{children:[s.jsxs("tr",{className:"kategorie-row clickable",onClick:()=>J(s=>({...s,[`aus_${e}`]:!s[`aus_${e}`]})),style:{cursor:"pointer"},children:[s.jsx("td",{colSpan:"2",children:s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[G[`aus_${e}`]?s.jsx(de,{size:14}):s.jsx(ce,{size:14}),s.jsx("strong",{children:Ps(e)})]})}),s.jsx("td",{className:"right",children:s.jsx("strong",{children:Ms(n.summe)})})]}),G[`aus_${e}`]&&(null==(r=n.details)?void 0:r.map((n,r)=>{var t,i,l;return s.jsxs(a.Fragment,{children:[s.jsxs("tr",{className:"detail-row clickable",onClick:s=>{s.stopPropagation(),J(s=>({...s,[`aus_${e}_${r}`]:!s[`aus_${e}_${r}`]}))},style:{cursor:(null==(t=n.einzelbuchungen)?void 0:t.length)>0?"pointer":"default"},children:[s.jsx("td",{}),s.jsx("td",{children:s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.3rem"},children:[(null==(i=n.einzelbuchungen)?void 0:i.length)>0&&(G[`aus_${e}_${r}`]?s.jsx(de,{size:12}):s.jsx(ce,{size:12})),n.quelle," (",n.anzahl,"x)"]})}),s.jsx("td",{className:"right",children:Ms(n.summe)})]}),G[`aus_${e}_${r}`]&&(null==(l=n.einzelbuchungen)?void 0:l.map((a,n)=>s.jsxs("tr",{className:"einzelbuchung-row",children:[s.jsx("td",{}),s.jsxs("td",{style:{paddingLeft:"2rem",fontSize:"0.85em",color:"#fff"},children:[new Date(a.datum).toLocaleDateString("de-DE")," - ",a.beschreibung||"Keine Beschreibung"]}),s.jsx("td",{className:"right",style:{fontSize:"0.85em",color:"#fff"},children:Ms(a.betrag)})]},`${e}-${r}-${n}`)))]},`${e}-${r}`)}))]},e)}),s.jsxs("tr",{className:"total-row",children:[s.jsx("td",{colSpan:"2",children:s.jsx("strong",{children:"Summe Ausgaben"})}),s.jsx("td",{className:"right",children:s.jsx("strong",{children:Ms(null==(o=N.ausgaben)?void 0:o.gesamt)})})]})]})]})]}),s.jsxs("div",{className:"euer-ergebnis "+(N.gewinnVerlust>=0?"positiv":"negativ"),children:[s.jsx("span",{children:"Ergebnis (Gewinn/Verlust):"}),s.jsx("span",{className:"ergebnis-wert",children:Ms(N.gewinnVerlust)})]})]})]}),"belege"===h&&s.jsxs("div",{className:"belege-content",children:[s.jsxs("div",{className:"belege-header",children:[s.jsxs("h3",{children:[s.jsx(oe,{size:18}),"Manuelle Belege"]}),s.jsxs("button",{className:"btn-primary",onClick:()=>{Is(),X(null),H(!0)},children:[s.jsx(he,{size:16}),"Neuer Beleg"]})]}),s.jsx("div",{className:"belege-table-container",children:s.jsxs("table",{className:"belege-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Beleg-Nr."}),s.jsx("th",{children:"Datum"}),s.jsx("th",{children:"Organisation"}),s.jsx("th",{children:"Typ"}),s.jsx("th",{children:"Kategorie"}),s.jsx("th",{children:"Beschreibung"}),s.jsx("th",{className:"right",children:"Betrag"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Aktionen"})]})}),s.jsx("tbody",{children:0===k.length?s.jsx("tr",{children:s.jsx("td",{colSpan:"9",className:"no-data",children:"Keine Belege vorhanden"})}):k.map(e=>s.jsxs("tr",{className:e.storniert?"storniert":"",children:[s.jsx("td",{children:e.beleg_nummer}),s.jsx("td",{children:Ls(e.beleg_datum)}),s.jsx("td",{children:e.organisation_name}),s.jsx("td",{children:s.jsx("span",{className:`typ-badge ${e.buchungsart}`,children:"einnahme"===e.buchungsart?"Einnahme":"Ausgabe"})}),s.jsx("td",{children:Ps(e.kategorie)}),s.jsx("td",{className:"beschreibung-cell",children:e.beschreibung}),s.jsx("td",{className:"right",children:Ms(e.betrag_brutto)}),s.jsxs("td",{children:[e.festgeschrieben&&s.jsxs("span",{className:"status-badge festgeschrieben",children:[s.jsx(me,{size:12})," Fest"]}),e.datei_name&&s.jsx("span",{className:"status-badge datei",children:s.jsx(E,{size:12})})]}),s.jsxs("td",{className:"actions",children:[!e.festgeschrieben&&s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"btn-icon",title:"Bearbeiten",onClick:()=>(e=>{var s,a;X(e),Ns({organisation_name:e.organisation_name,buchungsart:e.buchungsart,beleg_datum:null==(s=e.beleg_datum)?void 0:s.split("T")[0],buchungsdatum:null==(a=e.buchungsdatum)?void 0:a.split("T")[0],betrag_netto:e.betrag_netto,mwst_satz:e.mwst_satz,kategorie:e.kategorie,beschreibung:e.beschreibung,lieferant_kunde:e.lieferant_kunde||"",rechnungsnummer_extern:e.rechnungsnummer_extern||""}),H(!0)})(e),children:s.jsx(ue,{size:14})}),s.jsx("button",{className:"btn-icon",title:"Datei hochladen",onClick:()=>{re(e.beleg_id),se(!0)},children:s.jsx(xe,{size:14})}),s.jsx("button",{className:"btn-icon",title:"Festschreiben",onClick:()=>(async e=>{var s,a;if(confirm("Beleg wirklich festschreiben? Danach sind keine Änderungen mehr möglich."))try{P(!0),await n.post(`/buchhaltung/belege/${e}/festschreiben`,{},{headers:{Authorization:`Bearer ${r}`}}),W("Beleg festgeschrieben"),Ds(),setTimeout(()=>W(""),3e3)}catch(t){U((null==(a=null==(s=t.response)?void 0:s.data)?void 0:a.message)||"Fehler beim Festschreiben")}finally{P(!1)}})(e.beleg_id),children:s.jsx(me,{size:14})}),s.jsx("button",{className:"btn-icon danger",title:"Stornieren",onClick:()=>(async e=>{var s,a;const t=prompt("Bitte geben Sie einen Storno-Grund an:");if(t)try{P(!0),await n.post(`/buchhaltung/belege/${e}/stornieren`,{grund:t},{headers:{Authorization:`Bearer ${r}`}}),W("Beleg erfolgreich storniert"),Ds(),setTimeout(()=>W(""),3e3)}catch(i){U((null==(a=null==(s=i.response)?void 0:s.data)?void 0:a.message)||"Fehler beim Stornieren")}finally{P(!1)}})(e.beleg_id),children:s.jsx(ge,{size:14})})]}),e.datei_name&&s.jsx("a",{href:`${n.defaults.baseURL}/buchhaltung/belege/${e.beleg_id}/datei`,target:"_blank",rel:"noopener noreferrer",className:"btn-icon",title:"Datei anzeigen",children:s.jsx(E,{size:14})})]})]},e.beleg_id))})]})}),z>_s&&s.jsxs("div",{className:"pagination",children:[s.jsx("button",{disabled:1===ys,onClick:()=>ks(e=>Math.max(1,e-1)),children:"Zurück"}),s.jsxs("span",{children:["Seite ",ys," von ",Math.ceil(z/_s)]}),s.jsx("button",{disabled:ys>=Math.ceil(z/_s),onClick:()=>ks(e=>e+1),children:"Weiter"})]})]}),"rechnungen"===h&&s.jsx("div",{className:"rechnungen-content",children:s.jsx(gs,{token:r})}),"auto"===h&&s.jsxs("div",{className:"auto-content",children:[s.jsxs("div",{className:"auto-header",children:[s.jsxs("h3",{children:[s.jsx(Q,{size:18}),"Automatisch erfasste Einnahmen"]}),s.jsx("p",{className:"auto-info",children:"Diese Einnahmen werden automatisch aus Rechnungen, Verkäufen, Mitgliedsbeiträgen und Verbandsbeiträgen übernommen."})]}),s.jsx("div",{className:"auto-table-container",children:s.jsxs("table",{className:"auto-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Quelle"}),s.jsx("th",{children:"Datum"}),s.jsx("th",{children:"Organisation"}),s.jsx("th",{children:"Beschreibung"}),s.jsx("th",{className:"right",children:"Betrag"})]})}),s.jsx("tbody",{children:0===S.length?s.jsx("tr",{children:s.jsx("td",{colSpan:"5",className:"no-data",children:"Keine automatischen Einnahmen gefunden"})}):S.map((e,a)=>s.jsxs("tr",{children:[s.jsx("td",{children:s.jsxs("span",{className:`quelle-badge ${e.quelle}`,children:["rechnung"===e.quelle&&"Rechnung","verkauf"===e.quelle&&"Verkauf","beitrag"===e.quelle&&"Mitgliedsbeitrag","verbandsbeitrag"===e.quelle&&"Verbandsbeitrag","beleg"===e.quelle&&"Beleg"]})}),s.jsx("td",{children:Ls(e.datum)}),s.jsx("td",{children:e.organisation_name}),s.jsx("td",{children:e.beschreibung}),s.jsx("td",{className:"right",children:Ms(e.betrag_brutto)})]},a))})]})})]}),"bankimport"===h&&s.jsxs("div",{className:"bankimport-content",children:[Ae&&s.jsxs("div",{className:"bank-stats-cards",children:[s.jsxs("div",{className:"bank-stat-card",children:[s.jsx("span",{className:"stat-value",children:Ae.unzugeordnet||0}),s.jsx("span",{className:"stat-label",children:"Unzugeordnet"})]}),s.jsxs("div",{className:"bank-stat-card vorschlag",children:[s.jsx("span",{className:"stat-value",children:Ae.vorgeschlagen||0}),s.jsx("span",{className:"stat-label",children:"Mit Vorschlag"})]}),s.jsxs("div",{className:"bank-stat-card zugeordnet",children:[s.jsx("span",{className:"stat-value",children:Ae.zugeordnet||0}),s.jsx("span",{className:"stat-label",children:"Zugeordnet"})]}),s.jsxs("div",{className:"bank-stat-card ignoriert",children:[s.jsx("span",{className:"stat-value",children:Ae.ignoriert||0}),s.jsx("span",{className:"stat-label",children:"Ignoriert"})]})]}),s.jsxs("div",{className:"bank-header",children:[s.jsxs("div",{className:"bank-header-left",children:[s.jsxs("h3",{children:[s.jsx(pe,{size:18}),"Bank-Transaktionen"]}),s.jsxs("div",{className:"bank-filter",children:[s.jsxs("select",{value:Te,onChange:e=>{Fe(e.target.value),Re(1)},children:[s.jsx("option",{value:"",children:"Alle Status"}),s.jsx("option",{value:"unzugeordnet",children:"Unzugeordnet"}),s.jsx("option",{value:"vorgeschlagen",children:"Mit Vorschlag"}),s.jsx("option",{value:"zugeordnet",children:"Zugeordnet"}),s.jsx("option",{value:"ignoriert",children:"Ignoriert"})]}),s.jsxs("select",{value:ts,onChange:e=>is(e.target.value),children:[s.jsx("option",{value:"",children:"Alle Buchungen"}),s.jsx("option",{value:"einnahmen",children:"Nur Einnahmen"}),s.jsx("option",{value:"ausgaben",children:"Nur Ausgaben"})]}),s.jsxs("select",{value:ls,onChange:e=>ds(e.target.value),children:[s.jsx("option",{value:"",children:"Alle Kategorien"}),F.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),ls&&s.jsx("button",{className:"btn-small",onClick:()=>ds(""),title:"Filter zurücksetzen",children:s.jsx(ie,{size:14})})]}),s.jsxs("div",{className:"bank-search",children:[s.jsx(be,{size:16}),s.jsx("input",{type:"text",placeholder:"Suchen...",value:ss,onChange:e=>as(e.target.value)}),ss&&s.jsx("button",{className:"search-clear",onClick:()=>as(""),children:s.jsx(ie,{size:14})})]})]}),s.jsxs("button",{className:"btn-primary",onClick:()=>Ue(!0),children:[s.jsx(je,{size:16}),"Kontoauszug importieren"]})]}),Je.length>0&&s.jsxs("div",{className:"bank-batch-actions",children:[s.jsxs("span",{children:[Je.length," ausgewählt"]}),s.jsxs("div",{className:"batch-buttons",children:[s.jsx("button",{className:"btn-primary",onClick:()=>We(!0),children:"Kategorie zuordnen"}),s.jsx("button",{className:"btn-secondary",onClick:()=>Ze([]),children:"Auswahl aufheben"})]})]}),s.jsx("div",{className:"bank-table-container",children:s.jsxs("table",{className:"bank-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"checkbox-col",children:s.jsx("input",{type:"checkbox",checked:Je.length>0&&Je.length===Rs().filter(e=>"zugeordnet"!==e.status&&"ignoriert"!==e.status).length,onChange:()=>{const e=Rs().filter(e=>"zugeordnet"!==e.status&&"ignoriert"!==e.status).map(e=>e.transaktion_id);Je.length===e.length?Ze([]):Ze(e)}})}),s.jsxs("th",{className:"sortable",onClick:()=>$s("buchungsdatum"),children:["Datum","buchungsdatum"===Ye&&("asc"===Xe?s.jsx(ve,{size:14}):s.jsx(de,{size:14}))]}),s.jsxs("th",{className:"sortable",onClick:()=>$s("organisation_name"),children:["Organisation","organisation_name"===Ye&&("asc"===Xe?s.jsx(ve,{size:14}):s.jsx(de,{size:14}))]}),s.jsxs("th",{className:"betrag-col sortable",onClick:()=>$s("betrag"),children:["Betrag","betrag"===Ye&&("asc"===Xe?s.jsx(ve,{size:14}):s.jsx(de,{size:14}))]}),s.jsxs("th",{className:"sortable",onClick:()=>$s("auftraggeber_empfaenger"),children:["Auftraggeber/Empfänger","auftraggeber_empfaenger"===Ye&&("asc"===Xe?s.jsx(ve,{size:14}):s.jsx(de,{size:14}))]}),s.jsxs("th",{className:"sortable",onClick:()=>$s("verwendungszweck"),children:["Verwendungszweck","verwendungszweck"===Ye&&("asc"===Xe?s.jsx(ve,{size:14}):s.jsx(de,{size:14}))]}),s.jsxs("th",{className:"sortable",onClick:()=>$s("status"),children:["Status","status"===Ye&&("asc"===Xe?s.jsx(ve,{size:14}):s.jsx(de,{size:14}))]}),s.jsx("th",{children:"Aktionen"})]})}),s.jsx("tbody",{children:0===Rs().length?s.jsx("tr",{children:s.jsx("td",{colSpan:"8",className:"no-data",children:ss?"Keine Treffer für die Suche.":"Keine Transaktionen gefunden. Importieren Sie einen Kontoauszug."})}):Rs().map(e=>s.jsxs(a.Fragment,{children:[s.jsxs("tr",{className:`bank-row ${e.status}`,children:[s.jsx("td",{className:"checkbox-col",children:"zugeordnet"!==e.status&&"ignoriert"!==e.status&&s.jsx("input",{type:"checkbox",checked:Je.includes(e.transaktion_id),onChange:()=>{return s=e.transaktion_id,void Ze(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s}})}),s.jsx("td",{children:Ls(e.buchungsdatum)}),s.jsx("td",{className:"organisation-col",children:e.organisation_name||"-"}),s.jsx("td",{className:"betrag-col "+(e.betrag>=0?"einnahme":"ausgabe"),children:Ms(e.betrag)}),s.jsx("td",{className:"auftraggeber-col",children:e.auftraggeber_empfaenger}),s.jsx("td",{className:"verwendungszweck-col",children:e.verwendungszweck}),s.jsx("td",{children:s.jsxs("span",{className:`bank-status-badge ${e.status}`,children:["unzugeordnet"===e.status&&"Offen","vorgeschlagen"===e.status&&"Vorschlag","zugeordnet"===e.status&&"Zugeordnet","ignoriert"===e.status&&"Ignoriert"]})}),s.jsxs("td",{className:"actions",children:["vorgeschlagen"===e.status&&s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"btn-icon success",title:"Vorschlag annehmen",onClick:()=>(async e=>{var s,a;try{P(!0),await n.post(`/buchhaltung/bank-import/vorschlag-annehmen/${e}`,{},{headers:{Authorization:`Bearer ${r}`}}),W("Vorschlag angenommen"),Ts(),Fs(),setTimeout(()=>W(""),3e3)}catch(t){U((null==(a=null==(s=t.response)?void 0:s.data)?void 0:a.message)||"Fehler beim Annehmen")}finally{P(!1)}})(e.transaktion_id),children:s.jsx(fe,{size:14})}),s.jsx("button",{className:"btn-icon",title:"Andere Kategorie wählen",onClick:()=>{Ge(e),We(!0)},children:s.jsx(ue,{size:14})})]}),"unzugeordnet"===e.status&&s.jsx("button",{className:"btn-icon",title:"Kategorie zuordnen",onClick:()=>{Ge(e),We(!0)},children:s.jsx(he,{size:14})}),"unzugeordnet"===e.status&&e.betrag>0&&s.jsx("button",{className:"btn-icon rechnung",title:"Mit Rechnung verknüpfen",onClick:()=>{vs(e),(async()=>{try{const e=await n.get("/buchhaltung/bank-import/offene-rechnungen",{headers:{Authorization:`Bearer ${r}`}});bs(e.data.rechnungen||[])}catch(e){console.error("Fehler beim Laden offener Rechnungen:",e)}})(),xs(!0)},children:s.jsx(E,{size:14})}),("unzugeordnet"===e.status||"vorgeschlagen"===e.status)&&s.jsx("button",{className:"btn-icon danger",title:"Ignorieren",onClick:()=>(async(e,s=!1)=>{var a,t;try{P(!0),await n.post(`/buchhaltung/bank-import/ignorieren/${e}`,{lerne_regel:s},{headers:{Authorization:`Bearer ${r}`}}),W("Transaktion ignoriert"),Ts(),Fs(),setTimeout(()=>W(""),3e3)}catch(i){U((null==(t=null==(a=i.response)?void 0:a.data)?void 0:t.message)||"Fehler beim Ignorieren")}finally{P(!1)}})(e.transaktion_id),children:s.jsx(R,{size:14})}),"zugeordnet"!==e.status&&s.jsx("button",{className:"btn-icon danger",title:"Transaktion löschen",onClick:()=>(async e=>{var s,a;if(confirm("Transaktion wirklich löschen?"))try{P(!0),await n.delete(`/buchhaltung/bank-import/transaktion/${e}`,{headers:{Authorization:`Bearer ${r}`}}),W("Transaktion gelöscht"),Ts(),Fs(),setTimeout(()=>W(""),3e3)}catch(t){U((null==(a=null==(s=t.response)?void 0:s.data)?void 0:a.message)||"Fehler beim Löschen")}finally{P(!1)}})(e.transaktion_id),children:s.jsx(ge,{size:14})}),"zugeordnet"===e.status&&s.jsx("button",{className:"btn-icon",title:"Kategorie ändern (Umbuchung)",onClick:()=>{ms(e),os(!0)},children:s.jsx(ue,{size:14})})]})]}),"vorgeschlagen"===e.status&&e.match_details&&s.jsxs("tr",{className:"vorschlag-row",children:[s.jsx("td",{}),s.jsxs("td",{colSpan:"6",className:"vorschlag-info",children:[s.jsx(Ne,{size:14}),s.jsxs("span",{children:["beitrag"===e.match_typ&&`Beitrag: ${e.match_details.name} (${e.match_details.monat}/${e.match_details.jahr})`,"rechnung"===e.match_typ&&`Rechnung: ${e.match_details.rechnungsnummer} - ${e.match_details.name}`,"manuell"===e.match_typ&&`Kategorie: ${Ps(e.match_details.kategorie)}`]}),s.jsxs("span",{className:"confidence",children:["(",Math.round(100*(e.match_confidence||0)),"% Sicherheit)"]})]})]})]},e.transaktion_id))})]})}),Se>30&&s.jsxs("div",{className:"pagination",children:[0!==ns&&s.jsxs(s.Fragment,{children:[s.jsx("button",{disabled:1===$e,onClick:()=>Re(e=>Math.max(1,e-1)),children:"Zurück"}),s.jsxs("span",{children:["Seite ",$e," von ",Math.ceil(Se/ns)]}),s.jsx("button",{disabled:$e>=Math.ceil(Se/ns),onClick:()=>Re(e=>e+1),children:"Weiter"})]}),s.jsx("button",{className:0===ns?"btn-active":"",onClick:()=>{0===ns?(rs(30),Re(1)):rs(0)},children:0===ns?"Seiten anzeigen":"Alle anzeigen"}),0===ns&&s.jsxs("span",{children:[Se," Transaktionen"]})]}),Be.length>0&&s.jsxs("div",{className:"bank-historie",children:[s.jsxs("h4",{children:[s.jsx(ye,{size:16}),"Letzte Imports"]}),s.jsxs("table",{className:"historie-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Datei"}),s.jsx("th",{children:"Organisation"}),s.jsx("th",{children:"Bank"}),s.jsx("th",{children:"Transaktionen"}),s.jsx("th",{children:"Importiert am"}),s.jsx("th",{children:"Aktion"})]})}),s.jsx("tbody",{children:Be.map((e,a)=>s.jsxs("tr",{children:[s.jsx("td",{children:e.datei_name}),s.jsx("td",{children:e.organisation_name||"-"}),s.jsx("td",{children:e.bank_name}),s.jsx("td",{children:e.anzahl_transaktionen}),s.jsx("td",{children:Ls(e.importiert_am)}),s.jsx("td",{children:s.jsx("button",{className:"btn-icon danger",title:"Import löschen",onClick:()=>(async e=>{var s,a;if(confirm("Alle Transaktionen dieses Imports löschen? (Bereits zugeordnete bleiben erhalten)"))try{P(!0);const s=await n.delete(`/buchhaltung/bank-import/import/${e}`,{headers:{Authorization:`Bearer ${r}`}});W(s.data.message),Ts(),Fs(),setTimeout(()=>W(""),3e3)}catch(t){U((null==(a=null==(s=t.response)?void 0:s.data)?void 0:a.message)||"Fehler beim Löschen")}finally{P(!1)}})(e.import_id),children:s.jsx(ge,{size:14})})})]},a))})]})]})]}),"abschluss"===h&&s.jsxs("div",{className:"abschluss-content",children:[s.jsxs("div",{className:"abschluss-header",children:[s.jsxs("h3",{children:[s.jsx(ke,{size:18}),"Jahresabschluss ",g]}),s.jsxs("div",{className:"abschluss-actions",children:[s.jsxs("button",{className:"btn-secondary",onClick:async()=>{try{P(!0);const e=await n.get(`/buchhaltung/abschluss/${g}/export`,{headers:{Authorization:`Bearer ${r}`},params:{organisation:u},responseType:"blob"}),s=new Blob([e.data],{type:"text/csv;charset=utf-8"}),a=window.URL.createObjectURL(s),t=document.createElement("a");t.href=a,t.download=`EUeR_${g}_${u||"alle"}.csv`,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(a),W("Export erfolgreich"),setTimeout(()=>W(""),3e3)}catch(e){U("Export fehlgeschlagen")}finally{P(!1)}},children:[s.jsx(ae,{size:16}),"CSV Export"]}),"alle"!==u&&(!(null==B?void 0:B.abschluss)||"abgeschlossen"!==B.abschluss.status)&&s.jsxs("button",{className:"btn-primary",onClick:()=>_e(!0),children:[s.jsx(me,{size:16}),"Jahr festschreiben"]})]})]}),(null==B?void 0:B.abschluss)&&s.jsxs("div",{className:`abschluss-status ${B.abschluss.status}`,children:[s.jsx(A,{size:16}),"Status: ",B.abschluss.status,B.abschluss.abgeschlossen_am&&s.jsxs("span",{children:[" - Festgeschrieben am ",Ls(B.abschluss.abgeschlossen_am)]})]}),(null==B?void 0:B.berechnet)&&s.jsxs("div",{className:"abschluss-summary",children:[s.jsxs("div",{className:"summary-section",children:[s.jsx("h4",{children:"Einnahmen nach Kategorie"}),s.jsx("table",{className:"summary-table",children:s.jsxs("tbody",{children:[Object.entries(B.berechnet.einnahmen.details).map(([e,a])=>s.jsxs("tr",{children:[s.jsx("td",{children:Ps(e)}),s.jsx("td",{className:"right",children:Ms(a)})]},e)),s.jsxs("tr",{className:"total-row",children:[s.jsx("td",{children:s.jsx("strong",{children:"Gesamt Einnahmen"})}),s.jsx("td",{className:"right",children:s.jsx("strong",{children:Ms(B.berechnet.einnahmen.gesamt)})})]})]})})]}),s.jsxs("div",{className:"summary-section",children:[s.jsx("h4",{children:"Ausgaben nach Kategorie"}),s.jsx("table",{className:"summary-table",children:s.jsxs("tbody",{children:[Object.entries(B.berechnet.ausgaben.details).map(([e,a])=>s.jsxs("tr",{children:[s.jsx("td",{children:Ps(e)}),s.jsx("td",{className:"right",children:Ms(a)})]},e)),s.jsxs("tr",{className:"total-row",children:[s.jsx("td",{children:s.jsx("strong",{children:"Gesamt Ausgaben"})}),s.jsx("td",{className:"right",children:s.jsx("strong",{children:Ms(B.berechnet.ausgaben.gesamt)})})]})]})})]}),s.jsxs("div",{className:"abschluss-ergebnis "+(B.berechnet.gewinnVerlust>=0?"positiv":"negativ"),children:[s.jsx("span",{children:"Jahresergebnis:"}),s.jsx("span",{className:"ergebnis-wert",children:Ms(B.berechnet.gewinnVerlust)})]})]})]})]}),Z&&s.jsx("div",{className:"modal-overlay",onClick:()=>H(!1),children:s.jsxs("div",{className:"modal beleg-modal",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{children:Y?"Beleg bearbeiten":"Neuer Beleg"}),s.jsx("button",{className:"close-btn",onClick:()=>H(!1),children:s.jsx(ie,{size:20})})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Organisation *"}),s.jsxs("select",{value:fs.organisation_name,onChange:e=>Ns(s=>({...s,organisation_name:e.target.value})),children:[s.jsx("option",{value:"TDA International",children:"TDA International"}),s.jsx("option",{value:"Kampfkunstschule Schreiner",children:"Kampfkunstschule Schreiner"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Buchungsart *"}),s.jsxs("select",{value:fs.buchungsart,onChange:e=>Ns(s=>({...s,buchungsart:e.target.value})),children:[s.jsx("option",{value:"ausgabe",children:"Ausgabe"}),s.jsx("option",{value:"einnahme",children:"Einnahme"})]})]})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Belegdatum *"}),s.jsx("input",{type:"date",value:fs.beleg_datum,onChange:e=>Ns(s=>({...s,beleg_datum:e.target.value}))})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Buchungsdatum *"}),s.jsx("input",{type:"date",value:fs.buchungsdatum,onChange:e=>Ns(s=>({...s,buchungsdatum:e.target.value}))})]})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Betrag Netto (EUR) *"}),s.jsx("input",{type:"number",step:"0.01",min:"0",value:fs.betrag_netto,onChange:e=>Ns(s=>({...s,betrag_netto:e.target.value})),placeholder:"0.00"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"MwSt-Satz (%)"}),s.jsxs("select",{value:fs.mwst_satz,onChange:e=>Ns(s=>({...s,mwst_satz:e.target.value})),children:[s.jsx("option",{value:"19",children:"19%"}),s.jsx("option",{value:"7",children:"7%"}),s.jsx("option",{value:"0",children:"0% (steuerfrei)"})]})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Kategorie *"}),s.jsx("select",{value:fs.kategorie,onChange:e=>Ns(s=>({...s,kategorie:e.target.value})),children:F.filter(e=>"einnahme"===fs.buchungsart?"einnahme"===e.typ:"ausgabe"===e.typ).map(e=>s.jsxs("option",{value:e.id,children:[e.name," - ",e.beschreibung]},e.id))})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Beschreibung *"}),s.jsx("textarea",{value:fs.beschreibung,onChange:e=>Ns(s=>({...s,beschreibung:e.target.value})),placeholder:"Beschreibung des Belegs...",rows:"3"})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Lieferant / Kunde"}),s.jsx("input",{type:"text",value:fs.lieferant_kunde,onChange:e=>Ns(s=>({...s,lieferant_kunde:e.target.value})),placeholder:"Name des Lieferanten/Kunden"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Externe Rechnungsnummer"}),s.jsx("input",{type:"text",value:fs.rechnungsnummer_extern,onChange:e=>Ns(s=>({...s,rechnungsnummer_extern:e.target.value})),placeholder:"z.B. RE-2024-001"})]})]}),s.jsxs("div",{className:"brutto-preview",children:[s.jsx("span",{children:"Brutto-Betrag:"}),s.jsx("span",{className:"brutto-wert",children:Ms(parseFloat(fs.betrag_netto||0)*(1+parseFloat(fs.mwst_satz||0)/100))})]})]}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{className:"btn-secondary",onClick:()=>H(!1),children:"Abbrechen"}),s.jsx("button",{className:"btn-primary",onClick:async()=>{var e,s;try{P(!0),U(""),Y?(await n.put(`/buchhaltung/belege/${Y.beleg_id}`,fs,{headers:{Authorization:`Bearer ${r}`}}),W("Beleg erfolgreich aktualisiert")):(await n.post("/buchhaltung/belege",fs,{headers:{Authorization:`Bearer ${r}`}}),W("Beleg erfolgreich erstellt")),H(!1),X(null),Is(),Ds(),setTimeout(()=>W(""),3e3)}catch(a){console.error("Beleg speichern fehlgeschlagen:",a),U((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.message)||"Fehler beim Speichern des Belegs")}finally{P(!1)}},disabled:L||!fs.betrag_netto||!fs.beschreibung,children:L?"Speichern...":"Speichern"})]})]})}),ee&&s.jsx("div",{className:"modal-overlay",onClick:()=>se(!1),children:s.jsxs("div",{className:"modal upload-modal",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{children:"Beleg-Datei hochladen"}),s.jsx("button",{className:"close-btn",onClick:()=>se(!1),children:s.jsx(ie,{size:20})})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{className:"upload-info",children:[s.jsx(xe,{size:48}),s.jsx("p",{children:"Erlaubte Formate: PDF, JPG, PNG (max. 10MB)"})]}),s.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:async e=>{var s,a;const t=e.target.files[0];if(!t||!ne)return;const i=new FormData;i.append("datei",t);try{P(!0),await n.post(`/buchhaltung/belege/${ne}/upload`,i,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"multipart/form-data"}}),W("Datei erfolgreich hochgeladen"),se(!1),re(null),Ds(),setTimeout(()=>W(""),3e3)}catch(l){U((null==(a=null==(s=l.response)?void 0:s.data)?void 0:a.message)||"Fehler beim Upload")}finally{P(!1)}}})]})]})}),te&&s.jsx("div",{className:"modal-overlay",onClick:()=>_e(!1),children:s.jsxs("div",{className:"modal abschluss-modal",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsxs("h3",{children:["Jahr ",g," festschreiben"]}),s.jsx("button",{className:"close-btn",onClick:()=>_e(!1),children:s.jsx(ie,{size:20})})]}),s.jsx("div",{className:"modal-body",children:s.jsxs("div",{className:"warning-box",children:[s.jsx(M,{size:24}),s.jsxs("div",{children:[s.jsx("strong",{children:"Achtung!"}),s.jsxs("p",{children:["Nach dem Festschreiben können keine Änderungen mehr an den Belegen des Jahres ",g," für ",u," vorgenommen werden. Diese Aktion kann nicht rückgängig gemacht werden."]})]})]})}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{className:"btn-secondary",onClick:()=>_e(!1),children:"Abbrechen"}),s.jsx("button",{className:"btn-danger",onClick:async()=>{var e,s;if("alle"!==u){if(confirm(`Jahresabschluss ${g} für ${u} wirklich festschreiben? Danach sind keine Änderungen mehr möglich.`))try{P(!0),await n.post(`/buchhaltung/abschluss/${g}/festschreiben`,{organisation:u},{headers:{Authorization:`Bearer ${r}`}}),W("Jahresabschluss festgeschrieben"),_e(!1),Es(),setTimeout(()=>W(""),3e3)}catch(a){U((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.message)||"Fehler beim Festschreiben")}finally{P(!1)}}else U("Bitte wählen Sie eine Organisation aus")},disabled:L,children:L?"Wird festgeschrieben...":"Endgültig festschreiben"})]})]})}),Ve&&s.jsx("div",{className:"modal-overlay",onClick:()=>Ue(!1),children:s.jsxs("div",{className:"modal bank-upload-modal",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{children:"Kontoauszug importieren"}),s.jsx("button",{className:"close-btn",onClick:()=>Ue(!1),children:s.jsx(ie,{size:20})})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Organisation *"}),s.jsxs("select",{value:Le,onChange:e=>Pe(e.target.value),children:[s.jsx("option",{value:"Kampfkunstschule Schreiner",children:"Kampfkunstschule Schreiner"}),s.jsx("option",{value:"TDA International",children:"TDA International"})]})]}),s.jsxs("div",{className:"upload-area",children:[s.jsxs("div",{className:"upload-info",children:[s.jsx(je,{size:48}),s.jsx("p",{children:"CSV, Excel oder MT940 Datei hochladen"}),s.jsx("p",{className:"upload-hint",children:"Unterstützte Formate: CSV, XLS, XLSX, MT940 (STA)"})]}),s.jsx("input",{type:"file",accept:".csv,.sta,.mt940,.txt,.xls,.xlsx",onChange:e=>Me(e.target.files[0])}),Ie&&s.jsxs("div",{className:"selected-file",children:[s.jsx(E,{size:16}),Ie.name]})]})]}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{className:"btn-secondary",onClick:()=>{Ue(!1),Me(null)},children:"Abbrechen"}),s.jsx("button",{className:"btn-primary",onClick:async()=>{var e,s;if(!Ie)return;const a=new FormData;a.append("datei",Ie),a.append("organisation",Le);try{He(!0),U("");const e=await n.post("/buchhaltung/bank-import/upload",a,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"multipart/form-data"}});W(`Import erfolgreich: ${e.data.count} Transaktionen importiert, ${e.data.duplikate} Duplikate übersprungen`),Ue(!1),Me(null),Ts(),Fs(),setTimeout(()=>W(""),5e3)}catch(t){console.error("Bank-Upload fehlgeschlagen:",t),U((null==(s=null==(e=t.response)?void 0:e.data)?void 0:s.message)||"Fehler beim Import")}finally{He(!1)}},disabled:!Ie||qe,children:qe?"Wird importiert...":"Importieren"})]})]})}),Ke&&(Oe||Je.length>0)&&s.jsx("div",{className:"modal-overlay kategorie-overlay",onClick:()=>We(!1),children:s.jsxs("div",{className:"modal kategorie-modal kategorie-modal-wide",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{children:Je.length>0&&!Oe?`${Je.length} Transaktionen zuordnen`:"Kategorie zuordnen"}),s.jsx("button",{className:"close-btn",onClick:()=>We(!1),children:s.jsx(ie,{size:20})})]}),s.jsxs("div",{className:"modal-body",children:[s.jsx("div",{className:"form-group checkbox-group regel-lernen-top",children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",id:"lerne-regel"}),"Regel lernen (diese Zuordnung für ähnliche Transaktionen merken)"]})}),Oe&&s.jsxs("div",{className:"tx-preview",children:[s.jsxs("div",{className:"tx-preview-row",children:[s.jsx("span",{children:"Datum:"}),s.jsx("span",{children:Ls(Oe.buchungsdatum)})]}),s.jsxs("div",{className:"tx-preview-row",children:[s.jsx("span",{children:"Betrag:"}),s.jsx("span",{className:Oe.betrag>=0?"einnahme":"ausgabe",children:Ms(Oe.betrag)})]}),s.jsxs("div",{className:"tx-preview-row",children:[s.jsx("span",{children:"Auftraggeber:"}),s.jsx("span",{children:Oe.auftraggeber_empfaenger})]}),s.jsxs("div",{className:"tx-preview-row",children:[s.jsx("span",{children:"Verwendungszweck:"}),s.jsx("span",{children:Oe.verwendungszweck})]})]}),Je.length>0&&!Oe&&s.jsxs("div",{className:"tx-preview batch-preview",children:[s.jsxs("div",{className:"batch-summary",children:[s.jsxs("strong",{children:[Je.length," Transaktionen ausgewählt"]}),s.jsxs("span",{className:"batch-total",children:["Gesamt: ",Ms(ze.filter(e=>Je.includes(e.transaktion_id)).reduce((e,s)=>e+parseFloat(s.betrag),0))]})]}),s.jsxs("div",{className:"batch-list",children:[ze.filter(e=>Je.includes(e.transaktion_id)).slice(0,5).map(e=>s.jsxs("div",{className:"batch-item",children:[s.jsx("span",{children:Ls(e.buchungsdatum)}),s.jsx("span",{className:e.betrag>=0?"einnahme":"ausgabe",children:Ms(e.betrag)}),s.jsx("span",{children:e.auftraggeber_empfaenger})]},e.transaktion_id)),Je.length>5&&s.jsxs("div",{className:"batch-more",children:["... und ",Je.length-5," weitere"]})]})]}),s.jsx("div",{className:"kategorie-grid",children:F.map(e=>s.jsxs("button",{className:`kategorie-btn ${e.typ}`,onClick:()=>{var s;const a=(null==(s=document.getElementById("lerne-regel"))?void 0:s.checked)||!1;Je.length>0&&!Oe?((async(e,s=!1)=>{var a,t;if(0!==Je.length)try{P(!0);const a=Je.map(s=>({id:s,kategorie:e}));await n.post("/buchhaltung/bank-import/batch-zuordnen",{transaktionen:a,lerne_regel:s},{headers:{Authorization:`Bearer ${r}`}}),W(`${Je.length} Transaktionen zugeordnet`),Ze([]),Ts(),Fs(),setTimeout(()=>W(""),3e3)}catch(i){U((null==(t=null==(a=i.response)?void 0:a.data)?void 0:t.message)||"Fehler bei der Batch-Zuordnung")}finally{P(!1)}})(e.id,a),We(!1)):(async(e,s=!1)=>{var a,t;if(Oe)try{P(!0),await n.post(`/buchhaltung/bank-import/zuordnen/${Oe.transaktion_id}`,{kategorie:e,lerne_regel:s},{headers:{Authorization:`Bearer ${r}`}}),W("Transaktion zugeordnet"),We(!1),Ge(null),Ts(),Fs(),setTimeout(()=>W(""),3e3)}catch(i){U((null==(t=null==(a=i.response)?void 0:a.data)?void 0:t.message)||"Fehler bei der Zuordnung")}finally{P(!1)}})(e.id,a)},children:[s.jsx("span",{className:"kat-name",children:e.name}),s.jsx("span",{className:"kat-desc",children:e.beschreibung})]},e.id))})]})]})}),cs&&hs&&s.jsx("div",{className:"modal-overlay kategorie-overlay",onClick:()=>os(!1),children:s.jsxs("div",{className:"modal kategorie-modal kategorie-modal-wide",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{children:"Kategorie ändern (Umbuchung)"}),s.jsx("button",{className:"close-btn",onClick:()=>os(!1),children:s.jsx(ie,{size:20})})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{className:"tx-preview",children:[s.jsxs("div",{className:"tx-preview-row",children:[s.jsx("span",{children:"Datum:"}),s.jsx("span",{children:Ls(hs.buchungsdatum)})]}),s.jsxs("div",{className:"tx-preview-row",children:[s.jsx("span",{children:"Betrag:"}),s.jsx("span",{className:hs.betrag>=0?"einnahme":"ausgabe",children:Ms(hs.betrag)})]}),s.jsxs("div",{className:"tx-preview-row",children:[s.jsx("span",{children:"Auftraggeber:"}),s.jsx("span",{children:hs.auftraggeber_empfaenger})]}),s.jsxs("div",{className:"tx-preview-row",children:[s.jsx("span",{children:"Verwendungszweck:"}),s.jsx("span",{children:hs.verwendungszweck})]}),s.jsxs("div",{className:"tx-preview-row highlight",children:[s.jsx("span",{children:"Aktuelle Kategorie:"}),s.jsx("span",{className:"current-kategorie",children:Ps(hs.kategorie)})]})]}),s.jsx("h4",{className:"neue-kategorie-title",children:"Neue Kategorie wählen:"}),s.jsx("div",{className:"kategorie-grid",children:F.map(e=>s.jsxs("button",{className:`kategorie-btn ${e.typ} ${hs.kategorie===e.id?"current":""}`,onClick:()=>{e.id!==hs.kategorie&&(async(e,s)=>{var a,t;try{P(!0),await n.post(`/buchhaltung/bank-import/umbuchen/${e}`,{kategorie:s},{headers:{Authorization:`Bearer ${r}`}}),W("Kategorie geändert"),os(!1),ms(null),Ts(),Fs(),setTimeout(()=>W(""),3e3)}catch(i){U((null==(t=null==(a=i.response)?void 0:a.data)?void 0:t.message)||"Fehler bei der Umbuchung")}finally{P(!1)}})(hs.transaktion_id,e.id)},disabled:e.id===hs.kategorie,children:[s.jsx("span",{className:"kat-name",children:e.name}),s.jsx("span",{className:"kat-desc",children:e.beschreibung}),hs.kategorie===e.id&&s.jsx("span",{className:"current-marker",children:"Aktuell"})]},e.id))})]}),s.jsx("div",{className:"modal-footer",children:s.jsx("button",{className:"btn-secondary",onClick:()=>{os(!1),ms(null)},children:"Abbrechen"})})]})}),us&&js&&s.jsx("div",{className:"modal-overlay kategorie-overlay",onClick:()=>xs(!1),children:s.jsxs("div",{className:"modal kategorie-modal kategorie-modal-wide",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{children:"Mit Rechnung verknüpfen"}),s.jsx("button",{className:"close-btn",onClick:()=>xs(!1),children:s.jsx(ie,{size:20})})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{className:"tx-preview",children:[s.jsxs("div",{className:"tx-preview-row",children:[s.jsx("span",{children:"Datum:"}),s.jsx("span",{children:Ls(js.buchungsdatum)})]}),s.jsxs("div",{className:"tx-preview-row",children:[s.jsx("span",{children:"Betrag:"}),s.jsx("span",{className:"einnahme",children:Ms(js.betrag)})]}),s.jsxs("div",{className:"tx-preview-row",children:[s.jsx("span",{children:"Auftraggeber:"}),s.jsx("span",{children:js.auftraggeber_empfaenger})]}),s.jsxs("div",{className:"tx-preview-row",children:[s.jsx("span",{children:"Verwendungszweck:"}),s.jsx("span",{children:js.verwendungszweck})]})]}),s.jsx("h4",{className:"neue-kategorie-title",children:"Offene Rechnungen:"}),0===ps.length?s.jsx("p",{style:{color:"rgba(255,255,255,0.6)",textAlign:"center",padding:"1rem"},children:"Keine offenen Verbandsrechnungen vorhanden"}):s.jsx("div",{className:"rechnungen-liste",style:{maxHeight:"300px",overflowY:"auto"},children:ps.map(e=>s.jsxs("div",{className:"rechnung-item",onClick:()=>(async e=>{var s,a;if(js)try{P(!0),await n.post(`/buchhaltung/bank-import/rechnung-verknuepfen/${js.transaktion_id}`,{rechnung_id:e},{headers:{Authorization:`Bearer ${r}`}}),W("Transaktion mit Rechnung verknüpft"),xs(!1),vs(null),Ts(),Fs(),setTimeout(()=>W(""),3e3)}catch(t){U((null==(a=null==(s=t.response)?void 0:s.data)?void 0:a.message)||"Fehler bei der Verknüpfung")}finally{P(!1)}})(e.id),style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem 1rem",background:Math.abs(js.betrag-e.summe_brutto)<.01?"rgba(34, 197, 94, 0.15)":"rgba(255, 255, 255, 0.05)",border:Math.abs(js.betrag-e.summe_brutto)<.01?"1px solid rgba(34, 197, 94, 0.4)":"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"8px",marginBottom:"0.5rem",cursor:"pointer",transition:"all 0.2s"},children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontWeight:"600",color:"#fff"},children:e.rechnungsnummer}),s.jsx("div",{style:{fontSize:"0.85rem",color:"rgba(255,255,255,0.7)"},children:e.empfaenger_name}),s.jsx("div",{style:{fontSize:"0.8rem",color:"rgba(255,255,255,0.5)"},children:Ls(e.rechnungsdatum)})]}),s.jsxs("div",{style:{textAlign:"right"},children:[s.jsx("div",{style:{fontWeight:"600",color:"#22c55e"},children:Ms(e.summe_brutto)}),Math.abs(js.betrag-e.summe_brutto)<.01&&s.jsx("div",{style:{fontSize:"0.75rem",color:"#22c55e"},children:"✓ Betrag stimmt"})]})]},e.id))}),s.jsx("p",{style:{fontSize:"0.8rem",color:"rgba(255,255,255,0.5)",marginTop:"1rem",fontStyle:"italic"},children:"Hinweis: Die Verknüpfung markiert die Rechnung als bezahlt. Die EÜR-Buchung erfolgt über die Bank-Transaktion."})]}),s.jsx("div",{className:"modal-footer",children:s.jsx("button",{className:"btn-secondary",onClick:()=>{xs(!1),vs(null)},children:"Abbrechen"})})]})}),L&&s.jsx("div",{className:"loading-overlay",children:s.jsx("div",{className:"spinner"})})]})},bs=()=>{var r,t,i,d,c,o,h,m,u;const{token:x}=l(),[g,p]=e.useState(!0),[b,j]=e.useState(""),[v,f]=e.useState(null),[N,y]=e.useState(null),[k,_]=e.useState([]),[w,S]=e.useState(!1),[E,F]=e.useState(!1),[$,I]=e.useState(null),[M,P]=e.useState(!1),[V,U]=e.useState(!1),[K,W]=e.useState(14),[O,q]=e.useState("starter"),[H,Y]=e.useState("monthly"),[Q,X]=e.useState(12),[ee,se]=e.useState(""),[ae,ne]=e.useState(""),[te,ie]=e.useState(!1),[le,ce]=e.useState(new Set),[oe,me]=e.useState("overview"),[xe,pe]=e.useState([]),[be,je]=e.useState(null),[fe,Ne]=e.useState(!1),[ye,ke]=e.useState([]),[ze,we]=e.useState(null),[Se,Ce]=e.useState(!1),[Ae,De]=e.useState("alle"),[Be,Ee]=e.useState(null),[Te,Fe]=e.useState(!1),[$e,Re]=e.useState({smtp_host:"",smtp_port:587,smtp_secure:!0,smtp_user:"",smtp_password:"",default_from_email:"noreply@tda-intl.com",default_from_name:"DojoSoftware",aktiv:!0}),[Ie,Me]=e.useState(!1),[Le,Pe]=e.useState(""),[Ve,Ue]=e.useState("");e.useEffect(()=>{if(x)try{const e=JSON.parse(atob(x.split(".")[1]));ie("admin"===e.username||1===e.user_id)}catch(e){console.error("Token decode error:",e)}},[x]),e.useEffect(()=>{Ke(),We()},[]);const Ke=async()=>{var e,s;p(!0),j("");try{const[e,s,a]=await Promise.all([n.get("/admin/tda-stats",{headers:{Authorization:`Bearer ${x}`}}),n.get("/admin/global-stats",{headers:{Authorization:`Bearer ${x}`}}),n.get("/admin/dojos",{headers:{Authorization:`Bearer ${x}`}})]);f(e.data.stats),y(s.data.stats),_(a.data.dojos),console.log("✅ Super-Admin Daten geladen")}catch(a){console.error("❌ Fehler beim Laden der Super-Admin Daten:",a),j((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.message)||"Fehler beim Laden der Daten")}finally{p(!1)}},We=async()=>{try{Ne(!0);const e=await n.get("/admin/subscription-plans",{headers:{Authorization:`Bearer ${x}`}});e.data.success&&pe(e.data.plans)}catch(e){console.error("Fehler beim Laden der Pläne:",e)}finally{Ne(!1)}},Ze=async(e="alle")=>{try{Ce(!0);const s="alle"!==e?`?status=${e}`:"",a=await n.get(`/verband-auth/admin/bestellungen${s}`,{headers:{Authorization:`Bearer ${x}`}});a.data.success&&(ke(a.data.bestellungen),we(a.data.stats))}catch(s){console.error("Fehler beim Laden der Bestellungen:",s)}finally{Ce(!1)}},He=async(e,s)=>{try{Fe(!0);(await n.put(`/verband-auth/admin/bestellungen/${e}`,s,{headers:{Authorization:`Bearer ${x}`}})).data.success&&(await Ze(Ae),Ee(null))}catch(a){console.error("Fehler beim Aktualisieren der Bestellung:",a),alert("Fehler beim Aktualisieren")}finally{Fe(!1)}};e.useEffect(()=>{"email"===oe&&(async()=>{try{Me(!0);const e=await n.get("/email-settings/global",{headers:{Authorization:`Bearer ${x}`}});e.data.success&&Re(e.data.data)}catch(e){console.error("Fehler beim Laden der E-Mail-Einstellungen:",e)}finally{Me(!1)}})()},[oe]),e.useEffect(()=>{"bestellungen"===oe&&Ze(Ae)},[oe,Ae]);const Ye=e=>{const a={trial:{label:"Trial",className:"info",icon:s.jsx(D,{size:14})},active:{label:"Aktiv",className:"success",icon:s.jsx(A,{size:14})},expired:{label:"Abgelaufen",className:"danger",icon:s.jsx(R,{size:14})},cancelled:{label:"Gekündigt",className:"warning",icon:s.jsx(B,{size:14})},suspended:{label:"Gesperrt",className:"danger",icon:s.jsx(R,{size:14})}},n=a[e.subscription_status]||a.trial;return s.jsxs("span",{className:`status-badge ${n.className}`,children:[n.icon," ",n.label]})},Qe=e=>{if("trial"===e.subscription_status){const a=e.trial_days_remaining;return null===a?"-":a<0?s.jsx("span",{className:"text-danger",children:"Abgelaufen"}):0===a?s.jsx("span",{className:"text-danger",children:"Heute"}):a<=3?s.jsxs("span",{className:"text-danger",children:[a," Tage"]}):a<=7?s.jsxs("span",{className:"text-warning",children:[a," Tage"]}):s.jsxs("span",{children:[a," Tage"]})}if("active"===e.subscription_status){const a=e.subscription_days_remaining;if(null===a)return"-";if(a<0)return s.jsx("span",{className:"text-danger",children:"Abgelaufen"});if(0===a)return s.jsx("span",{className:"text-danger",children:"Heute"});if(a<=14)return s.jsxs("span",{className:"text-warning",children:[a," Tage"]});return new Date(e.subscription_ends_at).toLocaleDateString("de-DE")}return"-"},Xe=e=>{ce(s=>{const a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a})};if(g)return s.jsx("div",{className:"super-admin-dashboard",children:s.jsxs("div",{className:"loading-container",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Lade Super-Admin Dashboard..."})]})});if(b)return s.jsx("div",{className:"super-admin-dashboard",children:s.jsxs("div",{className:"error-container",children:[s.jsx(R,{size:48}),s.jsx("h2",{children:"Fehler"}),s.jsx("p",{children:b}),s.jsx("button",{onClick:Ke,className:"btn btn-primary",children:"Erneut versuchen"})]})});return s.jsxs("div",{className:"super-admin-dashboard",children:[s.jsx("div",{className:"dashboard-tabs",children:[{id:"overview",label:"Übersicht",icon:"📊"},{id:"verbandsmitglieder",label:"Verbandsmitglieder",icon:"🏆"},{id:"shop",label:"Artikel/Shop",icon:"🛒"},{id:"bestellungen",label:"Bestellungen",icon:"📦"},{id:"entwicklung",label:"Entwicklung",icon:"🎯"},{id:"support",label:"Support",icon:"🎫"},{id:"statistics",label:"Statistiken",icon:"📈"},{id:"finanzen",label:"Finanzen",icon:"💰"},{id:"buchhaltung",label:"Buchhaltung",icon:"📒"},{id:"contracts",label:"Verträge",icon:"📄"},{id:"users",label:"Benutzer",icon:"👤"},{id:"plans",label:"Pläne & Preise",icon:"💳"},{id:"email",label:"E-Mail",icon:"✉️"}].map(e=>s.jsxs("button",{className:"dashboard-tab "+(oe===e.id?"active":""),onClick:()=>me(e.id),children:[s.jsx("span",{className:"tab-icon",children:e.icon}),s.jsx("span",{className:"tab-label",children:e.label})]},e.id))}),s.jsxs("div",{className:"tab-content",children:["overview"===oe&&s.jsxs(s.Fragment,{children:[s.jsxs("section",{className:"stats-section",children:[s.jsxs("h2",{className:"section-title",children:[s.jsx(Z,{size:20}),"TDA International Statistiken"]}),s.jsx("div",{className:"stats-grid",children:s.jsxs("div",{className:"stat-card primary",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(z,{size:32})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-value",children:(null==(r=null==v?void 0:v.members)?void 0:r.active_members)||0}),s.jsx("div",{className:"stat-label",children:"Aktive Mitglieder"}),s.jsxs("div",{className:"stat-sublabel",children:["von ",(null==(t=null==v?void 0:v.members)?void 0:t.total_members)||0," gesamt"]})]})]})})]}),s.jsxs("section",{className:"stats-section",children:[s.jsxs("h2",{className:"section-title",children:[s.jsx(L,{size:20}),"Verbandsstatistiken (Alle Dojos)"]}),s.jsxs("div",{className:"stats-grid",children:[s.jsxs("div",{className:"stat-card global-primary",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(Z,{size:32})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-value",children:(null==(i=null==N?void 0:N.dojos)?void 0:i.active_dojos)||0}),s.jsx("div",{className:"stat-label",children:"Aktive Dojos"}),s.jsxs("div",{className:"stat-sublabel",children:["von ",(null==(d=null==N?void 0:N.dojos)?void 0:d.total_dojos)||0," gesamt"]})]})]}),s.jsxs("div",{className:"stat-card global-success",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(z,{size:32})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-value",children:(null==(c=null==N?void 0:N.members)?void 0:c.active_members)||0}),s.jsx("div",{className:"stat-label",children:"Mitglieder (Verband)"}),s.jsxs("div",{className:"stat-sublabel",children:["in ",(null==(o=null==N?void 0:N.members)?void 0:o.dojos_with_members)||0," Dojos"]})]})]}),s.jsxs("div",{className:"stat-card global-warning",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(_e,{size:32})}),s.jsxs("div",{className:"stat-content",children:[s.jsxs("div",{className:"stat-value",children:[(null==(h=null==N?void 0:N.storage)?void 0:h.used_gb)||"0"," / ",(null==(m=null==N?void 0:N.storage)?void 0:m.total_gb)||"0"," GB"]}),s.jsx("div",{className:"stat-label",children:"Server-Speicher"}),s.jsxs("div",{className:"stat-sublabel",children:[(null==(u=null==N?void 0:N.storage)?void 0:u.percent_used)||0,"% belegt"]})]})]})]})]}),s.jsxs("section",{className:"dojos-section",children:[s.jsxs("div",{className:"section-header",children:[s.jsxs("h2",{className:"section-title",children:[s.jsx(G,{size:20}),"Dojo-Verwaltung"]}),s.jsx("div",{className:"header-actions",children:s.jsxs("button",{onClick:()=>{I(null),S(!0)},className:"btn btn-primary",children:[s.jsx(he,{size:16}),"Neues Dojo anlegen"]})})]}),s.jsxs("div",{className:"dojos-table-container",children:[s.jsxs("table",{className:"dojos-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"40px"}}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Dojo-Name"}),s.jsx("th",{children:"Subdomain"}),s.jsx("th",{children:"Inhaber"}),s.jsx("th",{children:"Ort"}),s.jsx("th",{className:"text-center",children:"Mitglieder"}),s.jsx("th",{className:"text-center",children:"Kurse"}),s.jsx("th",{className:"text-center",children:"Speicher"}),s.jsx("th",{className:"text-center",children:"Abo-Status"}),s.jsx("th",{className:"text-center",children:"Trial/Abo Ende"})]})}),s.jsx("tbody",{children:k.map(e=>{const r=le.has(e.id);return s.jsxs(a.Fragment,{children:[s.jsxs("tr",{className:`dojo-row ${e.ist_aktiv?"":"inactive"} ${r?"expanded":""}`,onClick:()=>Xe(e.id),style:{cursor:"pointer"},children:[s.jsx("td",{children:s.jsx("button",{className:"expand-toggle",onClick:s=>{s.stopPropagation(),Xe(e.id)},children:r?s.jsx(ve,{size:16}):s.jsx(de,{size:16})})}),s.jsx("td",{children:e.ist_aktiv?s.jsxs("span",{className:"status-badge active",children:[s.jsx(A,{size:14})," Aktiv"]}):s.jsxs("span",{className:"status-badge inactive",children:[s.jsx(R,{size:14})," Inaktiv"]})}),s.jsx("td",{className:"font-bold",children:e.dojoname}),s.jsx("td",{children:s.jsx("code",{className:"subdomain",children:e.subdomain})}),s.jsx("td",{children:e.inhaber}),s.jsx("td",{children:e.ort||"-"}),s.jsx("td",{className:"text-center",children:e.mitglieder_count||0}),s.jsx("td",{className:"text-center",children:e.kurse_count||0}),s.jsx("td",{className:"text-center",children:e.storage_mb>=1024?`${e.storage_gb} GB`:`${e.storage_mb} MB`}),s.jsx("td",{className:"text-center",children:Ye(e)}),s.jsx("td",{className:"text-center",children:Qe(e)})]}),r&&s.jsx("tr",{className:"expandable-row",children:s.jsx("td",{colSpan:11,className:"expandable-cell",children:s.jsxs("div",{className:"dojo-details-panel",children:[s.jsxs("div",{className:"details-card",children:[s.jsxs("div",{className:"details-card-header",children:[s.jsx("span",{className:"details-card-icon",children:"📍"}),s.jsx("h4",{children:"Kontaktdaten"})]}),s.jsxs("div",{className:"details-card-body",children:[s.jsxs("div",{className:"details-row",children:[s.jsx("span",{className:"details-label",children:"E-Mail"}),s.jsx("span",{className:"details-value",children:e.email||"-"})]}),s.jsxs("div",{className:"details-row",children:[s.jsx("span",{className:"details-label",children:"Telefon"}),s.jsx("span",{className:"details-value",children:e.telefon||"-"})]}),s.jsxs("div",{className:"details-row",children:[s.jsx("span",{className:"details-label",children:"Adresse"}),s.jsx("span",{className:"details-value",children:e.strasse||e.plz||e.ort?`${e.strasse||""} ${e.hausnummer||""}, ${e.plz||""} ${e.ort||""}`:"-"})]}),s.jsxs("div",{className:"details-row",children:[s.jsx("span",{className:"details-label",children:"Land"}),s.jsx("span",{className:"details-value",children:e.land||"Deutschland"})]})]})]}),s.jsxs("div",{className:"details-card",children:[s.jsxs("div",{className:"details-card-header",children:[s.jsx("span",{className:"details-card-icon",children:"💳"}),s.jsx("h4",{children:"Abonnement"})]}),s.jsxs("div",{className:"details-card-body",children:[s.jsxs("div",{className:"details-row",children:[s.jsx("span",{className:"details-label",children:"Status"}),s.jsx("span",{className:"details-value",children:Ye(e)})]}),"trial"===e.subscription_status&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"details-row",children:[s.jsx("span",{className:"details-label",children:"Trial Start"}),s.jsx("span",{className:"details-value",children:e.trial_starts_at?new Date(e.trial_starts_at).toLocaleDateString("de-DE"):"-"})]}),s.jsxs("div",{className:"details-row",children:[s.jsx("span",{className:"details-label",children:"Trial Ende"}),s.jsx("span",{className:"details-value",children:e.trial_ends_at?new Date(e.trial_ends_at).toLocaleDateString("de-DE"):"-"})]}),s.jsxs("div",{className:"details-row highlight",children:[s.jsx("span",{className:"details-label",children:"Verbleibend"}),s.jsx("span",{className:"details-value countdown",children:null!==e.trial_days_remaining?`${e.trial_days_remaining} Tage`:"-"})]})]}),"active"===e.subscription_status&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"details-row",children:[s.jsx("span",{className:"details-label",children:"Plan"}),s.jsx("span",{className:"details-value plan-badge",children:e.subscription_plan||"-"})]}),s.jsxs("div",{className:"details-row",children:[s.jsx("span",{className:"details-label",children:"Intervall"}),s.jsx("span",{className:"details-value",children:e.subscription_interval||"-"})]}),s.jsxs("div",{className:"details-row",children:[s.jsx("span",{className:"details-label",children:"Abo Start"}),s.jsx("span",{className:"details-value",children:e.subscription_starts_at?new Date(e.subscription_starts_at).toLocaleDateString("de-DE"):"-"})]}),s.jsxs("div",{className:"details-row",children:[s.jsx("span",{className:"details-label",children:"Abo Ende"}),s.jsx("span",{className:"details-value",children:e.subscription_ends_at?new Date(e.subscription_ends_at).toLocaleDateString("de-DE"):"-"})]}),null!==e.subscription_days_remaining&&s.jsxs("div",{className:"details-row highlight",children:[s.jsx("span",{className:"details-label",children:"Verbleibend"}),s.jsxs("span",{className:"details-value countdown",children:[e.subscription_days_remaining," Tage"]})]})]})]})]}),s.jsxs("div",{className:"details-card actions-card",children:[s.jsxs("div",{className:"details-card-header",children:[s.jsx("span",{className:"details-card-icon",children:"⚡"}),s.jsx("h4",{children:"Aktionen"})]}),s.jsx("div",{className:"details-card-body",children:s.jsxs("div",{className:"action-buttons-grid",children:["trial"===e.subscription_status&&s.jsxs("button",{onClick:s=>{s.stopPropagation(),(e=>{I(e),W(14),P(!0)})(e)},className:"action-btn warning",title:"Trial verlängern",children:[s.jsx(D,{size:16}),s.jsx("span",{children:"Trial verlängern"})]}),("trial"===e.subscription_status||"expired"===e.subscription_status)&&s.jsxs("button",{onClick:s=>{s.stopPropagation(),(e=>{I(e),q("basic"),Y("monthly"),X(12),se(""),ne(""),U(!0)})(e)},className:"action-btn success",title:"Abo aktivieren",children:[s.jsx(A,{size:16}),s.jsx("span",{children:"Abo aktivieren"})]}),s.jsxs("button",{onClick:s=>{s.stopPropagation(),(e=>{I(e),F(!0)})(e)},className:"action-btn secondary",title:"Bearbeiten",children:[s.jsx(ue,{size:16}),s.jsx("span",{children:"Bearbeiten"})]}),2!==e.id&&s.jsxs("button",{onClick:s=>{s.stopPropagation(),(async e=>{var s,a;if(confirm(`Möchten Sie "${e.dojoname}" wirklich deaktivieren?`))try{await n.delete(`/admin/dojos/${e.id}`,{headers:{Authorization:`Bearer ${x}`}}),alert(`Dojo "${e.dojoname}" wurde deaktiviert`),Ke()}catch(r){console.error("❌ Fehler beim Löschen:",r),alert((null==(a=null==(s=r.response)?void 0:s.data)?void 0:a.error)||"Fehler beim Löschen")}})(e)},className:"action-btn danger",title:"Deaktivieren",children:[s.jsx(ge,{size:16}),s.jsx("span",{children:"Deaktivieren"})]})]})})]})]})})})]},e.id)})})]}),0===k.length&&s.jsxs("div",{className:"empty-state",children:[s.jsx(Z,{size:48}),s.jsx("p",{children:"Keine Dojos gefunden"})]})]})]}),(null==N?void 0:N.top_dojos)&&N.top_dojos.length>0&&s.jsxs("section",{className:"top-dojos-section",children:[s.jsxs("h2",{className:"section-title",children:[s.jsx(C,{size:20}),"Top Dojos nach Mitgliederzahl"]}),s.jsx("div",{className:"top-dojos-grid",children:N.top_dojos.slice(0,5).map((e,a)=>s.jsxs("div",{className:"top-dojo-card",children:[s.jsxs("div",{className:"ranking-badge",children:["#",a+1]}),s.jsxs("div",{className:"dojo-info",children:[s.jsx("h3",{children:e.dojoname}),s.jsxs("div",{className:"dojo-stats",children:[s.jsxs("span",{children:[s.jsx(z,{size:14})," ",e.member_count," Mitglieder"]}),s.jsxs("span",{children:[s.jsx(T,{size:14})," ",e.course_count," Kurse"]})]})]})]},e.id))})]})]}),"verbandsmitglieder"===oe&&s.jsx(Je,{}),"shop"===oe&&s.jsx(qe,{}),"bestellungen"===oe&&s.jsxs("section",{className:"bestellungen-section",children:[s.jsx("h2",{className:"section-title",children:"📦 Shop-Bestellungen"}),ze&&s.jsxs("div",{className:"bestellungen-stats",children:[s.jsxs("div",{className:"stat-card stat-offen",onClick:()=>De("offen"),children:[s.jsx("span",{className:"stat-number",children:ze.offen||0}),s.jsx("span",{className:"stat-label",children:"Offen"})]}),s.jsxs("div",{className:"stat-card stat-bearbeitung",onClick:()=>De("in_bearbeitung"),children:[s.jsx("span",{className:"stat-number",children:ze.in_bearbeitung||0}),s.jsx("span",{className:"stat-label",children:"In Bearbeitung"})]}),s.jsxs("div",{className:"stat-card stat-versendet",onClick:()=>De("versendet"),children:[s.jsx("span",{className:"stat-number",children:ze.versendet||0}),s.jsx("span",{className:"stat-label",children:"Versendet"})]}),s.jsxs("div",{className:"stat-card stat-abgeschlossen",onClick:()=>De("abgeschlossen"),children:[s.jsx("span",{className:"stat-number",children:ze.abgeschlossen||0}),s.jsx("span",{className:"stat-label",children:"Abgeschlossen"})]}),s.jsxs("div",{className:"stat-card stat-alle",onClick:()=>De("alle"),children:[s.jsx("span",{className:"stat-number",children:ze.gesamt||0}),s.jsx("span",{className:"stat-label",children:"Gesamt"})]})]}),s.jsxs("div",{className:"bestellungen-filter",children:[s.jsx("label",{children:"Status:"}),s.jsxs("select",{value:Ae,onChange:e=>De(e.target.value),children:[s.jsx("option",{value:"alle",children:"Alle"}),s.jsx("option",{value:"offen",children:"Offen"}),s.jsx("option",{value:"in_bearbeitung",children:"In Bearbeitung"}),s.jsx("option",{value:"versendet",children:"Versendet"}),s.jsx("option",{value:"abgeschlossen",children:"Abgeschlossen"}),s.jsx("option",{value:"storniert",children:"Storniert"})]})]}),Se?s.jsx("div",{className:"loading-spinner",children:"Lade Bestellungen..."}):0===ye.length?s.jsx("div",{className:"empty-state",children:s.jsx("p",{children:"Keine Bestellungen gefunden."})}):s.jsx("div",{className:"bestellungen-liste",children:ye.map(e=>{var a,n;return s.jsxs("div",{className:"bestellung-card "+((null==Be?void 0:Be.id)===e.id?"selected":""),onClick:()=>Ee((null==Be?void 0:Be.id)===e.id?null:e),children:[s.jsxs("div",{className:"bestellung-header",children:[s.jsx("span",{className:"bestellung-nummer",children:e.bestellnummer}),s.jsxs("span",{className:`bestellung-status status-${e.status}`,children:["offen"===e.status&&"🟡 Offen","in_bearbeitung"===e.status&&"🔵 In Bearbeitung","versendet"===e.status&&"📬 Versendet","abgeschlossen"===e.status&&"✅ Abgeschlossen","storniert"===e.status&&"❌ Storniert"]})]}),s.jsxs("div",{className:"bestellung-info",children:[s.jsxs("div",{className:"bestellung-kunde",children:[s.jsx("strong",{children:e.kunde_name}),s.jsx("span",{children:e.kunde_email}),e.mitgliedsnummer&&s.jsxs("span",{className:"mitglied-nr",children:["(",e.mitgliedsnummer,")"]})]}),s.jsxs("div",{className:"bestellung-betrag",children:[s.jsxs("strong",{children:[null==(a=e.gesamtbetrag_euro)?void 0:a.toFixed(2)," €"]}),s.jsxs("span",{children:[e.anzahl_positionen," Artikel"]})]}),s.jsx("div",{className:"bestellung-datum",children:new Date(e.bestellt_am).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(null==Be?void 0:Be.id)===e.id&&s.jsxs("div",{className:"bestellung-details",children:[s.jsxs("div",{className:"details-section",children:[s.jsx("h4",{children:"Lieferadresse"}),s.jsxs("p",{children:[e.lieferadresse_strasse,s.jsx("br",{}),e.lieferadresse_plz," ",e.lieferadresse_ort,s.jsx("br",{}),e.lieferadresse_land]})]}),s.jsxs("div",{className:"details-section",children:[s.jsx("h4",{children:"Bestellte Artikel"}),s.jsxs("table",{className:"positionen-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Artikel"}),s.jsx("th",{children:"Variante"}),s.jsx("th",{children:"Menge"}),s.jsx("th",{children:"Preis"})]})}),s.jsx("tbody",{children:null==(n=e.positionen)?void 0:n.map((e,a)=>s.jsxs("tr",{children:[s.jsx("td",{children:e.artikel_name}),s.jsx("td",{children:e.variante||"-"}),s.jsx("td",{children:e.menge}),s.jsxs("td",{children:[(e.gesamtpreis_cent/100).toFixed(2)," €"]})]},a))})]})]}),e.kundennotiz&&s.jsxs("div",{className:"details-section",children:[s.jsx("h4",{children:"Kundennotiz"}),s.jsx("p",{className:"kundennotiz",children:e.kundennotiz})]}),s.jsxs("div",{className:"details-section",children:[s.jsx("h4",{children:"Status ändern"}),s.jsxs("div",{className:"status-actions",children:["offen"===e.status&&s.jsx("button",{className:"btn btn-primary",onClick:s=>{s.stopPropagation(),He(e.id,{status:"in_bearbeitung"})},disabled:Te,children:"In Bearbeitung nehmen"}),"in_bearbeitung"===e.status&&s.jsxs(s.Fragment,{children:[s.jsx("input",{type:"text",placeholder:"Tracking-Nummer (optional)",className:"tracking-input",onClick:e=>e.stopPropagation(),id:`tracking-${e.id}`}),s.jsx("button",{className:"btn btn-success",onClick:s=>{s.stopPropagation();const a=document.getElementById(`tracking-${e.id}`).value;He(e.id,{status:"versendet",tracking_nummer:a})},disabled:Te,children:"Als versendet markieren"})]}),"versendet"===e.status&&s.jsx("button",{className:"btn btn-success",onClick:s=>{s.stopPropagation(),He(e.id,{status:"abgeschlossen"})},disabled:Te,children:"Abschließen"}),["offen","in_bearbeitung"].includes(e.status)&&s.jsx("button",{className:"btn btn-danger",onClick:s=>{s.stopPropagation(),window.confirm("Bestellung wirklich stornieren?")&&He(e.id,{status:"storniert"})},disabled:Te,children:"Stornieren"})]}),e.tracking_nummer&&s.jsxs("p",{className:"tracking-info",children:["📦 Tracking: ",e.tracking_nummer]})]})]})]},e.id)})})]}),"entwicklung"===oe&&s.jsx(Oe,{bereich:"org"}),"support"===oe&&s.jsx(Ge,{bereich:"org",showAllBereiche:!0}),"statistics"===oe&&s.jsx(ts,{token:x}),"finanzen"===oe&&s.jsx(hs,{token:x}),"buchhaltung"===oe&&s.jsx(ps,{token:x}),"contracts"===oe&&s.jsx(ls,{token:x}),"plans"===oe&&s.jsxs("div",{className:"plans-management",children:[s.jsxs("h2",{className:"section-title",style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx(J,{size:24})," Pläne & Preise verwalten"]}),s.jsx("p",{style:{color:"var(--text-secondary)",marginBottom:"2rem"},children:"Änderungen hier werden automatisch auf der Pricing-Seite und im Vertragsmodul übernommen."}),fe?s.jsx("p",{children:"Lade Pläne..."}):s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(350px, 1fr))",gap:"1.5rem"},children:xe.map(e=>s.jsxs("div",{className:"plan-card",style:{background:"var(--bg-secondary)",borderRadius:"12px",padding:"1.5rem",border:"1px solid var(--border-default)",opacity:e.is_visible?1:.6},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[s.jsx("h3",{style:{margin:0,color:"var(--primary)"},children:e.display_name}),s.jsxs("button",{onClick:()=>je(be===e.plan_id?null:e.plan_id),style:{background:"var(--bg-tertiary)",border:"1px solid var(--border-default)",borderRadius:"6px",padding:"0.4rem 0.8rem",cursor:"pointer",color:"var(--text-primary)"},children:[s.jsx(ue,{size:14})," ",be===e.plan_id?"Abbrechen":"Bearbeiten"]})]}),be===e.plan_id?s.jsx("form",{onSubmit:s=>{s.preventDefault();const a=new FormData(s.target);(async(e,s)=>{try{(await n.put(`/admin/subscription-plans/${e}`,s,{headers:{Authorization:`Bearer ${x}`}})).data.success&&(We(),je(null),alert("Plan erfolgreich aktualisiert"))}catch(a){console.error("Fehler beim Aktualisieren:",a),alert("Fehler beim Aktualisieren des Plans")}})(e.plan_id,{display_name:a.get("display_name"),description:a.get("description"),price_monthly:parseFloat(a.get("price_monthly")),price_yearly:parseFloat(a.get("price_yearly")),max_members:parseInt(a.get("max_members")),max_dojos:parseInt(a.get("max_dojos")),storage_limit_mb:parseInt(a.get("storage_limit_mb")),feature_verkauf:"on"===a.get("feature_verkauf"),feature_buchfuehrung:"on"===a.get("feature_buchfuehrung"),feature_events:"on"===a.get("feature_events"),feature_multidojo:"on"===a.get("feature_multidojo"),feature_api:"on"===a.get("feature_api"),is_visible:"on"===a.get("is_visible")})},children:s.jsxs("div",{style:{display:"grid",gap:"0.75rem"},children:[s.jsxs("div",{children:[s.jsx("label",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Anzeigename"}),s.jsx("input",{name:"display_name",defaultValue:e.display_name,className:"form-control",style:{width:"100%",background:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-default)"}})]}),s.jsxs("div",{children:[s.jsx("label",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Beschreibung"}),s.jsx("input",{name:"description",defaultValue:e.description,className:"form-control",style:{width:"100%",background:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-default)"}})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.5rem"},children:[s.jsxs("div",{children:[s.jsx("label",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Preis/Monat"}),s.jsx("input",{name:"price_monthly",type:"number",step:"0.01",defaultValue:e.price_monthly,className:"form-control",style:{background:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-default)"}})]}),s.jsxs("div",{children:[s.jsx("label",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Preis/Jahr"}),s.jsx("input",{name:"price_yearly",type:"number",step:"0.01",defaultValue:e.price_yearly,className:"form-control",style:{background:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-default)"}})]})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"0.5rem"},children:[s.jsxs("div",{children:[s.jsx("label",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Max Mitglieder"}),s.jsx("input",{name:"max_members",type:"number",defaultValue:e.max_members,className:"form-control",style:{background:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-default)"}})]}),s.jsxs("div",{children:[s.jsx("label",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Max Dojos"}),s.jsx("input",{name:"max_dojos",type:"number",defaultValue:e.max_dojos,className:"form-control",style:{background:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-default)"}})]}),s.jsxs("div",{children:[s.jsx("label",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Speicher MB"}),s.jsx("input",{name:"storage_limit_mb",type:"number",defaultValue:e.storage_limit_mb,className:"form-control",style:{background:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-default)"}})]})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.5rem",marginTop:"0.5rem"},children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.3rem",fontSize:"0.85rem"},children:[s.jsx("input",{name:"feature_verkauf",type:"checkbox",defaultChecked:e.feature_verkauf})," Verkauf"]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.3rem",fontSize:"0.85rem"},children:[s.jsx("input",{name:"feature_buchfuehrung",type:"checkbox",defaultChecked:e.feature_buchfuehrung})," Buchführung"]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.3rem",fontSize:"0.85rem"},children:[s.jsx("input",{name:"feature_events",type:"checkbox",defaultChecked:e.feature_events})," Events"]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.3rem",fontSize:"0.85rem"},children:[s.jsx("input",{name:"feature_multidojo",type:"checkbox",defaultChecked:e.feature_multidojo})," Multi-Dojo"]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.3rem",fontSize:"0.85rem"},children:[s.jsx("input",{name:"feature_api",type:"checkbox",defaultChecked:e.feature_api})," API"]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.3rem",fontSize:"0.85rem"},children:[s.jsx("input",{name:"is_visible",type:"checkbox",defaultChecked:e.is_visible})," Sichtbar"]})]}),s.jsxs("button",{type:"submit",style:{marginTop:"1rem",background:"var(--primary)",color:"#000",border:"none",borderRadius:"6px",padding:"0.6rem 1rem",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:"center"},children:[s.jsx(re,{size:16})," Speichern"]})]})}):s.jsxs(s.Fragment,{children:[s.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:e.description}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.5rem",marginBottom:"1rem"},children:[s.jsxs("div",{style:{background:"var(--bg-tertiary)",padding:"0.75rem",borderRadius:"8px"},children:[s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Monatlich"}),s.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"var(--primary)"},children:[e.price_monthly,"€"]})]}),s.jsxs("div",{style:{background:"var(--bg-tertiary)",padding:"0.75rem",borderRadius:"8px"},children:[s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Jährlich"}),s.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:"700",color:"var(--primary)"},children:[e.price_yearly,"€"]})]})]}),s.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:[s.jsxs("div",{children:["Max. ",e.max_members>=999999?"Unbegrenzt":e.max_members," Mitglieder"]}),s.jsxs("div",{style:{marginTop:"0.5rem",display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[e.feature_verkauf?s.jsx("span",{style:{background:"rgba(16,185,129,0.2)",color:"#10b981",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem"},children:"Verkauf"}):null,e.feature_buchfuehrung?s.jsx("span",{style:{background:"rgba(16,185,129,0.2)",color:"#10b981",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem"},children:"Buchführung"}):null,e.feature_events?s.jsx("span",{style:{background:"rgba(16,185,129,0.2)",color:"#10b981",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem"},children:"Events"}):null,e.feature_multidojo?s.jsx("span",{style:{background:"rgba(16,185,129,0.2)",color:"#10b981",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem"},children:"Multi-Dojo"}):null,e.feature_api?s.jsx("span",{style:{background:"rgba(16,185,129,0.2)",color:"#10b981",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem"},children:"API"}):null]})]})]})]},e.plan_id))})]}),"users"===oe&&s.jsx(ds,{token:x}),"email"===oe&&s.jsx("div",{className:"tab-content",children:s.jsxs("div",{className:"section-card",children:[s.jsx("h3",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1.5rem"},children:"✉️ Globale E-Mail-Einstellungen"}),s.jsx("p",{style:{color:"var(--text-secondary)",marginBottom:"1.5rem"},children:"Diese Einstellungen werden als Fallback für alle Dojos verwendet, die keine eigenen SMTP-Daten hinterlegt haben."}),Le&&s.jsx("div",{style:{padding:"1rem",borderRadius:"8px",marginBottom:"1.5rem",background:Le.includes("✅")?"rgba(16,185,129,0.1)":"rgba(239,68,68,0.1)",border:"1px solid "+(Le.includes("✅")?"#10b981":"#ef4444"),color:Le.includes("✅")?"#10b981":"#ef4444"},children:Le}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem",marginBottom:"1.5rem"},children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"SMTP-Server"}),s.jsx("input",{type:"text",value:$e.smtp_host,onChange:e=>Re({...$e,smtp_host:e.target.value}),placeholder:"z.B. smtp.tda-intl.com"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"SMTP-Port"}),s.jsx("input",{type:"number",value:$e.smtp_port,onChange:e=>Re({...$e,smtp_port:parseInt(e.target.value)||587}),placeholder:"587"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"SMTP-Benutzer"}),s.jsx("input",{type:"text",value:$e.smtp_user,onChange:e=>Re({...$e,smtp_user:e.target.value}),placeholder:"E-Mail-Adresse für Login"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"SMTP-Passwort"}),s.jsx("input",{type:"password",value:$e.smtp_password,onChange:e=>Re({...$e,smtp_password:e.target.value}),placeholder:$e.has_password?"********":"Passwort eingeben"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Absender-E-Mail"}),s.jsx("input",{type:"email",value:$e.default_from_email,onChange:e=>Re({...$e,default_from_email:e.target.value}),placeholder:"noreply@tda-intl.com"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Absender-Name"}),s.jsx("input",{type:"text",value:$e.default_from_name,onChange:e=>Re({...$e,default_from_name:e.target.value}),placeholder:"DojoSoftware"})]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1.5rem"},children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[s.jsx("input",{type:"checkbox",checked:$e.smtp_secure,onChange:e=>Re({...$e,smtp_secure:e.target.checked})}),"TLS/SSL verwenden"]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[s.jsx("input",{type:"checkbox",checked:$e.aktiv,onChange:e=>Re({...$e,aktiv:e.target.checked})}),"E-Mail-Versand aktiviert"]})]}),s.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"2rem"},children:s.jsxs("button",{className:"btn-primary",onClick:async()=>{var e,s;try{Me(!0),Pe("");(await n.put("/email-settings/global",$e,{headers:{Authorization:`Bearer ${x}`}})).data.success&&Pe("✅ E-Mail-Einstellungen erfolgreich gespeichert")}catch(a){console.error("Fehler beim Speichern:",a),Pe("❌ Fehler beim Speichern: "+((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.error)||a.message))}finally{Me(!1)}},disabled:Ie,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx(re,{size:18}),Ie?"Speichern...":"Einstellungen speichern"]})}),s.jsx("hr",{style:{border:"none",borderTop:"1px solid var(--border)",margin:"2rem 0"}}),s.jsx("h4",{style:{marginBottom:"1rem"},children:"🧪 Test-E-Mail senden"}),s.jsx("p",{style:{color:"var(--text-secondary)",marginBottom:"1rem",fontSize:"0.9rem"},children:"Senden Sie eine Test-E-Mail, um die Konfiguration zu prüfen."}),s.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"flex-end"},children:[s.jsxs("div",{className:"form-group",style:{flex:1,marginBottom:0},children:[s.jsx("label",{children:"Test-E-Mail-Adresse"}),s.jsx("input",{type:"email",value:Ve,onChange:e=>Ue(e.target.value),placeholder:"ihre-email@beispiel.de"})]}),s.jsx("button",{className:"btn-secondary",onClick:async()=>{var e,s;if(Ve)try{Me(!0),Pe("");const e=await n.post("/email-settings/test",{test_email:Ve,use_global:!0},{headers:{Authorization:`Bearer ${x}`}});e.data.success&&Pe(`✅ ${e.data.message}`)}catch(a){console.error("Test-E-Mail fehlgeschlagen:",a),Pe("❌ "+((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.error)||a.message))}finally{Me(!1)}else Pe("⚠️ Bitte geben Sie eine Test-E-Mail-Adresse ein")},disabled:Ie||!Ve,style:{marginBottom:"0.5rem"},children:Ie?"Sende...":"Test senden"})]}),s.jsxs("div",{style:{marginTop:"2rem",padding:"1rem",background:"rgba(59,130,246,0.1)",borderRadius:"8px",border:"1px solid rgba(59,130,246,0.2)"},children:[s.jsx("h4",{style:{color:"#3b82f6",marginBottom:"0.5rem"},children:"ℹ️ So funktioniert das 3-Stufen-System"}),s.jsxs("ol",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",margin:0,paddingLeft:"1.5rem"},children:[s.jsxs("li",{style:{marginBottom:"0.5rem"},children:[s.jsx("strong",{children:"Eigene SMTP-Daten:"})," Dojos können eigene Mailserver-Daten hinterlegen"]}),s.jsxs("li",{style:{marginBottom:"0.5rem"},children:[s.jsx("strong",{children:"TDA-E-Mail:"})," Sie können Dojos eine @tda-intl.com Adresse zuweisen"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Zentraler Versand (Fallback):"})," Diese globalen Einstellungen werden verwendet, wenn nichts anderes konfiguriert ist"]})]})]})]})})]}),w&&s.jsx(js,{onClose:()=>S(!1),onSuccess:()=>{S(!1),Ke()},token:x}),E&&$&&s.jsx(js,{dojo:$,onClose:()=>F(!1),onSuccess:()=>{F(!1),Ke()},token:x}),M&&$&&s.jsx("div",{className:"modal-overlay",onClick:()=>P(!1),children:s.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsxs("h2",{children:[s.jsx(D,{size:24}),"Trial verlängern"]}),s.jsx("button",{onClick:()=>P(!1),className:"modal-close",children:s.jsx(R,{size:20})})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Dojo:"})," ",$.dojoname]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Aktuelles Trial-Ende:"})," ",new Date($.trial_ends_at).toLocaleDateString("de-DE")]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Verbleibende Tage:"})," ",$.trial_days_remaining," Tage"]}),s.jsxs("div",{className:"form-group",style:{marginTop:"1.5rem"},children:[s.jsx("label",{children:"Trial verlängern um (Tage):"}),s.jsx("input",{type:"number",min:"1",max:"365",value:K,onChange:e=>W(parseInt(e.target.value)),className:"form-control"}),s.jsxs("small",{style:{color:"rgba(255,255,255,0.6)",marginTop:"0.5rem",display:"block"},children:["Neues Trial-Ende: ",new Date(new Date($.trial_ends_at).getTime()+24*K*60*60*1e3).toLocaleDateString("de-DE")]})]})]}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{onClick:()=>P(!1),className:"btn btn-secondary",children:"Abbrechen"}),s.jsx("button",{onClick:async()=>{var e,s;if($)try{await n.put(`/admin/dojos/${$.id}/extend-trial`,{days:K},{headers:{Authorization:`Bearer ${x}`}}),alert(`Trial für "${$.dojoname}" um ${K} Tage verlängert`),P(!1),Ke()}catch(a){console.error("❌ Fehler beim Verlängern:",a),alert((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.error)||"Fehler beim Verlängern des Trials")}},className:"btn btn-warning",children:"Trial verlängern"})]})]})}),V&&$&&s.jsx("div",{className:"modal-overlay",onClick:()=>U(!1),children:s.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsxs("h2",{children:[s.jsx(A,{size:24}),"Abonnement aktivieren"]}),s.jsx("button",{onClick:()=>U(!1),className:"modal-close",children:s.jsx(R,{size:20})})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Dojo:"})," ",$.dojoname]}),s.jsxs("div",{className:"form-group",style:{marginTop:"1.5rem"},children:[s.jsx("label",{children:"Abo-Plan:"}),s.jsxs("select",{value:O,onChange:e=>q(e.target.value),className:"form-control",children:[s.jsx("option",{value:"starter",children:"Starter (49€/Monat)"}),s.jsx("option",{value:"professional",children:"Professional (89€/Monat)"}),s.jsx("option",{value:"premium",children:"Premium (149€/Monat)"}),s.jsx("option",{value:"enterprise",children:"Enterprise (249€/Monat)"}),te&&s.jsxs(s.Fragment,{children:[s.jsx("option",{value:"free",children:"🎁 Kostenloser Account (Lifetime)"}),s.jsx("option",{value:"custom",children:"⚙️ Flexibel/Custom"})]})]})]}),"custom"===O&&te&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Custom Preis (€):"}),s.jsx("input",{type:"number",min:"0",step:"0.01",value:ee,onChange:e=>se(e.target.value),className:"form-control",placeholder:"z.B. 39.99"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Notizen/Details:"}),s.jsx("textarea",{value:ae,onChange:e=>ne(e.target.value),className:"form-control",rows:"3",placeholder:"z.B. Sonderkonditionen, Rabatte, besondere Vereinbarungen..."})]})]}),"free"!==O&&s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Zahlungsintervall:"}),s.jsxs("select",{value:H,onChange:e=>Y(e.target.value),className:"form-control",children:[s.jsx("option",{value:"monthly",children:"Monatlich"}),s.jsx("option",{value:"quarterly",children:"Quartalsweise"}),s.jsx("option",{value:"yearly",children:"Jährlich"})]})]}),"free"!==O&&s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Laufzeit (Monate):"}),s.jsx("input",{type:"number",min:"1",max:"60",value:Q,onChange:e=>X(parseInt(e.target.value)),className:"form-control"}),s.jsxs("small",{style:{color:"rgba(255,255,255,0.6)",marginTop:"0.5rem",display:"block"},children:["Abo-Ende: ",new Date((new Date).setMonth((new Date).getMonth()+Q)).toLocaleDateString("de-DE")]})]}),"free"===O&&s.jsxs("div",{style:{background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)",borderRadius:"8px",padding:"1rem",marginTop:"1rem",color:"rgba(255, 255, 255, 0.9)"},children:[s.jsx("strong",{children:"🎁 Kostenloser Account"}),s.jsx("br",{}),"Dieser Account hat unbegrenzten Zugriff ohne Ablaufdatum."]})]}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{onClick:()=>U(!1),className:"btn btn-secondary",children:"Abbrechen"}),s.jsx("button",{onClick:async()=>{var e,s;if($)try{const e={plan:O,interval:H,duration_months:Q};te&&("free"===O?e.is_free=!0:"custom"===O&&(e.custom_price=ee,e.custom_notes=ae)),await n.put(`/admin/dojos/${$.id}/activate-subscription`,e,{headers:{Authorization:`Bearer ${x}`}});const s="free"===O?`Kostenloser Account für "${$.dojoname}" aktiviert (unbegrenzt)`:"custom"===O?`Custom Abo für "${$.dojoname}" aktiviert (${ee}€, ${Q} Monate)`:`Abonnement für "${$.dojoname}" aktiviert (${O}, ${Q} Monate)`;alert(s),U(!1),Ke()}catch(a){console.error("❌ Fehler beim Aktivieren:",a),alert((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.error)||"Fehler beim Aktivieren des Abonnements")}},className:"btn btn-success",children:"Abo aktivieren"})]})]})})]})},js=({dojo:a,onClose:r,onSuccess:t,token:i})=>{const l=!!a,[d,c]=e.useState({dojoname:(null==a?void 0:a.dojoname)||"",subdomain:(null==a?void 0:a.subdomain)||"",inhaber:(null==a?void 0:a.inhaber)||"",email:(null==a?void 0:a.email)||"",telefon:(null==a?void 0:a.telefon)||"",strasse:(null==a?void 0:a.strasse)||"",hausnummer:(null==a?void 0:a.hausnummer)||"",plz:(null==a?void 0:a.plz)||"",ort:(null==a?void 0:a.ort)||"",land:(null==a?void 0:a.land)||"Deutschland",ist_aktiv:void 0===(null==a?void 0:a.ist_aktiv)||a.ist_aktiv}),[o,h]=e.useState(!1),[m,u]=e.useState(""),x=e=>{const{name:s,value:a}=e.target;c(e=>({...e,[s]:a}))};return s.jsx("div",{className:"modal-overlay",onClick:r,children:s.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h2",{children:l?"Dojo bearbeiten":"Neues Dojo anlegen"}),s.jsx("button",{onClick:r,className:"modal-close",children:"×"})]}),s.jsxs("form",{onSubmit:async e=>{var s,r;e.preventDefault(),h(!0),u("");try{l?(await n.put(`/admin/dojos/${a.id}`,d,{headers:{Authorization:`Bearer ${i}`}}),alert("Dojo erfolgreich aktualisiert!")):(await n.post("/admin/dojos",d,{headers:{Authorization:`Bearer ${i}`}}),alert("Dojo erfolgreich angelegt!")),t()}catch(c){console.error("❌ Fehler beim Speichern:",c),u((null==(r=null==(s=c.response)?void 0:s.data)?void 0:r.error)||"Fehler beim Speichern")}finally{h(!1)}},className:"dojo-form",children:[s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Dojo-Name *"}),s.jsx("input",{type:"text",name:"dojoname",value:d.dojoname,onChange:x,required:!0})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Subdomain *"}),s.jsx("input",{type:"text",name:"subdomain",value:d.subdomain,onChange:x,placeholder:"z.B. mein-dojo",required:!0}),s.jsx("small",{children:".dojo.tda-intl.org"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Inhaber *"}),s.jsx("input",{type:"text",name:"inhaber",value:d.inhaber,onChange:x,required:!0})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"E-Mail"}),s.jsx("input",{type:"email",name:"email",value:d.email,onChange:x})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Telefon"}),s.jsx("input",{type:"tel",name:"telefon",value:d.telefon,onChange:x})]})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group flex-2",children:[s.jsx("label",{children:"Straße"}),s.jsx("input",{type:"text",name:"strasse",value:d.strasse,onChange:x})]}),s.jsxs("div",{className:"form-group flex-1",children:[s.jsx("label",{children:"Hausnr."}),s.jsx("input",{type:"text",name:"hausnummer",value:d.hausnummer,onChange:x})]})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"PLZ"}),s.jsx("input",{type:"text",name:"plz",value:d.plz,onChange:x})]}),s.jsxs("div",{className:"form-group flex-2",children:[s.jsx("label",{children:"Ort"}),s.jsx("input",{type:"text",name:"ort",value:d.ort,onChange:x})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Land"}),s.jsx("input",{type:"text",name:"land",value:d.land,onChange:x})]})]}),l&&s.jsx("div",{className:"form-group",style:{marginTop:"1rem",padding:"1rem",background:d.ist_aktiv?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",borderRadius:"8px",border:"1px solid "+(d.ist_aktiv?"rgba(34, 197, 94, 0.3)":"rgba(239, 68, 68, 0.3)")},children:s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:"pointer",margin:0},children:[s.jsx("input",{type:"checkbox",checked:d.ist_aktiv,onChange:e=>c(s=>({...s,ist_aktiv:e.target.checked})),style:{width:"20px",height:"20px",cursor:"pointer"}}),s.jsx("span",{style:{fontWeight:600,color:d.ist_aktiv?"#22c55e":"#ef4444"},children:d.ist_aktiv?"✓ Dojo ist aktiv":"✗ Dojo ist inaktiv"})]})}),m&&s.jsxs("div",{className:"error-message",children:[s.jsx(R,{size:16}),m]}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{type:"button",onClick:r,className:"btn btn-secondary",disabled:o,children:"Abbrechen"}),s.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?"Speichere...":l?"Aktualisieren":"Anlegen"})]})]})]})})},vs=()=>{const{token:a,user:r}=l();Ye();const[t,i]=e.useState(!0),[d,c]=e.useState(""),[o,h]=e.useState("tickets"),[m,u]=e.useState({gesamt:0,offen:0,in_bearbeitung:0,warten_auf_antwort:0,erledigt:0,geschlossen:0,heute_erstellt:0,durchschnittliche_bearbeitungszeit:0}),[x,g]=e.useState({gesamt:0,neu:0,geprueft:0,geplant:0,in_arbeit:0,umgesetzt:0,abgelehnt:0}),p=("admin"===(null==r?void 0:r.rolle)||"admin"===(null==r?void 0:r.role))&&null===(null==r?void 0:r.dojo_id),b=[{id:"tickets",label:"Tickets",icon:ze},{id:"wunschliste",label:"Wunschliste",icon:Ne},{id:"statistiken",label:"Statistiken",icon:G}];e.useEffect(()=>{j()},[]);const j=async()=>{i(!0),c("");try{const[e,s]=await Promise.all([n.get("/support-tickets/statistiken",{headers:{Authorization:`Bearer ${a}`}}),n.get("/feature-requests",{headers:{Authorization:`Bearer ${a}`}})]);e.data.success&&u(e.data.statistiken||{}),s.data.success&&g(s.data.stats||{})}catch(e){console.error("Fehler beim Laden der Statistiken:",e),c("Fehler beim Laden der Statistiken")}finally{i(!1)}},v=({icon:e,label:a,value:n,color:r,trend:t})=>s.jsxs("div",{className:"support-stat-card",style:{borderLeftColor:r},children:[s.jsx("div",{className:"stat-icon",style:{backgroundColor:`${r}20`},children:s.jsx(e,{size:24,color:r})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-value",children:n}),s.jsx("div",{className:"stat-label",children:a}),t&&s.jsxs("div",{className:"stat-trend "+(t>0?"up":"down"),children:[s.jsx(C,{size:12}),Math.abs(t),"% vs. letzte Woche"]})]})]});return s.jsxs("div",{className:"support-dashboard",children:[s.jsxs("div",{className:"support-header",children:[s.jsxs("div",{className:"support-header-info",children:[s.jsxs("h1",{children:[s.jsx(ze,{size:28}),"Support Center"]}),s.jsx("p",{children:"Verwalten Sie Support-Tickets aus allen Bereichen"})]}),s.jsx("div",{className:"support-header-actions",children:s.jsxs("button",{onClick:j,className:"btn-refresh",disabled:t,children:[s.jsx(Q,{size:16,className:t?"spin":""}),"Aktualisieren"]})})]}),s.jsxs("div",{className:"support-stats-grid",children:[s.jsx(v,{icon:ze,label:"Gesamt",value:m.gesamt||0,color:"#6366f1"}),s.jsx(v,{icon:M,label:"Offen",value:m.offen||0,color:"#f59e0b"}),s.jsx(v,{icon:D,label:"In Bearbeitung",value:m.in_bearbeitung||0,color:"#3b82f6"}),s.jsx(v,{icon:we,label:"Warten auf Antwort",value:m.warten_auf_antwort||0,color:"#8b5cf6"}),s.jsx(v,{icon:A,label:"Erledigt",value:m.erledigt||0,color:"#10b981"})]}),s.jsx("div",{className:"support-tabs",children:b.map(e=>{const a=e.icon;return s.jsxs("button",{className:"support-tab "+(o===e.id?"active":""),onClick:()=>h(e.id),children:[s.jsx(a,{size:18}),s.jsx("span",{children:e.label})]},e.id)})}),s.jsxs("div",{className:"support-content",children:["tickets"===o&&s.jsx(Ge,{bereich:"support",showAllBereiche:p,compact:!1}),"wunschliste"===o&&s.jsx(He,{adminMode:!0}),"statistiken"===o&&s.jsx("div",{className:"support-statistiken",children:s.jsxs("div",{className:"statistiken-two-columns",children:[s.jsxs("div",{className:"statistiken-column tickets-column",children:[s.jsxs("div",{className:"column-header",children:[s.jsx(ze,{size:24}),s.jsx("h2",{children:"Support-Tickets"})]}),s.jsxs("div",{className:"stats-numbers-row",children:[s.jsxs("div",{className:"stat-number-box",children:[s.jsx("span",{className:"stat-big-number",children:m.gesamt||0}),s.jsx("span",{className:"stat-number-label",children:"Gesamt"})]}),s.jsxs("div",{className:"stat-number-box orange",children:[s.jsx("span",{className:"stat-big-number",children:m.offen||0}),s.jsx("span",{className:"stat-number-label",children:"Offen"})]}),s.jsxs("div",{className:"stat-number-box blue",children:[s.jsx("span",{className:"stat-big-number",children:m.in_bearbeitung||0}),s.jsx("span",{className:"stat-number-label",children:"In Bearbeitung"})]}),s.jsxs("div",{className:"stat-number-box green",children:[s.jsx("span",{className:"stat-big-number",children:m.erledigt||0}),s.jsx("span",{className:"stat-number-label",children:"Erledigt"})]})]}),s.jsxs("div",{className:"statistik-card",children:[s.jsx("h3",{children:"Nach Kategorie"}),s.jsx("div",{className:"kategorie-bars",children:[{name:"Vertrag",count:m.kategorie_vertrag||0,color:"#3b82f6"},{name:"Hilfe",count:m.kategorie_hilfe||0,color:"#10b981"},{name:"Problem",count:m.kategorie_problem||0,color:"#f59e0b"},{name:"Sonstiges",count:m.kategorie_sonstiges||0,color:"#6b7280"}].map(e=>{const a=(m.kategorie_vertrag||0)+(m.kategorie_hilfe||0)+(m.kategorie_problem||0)+(m.kategorie_sonstiges||0),n=a>0?e.count/a*100:0;return s.jsxs("div",{className:"kategorie-item",children:[s.jsxs("div",{className:"kategorie-label",children:[s.jsx("span",{children:e.name}),s.jsx("span",{children:e.count})]}),s.jsx("div",{className:"kategorie-bar",children:s.jsx("div",{className:"kategorie-fill",style:{width:`${n}%`,backgroundColor:e.color}})})]},e.name)})})]}),s.jsxs("div",{className:"statistik-card",children:[s.jsx("h3",{children:"Nach Bereich"}),s.jsxs("div",{className:"bereich-stats",children:[s.jsxs("div",{className:"bereich-item dojo",children:[s.jsx("div",{className:"bereich-icon",children:"🥋"}),s.jsxs("div",{className:"bereich-info",children:[s.jsx("span",{className:"bereich-name",children:"Dojo"}),s.jsx("span",{className:"bereich-count",children:m.bereich_dojo||0})]})]}),s.jsxs("div",{className:"bereich-item verband",children:[s.jsx("div",{className:"bereich-icon",children:"🌐"}),s.jsxs("div",{className:"bereich-info",children:[s.jsx("span",{className:"bereich-name",children:"Verband"}),s.jsx("span",{className:"bereich-count",children:m.bereich_verband||0})]})]}),s.jsxs("div",{className:"bereich-item org",children:[s.jsx("div",{className:"bereich-icon",children:"🏆"}),s.jsxs("div",{className:"bereich-info",children:[s.jsx("span",{className:"bereich-name",children:"Org"}),s.jsx("span",{className:"bereich-count",children:m.bereich_org||0})]})]})]})]}),s.jsxs("div",{className:"statistik-card",children:[s.jsx("h3",{children:"Performance"}),s.jsxs("div",{className:"performance-stats",children:[s.jsxs("div",{className:"performance-item",children:[s.jsx(D,{size:20}),s.jsxs("div",{children:[s.jsxs("span",{className:"performance-value",children:[m.durchschnittliche_bearbeitungszeit||"-"," Std"]}),s.jsx("span",{className:"performance-label",children:"Ø Bearbeitungszeit"})]})]}),s.jsxs("div",{className:"performance-item",children:[s.jsx(ze,{size:20}),s.jsxs("div",{children:[s.jsx("span",{className:"performance-value",children:m.heute_erstellt||0}),s.jsx("span",{className:"performance-label",children:"Heute erstellt"})]})]}),s.jsxs("div",{className:"performance-item",children:[s.jsx(A,{size:20}),s.jsxs("div",{children:[s.jsx("span",{className:"performance-value",children:m.heute_geschlossen||0}),s.jsx("span",{className:"performance-label",children:"Heute geschlossen"})]})]})]})]})]}),s.jsxs("div",{className:"statistiken-column features-column",children:[s.jsxs("div",{className:"column-header features",children:[s.jsx(Ne,{size:24}),s.jsx("h2",{children:"Feature-Wünsche"})]}),s.jsxs("div",{className:"stats-numbers-row",children:[s.jsxs("div",{className:"stat-number-box",children:[s.jsx("span",{className:"stat-big-number",children:x.gesamt||0}),s.jsx("span",{className:"stat-number-label",children:"Gesamt"})]}),s.jsxs("div",{className:"stat-number-box orange",children:[s.jsx("span",{className:"stat-big-number",children:x.neu||0}),s.jsx("span",{className:"stat-number-label",children:"Neu"})]}),s.jsxs("div",{className:"stat-number-box purple",children:[s.jsx("span",{className:"stat-big-number",children:x.geplant||0}),s.jsx("span",{className:"stat-number-label",children:"Geplant"})]}),s.jsxs("div",{className:"stat-number-box green",children:[s.jsx("span",{className:"stat-big-number",children:x.umgesetzt||0}),s.jsx("span",{className:"stat-number-label",children:"Umgesetzt"})]})]}),s.jsxs("div",{className:"statistik-card",children:[s.jsx("h3",{children:"Nach Status"}),s.jsx("div",{className:"kategorie-bars",children:[{name:"Neu",count:x.neu||0,color:"#f59e0b"},{name:"Geprüft",count:x.geprueft||0,color:"#3b82f6"},{name:"Geplant",count:x.geplant||0,color:"#8b5cf6"},{name:"In Arbeit",count:x.in_arbeit||0,color:"#ec4899"},{name:"Umgesetzt",count:x.umgesetzt||0,color:"#10b981"},{name:"Abgelehnt",count:x.abgelehnt||0,color:"#6b7280"}].map(e=>{const a=x.gesamt||1,n=a>0?e.count/a*100:0;return s.jsxs("div",{className:"kategorie-item",children:[s.jsxs("div",{className:"kategorie-label",children:[s.jsx("span",{children:e.name}),s.jsx("span",{children:e.count})]}),s.jsx("div",{className:"kategorie-bar",children:s.jsx("div",{className:"kategorie-fill",style:{width:`${n}%`,backgroundColor:e.color}})})]},e.name)})})]}),s.jsxs("div",{className:"statistik-card",children:[s.jsx("h3",{children:"Voting-Info"}),s.jsxs("div",{className:"voting-info",children:[s.jsxs("div",{className:"voting-stat",children:[s.jsx(Se,{size:20}),s.jsxs("div",{children:[s.jsxs("span",{className:"voting-value",children:[x.gesamt>0?Math.round(((x.geplant||0)+(x.in_arbeit||0)+(x.umgesetzt||0))/x.gesamt*100):0,"%"]}),s.jsx("span",{className:"voting-label",children:"Umsetzungsrate"})]})]}),s.jsxs("div",{className:"voting-stat",children:[s.jsx(D,{size:20}),s.jsxs("div",{children:[s.jsx("span",{className:"voting-value",children:x.in_arbeit||0}),s.jsx("span",{className:"voting-label",children:"Aktuell in Arbeit"})]})]})]})]})]})]})})]})]})},fs="/dojo-logo.png",Ns={background:"linear-gradient(135deg, #ffd700, #ff6b35, #f7931e)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",textShadow:"none",fontWeight:600};function ys(){const{t:t}=d("dashboard"),k=Qe(),_=Ye(),{token:z,logout:w}=l(),{getDojoFilterParam:S,selectedDojo:C}=r(),{standorte:A}=c(),{updateTrigger:D}=o(),{theme:B,setTheme:E,isDarkMode:T,toggleDarkMode:F,themes:$}=h(),[R,I]=e.useState({mitglieder:0,anwesenheit:0,kurse:0,trainer:0,beitraege:0,checkins_heute:0,stile:0,termine:0,inventar:0,personal:0,buddy_gruppen:0,tarife:0,zahlungszyklen:0}),[M,L]=e.useState([]),[P,V]=e.useState(!1),[U,K]=e.useState(""),[W,O]=e.useState(""),[G,J]=e.useState("checkin"),[Z,q]=e.useState(!1),H=a.useRef(null);let Y="mitglied",Q=!1;try{if(z){const e=b(z);Y=e.role||"mitglied",Q=1===e.id||1===e.user_id||"admin"===e.username}}catch(me){console.error("Fehler beim Dekodieren des Tokens:",me)}const X=async()=>{V(!0),K("");try{const e=S(),s=await x(z,e);if(I({...s.stats,checkins_heute:s.stats.checkins_heute||0,stile:s.stats.stile||0,termine:s.stats.termine||0,inventar:s.stats.inventar||0,personal:s.stats.personal||0,buddy_gruppen:s.stats.buddy_gruppen||0,tarife:s.stats.tarife||0,zahlungszyklen:s.stats.zahlungszyklen||0}),s.activities){const e=s.activities.activities||s.activities||[];L(e)}}catch(e){console.error("Fehler beim Laden der Dashboard-Statistiken:",e),K("Fehler beim Laden der Statistiken: "+e.message);try{const e=S(),[s,a]=await Promise.all([g(z,e),p(z,e)]);I({...s,checkins_heute:s.checkins_heute||0,stile:s.stile||0,termine:s.termine||0,inventar:s.inventar||0,personal:s.personal||0,buddy_gruppen:s.buddy_gruppen||0,tarife:s.tarife||0,zahlungszyklen:s.zahlungszyklen||0});const n=a.activities||a||[];L(n),K("")}catch(s){console.error("Fallback fehlgeschlagen:",s)}}finally{V(!1)}};e.useEffect(()=>{z&&X()},[z,S,D]),e.useEffect(()=>{(async()=>{try{if(z){const s=b(z);if("admin"===s.role)O(s.username||"Admin");else if(s.email)try{const e=await n.get(`/mitglieder/by-email/${encodeURIComponent(s.email)}`);if(e.data){const a=`${e.data.vorname||""} ${e.data.nachname||""}`.trim();O(a||s.username||"Mitglied")}}catch(e){console.error("Fehler beim Laden des Mitgliedsnamens:",e),O(s.username||"Mitglied")}}}catch(me){console.error("Fehler beim Dekodieren des Tokens:",me)}})()},[z]),e.useEffect(()=>{const e=e=>{H.current&&!H.current.contains(e.target)&&q(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const ee=()=>{w(),_("/login")},se=e=>{if("/dashboard/stundenplan"===e)try{_(e)}catch(me){console.error("❌ Stundenplan Navigation Fehler:",me),window.location.href=e}else _(e)},ae=[{id:"checkin",label:t("tabs.checkin"),icon:"📱"},{id:"mitglieder",label:t("tabs.mitglieder"),icon:"👥"},{id:"pruefungswesen",label:t("tabs.pruefungswesen"),icon:"🏆"},{id:"events",label:t("tabs.events"),icon:"📅"},{id:"finanzen",label:t("tabs.finanzen"),icon:"💰"},{id:"artikelverwaltung",label:t("tabs.artikelverwaltung"),icon:"📦"},{id:"verwaltung",label:t("tabs.verwaltung"),icon:"🔧"},{id:"personal",label:t("tabs.personal"),icon:"👨‍🏫"},{id:"berichte",label:t("tabs.berichte"),icon:"📊"},{id:"einstellungen",label:t("tabs.einstellungen"),icon:"⚙️"},{id:"schnellaktionen",label:t("tabs.schnellaktionen"),icon:"⚡"},{id:"support",label:t("tabs.support"),icon:"🎫"},{id:"wunschliste",label:t("tabs.wunschliste"),icon:"💡"},{id:"info",label:t("tabs.info"),icon:"ℹ️"}],ne=e=>0===e?"0":e.toLocaleString("de-DE"),re="/dashboard"===k.pathname,te=t("admin"===Y?"header.title":"header.memberTitle"),ie=[{icon:"👥",title:"Mitglieder",description:"Verwalten Sie alle Dojo-Mitglieder",path:"/dashboard/mitglieder",count:R.mitglieder},{icon:"👥",title:"Buddy-Gruppen",description:"Freunde-Einladungen und Gruppenverwaltung",path:"/dashboard/buddy-gruppen",badge:"NEU",featured:!0,count:R.buddy_gruppen||0},{icon:"📧",title:"Newsletter & Benachrichtigungen",description:"Email-Versand, Push-Nachrichten & Server-Einstellungen",path:"/dashboard/notifications",badge:"NEU",featured:!0},{icon:"👋",title:"Ehemalige",description:"Ehemalige Mitglieder verwalten",path:"/dashboard/ehemalige",badge:"NEU",count:R.ehemalige||0},{icon:"💼",title:"Interessenten",description:"Potenzielle Mitglieder und Leads",path:"/dashboard/interessenten",badge:"NEU",count:R.interessenten||0}],le=[{icon:"🥋",title:"Kurse",description:"Kurse und Gruppen verwalten",path:"/dashboard/kurse",count:R.kurse},{icon:"📋",title:"Stundenplan",description:"Stundenplan und Kurszeiten verwalten",path:"/dashboard/stundenplan",featured:!0},{icon:"🎖️",title:"Stil-Verwaltung",description:"Kampfkunst-Stile, Prüfungen & Techniken",path:"/dashboard/stile",badge:"NEU",featured:!0,count:R.stile||0},{icon:"👥",title:"Gruppen",description:"Trainingsgruppen verwalten",path:"/dashboard/gruppen"},{icon:"📍",title:"Standorte",description:"Standorte & Filialen verwalten",path:"/dashboard/standorte",count:(null==A?void 0:A.length)||0}],de=[{icon:"👨‍🏫",title:"Trainer",description:"Trainer und Qualifikationen verwalten",path:"/dashboard/trainer",count:R.trainer},{icon:"🧑‍💼",title:"Personal",description:"Mitarbeiter & Personalverwaltung",path:"/dashboard/personal",count:R.personal,badge:"NEU",featured:!0}],ce=[{icon:"📊",title:"Finanzcockpit",description:"Übersicht über alle Finanzkennzahlen",path:"/dashboard/finanzcockpit",featured:!0},{icon:"📈",title:"EÜR",description:"Einnahmen-Überschuss-Rechnung",path:"/dashboard/euer",badge:"NEU",featured:!0},{icon:"📉",title:"Ausgaben",description:"Betriebsausgaben erfassen",path:"/dashboard/ausgaben",badge:"NEU",featured:!0},{icon:"💰",title:"Beiträge",description:"Mitgliedsbeiträge und Zahlungen",path:"/dashboard/beitraege",count:R.beitraege,featured:!0},{icon:"🧾",title:"Rechnungen",description:"Rechnungen erstellen und verwalten",path:"/dashboard/rechnungen",featured:!0},{icon:"💳",title:"Lastschriftlauf",description:"SEPA-Lastschriften generieren und verwalten",path:"/dashboard/lastschriftlauf",featured:!0},{icon:"📋",title:"SEPA-Mandate",description:"SEPA-Einzugsermächtigungen verwalten",path:"/dashboard/sepa-mandate",featured:!0},{icon:"⚠️",title:"Mahnwesen",description:"Offene Rechnungen und Mahnungen",path:"/dashboard/mahnwesen",featured:!0},{icon:"🔴",title:"Offene Zahlungen",description:"Rücklastschriften & Chargebacks verwalten",path:"/dashboard/offene-zahlungen",badge:"NEU",featured:!0},{icon:"🎯",title:"Tarife & Preise",description:"Mitgliedschaftstarife und Preisgestaltung",path:"/dashboard/tarife",featured:!0},{icon:"🔄",title:"Zahlungszyklen",description:"Automatische Beitragszahlungen verwalten",path:"/dashboard/zahlungszyklen",badge:"NEU",featured:!0},{icon:"⚙️",title:"Zahlungseinstellungen",description:"Stripe & DATEV Integration",path:"/dashboard/einstellungen/zahlungen",badge:"NEU",featured:!0},{icon:"📊",title:"DATEV Export",description:"Buchungsdaten für Steuerberater exportieren",path:"/dashboard/datev-export",badge:"NEU",featured:!0}],oe=[{icon:"🎯",title:"Prüfung durchführen",description:"Live-Ansicht für Prüfungstag - Ergebnisse eintragen",path:"/dashboard/pruefung-durchfuehren",badge:"LIVE",featured:!0},{icon:"🏆",title:"Prüfungen & Termine",description:"Events, Prüfungen und Termine verwalten",path:"/dashboard/termine",badge:"NEU",featured:!0,count:R.termine||0},{icon:"🏅",title:"Auszeichnungen",description:"Badges vergeben und verwalten",path:"/dashboard/badges",badge:"NEU",featured:!0}],he=[{icon:"📊",title:"Auswertungen",description:"Statistiken und Berichte erstellen",path:"/dashboard/auswertungen",badge:"NEU",featured:!0},{icon:"📄",title:"Berichte & Dokumente",description:"PDF-Berichte erstellen, ändern & verwalten",path:"/dashboard/berichte",badge:"NEU",featured:!0},{icon:"📋",title:"Vertragsdokumente",description:"AGB, Datenschutz & Hausordnung verwalten",path:"/dashboard/vertragsdokumente",badge:"NEU",featured:!0},{icon:"🥊",title:"Equipment",description:"Inventar und Ausrüstung verwalten",path:"/dashboard/inventar",badge:"NEU",featured:!0,count:R.inventar||0}];return"admin"!==Y&&re?s.jsx(y,{}):(console.log("🔍 Super-Admin Dashboard Check:",{role:Y,selectedDojo:C,isMainDashboard:re,pathname:k.pathname}),"admin"===Y&&"super-admin"===C&&re?(console.log("✅ Zeige Super-Admin Dashboard für TDA Int'l Org"),s.jsxs("div",{className:"dashboard-container "+("tda-vib"===B?"dashboard-tda-vib":""),children:[s.jsxs("header",{className:"dashboard-header",style:{background:T?"rgba(15, 15, 35, 0.85)":"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"dashboard-header-left",children:[s.jsx("img",{src:fs,alt:"DojoSoftware Logo",className:"dashboard-logo dojo-software-logo"}),s.jsx("h2",{children:"🏆 TDA Int'l Org - Super-Admin"}),s.jsxs("span",{className:"version-badge",style:{background:"rgba(255, 215, 0, 0.15)",color:"#ffd700",border:"1px solid rgba(255, 215, 0, 0.3)"},children:["v",i.app.version]})]}),s.jsxs("div",{className:"dashboard-header-right",children:[s.jsx(j,{}),!re&&window.history.length>1&&s.jsxs("button",{onClick:()=>_(-1),className:"logout-button",title:"Zur vorherigen Seite",children:["← ",t("header.back")]}),!re&&s.jsxs("button",{onClick:()=>_("/dashboard"),className:"logout-button",children:["← ",t("header.dashboard")]}),s.jsxs("div",{style:{position:"relative"},children:[s.jsxs("button",{onClick:()=>q(!Z),className:"logout-button",style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{children:"👤"}),s.jsx("span",{children:W||"User"}),s.jsx("span",{style:{fontSize:"0.7rem"},children:"▼"})]}),Z&&s.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"8px",background:"#1f2937",border:"1px solid rgba(255,255,255,0.15)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",minWidth:"200px",zIndex:1e4,overflow:"hidden"},children:[s.jsxs("button",{onClick:F,style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",fontSize:"0.9rem",textAlign:"left"},children:[T?s.jsx(Ce,{size:18}):s.jsx(Ae,{size:18}),s.jsx("span",{children:T?"Helles Theme":"Dunkles Theme"})]}),s.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",alignItems:"center",gap:"12px",fontSize:"0.9rem",color:"rgba(255,255,255,0.9)"},children:[s.jsx("span",{children:"🌐"}),s.jsx(m,{compact:!0,showLabel:!1})]}),s.jsxs("button",{onClick:()=>{q(!1),ee()},style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",fontSize:"0.9rem",textAlign:"left"},children:[s.jsx("span",{children:"🚪"}),s.jsx("span",{children:t("header.logout")})]})]})]})]})]}),s.jsx("main",{className:"dashboard-main",children:s.jsx(bs,{})})]})):"admin"===Y&&"verband"===C?(console.log("✅ Zeige Verband Dashboard für TDA Verband"),s.jsxs("div",{className:"dashboard-container "+("tda-vib"===B?"dashboard-tda-vib":""),children:[s.jsxs("header",{className:"dashboard-header",style:{background:T?"rgba(15, 15, 35, 0.85)":"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"dashboard-header-left",children:[s.jsx("img",{src:fs,alt:"DojoSoftware Logo",className:"dashboard-logo dojo-software-logo"}),s.jsx("h2",{children:"🌐 TDA Verband"}),s.jsxs("span",{className:"version-badge",style:{background:"rgba(255, 215, 0, 0.15)",color:"#ffd700",border:"1px solid rgba(255, 215, 0, 0.3)"},children:["v",i.app.version]})]}),s.jsxs("div",{className:"dashboard-header-right",children:[s.jsx(j,{}),s.jsxs("div",{style:{position:"relative"},children:[s.jsxs("button",{onClick:()=>q(!Z),className:"logout-button",style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{children:"👤"}),s.jsx("span",{children:W||"User"}),s.jsx("span",{style:{fontSize:"0.7rem"},children:"▼"})]}),Z&&s.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"8px",background:"#1f2937",border:"1px solid rgba(255,255,255,0.15)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",minWidth:"200px",zIndex:1e4,overflow:"hidden"},children:[s.jsxs("button",{onClick:F,style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",fontSize:"0.9rem",textAlign:"left"},children:[T?s.jsx(Ce,{size:18}):s.jsx(Ae,{size:18}),s.jsx("span",{children:T?"Helles Theme":"Dunkles Theme"})]}),s.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",alignItems:"center",gap:"12px",fontSize:"0.9rem",color:"rgba(255,255,255,0.9)"},children:[s.jsx("span",{children:"🌐"}),s.jsx(m,{compact:!0,showLabel:!1})]}),s.jsxs("button",{onClick:()=>{q(!1),ee()},style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",fontSize:"0.9rem",textAlign:"left"},children:[s.jsx("span",{children:"🚪"}),s.jsx("span",{children:t("header.logout")})]})]})]})]})]}),s.jsx("main",{className:"dashboard-main",children:s.jsx(Ze,{})})]})):"admin"===Y&&"support"===C?(console.log("✅ Zeige Support Dashboard für Support Center"),s.jsxs("div",{className:"dashboard-container "+("tda-vib"===B?"dashboard-tda-vib":""),children:[s.jsxs("header",{className:"dashboard-header",style:{background:T?"rgba(15, 15, 35, 0.85)":"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"dashboard-header-left",children:[s.jsx("img",{src:fs,alt:"DojoSoftware Logo",className:"dashboard-logo dojo-software-logo"}),s.jsx("h2",{children:"🎫 Support Center"}),s.jsxs("span",{className:"version-badge",style:{background:"rgba(255, 215, 0, 0.15)",color:"#ffd700",border:"1px solid rgba(255, 215, 0, 0.3)"},children:["v",i.app.version]})]}),s.jsxs("div",{className:"dashboard-header-right",children:[s.jsx(j,{}),s.jsxs("div",{style:{position:"relative"},children:[s.jsxs("button",{onClick:()=>q(!Z),className:"logout-button",style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{children:"👤"}),s.jsx("span",{children:W||"User"}),s.jsx("span",{style:{fontSize:"0.7rem"},children:"▼"})]}),Z&&s.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"8px",background:"#1f2937",border:"1px solid rgba(255,255,255,0.15)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",minWidth:"200px",zIndex:1e4,overflow:"hidden"},children:[s.jsxs("button",{onClick:F,style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",borderBottom:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.9)",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",fontSize:"0.9rem",textAlign:"left"},children:[T?s.jsx(Ce,{size:18}):s.jsx(Ae,{size:18}),s.jsx("span",{children:T?"Helles Theme":"Dunkles Theme"})]}),s.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",alignItems:"center",gap:"12px",fontSize:"0.9rem",color:"rgba(255,255,255,0.9)"},children:[s.jsx("span",{children:"🌐"}),s.jsx(m,{compact:!0,showLabel:!1})]}),s.jsxs("button",{onClick:()=>{q(!1),ee()},style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",fontSize:"0.9rem",textAlign:"left"},children:[s.jsx("span",{children:"🚪"}),s.jsx("span",{children:t("header.logout")})]})]})]})]})]}),s.jsx("main",{className:"dashboard-main",children:s.jsx(vs,{})})]})):s.jsxs("div",{className:"dashboard-container "+("tda-vib"===B?"dashboard-tda-vib":""),children:[s.jsxs("header",{className:"dashboard-header",children:[s.jsxs("div",{className:"dashboard-header-left",children:[s.jsx("img",{src:fs,alt:"DojoSoftware Logo",className:"dashboard-logo dojo-software-logo"}),s.jsx("h2",{children:te}),s.jsxs("span",{className:"version-badge",style:{background:"rgba(255, 215, 0, 0.15)",color:"#ffd700",border:"1px solid rgba(255, 215, 0, 0.3)"},children:["v",i.app.version]})]}),s.jsxs("div",{className:"dashboard-header-right",children:["admin"===Y&&s.jsx(j,{}),"admin"===Y&&s.jsx(v,{}),!re&&window.history.length>1&&s.jsx("button",{onClick:()=>_(-1),className:"logout-button",title:"Zur vorherigen Seite",children:"← Zurück"}),!re&&s.jsx("button",{onClick:()=>_("/dashboard"),className:"logout-button",children:"← Dashboard"}),s.jsxs("div",{ref:H,style:{position:"relative"},children:[s.jsxs("button",{onClick:()=>q(!Z),className:"logout-button",style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{children:"👤"}),s.jsx("span",{children:W||"User"}),s.jsx("span",{style:{fontSize:"0.7rem"},children:"▼"})]}),Z&&s.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"8px",background:"#1f2937",border:"1px solid rgba(255, 255, 255, 0.15)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",minWidth:"200px",zIndex:1e4},children:[s.jsxs("button",{onClick:()=>{F()},style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.9)",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",fontSize:"0.9rem",textAlign:"left"},onMouseEnter:e=>e.target.style.background="rgba(255, 255, 255, 0.1)",onMouseLeave:e=>e.target.style.background="transparent",children:[T?s.jsx(Ce,{size:18}):s.jsx(Ae,{size:18}),s.jsx("span",{children:T?"Helles Theme":"Dunkles Theme"})]}),s.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",display:"flex",alignItems:"center",gap:"12px",fontSize:"0.9rem",color:"rgba(255, 255, 255, 0.9)"},children:[s.jsx("span",{children:"🌐"}),s.jsx(m,{compact:!0,showLabel:!1})]}),s.jsxs("button",{onClick:()=>{q(!1),ee()},style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",fontSize:"0.9rem",textAlign:"left"},onMouseEnter:e=>e.target.style.background="rgba(239, 68, 68, 0.1)",onMouseLeave:e=>e.target.style.background="transparent",children:[s.jsx("span",{children:"🚪"}),s.jsx("span",{children:t("header.logout")})]})]})]})]})]}),s.jsx("div",{className:"dashboard-content",children:s.jsx("main",{className:"dashboard-main",children:re?s.jsxs("div",{className:"content-card",children:[U&&s.jsxs("div",{className:"error-message",children:["⚠️ ",U,s.jsx("button",{onClick:X,className:"btn btn-neutral btn-small",style:{marginLeft:"10px"},children:"🔄 Erneut versuchen"})]}),s.jsx(f,{stats:R}),"admin"===Y&&s.jsx(s.Fragment,{children:s.jsx("div",{className:"dashboard-tabs",children:ae.map(e=>s.jsxs("button",{className:"dashboard-tab "+(G===e.id?"active":""),onClick:()=>J(e.id),children:[s.jsx("span",{className:"tab-icon",children:e.icon}),s.jsx("span",{className:"tab-label",children:e.label})]},e.id))})}),s.jsx("div",{className:"dashboard-navigation",children:"admin"===Y?s.jsx(s.Fragment,{children:s.jsxs("div",{className:"tab-content",children:["checkin"===G&&s.jsxs("div",{className:"nav-cards",children:[s.jsxs("div",{onClick:()=>se("/dashboard/checkin"),className:"nav-card clickable featured",children:[s.jsx("div",{className:"nav-badge live",children:"LIVE"}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:"📱"}),s.jsxs("h3",{style:Ns,children:["Mitglieder Check-in",s.jsxs("span",{className:"nav-count",children:["(",ne(R.checkins_heute),")"]})]})]}),s.jsx("p",{children:"Touch & QR-Code Check-in für Mitglieder"})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]}),s.jsxs("div",{onClick:()=>se("/dashboard/anwesenheit"),className:"nav-card clickable",children:[s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:"✅"}),s.jsxs("h3",{style:Ns,children:["Anwesenheit",s.jsxs("span",{className:"nav-count",children:["(",ne(R.anwesenheit),")"]})]})]}),s.jsx("p",{children:"Anwesenheitsverfolgung und Statistiken"})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]}),s.jsxs("div",{onClick:()=>se("/dashboard/personal-checkin"),className:"nav-card clickable featured",children:[s.jsx("div",{className:"nav-badge new",children:"NEU"}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:"👥"}),s.jsxs("h3",{style:Ns,children:["Personal Check-in",s.jsxs("span",{className:"nav-count",children:["(",ne(R.personal_checkins_heute||0),")"]})]})]}),s.jsx("p",{children:"Arbeitszeit-Erfassung für Personal"})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]}),s.jsxs("div",{onClick:()=>window.open("/public-checkin","_blank","fullscreen=yes,scrollbars=yes"),className:"nav-card clickable featured",children:[s.jsx("div",{className:"nav-badge live",children:"LIVE"}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:"🖥️"}),s.jsxs("h3",{style:Ns,children:["Check-in Anzeige",s.jsx("span",{className:"nav-count",children:"(LIVE)"})]})]}),s.jsx("p",{children:"Check-in Display für 2. Monitor"})]}),s.jsx("div",{className:"nav-arrow",children:"↗"})]}),s.jsxs("div",{onClick:()=>window.open("/public-timetable","_blank","fullscreen=yes,scrollbars=yes"),className:"nav-card clickable featured",children:[s.jsx("div",{className:"nav-badge live",children:"LIVE"}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:"📚"}),s.jsxs("h3",{style:Ns,children:["Stundenplan Anzeige",s.jsx("span",{className:"nav-count",children:"(AUTO)"})]})]}),s.jsx("p",{children:"Rotierender Stundenplan für 2. Monitor"})]}),s.jsx("div",{className:"nav-arrow",children:"↗"})]}),s.jsxs("div",{onClick:()=>se("/dashboard/kasse"),className:"nav-card clickable featured",children:[s.jsx("div",{className:"nav-badge new",children:"NEU"}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:"💰"}),s.jsx("h3",{style:Ns,children:"Barverkauf"})]}),s.jsx("p",{children:"Touch-Kasse für Verkäufe und Barzahlungen"})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]}),s.jsxs("div",{onClick:()=>se("/dashboard/tresen"),className:"nav-card clickable featured",children:[s.jsx("div",{className:"nav-badge live",children:"LIVE"}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:"🏪"}),s.jsx("h3",{style:Ns,children:"Tresen-Übersicht"})]}),s.jsx("p",{children:"Empfang, Checkin & Tagesübersicht"})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]})]}),"mitglieder"===G&&s.jsx("div",{className:"nav-cards",children:ie.map((e,a)=>s.jsxs("div",{onClick:()=>se(e.path),className:"nav-card clickable "+(e.featured?"featured":""),children:[e.badge&&s.jsx("div",{className:"nav-badge "+("NEU"===e.badge?"new":"live"),children:e.badge}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:e.icon}),s.jsxs("h3",{style:Ns,children:[e.title,void 0!==e.count&&s.jsxs("span",{className:"nav-count",children:["(",ne(e.count),")"]})]})]}),s.jsx("p",{children:e.description})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]},a))}),"pruefungswesen"===G&&s.jsx("div",{className:"nav-cards",children:oe.map((e,a)=>s.jsxs("div",{onClick:()=>se(e.path),className:"nav-card clickable "+(e.featured?"featured":""),children:[e.badge&&s.jsx("div",{className:"nav-badge "+("NEU"===e.badge?"new":"LIVE"===e.badge?"live":"admin"),children:e.badge}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:e.icon}),s.jsxs("h3",{style:Ns,children:[e.title,void 0!==e.count&&s.jsxs("span",{className:"nav-count",children:["(",ne(e.count),")"]})]})]}),s.jsx("p",{children:e.description})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]},a))}),"events"===G&&s.jsx("div",{className:"nav-cards",children:[{icon:"📅",title:"Events verwalten",description:"Veranstaltungen, Wettkämpfe und besondere Termine",path:"/dashboard/events",badge:"NEU",featured:!0},{icon:"📊",title:"Event-Dashboard",description:"Statistiken, Zahlungen & Export",path:"/dashboard/events-dashboard",badge:"NEU"}].map((e,a)=>s.jsxs("div",{onClick:()=>se(e.path),className:"nav-card clickable "+(e.featured?"featured":""),children:[e.badge&&s.jsx("div",{className:"nav-badge "+("NEU"===e.badge?"new":"LIVE"===e.badge?"live":"admin"),children:e.badge}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:e.icon}),s.jsx("h3",{style:Ns,children:e.title})]}),s.jsx("p",{children:e.description})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]},a))}),"finanzen"===G&&s.jsx("div",{className:"nav-cards",children:ce.map((e,a)=>s.jsxs("div",{onClick:()=>se(e.path),className:"nav-card clickable "+(e.featured?"featured":""),children:[e.badge&&s.jsx("div",{className:"nav-badge "+("NEU"===e.badge?"new":"live"),children:e.badge}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:e.icon}),s.jsxs("h3",{style:Ns,children:[e.title,void 0!==e.count&&s.jsxs("span",{className:"nav-count",children:["(",ne(e.count),")"]})]})]}),s.jsx("p",{children:e.description})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]},a))}),"artikelverwaltung"===G&&s.jsx("div",{className:"nav-cards",children:[{icon:"📁",title:"Artikelgruppen",description:"Kampfsport-Kategorien und Unterkategorien",path:"/dashboard/artikelgruppen",badge:"NEU",featured:!0},{icon:"📦",title:"Artikelverwaltung",description:"Sortiment und Lagerbestände verwalten",path:"/dashboard/artikel",badge:"NEU",featured:!0}].map((e,a)=>s.jsxs("div",{onClick:()=>se(e.path),className:"nav-card clickable "+(e.featured?"featured":""),children:[e.badge&&s.jsx("div",{className:"nav-badge "+("NEU"===e.badge?"new":"LIVE"===e.badge?"live":"admin"),children:e.badge}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:e.icon}),s.jsx("h3",{style:Ns,children:e.title})]}),s.jsx("p",{children:e.description})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]},a))}),"verwaltung"===G&&s.jsx("div",{className:"nav-cards",children:le.map((e,a)=>s.jsxs("div",{onClick:()=>se(e.path),className:"nav-card clickable "+(e.featured?"featured":""),children:[e.badge&&s.jsx("div",{className:"nav-badge "+("NEU"===e.badge?"new":"live"),children:e.badge}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:e.icon}),s.jsxs("h3",{style:Ns,children:[e.title,void 0!==e.count&&s.jsxs("span",{className:"nav-count",children:["(",ne(e.count),")"]})]})]}),s.jsx("p",{children:e.description})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]},a))}),"personal"===G&&s.jsx("div",{className:"nav-cards",children:de.map((e,a)=>s.jsxs("div",{onClick:()=>se(e.path),className:"nav-card clickable "+(e.featured?"featured":""),children:[e.badge&&s.jsx("div",{className:"nav-badge "+("NEU"===e.badge?"new":"live"),children:e.badge}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:e.icon}),s.jsxs("h3",{style:Ns,children:[e.title,void 0!==e.count&&s.jsxs("span",{className:"nav-count",children:["(",ne(e.count),")"]})]})]}),s.jsx("p",{children:e.description})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]},a))}),"berichte"===G&&s.jsx("div",{className:"nav-cards",children:he.map((e,a)=>s.jsxs("div",{onClick:()=>se(e.path),className:"nav-card clickable "+(e.featured?"featured":""),children:[e.badge&&s.jsx("div",{className:"nav-badge "+("NEU"===e.badge?"new":"LIVE"===e.badge?"live":"admin"),children:e.badge}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:e.icon}),s.jsxs("h3",{style:Ns,children:[e.title,void 0!==e.count&&s.jsxs("span",{className:"nav-count",children:["(",ne(e.count),")"]})]})]}),s.jsx("p",{children:e.description})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]},a))}),"einstellungen"===G&&s.jsx("div",{className:"nav-cards",children:[{icon:"🏯",title:"Dojo-Verwaltung",description:"Dojos verwalten, Design, Theme, Verträge & Steuern",path:"/dashboard/dojos",badge:"DESIGN",featured:!0},{icon:"📥",title:"MagicLine Import",description:"Mitglieder & Verträge aus MagicLine importieren",path:"/dashboard/magicline-import",badge:"IMPORT",featured:!0},{icon:"📋",title:"Audit-Log",description:"Alle Änderungen nachverfolgen - Wer hat wann was geändert?",path:"/dashboard/audit-log",badge:"NEU",featured:!1},{icon:"🔗",title:"Webhooks & Zapier",description:"Automatisierungen mit externen Services",path:"/dashboard/webhooks",badge:"NEU",featured:!0},{icon:"🔌",title:"Integrationen",description:"PayPal, LexOffice, DATEV konfigurieren",path:"/dashboard/integrationen",badge:"NEU",featured:!0},{icon:"📅",title:"Kalender-Synchronisation",description:"iCal-Links für Google, Outlook, Apple",path:"/dashboard/kalender-sync",badge:"NEU",featured:!0}].map((e,a)=>s.jsxs("div",{onClick:()=>se(e.path),className:"nav-card clickable "+(e.featured?"featured":""),children:[e.badge&&s.jsx("div",{className:"nav-badge "+("NEU"===e.badge?"new":"LIVE"===e.badge?"live":"admin"),children:e.badge}),s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:e.icon}),s.jsx("h3",{style:Ns,children:e.title})]}),s.jsx("p",{children:e.description})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]},a))}),"schnellaktionen"===G&&s.jsxs("div",{className:"nav-section",children:[s.jsxs("h2",{className:"section-header quick-actions-header",style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",backgroundImage:"none",WebkitBackgroundClip:"unset",WebkitTextFillColor:"#FFD700",backgroundClip:"unset",color:"#FFD700",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"2rem"},children:[s.jsx("span",{style:{fontSize:"1.5rem",filter:"drop-shadow(0 2px 8px rgba(255, 215, 0, 0.3))",position:"relative",zIndex:10,lineHeight:1,display:"inline-block",flexShrink:0},children:"⚡"}),s.jsx("span",{style:{WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",color:"#FFD700 !important",WebkitTextFillColor:"#FFD700 !important",backgroundImage:"none !important",WebkitBackgroundClip:"unset !important",backgroundClip:"unset !important"},children:t("quickActions.title")})]}),"admin"===Y?s.jsx("div",{className:"quick-actions",children:[{label:"➕ Neues Mitglied",path:"/dashboard/mitglieder/neu",className:"primary"},{label:"🎖️ Neuen Stil anlegen",path:"/dashboard/stile/neu",className:"info"},{label:"✅ Anwesenheit erfassen",path:"/dashboard/anwesenheit",className:"secondary"},{label:"🥋 Prüfung verwalten",path:"/dashboard/stile/pruefungen",className:"warning"},{label:"👥 Buddy-Gruppe erstellen",path:"/dashboard/buddy-gruppen",className:"success"},{label:"🎯 Neuen Tarif anlegen",path:"/dashboard/tarife",className:"info"},{label:"📦 Artikel hinzufügen",path:"/dashboard/artikel",className:"success"},{label:"💰 Barverkauf",path:"/dashboard/kasse",className:"primary"},{label:"💰 Zahlungseinstellungen",path:"/dashboard/einstellungen/zahlungen",className:"warning"}].map((e,a)=>s.jsx("button",{onClick:()=>se(e.path),className:`quick-action-btn ${e.className}`,children:e.label},a))}):s.jsx("div",{className:"quick-actions",children:[{label:"📅 Kurs buchen",path:"/dashboard/kurse",className:"primary"},{label:"👤 Daten bearbeiten",path:"/dashboard/meine-daten",className:"secondary"}].map((e,a)=>s.jsx("button",{onClick:()=>se(e.path),className:`quick-action-btn ${e.className}`,children:e.label},a))}),s.jsx("div",{style:{marginTop:"2rem",textAlign:"center"},children:s.jsxs("button",{onClick:X,className:"quick-action-btn info",disabled:P,children:["🔄 ",t(P?"quickActions.loading":"quickActions.refreshStats")]})})]}),"support"===G&&s.jsx("div",{className:"nav-section",children:s.jsx(Ge,{bereich:"dojo"})}),"wunschliste"===G&&s.jsx("div",{className:"nav-section",children:s.jsx(He,{})}),"info"===G&&s.jsxs("div",{className:"nav-section",children:[s.jsxs("h2",{className:"section-header",children:["ℹ️ ",t("info.title")]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:"1.5rem",maxWidth:"1200px",margin:"0 auto"},children:[s.jsx("div",{style:{gridColumn:"span 1",background:"var(--glass-bg)",borderRadius:"16px",border:"1px solid var(--border-accent)",overflow:"hidden"},children:s.jsx(es,{})}),s.jsxs("div",{style:{background:"var(--glass-bg)",borderRadius:"16px",padding:"1.5rem",border:"1px solid var(--border-accent)"},children:[s.jsxs("h3",{style:{color:"var(--primary)",marginBottom:"1rem",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:["📊 ",t("info.dojoStats")]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[s.jsxs("div",{style:{background:"rgba(255,215,0,0.1)",padding:"1rem",borderRadius:"8px",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"700",color:"var(--primary)"},children:ne(R.mitglieder)}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:t("info.members")})]}),s.jsxs("div",{style:{background:"rgba(96,165,250,0.1)",padding:"1rem",borderRadius:"8px",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"700",color:"#60A5FA"},children:ne(R.kurse)}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:t("info.courses")})]}),s.jsxs("div",{style:{background:"rgba(52,211,153,0.1)",padding:"1rem",borderRadius:"8px",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"700",color:"#34D399"},children:ne(R.trainer)}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:t("info.trainers")})]}),s.jsxs("div",{style:{background:"rgba(244,114,182,0.1)",padding:"1rem",borderRadius:"8px",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"700",color:"#F472B6"},children:ne(R.checkins_heute)}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:t("info.checkinsToday")})]})]})]}),s.jsxs("div",{style:{background:"var(--glass-bg)",borderRadius:"16px",padding:"1.5rem",border:"1px solid var(--border-accent)"},children:[s.jsxs("h3",{style:{color:"var(--primary)",marginBottom:"1rem",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:["⚙️ ",t("info.system")]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"0.5rem 0",borderBottom:"1px solid var(--border-accent)"},children:[s.jsx("span",{style:{color:"var(--text-secondary)"},children:t("info.version")}),s.jsxs("span",{style:{color:"var(--text-primary)",fontWeight:"600"},children:["v",i.app.version]})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"0.5rem 0",borderBottom:"1px solid var(--border-accent)"},children:[s.jsx("span",{style:{color:"var(--text-secondary)"},children:t("info.build")}),s.jsx("span",{style:{color:"var(--text-primary)"},children:i.app.buildDate})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"0.5rem 0",borderBottom:"1px solid var(--border-accent)"},children:[s.jsx("span",{style:{color:"var(--text-secondary)"},children:t("info.developer")}),s.jsx("span",{style:{color:"var(--text-primary)"},children:i.app.author})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"0.5rem 0"},children:[s.jsx("span",{style:{color:"var(--text-secondary)"},children:t("info.support")}),s.jsx("a",{href:`mailto:${i.app.contactEmail}`,style:{color:"var(--primary)"},children:i.app.contactEmail})]})]})]}),s.jsxs("div",{style:{background:"var(--glass-bg)",borderRadius:"16px",padding:"1.5rem",border:"1px solid var(--border-accent)"},children:[s.jsxs("h3",{style:{color:"var(--primary)",marginBottom:"1rem",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:["🔗 ",t("info.quickAccess")]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[s.jsxs("button",{onClick:()=>se("/dashboard/einstellungen"),style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",background:"rgba(255,255,255,0.05)",border:"1px solid var(--border-accent)",borderRadius:"8px",color:"var(--text-primary)",cursor:"pointer",textAlign:"left",width:"100%"},children:[s.jsx("span",{children:"🏯"}),s.jsx("span",{children:t("info.dojoSettings")})]}),s.jsxs("button",{onClick:()=>se("/dashboard/audit-log"),style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",background:"rgba(255,255,255,0.05)",border:"1px solid var(--border-accent)",borderRadius:"8px",color:"var(--text-primary)",cursor:"pointer",textAlign:"left",width:"100%"},children:[s.jsx("span",{children:"📋"}),s.jsx("span",{children:t("einstellungen.auditLog")})]}),s.jsxs("button",{onClick:()=>se("/dashboard/vertragsdokumente"),style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",background:"rgba(255,255,255,0.05)",border:"1px solid var(--border-accent)",borderRadius:"8px",color:"var(--text-primary)",cursor:"pointer",textAlign:"left",width:"100%"},children:[s.jsx("span",{children:"📄"}),s.jsx("span",{children:t("info.editAgb")})]})]})]}),s.jsx("div",{style:{gridColumn:"1 / -1"},children:s.jsx(u,{maxItems:3})})]})]})]})}):s.jsx(s.Fragment,{children:s.jsxs("div",{className:"nav-section",children:[s.jsx("h2",{className:"section-header",children:"🥋 Meine Dojo-Bereiche"}),s.jsx("div",{className:"nav-cards",children:[{icon:"✅",title:"Meine Anwesenheit",description:"Ihre Trainingshistorie einsehen",path:"/dashboard/meine-anwesenheit"},{icon:"🥋",title:"Meine Kurse",description:"Angemeldete Kurse und Termine",path:"/dashboard/meine-kurse"},{icon:"👤",title:"Meine Daten",description:"Persönliche Daten bearbeiten",path:"/dashboard/meine-daten"},{icon:"🎖️",title:"Meine Prüfungen",description:"Prüfungsstatus und nächste Gürtelprüfung",path:"/dashboard/meine-pruefungen"},{icon:"💰",title:"Meine Beiträge",description:"Zahlungshistorie und offene Beiträge",path:"/dashboard/meine-beitraege"}].map((e,a)=>s.jsxs("div",{onClick:()=>se(e.path),className:"nav-card clickable",children:[s.jsxs("div",{className:"nav-content",children:[s.jsxs("div",{className:"nav-card-header",children:[s.jsx("span",{className:"nav-icon",children:e.icon}),s.jsx("h3",{style:Ns,children:e.title})]}),s.jsx("p",{children:e.description})]}),s.jsx("div",{className:"nav-arrow",children:"→"})]},a))})]})})})]}):s.jsx("div",{className:"content-card",children:s.jsx(Xe,{})})})}),"admin"===Y&&s.jsx(N,{})]}))}export{ys as default};
