import{j as e}from"./animation-1wuIdCBS.js";import{r as s}from"./vendor-router-BhMXg4Z-.js";import{u as t,b as n,k as a,c as r,i}from"./index-DUnH23_2.js";import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";import"./icons-D7rg4pDH.js";const l=()=>{const{token:l}=t(),{getDojoFilterParam:c}=n(),[o,d]=s.useState([]),[h,u]=s.useState({}),[m,g]=s.useState({mitglieder:0,anwesenheit:0,checkins_heute:0,kurse:0,stile:0,trainer:0,beitraege:0}),[p,f]=s.useState(()=>(new Date).toISOString().split("T")[0]),[x,b]=s.useState(!1),[k,_]=s.useState(null),[j,v]=s.useState(""),[y,w]=s.useState(!1);s.useEffect(()=>{(async()=>{if(l)try{const e=c(),s=await i(l,e);g({mitglieder:s.mitglieder||0,anwesenheit:s.anwesenheit||0,checkins_heute:s.checkins_heute||0,kurse:s.kurse||0,stile:s.stile||0,trainer:s.trainer||0,beitraege:s.beitraege||0})}catch(e){console.error("Fehler beim Laden der Dashboard-Stats:",e)}})()},[l,c]),s.useEffect(()=>{N(p)},[p]);const N=async e=>{try{b(!0),_(null),console.log(`ğŸ“¢ Lade Tresen-Daten fÃ¼r ${e}...`);const s=await a(`${r.apiBaseUrl}/checkin/tresen/${e}`);if(!s.ok){const e=await s.text();throw console.error(`âŒ HTTP ${s.status}: ${e.substring(0,200)}`),new Error(`HTTP ${s.status}: ${s.statusText}`)}const t=s.headers.get("content-type");if(!t||!t.includes("application/json")){const e=await s.text();throw console.error(`âŒ UngÃ¼ltiger Content-Type: ${t}`),console.error(`Response: ${e.substring(0,500)}`),new Error("Server hat kein JSON zurÃ¼ckgegeben")}const n=await s.json();n.success?(console.log("ğŸ“¦ Rohe Daten vom Server:",n),console.log("ğŸ“‹ Anwesende Array:",n.anwesende),console.log("ğŸ“Š Anzahl Anwesende:",(n.anwesende||[]).length),d(n.anwesende||[]),u(n.stats||{}),console.log(`âœ… ${(n.anwesende||[]).length} Anwesende geladen`),console.log("ğŸ“Š Stats:",n.stats),(n.anwesende||[]).length>0&&console.log("ğŸ‘¥ Erste 3 Anwesende:",n.anwesende.slice(0,3))):(_(n.message||"Fehler beim Laden der Daten"),d([]),u({}))}catch(s){console.error("âŒ Fehler beim Laden der Tresen-Daten:",s),_(`Verbindungsfehler: ${s.message}`),d([]),u({})}finally{b(!1)}},z=e=>{f(e),v(""),w(!1)},S=e=>{const s=new Date;s.setDate(s.getDate()+e);const t=s.toISOString().split("T")[0];z(t)},C=async e=>{try{b(!0);const s=await a(`${r.apiBaseUrl}/checkin/tresen/batch-checkin`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mitglieder_ids:e,datum:p})}),t=await s.json();t.success?(console.log(`âœ… Batch Check-in erfolgreich: ${t.results.length} Mitglieder`),await N(p)):_(t.message||"Fehler beim Batch Check-in")}catch(s){console.error("âŒ Batch Check-in Fehler:",s),_("Batch Check-in fehlgeschlagen")}finally{b(!1)}},T=s.useMemo(()=>{const e=((e=[])=>{const s=new Map;return e.forEach(e=>{if(!e)return;const t=e.mitglied_id||`${e.full_name||""}-${e.stundenplan_id||""}`;if(!s.has(t)){const n=e.full_name||`${e.vorname||""} ${e.nachname||""}`.trim();s.set(t,{mitglied_id:e.mitglied_id,full_name:n,vorname:e.vorname,nachname:e.nachname,gurtfarbe:e.gurtfarbe,foto_pfad:e.foto_pfad,kurse:[],selbsteingechecktCount:0,trainerHinzugefuegtCount:0,selbst_checkin_time:e.selbst_checkin_time,checkout_time:e.checkout_time,trainer_hinzugefuegt_am:e.trainer_hinzugefuegt_am,anwesenheits_typ:e.anwesenheits_typ,erstesCheckinDatum:e.selbst_checkin_time||e.trainer_hinzugefuegt_am||null})}const n=s.get(t);n.kurse.push({kurs_name:e.kurs_name||"Freies Training",kurs_zeit:e.kurs_zeit,anwesenheits_typ:e.anwesenheits_typ,selbst_checkin_time:e.selbst_checkin_time,trainer_hinzugefuegt_am:e.trainer_hinzugefuegt_am,checkout_time:e.checkout_time}),"selbst_eingecheckt"===e.anwesenheits_typ&&(n.selbsteingechecktCount+=1,!n.selbst_checkin_time&&e.selbst_checkin_time&&(n.selbst_checkin_time=e.selbst_checkin_time)),"trainer_hinzugefuegt"===e.anwesenheits_typ&&(n.trainerHinzugefuegtCount+=1,!n.trainer_hinzugefuegt_am&&e.trainer_hinzugefuegt_am&&(n.trainer_hinzugefuegt_am=e.trainer_hinzugefuegt_am))}),Array.from(s.values()).map(e=>{const s=e.trainerHinzugefuegtCount>0,t=e.selbsteingechecktCount>0;return{...e,hatTrainerHinzugefuegt:s,hatSelbstEingecheckt:t,anwesenheits_typ:s?"trainer_hinzugefuegt":t?"selbst_eingecheckt":e.anwesenheits_typ}})})(o),s=j.trim().toLowerCase();return e.filter(e=>{var t,n,a,r;const i=!s||(null==(t=e.full_name)?void 0:t.toLowerCase().includes(s))||(null==(n=e.vorname)?void 0:n.toLowerCase().includes(s))||(null==(a=e.nachname)?void 0:a.toLowerCase().includes(s))||(null==(r=e.kurse)?void 0:r.some(e=>{var t;return null==(t=e.kurs_name)?void 0:t.toLowerCase().includes(s)})),l=!y||e.hatTrainerHinzugefuegt;return i&&l})},[o,j,y]),$=e=>0===e?"0":e.toLocaleString("de-DE");return e.jsxs("div",{className:"tresen-uebersicht-container",children:[e.jsxs("div",{className:"tresen-header",children:[e.jsx("h2",{children:"ğŸª Tresen-Ãœbersicht"}),e.jsx("p",{className:"description",children:"Alle heute anwesenden Mitglieder - eingecheckt oder vom Trainer hinzugefÃ¼gt"})]}),e.jsxs("div",{className:"stats-floating-bar",style:{display:"flex",alignItems:"center",justifyContent:"space-around",gap:"0.5rem",padding:"0.5rem 1rem",marginBottom:"1.5rem",background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(10px)",borderRadius:"8px",border:"1px solid rgba(255, 215, 0, 0.15)",flexWrap:"wrap"},children:[e.jsxs("div",{className:"stat-item",style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.25rem 0.75rem",borderRadius:"6px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 215, 0, 0.1)",flex:"1 1 auto",minWidth:"fit-content"},children:[e.jsx("span",{style:{fontSize:"0.95rem"},children:"ğŸ‘¥"}),e.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ffd700"},children:$(m.mitglieder)}),e.jsx("span",{style:{fontSize:"0.7rem",color:"rgba(255, 255, 255, 0.6)",textTransform:"uppercase",letterSpacing:"0.3px"},children:"Mitglieder"})]}),e.jsxs("div",{className:"stat-item",style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.25rem 0.75rem",borderRadius:"6px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 215, 0, 0.1)",flex:"1 1 auto",minWidth:"fit-content"},children:[e.jsx("span",{style:{fontSize:"0.95rem"},children:"âœ…"}),e.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ffd700"},children:$(m.anwesenheit)}),e.jsx("span",{style:{fontSize:"0.7rem",color:"rgba(255, 255, 255, 0.6)",textTransform:"uppercase",letterSpacing:"0.3px"},children:"Anwesenheiten"})]}),e.jsxs("div",{className:"stat-item",style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.25rem 0.75rem",borderRadius:"6px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 215, 0, 0.1)",flex:"1 1 auto",minWidth:"fit-content"},children:[e.jsx("span",{style:{fontSize:"0.95rem"},children:"ğŸ“±"}),e.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ffd700"},children:$(m.checkins_heute)}),e.jsx("span",{style:{fontSize:"0.7rem",color:"rgba(255, 255, 255, 0.6)",textTransform:"uppercase",letterSpacing:"0.3px"},children:"Check-ins"})]}),e.jsxs("div",{className:"stat-item",style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.25rem 0.75rem",borderRadius:"6px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 215, 0, 0.1)",flex:"1 1 auto",minWidth:"fit-content"},children:[e.jsx("span",{style:{fontSize:"0.95rem"},children:"ğŸ¥‹"}),e.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ffd700"},children:$(m.kurse)}),e.jsx("span",{style:{fontSize:"0.7rem",color:"rgba(255, 255, 255, 0.6)",textTransform:"uppercase",letterSpacing:"0.3px"},children:"Kurse"})]}),e.jsxs("div",{className:"stat-item",style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.25rem 0.75rem",borderRadius:"6px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 215, 0, 0.1)",flex:"1 1 auto",minWidth:"fit-content"},children:[e.jsx("span",{style:{fontSize:"0.95rem"},children:"ğŸ–ï¸"}),e.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ffd700"},children:$(m.stile)}),e.jsx("span",{style:{fontSize:"0.7rem",color:"rgba(255, 255, 255, 0.6)",textTransform:"uppercase",letterSpacing:"0.3px"},children:"Stile"})]}),e.jsxs("div",{className:"stat-item",style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.25rem 0.75rem",borderRadius:"6px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 215, 0, 0.1)",flex:"1 1 auto",minWidth:"fit-content"},children:[e.jsx("span",{style:{fontSize:"0.95rem"},children:"ğŸ‘¨â€ğŸ«"}),e.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ffd700"},children:$(m.trainer)}),e.jsx("span",{style:{fontSize:"0.7rem",color:"rgba(255, 255, 255, 0.6)",textTransform:"uppercase",letterSpacing:"0.3px"},children:"Trainer"})]}),e.jsxs("div",{className:"stat-item",style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.25rem 0.75rem",borderRadius:"6px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 215, 0, 0.1)",flex:"1 1 auto",minWidth:"fit-content"},children:[e.jsx("span",{style:{fontSize:"0.95rem"},children:"ğŸ’°"}),e.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ffd700"},children:$(m.beitraege)}),e.jsx("span",{style:{fontSize:"0.7rem",color:"rgba(255, 255, 255, 0.6)",textTransform:"uppercase",letterSpacing:"0.3px"},children:"BeitrÃ¤ge"})]})]}),e.jsxs("div",{className:"tresen-kontrollzeile",children:[e.jsxs("div",{className:"datum-kontrollen",children:[e.jsxs("div",{className:"datum-auswahl",children:[e.jsx("label",{children:"Datum:"}),e.jsx("input",{type:"date",value:p,onChange:e=>z(e.target.value)}),e.jsx("span",{className:"wochentag",children:(D=p,["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"][new Date(D).getDay()])})]}),e.jsxs("div",{className:"schnellzugriff",children:[e.jsx("button",{onClick:()=>S(-1),children:"â¬… Gestern"}),e.jsx("button",{onClick:()=>S(0),children:"ğŸ“… Heute"}),e.jsx("button",{onClick:()=>S(1),children:"Morgen â¡"})]})]}),e.jsxs("div",{className:"stats-overview",children:[e.jsxs("div",{className:"stat-card total",children:[e.jsx("div",{className:"stat-number",children:h.total_anwesend||0}),e.jsx("div",{className:"stat-label",children:"Gesamt"})]}),e.jsxs("div",{className:"stat-card eingecheckt",children:[e.jsx("div",{className:"stat-number",children:h.selbst_eingecheckt||0}),e.jsx("div",{className:"stat-label",children:"ğŸ“± Eingecheckt"})]}),e.jsxs("div",{className:"stat-card trainer",children:[e.jsx("div",{className:"stat-number",children:h.trainer_hinzugefuegt||0}),e.jsx("div",{className:"stat-label",children:"ğŸ‘¨â€ğŸ« Trainer"})]}),e.jsxs("div",{className:"stat-card warnung",children:[e.jsx("div",{className:"stat-number",children:h.brauchen_checkin||0}),e.jsx("div",{className:"stat-label",children:"âš ï¸ Offen"})]})]})]}),e.jsxs("div",{className:"filter-kontrollen",children:[e.jsx("div",{className:"suche",children:e.jsx("input",{type:"text",placeholder:"ğŸ” Name oder Kurs suchen...",value:j,onChange:e=>v(e.target.value),className:"suchfeld"})}),e.jsxs("div",{className:"filter-optionen",children:[e.jsxs("label",{className:"filter-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:e=>w(e.target.checked)}),'Nur "brauchen Check-in" anzeigen']}),h.brauchen_checkin>0&&e.jsxs("button",{className:"batch-checkin-button",onClick:()=>{const e=o.filter(e=>"trainer_hinzugefuegt"===e.anwesenheits_typ).map(e=>e.mitglied_id);e.length>0&&confirm(`${e.length} Mitglieder nachtrÃ¤glich einchecken?`)&&C(e)},disabled:x,children:["ğŸ“± Alle ",h.brauchen_checkin," nachtrÃ¤glich einchecken"]})]})]}),k&&e.jsxs("div",{className:"error-message",children:["âŒ ",k]}),x&&e.jsx("div",{className:"loading",children:"ğŸ”„ Lade..."}),e.jsxs("div",{className:"anwesende-liste",children:[!x&&0===T.length&&e.jsx("div",{className:"keine-anwesende",children:0===o.length?"ğŸ“­ Keine Anwesenden heute":"ğŸ“­ Keine Treffer fÃ¼r die aktuellen Filter"}),T.map(s=>{var t,n,a;const r=s.mitglied_id||s.full_name,i=(null==(t=s.kurse)?void 0:t.filter(e=>"trainer_hinzugefuegt"===e.anwesenheits_typ))||[],l=(null==(n=s.kurse)?void 0:n.filter(e=>"selbst_eingecheckt"===e.anwesenheits_typ))||[],c=s.full_name||`${s.vorname||""} ${s.nachname||""}`.trim();return e.jsxs("div",{className:`person-card ${s.anwesenheits_typ||""}`,children:[e.jsxs("div",{className:"person-card-main",children:[e.jsx("div",{className:"status-icon",children:s.hatTrainerHinzugefuegt?"ğŸ‘¨â€ğŸ«":"ğŸ“±"}),e.jsxs("div",{className:"person-info",children:[e.jsxs("div",{className:"person-name",children:[e.jsx("strong",{children:c}),s.gurtfarbe&&e.jsx("span",{className:"gurtfarbe",children:s.gurtfarbe})]}),(null==(a=s.kurse)?void 0:a.length)>0&&e.jsx("div",{className:"kurs-tags",children:s.kurse.map((t,n)=>e.jsxs("span",{className:"kurs-tag "+("trainer_hinzugefuegt"===t.anwesenheits_typ?"kurs-tag-trainer":"kurs-tag-checkin"),children:[e.jsx("span",{children:t.kurs_name||"Unbekannter Kurs"}),t.kurs_zeit&&e.jsx("span",{className:"kurs-tag-zeit",children:t.kurs_zeit})]},`${s.mitglied_id||n}-${t.stundenplan_id||n}`))})]})]}),e.jsxs("div",{className:"person-status",children:[l.length>0&&e.jsxs("div",{className:"status-block success",children:[e.jsx("div",{className:"status-label",children:"ğŸ“± Eingecheckt"}),e.jsx("ul",{className:"kurs-status-list",children:l.map((s,t)=>e.jsxs("li",{children:[s.kurs_name||"Kurs",s.selbst_checkin_time&&e.jsxs("span",{className:"kurs-status-zeit",children:[" ","Â·"," ",new Date(s.selbst_checkin_time).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})]})]},`selbst-${r}-${t}`))})]}),i.length>0&&e.jsxs("div",{className:"status-block warnung",children:[e.jsx("div",{className:"status-label warnung",children:"âš ï¸ Bitte einchecken"}),e.jsx("ul",{className:"kurs-status-list",children:i.map((s,t)=>e.jsxs("li",{children:[s.kurs_name||"Kurs",s.trainer_hinzugefuegt_am&&e.jsxs("span",{className:"kurs-status-zeit",children:[" ","Â·"," ",new Date(s.trainer_hinzugefuegt_am).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})]})]},`trainer-${r}-${t}`))}),e.jsx("button",{className:"einzelner-checkin-button",onClick:()=>C([s.mitglied_id]),disabled:x,children:"ğŸ“± Einchecken"})]})]})]},r)})]}),e.jsx("div",{className:"refresh-controls",children:e.jsx("button",{className:"refresh-button",onClick:()=>N(p),disabled:x,children:"ğŸ”„ Aktualisieren"})})]});var D};export{l as default};
