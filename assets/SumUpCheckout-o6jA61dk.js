import{a as e,j as n}from"./query-Caj74EYQ.js";import{a as t}from"./index-D4wQygnO.js";import{Q as a}from"./index-wRQyZq66.js";import{K as r,V as o,b4 as s,R as i,g as l,t as d}from"./icons-eh0tbLFx.js";const c=({amount:c,description:u,reference:x,dojoId:g,mitgliedId:f,rechnungId:h,verkaufId:m,eventAnmeldungId:b,verbandsmitgliedschaftId:y,zahlungstyp:j="sonstig",onSuccess:I,onError:k,onCancel:v,showQRCode:z=!0,autoCheckStatus:S=!0,pollInterval:B=3e3,maxPollAttempts:C=60})=>{const[w,R]=e.useState("idle"),[D,Z]=e.useState(null),[A,T]=e.useState(null),[E,U]=e.useState(0),W=e.useCallback(async()=>{var e,n;R("creating"),T(null);try{const e=await t.post("/sumup/checkout",{dojo_id:g,amount:c,description:u,reference:x,mitgliedId:f,rechnungId:h,verkaufId:m,eventAnmeldungId:b,verbandsmitgliedschaftId:y,zahlungstyp:j,returnUrl:window.location.href});e.data.success?(Z(e.data),R("pending")):(T(e.data.error||"Fehler beim Erstellen der Zahlung"),R("failed"),k&&k(e.data.error))}catch(a){const t=(null==(n=null==(e=a.response)?void 0:e.data)?void 0:n.error)||a.message;T(t),R("failed"),k&&k(t)}},[c,u,x,g,f,h,m,b,y,j,z,k]),q=e.useCallback(async()=>{if(null==D?void 0:D.checkoutId){try{const e=await t.get(`/sumup/checkout/${D.checkoutId}?dojo_id=${g}`);if("PAID"===e.data.status)return R("paid"),I&&I({checkoutId:D.checkoutId,transactionId:e.data.transactionId,amount:e.data.amount}),!0;if("FAILED"===e.data.status)return R("failed"),T("Zahlung fehlgeschlagen"),k&&k("Zahlung fehlgeschlagen"),!0}catch(e){console.error("Status check error:",e)}return!1}},[D,g,I,k]);e.useEffect(()=>{if("pending"!==w||!S)return;const e=setInterval(async()=>{U(e=>e+1);(await q()||E>=C)&&(clearInterval(e),E>=C&&"pending"===w&&(R("expired"),T("Zahlung abgelaufen"),k&&k("Zahlung abgelaufen")))},B);return()=>clearInterval(e)},[w,S,q,E,C,B,k]);return n.jsxs("div",{style:p.container,children:[n.jsxs("div",{style:p.header,children:[n.jsx(r,{size:24,color:"#00b5ad"}),n.jsx("span",{style:p.title,children:"SumUp Kartenzahlung"})]}),n.jsxs("div",{style:p.amountDisplay,children:[n.jsx("span",{style:p.amountLabel,children:"Betrag"}),n.jsxs("span",{style:p.amountValue,children:[parseFloat(c).toFixed(2)," EUR"]})]}),"idle"===w&&n.jsxs("button",{style:p.primaryButton,onClick:W,children:[n.jsx(r,{size:20}),"Kartenzahlung starten"]}),"creating"===w&&n.jsxs("div",{style:p.statusBox,children:[n.jsx(o,{size:32,style:p.spinner}),n.jsx("span",{style:p.statusText,children:"Zahlung wird erstellt..."})]}),"pending"===w&&D&&n.jsxs("div",{style:p.pendingBox,children:[z&&(null==D?void 0:D.checkoutUrl)&&n.jsxs("div",{style:p.qrContainer,children:[n.jsx(a,{value:D.checkoutUrl,size:180,bgColor:"#ffffff",fgColor:"#000000",level:"M"}),n.jsx("span",{style:p.qrHint,children:"QR-Code scannen oder Link öffnen"})]}),n.jsxs("button",{style:p.linkButton,onClick:()=>{(null==D?void 0:D.checkoutUrl)&&window.open(D.checkoutUrl,"_blank")},children:[n.jsx(s,{size:18}),"Zahlungslink öffnen"]}),n.jsxs("div",{style:p.waitingBox,children:[n.jsx(o,{size:20,style:p.smallSpinner}),n.jsx("span",{children:"Warte auf Zahlung..."})]}),n.jsxs("button",{style:p.secondaryButton,onClick:q,children:[n.jsx(i,{size:16}),"Status prüfen"]}),n.jsx("button",{style:p.cancelButton,onClick:async()=>{if(null==D?void 0:D.checkoutId)try{await t.delete(`/sumup/checkout/${D.checkoutId}?dojo_id=${g}`)}catch(e){console.error("Cancel error:",e)}R("idle"),Z(null),v&&v()},children:"Abbrechen"})]}),"paid"===w&&n.jsxs("div",{style:p.successBox,children:[n.jsx(l,{size:48,color:"#22c55e"}),n.jsx("span",{style:p.successText,children:"Zahlung erfolgreich!"}),(null==D?void 0:D.transactionId)&&n.jsxs("span",{style:p.transactionId,children:["Transaktions-ID: ",D.transactionId]})]}),("failed"===w||"expired"===w)&&n.jsxs("div",{style:p.errorBox,children:[n.jsx(d,{size:48,color:"#ef4444"}),n.jsx("span",{style:p.errorText,children:"expired"===w?"Zahlung abgelaufen":"Zahlung fehlgeschlagen"}),A&&n.jsx("span",{style:p.errorDetail,children:A}),n.jsxs("button",{style:p.retryButton,onClick:()=>{R("idle"),Z(null),T(null),U(0),W()},children:[n.jsx(i,{size:16}),"Erneut versuchen"]})]})]})},p={container:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(0, 181, 173, 0.3)",borderRadius:"12px",padding:"24px",maxWidth:"400px"},header:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},title:{color:"#fff",fontSize:"18px",fontWeight:"600"},amountDisplay:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",background:"rgba(0, 0, 0, 0.2)",borderRadius:"8px",marginBottom:"20px"},amountLabel:{color:"#aaa",fontSize:"14px"},amountValue:{color:"#ffd700",fontSize:"24px",fontWeight:"bold"},primaryButton:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",padding:"14px 20px",background:"#00b5ad",border:"none",borderRadius:"8px",color:"#fff",fontSize:"16px",fontWeight:"600",cursor:"pointer"},statusBox:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",padding:"24px"},spinner:{animation:"spin 1s linear infinite",color:"#00b5ad"},smallSpinner:{animation:"spin 1s linear infinite",color:"#00b5ad"},statusText:{color:"#aaa",fontSize:"14px"},pendingBox:{display:"flex",flexDirection:"column",alignItems:"center",gap:"16px"},qrContainer:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"16px",background:"#fff",borderRadius:"12px"},qrHint:{color:"#666",fontSize:"12px",textAlign:"center"},linkButton:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",background:"rgba(0, 181, 173, 0.2)",border:"1px solid #00b5ad",borderRadius:"8px",color:"#00b5ad",fontSize:"14px",cursor:"pointer"},waitingBox:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 16px",background:"rgba(255, 255, 255, 0.05)",borderRadius:"8px",color:"#aaa",fontSize:"14px"},secondaryButton:{display:"flex",alignItems:"center",gap:"6px",padding:"10px 16px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"#fff",fontSize:"14px",cursor:"pointer"},cancelButton:{padding:"10px 16px",background:"transparent",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"#aaa",fontSize:"14px",cursor:"pointer"},successBox:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",padding:"24px"},successText:{color:"#22c55e",fontSize:"18px",fontWeight:"600"},transactionId:{color:"#aaa",fontSize:"12px"},errorBox:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",padding:"24px"},errorText:{color:"#ef4444",fontSize:"18px",fontWeight:"600"},errorDetail:{color:"#aaa",fontSize:"14px",textAlign:"center"},retryButton:{display:"flex",alignItems:"center",gap:"6px",padding:"10px 20px",background:"rgba(239, 68, 68, 0.2)",border:"1px solid #ef4444",borderRadius:"8px",color:"#ef4444",fontSize:"14px",cursor:"pointer",marginTop:"8px"}};if("undefined"!=typeof document){const e=document.createElement("style");e.textContent="\n  @keyframes spin {\n    from { transform: rotate(0deg); }\n    to { transform: rotate(360deg); }\n  }\n",document.head.appendChild(e)}export{c as S};
