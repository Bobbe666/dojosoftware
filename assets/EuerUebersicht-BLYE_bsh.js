import{a as e,j as r}from"./query-Caj74EYQ.js";import{u as n,c as s,f as i}from"./index-lGWqIYMX.js";import{ac as t,az as a,a0 as l,Q as d,F as o,p as m,u as c,D as h,N as g,o as x,aD as u,K as v,aE as j}from"./icons-C9nQ4cWf.js";import{R as p,h as y,C as b,X as f,Y as S,T as k,L as w,b as z,e as A}from"./charts-QHQg_ypW.js";import"./vendor-router-B2AaIOtG.js";const E=({isTDA:E=!1})=>{var R,_,D,F,C,N,I,U,W,$,B,L,T,V,K,M,P,O,Y,G,J,X;const{activeDojo:q}=n(),[Q,H]=e.useState(!0),[Z,ee]=e.useState(null),[re,ne]=e.useState((new Date).getFullYear()),[se,ie]=e.useState(null),[te,ae]=e.useState(null);e.useEffect(()=>{le()},[re,q,E]);const le=async()=>{try{H(!0),ee(null);const e=E?`${s.apiBaseUrl}/euer/tda?jahr=${re}`:`${s.apiBaseUrl}/euer/dojo/${(null==q?void 0:q.dojo_id)||(null==q?void 0:q.id)}?jahr=${re}`,r=await i(e);if(!r.ok)throw new Error("Fehler beim Laden der EÜR-Daten");const n=await r.json();if(!n.success)throw new Error(n.error||"Unbekannter Fehler");ie(n)}catch(e){console.error("EÜR Fehler:",e),ee(e.message)}finally{H(!1)}},de=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e||0),oe=e=>new Date(2024,e-1,1).toLocaleString("de-DE",{month:"short"}),me=(null==(R=null==se?void 0:se.monate)?void 0:R.map(e=>({name:oe(e.monat),monat:e.monat,einnahmen:e.einnahmen.gesamt,ausgaben:e.ausgaben.gesamt,ueberschuss:e.ueberschuss})))||[];!E||!(null==se?void 0:se.monate)||se.monate.map(e=>({name:oe(e.monat),mitglieder:e.einnahmen.mitglieder||0,verband:e.einnahmen.verbandsmitgliedschaften||0,software:e.einnahmen.software_lizenzen||0,rechnungen:e.einnahmen.rechnungen||0,verkaeufe:e.einnahmen.verkaeufe||0}));const ce=({active:e,payload:n,label:s})=>e&&n&&n.length?r.jsxs("div",{className:"chart-tooltip",style:{backgroundColor:"var(--bg-modal)",border:"1px solid var(--border-primary)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.3)"},children:[r.jsx("p",{style:{fontWeight:"600",marginBottom:"8px"},children:s}),n.map((e,n)=>r.jsxs("p",{style:{color:e.color,margin:"4px 0"},children:[e.name,": ",de(e.value)]},n))]}):null;return Q?r.jsxs("div",{className:"loading-container",style:{padding:"2rem",textAlign:"center"},children:[r.jsx("div",{className:"loading-spinner"}),r.jsx("p",{children:"Lade EÜR-Daten..."})]}):Z?r.jsxs("div",{className:"error-container",style:{padding:"2rem",textAlign:"center",color:"var(--error)"},children:[r.jsxs("p",{children:["Fehler: ",Z]}),r.jsx("button",{onClick:le,className:"btn btn-primary",style:{marginTop:"1rem"},children:"Erneut versuchen"})]}):r.jsxs("div",{className:"euer-uebersicht",children:[r.jsxs("div",{className:"euer-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem",flexWrap:"wrap",gap:"1rem"},children:[r.jsxs("div",{children:[r.jsxs("h2",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.jsx(t,{size:24}),"EÜR - Einnahmen-Überschuss-Rechnung",E&&r.jsx("span",{style:{backgroundColor:"var(--primary)",color:"white",padding:"2px 8px",borderRadius:"4px",fontSize:"0.7rem",marginLeft:"0.5rem"},children:"TDA"})]}),r.jsx("p",{style:{margin:"0.5rem 0 0 0",color:"var(--text-secondary)"},children:E?"Tiger & Dragon Association International":(null==q?void 0:q.dojoname)||"Dojo"})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.jsx("button",{onClick:()=>ne(e=>e-1),className:"btn btn-icon",title:"Vorheriges Jahr",children:r.jsx(a,{size:20})}),r.jsx("span",{style:{fontWeight:"600",fontSize:"1.1rem",minWidth:"60px",textAlign:"center"},children:re}),r.jsx("button",{onClick:()=>ne(e=>e+1),className:"btn btn-icon",disabled:re>=(new Date).getFullYear(),title:"Nächstes Jahr",children:r.jsx(l,{size:20})})]}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[r.jsxs("button",{onClick:async()=>{try{const e=E?`${s.apiBaseUrl}/euer/export/tda?jahr=${re}`:`${s.apiBaseUrl}/euer/export/${(null==q?void 0:q.dojo_id)||(null==q?void 0:q.id)}?jahr=${re}`,r=await i(e),n=await r.blob(),t=window.URL.createObjectURL(n),a=document.createElement("a");a.href=t,a.download=`EUER_${E?"TDA":"Dojo"}_${re}.csv`,document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(t)}catch(e){console.error("Export Fehler:",e),alert("Fehler beim Export")}},className:"btn btn-secondary",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.jsx(d,{size:16}),"CSV"]}),r.jsxs("button",{onClick:async()=>{try{const e=E?`${s.apiBaseUrl}/euer/pdf/tda?jahr=${re}`:`${s.apiBaseUrl}/euer/pdf/dojo/${(null==q?void 0:q.dojo_id)||(null==q?void 0:q.id)}?jahr=${re}`,r=await i(e),n=r.headers.get("content-type");if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(e.error||e.details||"PDF-Generierung fehlgeschlagen")}if(!n||!n.includes("application/pdf"))throw new Error("Server hat kein PDF zurückgegeben");const t=await r.blob(),a=window.URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=`EUER_${E?"TDA_International":(null==q?void 0:q.dojoname)||"Dojo"}_${re}.pdf`,document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(a)}catch(e){console.error("PDF Export Fehler:",e),alert("Fehler beim PDF-Export: "+e.message)}},className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.jsx(o,{size:16}),"PDF für Finanzamt"]})]})]})]}),r.jsxs("div",{className:"euer-summary-cards",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"2rem"},children:[r.jsxs("div",{className:"stat-card",style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",border:"1px solid var(--border-primary)"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[r.jsx(m,{size:20,color:"var(--success)"}),r.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:["Einnahmen ",re]})]}),r.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"var(--success)"},children:de(null==(_=null==se?void 0:se.jahresSumme)?void 0:_.einnahmen_gesamt)})]}),r.jsxs("div",{className:"stat-card",style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",border:"1px solid var(--border-primary)"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[r.jsx(c,{size:20,color:"var(--error)"}),r.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:["Ausgaben ",re]})]}),r.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"var(--error)"},children:de(null==(D=null==se?void 0:se.jahresSumme)?void 0:D.ausgaben_gesamt)})]}),r.jsxs("div",{className:"stat-card",style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",border:"1px solid var(--border-primary)",borderLeft:"4px solid "+(((null==(F=null==se?void 0:se.jahresSumme)?void 0:F.ueberschuss)||0)>=0?"var(--success)":"var(--error)")},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[r.jsx(h,{size:20}),r.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:["Überschuss ",re]})]}),r.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:((null==(C=null==se?void 0:se.jahresSumme)?void 0:C.ueberschuss)||0)>=0?"var(--success)":"var(--error)"},children:de(null==(N=null==se?void 0:se.jahresSumme)?void 0:N.ueberschuss)})]}),E&&(null==se?void 0:se.statistiken)&&r.jsxs("div",{className:"stat-card",style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",border:"1px solid var(--border-primary)"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[r.jsx(g,{size:20,color:"var(--primary)"}),r.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Verbandsmitglieder"})]}),r.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700"},children:se.statistiken.aktive_verbandsmitglieder.gesamt}),r.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[se.statistiken.aktive_verbandsmitglieder.dojos," Dojos, ",se.statistiken.aktive_verbandsmitglieder.einzelpersonen," Einzelpersonen"]})]})]}),E&&r.jsxs("div",{className:"euer-einnahmen-breakdown",style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",border:"1px solid var(--border-primary)",marginBottom:"2rem"},children:[r.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Einnahmen nach Kategorie"}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"1rem"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.jsx(x,{size:18,color:"#10b981"}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Mitgliedsbeiträge"}),r.jsx("div",{style:{fontWeight:"600"},children:de(null==(I=null==se?void 0:se.jahresSumme)?void 0:I.einnahmen_mitglieder)})]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.jsx(g,{size:18,color:"#3b82f6"}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Verbandsmitgliedschaften"}),r.jsx("div",{style:{fontWeight:"600"},children:de(null==(U=null==se?void 0:se.jahresSumme)?void 0:U.einnahmen_verband)})]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.jsx(u,{size:18,color:"#8b5cf6"}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Software-Lizenzen"}),r.jsx("div",{style:{fontWeight:"600"},children:de(null==(W=null==se?void 0:se.jahresSumme)?void 0:W.einnahmen_software)})]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.jsx(v,{size:18,color:"#f59e0b"}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Rechnungen"}),r.jsx("div",{style:{fontWeight:"600"},children:de(null==($=null==se?void 0:se.jahresSumme)?void 0:$.einnahmen_rechnungen)})]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.jsx(j,{size:18,color:"#ef4444"}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Verkäufe/Kasse"}),r.jsx("div",{style:{fontWeight:"600"},children:de(null==(B=null==se?void 0:se.jahresSumme)?void 0:B.einnahmen_verkaeufe)})]})]})]})]}),r.jsxs("div",{className:"euer-chart",style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",border:"1px solid var(--border-primary)",marginBottom:"2rem"},children:[r.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Monatlicher Verlauf"}),r.jsx(p,{width:"100%",height:300,children:r.jsxs(y,{data:me,children:[r.jsx(b,{strokeDasharray:"3 3",stroke:"var(--border-secondary)"}),r.jsx(f,{dataKey:"name",tick:{fill:"var(--text-secondary)"}}),r.jsx(S,{tick:{fill:"var(--text-secondary)"},tickFormatter:e=>Math.abs(e||0)>=1e3?new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:1}).format(e/1e3)+"k":de(e)}),r.jsx(k,{content:r.jsx(ce,{})}),r.jsx(w,{}),r.jsx(z,{dataKey:"einnahmen",name:"Einnahmen",fill:"#10b981",radius:[4,4,0,0]}),r.jsx(z,{dataKey:"ausgaben",name:"Ausgaben",fill:"#ef4444",radius:[4,4,0,0]}),r.jsx(A,{type:"monotone",dataKey:"ueberschuss",name:"Überschuss",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6"}})]})})]}),r.jsxs("div",{className:"euer-table",style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",border:"1px solid var(--border-primary)",overflowX:"auto"},children:[r.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Monatliche Übersicht"}),r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9rem"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{borderBottom:"2px solid var(--border-primary)"},children:[r.jsx("th",{style:{textAlign:"left",padding:"0.75rem 0.5rem"},children:"Monat"}),E?r.jsxs(r.Fragment,{children:[r.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:"Mitglieder"}),r.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:"Verband"}),r.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:"Software"})]}):r.jsxs(r.Fragment,{children:[r.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:"Beiträge"}),r.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:"Rechnungen"}),r.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:"Verkäufe"})]}),r.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem",color:"var(--success)"},children:"Einnahmen"}),r.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem",color:"var(--error)"},children:"Ausgaben"}),r.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem",fontWeight:"700"},children:"Überschuss"})]})}),r.jsxs("tbody",{children:[null==(L=null==se?void 0:se.monate)?void 0:L.map(e=>r.jsxs("tr",{style:{borderBottom:"1px solid var(--border-secondary)",backgroundColor:te===e.monat?"var(--bg-hover)":"transparent",cursor:"pointer"},onClick:()=>ae(te===e.monat?null:e.monat),children:[r.jsx("td",{style:{padding:"0.75rem 0.5rem",fontWeight:"500"},children:e.monat_name}),E?r.jsxs(r.Fragment,{children:[r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(e.einnahmen.mitglieder)}),r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(e.einnahmen.verbandsmitgliedschaften)}),r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(e.einnahmen.software_lizenzen)})]}):r.jsxs(r.Fragment,{children:[r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(e.einnahmen.beitraege)}),r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(e.einnahmen.rechnungen)}),r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(e.einnahmen.verkaeufe)})]}),r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem",color:"var(--success)",fontWeight:"500"},children:de(e.einnahmen.gesamt)}),r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem",color:"var(--error)"},children:de(e.ausgaben.gesamt)}),r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem",fontWeight:"700",color:e.ueberschuss>=0?"var(--success)":"var(--error)"},children:de(e.ueberschuss)})]},e.monat)),r.jsxs("tr",{style:{borderTop:"2px solid var(--border-primary)",backgroundColor:"var(--bg-secondary)",fontWeight:"700"},children:[r.jsxs("td",{style:{padding:"0.75rem 0.5rem"},children:["GESAMT ",re]}),E?r.jsxs(r.Fragment,{children:[r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(null==(T=null==se?void 0:se.jahresSumme)?void 0:T.einnahmen_mitglieder)}),r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(null==(V=null==se?void 0:se.jahresSumme)?void 0:V.einnahmen_verband)}),r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(null==(K=null==se?void 0:se.jahresSumme)?void 0:K.einnahmen_software)})]}):r.jsxs(r.Fragment,{children:[r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(null==(M=null==se?void 0:se.jahresSumme)?void 0:M.einnahmen_beitraege)}),r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(null==(P=null==se?void 0:se.jahresSumme)?void 0:P.einnahmen_rechnungen)}),r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(null==(O=null==se?void 0:se.jahresSumme)?void 0:O.einnahmen_verkaeufe)})]}),r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem",color:"var(--success)"},children:de(null==(Y=null==se?void 0:se.jahresSumme)?void 0:Y.einnahmen_gesamt)}),r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem",color:"var(--error)"},children:de(null==(G=null==se?void 0:se.jahresSumme)?void 0:G.ausgaben_gesamt)}),r.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem",color:((null==(J=null==se?void 0:se.jahresSumme)?void 0:J.ueberschuss)||0)>=0?"var(--success)":"var(--error)"},children:de(null==(X=null==se?void 0:se.jahresSumme)?void 0:X.ueberschuss)})]})]})]})]})]})};export{E as default};
