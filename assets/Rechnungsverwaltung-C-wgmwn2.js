import{j as e}from"./animation-1wuIdCBS.js";import{u as s,r as n}from"./vendor-router-BhMXg4Z-.js";import{k as a,c as i}from"./index-DUnH23_2.js";import{V as l,P as t,F as r,q as c,g as d,k as h,aB as o,ay as u,j,K as m,D as g}from"./icons-D7rg4pDH.js";import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";const x=()=>{const x=s(),[b,v]=n.useState(!0),[N,f]=n.useState("alle"),[p,z]=n.useState(""),[k,w]=n.useState([]),[y,R]=n.useState([]),[_,C]=n.useState(!1),[S,D]=n.useState(null),[B,L]=n.useState("details"),[A,E]=n.useState({gesamt_rechnungen:0,offene_rechnungen:0,bezahlte_rechnungen:0,ueberfaellige_rechnungen:0,offene_summe:0,bezahlte_summe:0,ueberfaellige_summe:0,gesamt_summe:0});n.useEffect(()=>{F()},[]),n.useEffect(()=>{K()},[N,p,k]);const F=async()=>{try{v(!0);const[e,s]=await Promise.all([a(`${i.apiBaseUrl}/rechnungen`),a(`${i.apiBaseUrl}/rechnungen/statistiken`)]);if(e.ok){const s=await e.json();w(s.data||[])}if(s.ok){const e=await s.json();E(e.data||A)}v(!1)}catch(e){console.error("Fehler beim Laden der Daten:",e),v(!1)}},K=()=>{let e=[...k];switch(N){case"offen":e=e.filter(e=>"offen"===e.status&&0===e.archiviert);break;case"bezahlt":e=e.filter(e=>"bezahlt"===e.status&&0===e.archiviert);break;case"ueberfaellig":e=e.filter(e=>{const s=new Date(e.faelligkeitsdatum),n=new Date;return("offen"===e.status||"ueberfaellig"===e.status)&&s<n&&0===e.archiviert});break;case"archiv":e=e.filter(e=>1===e.archiviert);break;default:e=e.filter(e=>0===e.archiviert)}if(p){const s=p.toLowerCase();e=e.filter(e=>{var n;return e.rechnungsnummer.toLowerCase().includes(s)||e.mitglied_name.toLowerCase().includes(s)||(null==(n=e.beschreibung)?void 0:n.toLowerCase().includes(s))})}R(e)},P=async(e,s)=>{if(window.confirm(s?"Rechnung archivieren?":"Archivierung aufheben?"))try{(await a(`${i.apiBaseUrl}/rechnungen/${e}/archivieren`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({archiviert:s})})).ok&&(alert(s?"Rechnung archiviert":"Archivierung aufgehoben"),F())}catch(n){console.error("Fehler beim Archivieren:",n),alert("Fehler beim Archivieren")}},$=()=>{C(!1),D(null),L("details")},M=s=>{const n=new Date(s.faelligkeitsdatum),a=new Date;return"bezahlt"===s.status?e.jsx("span",{className:"badge badge-success",children:"Bezahlt"}):"teilweise_bezahlt"===s.status?e.jsx("span",{className:"badge badge-warning",children:"Teilweise bezahlt"}):n<a?e.jsx("span",{className:"badge badge-danger",children:"√úberf√§llig"}):e.jsx("span",{className:"badge badge-info",children:"Offen"})},U=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e||0),O=e=>e?new Date(e).toLocaleDateString("de-DE"):"-";return b?e.jsx("div",{className:"rechnungen-container",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Lade Rechnungen..."})]})}):e.jsxs("div",{className:"rechnungen-container",children:[e.jsxs("div",{className:"rechnungen-header",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:()=>x("/dashboard/beitraege"),children:[e.jsx(l,{size:20}),"Zur√ºck"]}),e.jsxs("div",{children:[e.jsx("h1",{children:"üìÑ Rechnungsverwaltung"}),e.jsx("p",{children:"Erstelle, verwalte und pr√ºfe alle Rechnungen"})]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>x("/dashboard/rechnung-erstellen"),children:[e.jsx(t,{size:20}),"Neue Rechnung"]})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(r,{size:32})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Gesamt Rechnungen"}),e.jsx("p",{className:"stat-value",children:A.gesamt_rechnungen}),e.jsx("span",{className:"stat-trend",children:U(A.gesamt_summe)})]})]}),e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(c,{size:32})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Offene Rechnungen"}),e.jsx("p",{className:"stat-value",children:A.offene_rechnungen}),e.jsx("span",{className:"stat-trend",children:U(A.offene_summe)})]})]}),e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(d,{size:32})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Bezahlte Rechnungen"}),e.jsx("p",{className:"stat-value",children:A.bezahlte_rechnungen}),e.jsx("span",{className:"stat-trend",children:U(A.bezahlte_summe)})]})]}),e.jsxs("div",{className:"stat-card danger",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(h,{size:32})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"√úberf√§llige Rechnungen"}),e.jsx("p",{className:"stat-value",children:A.ueberfaellige_rechnungen}),e.jsx("span",{className:"stat-trend",children:U(A.ueberfaellige_summe)})]})]})]}),e.jsxs("div",{className:"view-tabs",children:[e.jsxs("button",{className:"tab "+("alle"===N?"active":""),onClick:()=>f("alle"),children:[e.jsx(r,{size:18}),"Alle Rechnungen"]}),e.jsxs("button",{className:"tab "+("offen"===N?"active":""),onClick:()=>f("offen"),children:[e.jsx(c,{size:18}),"Offen"]}),e.jsxs("button",{className:"tab "+("bezahlt"===N?"active":""),onClick:()=>f("bezahlt"),children:[e.jsx(d,{size:18}),"Bezahlt"]}),e.jsxs("button",{className:"tab "+("ueberfaellig"===N?"active":""),onClick:()=>f("ueberfaellig"),children:[e.jsx(h,{size:18}),"√úberf√§llig"]}),e.jsxs("button",{className:"tab "+("archiv"===N?"active":""),onClick:()=>f("archiv"),children:[e.jsx(o,{size:18}),"Archiv"]})]}),e.jsxs("div",{className:"search-bar",children:[e.jsx(u,{size:20}),e.jsx("input",{type:"text",placeholder:"Suche nach Rechnungsnummer, Mitglied oder Beschreibung...",value:p,onChange:e=>z(e.target.value)})]}),e.jsx("div",{className:"rechnungen-table-container",children:0===y.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(r,{size:64}),e.jsx("h3",{children:"Keine Rechnungen gefunden"}),e.jsxs("p",{children:["alle"===N&&"Es wurden noch keine Rechnungen erstellt.","offen"===N&&"Keine offenen Rechnungen vorhanden.","bezahlt"===N&&"Keine bezahlten Rechnungen vorhanden.","ueberfaellig"===N&&"Keine √ºberf√§lligen Rechnungen vorhanden.","archiv"===N&&"Keine archivierten Rechnungen vorhanden."]})]}):e.jsxs("table",{className:"rechnungen-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Rechnungsnr."}),e.jsx("th",{children:"Mitglied"}),e.jsx("th",{children:"Datum"}),e.jsx("th",{children:"F√§lligkeit"}),e.jsx("th",{children:"Art"}),e.jsx("th",{children:"Betrag"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Aktionen"})]})}),e.jsx("tbody",{children:y.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:s.rechnungsnummer})}),e.jsx("td",{children:s.mitglied_name}),e.jsx("td",{children:O(s.datum)}),e.jsx("td",{children:O(s.faelligkeitsdatum)}),e.jsx("td",{children:e.jsxs("span",{className:"badge badge-neutral",children:["mitgliedsbeitrag"===s.art&&"Mitgliedsbeitrag","pruefungsgebuehr"===s.art&&"Pr√ºfungsgeb√ºhr","kursgebuehr"===s.art&&"Kursgeb√ºhr","ausruestung"===s.art&&"Ausr√ºstung","sonstiges"===s.art&&"Sonstiges"]})}),e.jsx("td",{children:e.jsx("strong",{children:U(s.betrag)})}),e.jsx("td",{children:M(s)}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-icon btn-info",onClick:()=>(async e=>{try{const s=await a(`${i.apiBaseUrl}/rechnungen/${e}`);if(s.ok){const e=await s.json();D(e.data),L("details"),C(!0)}}catch(s){console.error("Fehler beim Laden der Rechnung:",s),alert("Fehler beim Laden der Rechnung")}})(s.rechnung_id),title:"Details anzeigen",children:e.jsx(j,{size:16})}),0===s.archiviert?e.jsx("button",{className:"btn-icon btn-secondary",onClick:()=>P(s.rechnung_id,!0),title:"Archivieren",children:e.jsx(o,{size:16})}):e.jsx("button",{className:"btn-icon btn-success",onClick:()=>P(s.rechnung_id,!1),title:"Wiederherstellen",children:e.jsx(o,{size:16})}),e.jsx("button",{className:"btn-icon btn-danger",onClick:()=>(async e=>{if(window.confirm("Rechnung wirklich l√∂schen? Dies kann nicht r√ºckg√§ngig gemacht werden!"))try{(await a(`${i.apiBaseUrl}/rechnungen/${e}`,{method:"DELETE"})).ok&&(alert("Rechnung gel√∂scht"),F())}catch(s){console.error("Fehler beim L√∂schen:",s),alert("Fehler beim L√∂schen")}})(s.rechnung_id),title:"L√∂schen",children:e.jsx(m,{size:16})})]})})]},s.rechnung_id))})]})}),_&&S&&e.jsx("div",{className:"modal-overlay",onClick:$,children:e.jsxs("div",{className:"modal-content extra-large",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{className:"modal-title",children:"Rechnungsdetails"}),e.jsx("button",{className:"close-btn",onClick:$,title:"Schlie√üen",children:"√ó"})]}),e.jsxs("div",{className:"tabs-container",children:[e.jsxs("button",{className:"tab "+("details"===B?"active":""),onClick:()=>L("details"),children:[e.jsx(r,{size:18,className:"tab-icon"}),e.jsx("span",{className:"tab-label",children:"Details"})]}),e.jsxs("button",{className:"tab "+("positionen"===B?"active":""),onClick:()=>L("positionen"),children:[e.jsx(g,{size:18,className:"tab-icon"}),e.jsx("span",{className:"tab-label",children:"Positionen"})]}),e.jsxs("button",{className:"tab "+("zahlungen"===B?"active":""),onClick:()=>L("zahlungen"),children:[e.jsx(d,{size:18,className:"tab-icon"}),e.jsx("span",{className:"tab-label",children:"Zahlungen"})]})]}),e.jsxs("div",{className:"modal-body",children:["details"===B&&e.jsx("div",{className:"detail-section",children:e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Rechnungsnummer"}),e.jsx("div",{className:"detail-value",children:e.jsx("strong",{children:S.rechnungsnummer})})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Mitglied"}),e.jsx("div",{className:"detail-value",children:S.mitglied_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Datum"}),e.jsx("div",{className:"detail-value",children:O(S.datum)})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"F√§lligkeitsdatum"}),e.jsx("div",{className:"detail-value",children:O(S.faelligkeitsdatum)})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Art"}),e.jsxs("div",{className:"detail-value",children:["mitgliedsbeitrag"===S.art&&"Mitgliedsbeitrag","pruefungsgebuehr"===S.art&&"Pr√ºfungsgeb√ºhr","kursgebuehr"===S.art&&"Kursgeb√ºhr","ausruestung"===S.art&&"Ausr√ºstung","sonstiges"===S.art&&"Sonstiges"]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Status"}),e.jsx("div",{className:"detail-value",children:M(S)})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Betrag"}),e.jsx("div",{className:"detail-value",children:e.jsx("strong",{children:U(S.betrag)})})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Beschreibung"}),e.jsx("div",{className:"detail-value",children:S.beschreibung||"-"})]})]})}),"positionen"===B&&e.jsxs("div",{className:"detail-section",children:[e.jsx("h3",{children:"Rechnungspositionen"}),S.positionen&&S.positionen.length>0?e.jsxs("table",{className:"rechnungen-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Pos."}),e.jsx("th",{children:"Beschreibung"}),e.jsx("th",{children:"Menge"}),e.jsx("th",{children:"Einzelpreis"}),e.jsx("th",{children:"Gesamt"})]})}),e.jsx("tbody",{children:S.positionen.map((s,n)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.position_nr}),e.jsx("td",{children:s.bezeichnung}),e.jsx("td",{children:s.menge}),e.jsx("td",{children:U(s.einzelpreis)}),e.jsx("td",{children:e.jsx("strong",{children:U(s.gesamtpreis||s.menge*s.einzelpreis)})})]},n))})]}):e.jsx("p",{className:"info-text",children:"Keine Positionen vorhanden"})]}),"zahlungen"===B&&e.jsxs("div",{className:"detail-section",children:[e.jsx("h3",{children:"Zahlungshistorie"}),S.zahlungen&&S.zahlungen.length>0?e.jsxs("table",{className:"rechnungen-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Datum"}),e.jsx("th",{children:"Betrag"}),e.jsx("th",{children:"Methode"}),e.jsx("th",{children:"Notiz"})]})}),e.jsx("tbody",{children:S.zahlungen.map((s,n)=>e.jsxs("tr",{children:[e.jsx("td",{children:O(s.zahlungsdatum)}),e.jsx("td",{children:e.jsx("strong",{children:U(s.betrag)})}),e.jsx("td",{children:s.zahlungsmethode}),e.jsx("td",{children:s.notiz||"-"})]},n))})]}):e.jsx("p",{className:"info-text",children:"Keine Zahlungen vorhanden"})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-secondary",onClick:$,children:"Schlie√üen"})})]})})]})};export{x as default};
