import{a as e,j as s}from"./query-Caj74EYQ.js";import a from"./MemberHeader-IalPk7Zc.js";import{u as n,c as t}from"./index-CREwepoQ.js";import{y as i,w as r,p as l,A as c,n as d,ag as o,C as h,X as m}from"./icons-DiLw-1i5.js";/* empty css                  */import"./vendor-router-Co3o87Zc.js";import"./charts-C1Gv3M_c.js";const u=()=>{var u,j;const{user:x}=n(),[g,v]=e.useState({}),[p,N]=e.useState(!0),[f,b]=e.useState(null),[w,y]=e.useState(!1),[z,S]=e.useState([]),[k,D]=e.useState(null),[M,$]=e.useState(null);e.useEffect(()=>{T()},[]);const T=async()=>{N(!0);try{const s=(null==x?void 0:x.email)||"tom@example.com";console.log("MemberStats: Lade Mitgliedsdaten f√ºr Email:",s);const a=await fetch(`/mitglieder/by-email/${encodeURIComponent(s)}`);if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const n=await a.json();console.log("MemberStats: Mitgliedsdaten geladen:",n),$(n);const i=await fetch(`/anwesenheit/${n.mitglied_id}`);let r=[];i.ok&&(r=await i.json());const l=Array.isArray(r)?r.length:0,c=Array.isArray(r)?r.filter(e=>1===e.anwesend||!0===e.anwesend).length:0,d=l>0?Math.round(c/l*100):0,o=B(r);let h=[];try{const e=await fetch(`/fortschritt/mitglied/${n.mitglied_id}/ziele`);e.ok&&(h=await e.json())}catch(e){console.log("Keine Ziele verf√ºgbar")}v({trainingsstunden:l,anwesenheit:d,"aktuellerG√ºrtel":n.gurtfarbe||"Wei√ügurt",naechsterGuertel:A(n.gurtfarbe),trainingswochen:Math.floor(l/2),durchschnittlicheStunden:l>0?Math.round(l/6):0,laengsteSerie:8,aktuelleSerie:3,pruefungen:[],monatsDaten:o,ziele:h}),await(async()=>{try{const e=await fetch(`${t.apiBaseUrl}/mitglieder/comparison-stats`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const s=await e.json();D(s)}else console.log("Vergleichsdaten-API nicht verf√ºgbar, zeige keine Vergleichsdaten"),D(null)}catch(e){console.error("Fehler beim Laden der Vergleichsdaten:",e),D(null)}})()}catch(e){console.error("Fehler beim Laden der Statistiken:",e),v({trainingsstunden:0,anwesenheit:0,"aktuellerG√ºrtel":"Nicht verf√ºgbar",naechsterGuertel:"-",trainingswochen:0,durchschnittlicheStunden:0,laengsteSerie:0,aktuelleSerie:0,pruefungen:[],monatsDaten:[],ziele:[]})}finally{N(!1)}},A=e=>{const s=["Wei√ügurt","Gelbgurt","Orangegurt","Gr√ºngurt","Blaugurt","Braungurt","Schwarzgurt"],a=s.findIndex(s=>s.toLowerCase()===(e||"").toLowerCase());return a>=0&&a<s.length-1?s[a+1]:"Schwarzgurt"},B=e=>{if(!Array.isArray(e)||0===e.length)return[];const s={};return e.forEach(e=>{if(!e.datum||1!==e.anwesend)return;const a=new Date(e.datum),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`,t=`${["Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"][a.getMonth()]} ${a.getFullYear()}`;s[n]||(s[n]={monat:t,stunden:0,tage:0,sortKey:n}),s[n].stunden+=1,s[n].tage+=1}),Object.values(s).sort((e,s)=>e.sortKey.localeCompare(s.sortKey)).slice(-6)};return p?s.jsxs("div",{className:"dashboard-container",children:[s.jsx(a,{}),s.jsx("div",{className:"dashboard-content",children:s.jsxs("div",{className:"member-stats-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Lade Statistiken..."})]})})]}):s.jsxs("div",{className:"dashboard-container",children:[s.jsx(a,{}),s.jsx("div",{className:"dashboard-content",children:s.jsxs("div",{className:"member-stats",children:[s.jsxs("div",{className:"stats-header",children:[s.jsxs("h1",{children:[s.jsx(i,{size:32}),"Meine Statistiken"]}),s.jsx("p",{children:"Dein Trainingsfortschritt und deine Erfolge im √úberblick"})]}),s.jsxs("div",{className:"stats-grid",children:[s.jsxs("div",{className:"stat-card primary",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(r,{size:24})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-number",children:g.trainingsstunden}),s.jsx("div",{className:"stat-label",children:"Trainingsstunden"}),s.jsx("div",{className:"stat-trend",children:"+12 diese Woche"})]})]}),s.jsxs("div",{className:"stat-card success",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(l,{size:24})}),s.jsxs("div",{className:"stat-content",children:[s.jsxs("div",{className:"stat-number",children:[g.anwesenheit,"%"]}),s.jsx("div",{className:"stat-label",children:"Anwesenheit"}),s.jsx("div",{className:"stat-trend",children:"Sehr gut!"})]})]}),s.jsxs("div",{className:"stat-card warning",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(c,{size:24})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-number",children:g.aktuellerG√ºrtel}),s.jsx("div",{className:"stat-label",children:"Aktueller G√ºrtel"}),s.jsxs("div",{className:"stat-trend",children:["N√§chster: ",g.naechsterGuertel]})]})]}),s.jsxs("div",{className:"stat-card info",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(d,{size:24})}),s.jsxs("div",{className:"stat-content",children:[s.jsx("div",{className:"stat-number",children:g.aktuelleSerie}),s.jsx("div",{className:"stat-label",children:"Trainingstage in Serie"}),s.jsxs("div",{className:"stat-trend",children:["Best: ",g.laengsteSerie," Tage"]})]})]})]}),k&&s.jsxs("div",{className:"stats-section",children:[s.jsxs("h2",{children:[s.jsx(l,{size:20}),"Vergleich mit anderen Mitgliedern"]}),s.jsx("div",{className:"comparison-grid",children:Object.entries(k).map(([e,a])=>{const n=(t=a.percentile)>=90?{level:"Top 10%",color:"#10B981",icon:"ü•á"}:t>=75?{level:"Sehr gut",color:"#3B82F6",icon:"ü•à"}:t>=50?{level:"√úberdurchschnittlich",color:"#8B5CF6",icon:"ü•â"}:t>=25?{level:"Durchschnittlich",color:"#F59E0B",icon:"üìä"}:{level:"Verbesserung m√∂glich",color:"#EF4444",icon:"üìà"};var t;return s.jsxs("div",{className:"comparison-card",children:[s.jsxs("div",{className:"comparison-header",children:[s.jsx("h3",{children:{trainingsstunden:"Trainingsstunden",anwesenheit:"Anwesenheit (%)",trainingswochen:"Trainingswochen"}[e]}),s.jsxs("div",{className:"performance-badge",style:{color:n.color},children:[s.jsx("span",{children:n.icon}),s.jsx("span",{children:n.level})]})]}),s.jsxs("div",{className:"comparison-values",children:[s.jsxs("div",{className:"value-row",children:[s.jsx("span",{className:"label",children:"Dein Wert:"}),s.jsxs("span",{className:"value primary",children:[a.deinWert,"anwesenheit"===e?"%":"trainingsstunden"===e?"h":""]})]}),s.jsxs("div",{className:"value-row",children:[s.jsx("span",{className:"label",children:"Durchschnitt:"}),s.jsxs("span",{className:"value",children:[a.durchschnitt,"anwesenheit"===e?"%":"trainingsstunden"===e?"h":""]})]}),s.jsxs("div",{className:"value-row",children:[s.jsx("span",{className:"label",children:"Top 10%:"}),s.jsxs("span",{className:"value top",children:[a.top10Prozent,"anwesenheit"===e?"%":"trainingsstunden"===e?"h":""]})]})]}),s.jsxs("div",{className:"comparison-bar",children:[s.jsxs("div",{className:"bar-container",children:[s.jsx("div",{className:"bar-average",style:{width:a.durchschnitt/a.top10Prozent*100+"%"}}),s.jsx("div",{className:"bar-top",style:{width:"100%"}}),s.jsx("div",{className:"bar-your",style:{width:a.deinWert/a.top10Prozent*100+"%"}})]}),s.jsxs("div",{className:"bar-labels",children:[s.jsx("span",{children:"Durchschnitt"}),s.jsx("span",{children:"Dein Wert"}),s.jsx("span",{children:"Top 10%"})]})]})]},e)})}),s.jsx("div",{className:"comparison-note",children:s.jsx("p",{children:"üìä Basierend auf anonymisierten Daten aller aktiven Mitglieder"})})]}),s.jsxs("div",{className:"stats-section",children:[s.jsxs("h2",{children:[s.jsx(o,{size:20}),"Pr√ºfungsverlauf"]}),s.jsx("div",{className:"pruefungen-list",children:null==(u=g.pruefungen)?void 0:u.map((e,a)=>s.jsxs("div",{className:"pruefung-item",children:[s.jsx("div",{className:"pruefung-date",children:new Date(e.datum).toLocaleDateString("de-DE")}),s.jsxs("div",{className:"pruefung-details",children:[s.jsxs("div",{className:"pruefung-guertel",children:[e.guertel," G√ºrtel"]}),s.jsx("div",{className:`pruefung-status ${e.status}`,children:"bestanden"===e.status?"‚úÖ Bestanden":e.status})]})]},a))})]}),s.jsxs("div",{className:"stats-section",children:[s.jsxs("h2",{children:[s.jsx(h,{size:20}),"Trainingsstunden pro Monat"]}),s.jsx("div",{className:"training-chart-wrapper",children:s.jsx("div",{className:"training-chart",style:{position:"relative",zIndex:1},children:null==(j=g.monatsDaten)?void 0:j.map((e,a)=>{const n=Math.max(...g.monatsDaten.map(e=>e.stunden)),t=g.monatsDaten.reduce((e,s)=>e+s.stunden,0)/g.monatsDaten.length,i=n>0?e.stunden/n*100:0;let r="medium";return e.stunden>=1.1*t?r="high":e.stunden<=.9*t&&(r="low"),s.jsxs("div",{className:"chart-bar",style:{cursor:"pointer"},children:[s.jsx("div",{className:"bar-container",style:{display:"flex",flexDirection:"column",justifyContent:"flex-end"},onClick:()=>{console.log("Balken geklickt, Monat:",e),b(e);const[s,a]=e.monat.split(" ");(async(e,s,a)=>{try{console.log(`Lade Monatsdetails f√ºr Monat ${e}/${s}, Mitglied-ID: ${a}`);const n=await fetch(`/anwesenheit/${a}`);if(n.ok){const a=(await n.json()).filter(a=>{const n=new Date(a.datum);return n.getMonth()+1===parseInt(e)&&n.getFullYear()===parseInt(s)&&1===a.anwesend});console.log(`Gefundene Trainingstage f√ºr ${e}/${s}:`,a.length),S(a)}else console.log("Anwesenheitsdaten nicht verf√ºgbar"),S([])}catch(n){console.error("Fehler beim Laden der Monatsdetails:",n),S([])}})(new Date(Date.parse(s+" 1, 2000")).getMonth()+1,a,null==M?void 0:M.mitglied_id),y(!0)},children:s.jsx("div",{className:`bar-fill ${r}`,style:{height:`${Math.max(i,10)}%`,width:"100%"},children:s.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:"600"},children:[e.stunden,"h"]})})}),s.jsx("div",{className:"bar-label",children:e.monat})]},a)})})})]}),g.ziele&&g.ziele.length>0&&s.jsxs("div",{className:"stats-section",children:[s.jsxs("h2",{children:[s.jsx(d,{size:20}),"Deine Ziele"]}),s.jsx("div",{className:"goals-list",children:g.ziele.map((e,a)=>s.jsxs("div",{className:"goal-item",children:[s.jsxs("div",{className:"goal-progress",children:[s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-fill",style:{width:`${e.fortschritt_prozent||0}%`}})}),s.jsx("span",{children:e.titel})]}),s.jsx("div",{className:"goal-status",children:e.messbar&&e.ziel_wert?`${e.aktueller_wert||0}/${e.ziel_wert} (${e.fortschritt_prozent||0}%)`:"erreicht"===e.status?"‚úÖ Erreicht":"In Arbeit"})]},a))})]})]})}),w&&f&&s.jsx("div",{className:"month-details-overlay",onClick:()=>y(!1),children:s.jsxs("div",{className:"month-details-popup",onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"month-details-header",children:[s.jsxs("h3",{children:["Trainingsdetails - ",f.monat]}),s.jsx("button",{className:"close-button",onClick:()=>y(!1),children:s.jsx(m,{size:20})})]}),s.jsxs("div",{className:"month-details-content",children:[s.jsxs("div",{className:"month-summary",children:[s.jsxs("div",{className:"summary-item",children:[s.jsx(h,{size:16}),s.jsxs("span",{children:[f.tage," Trainingstage"]})]}),s.jsxs("div",{className:"summary-item",children:[s.jsx(r,{size:16}),s.jsxs("span",{children:[f.stunden," Trainingsstunden"]})]})]}),s.jsxs("div",{className:"training-days-list",children:[s.jsx("h4",{children:"Trainingsdaten:"}),z.length>0?z.map((e,a)=>s.jsxs("div",{className:"training-day-item",children:[s.jsxs("div",{className:"training-date",children:[s.jsx(h,{size:14}),s.jsx("span",{children:new Date(e.datum).toLocaleDateString("de-DE")})]}),s.jsxs("div",{className:"training-details",children:[s.jsxs("div",{className:"training-time",children:[s.jsx(r,{size:14}),s.jsx("span",{children:e.uhrzeit||e.stunde})]}),s.jsxs("div",{className:"training-course",children:[s.jsx(o,{size:14}),s.jsx("span",{children:e.kurs_name||e.kurs||e.gruppenname})]}),s.jsxs("div",{className:"training-trainer",children:[s.jsx(c,{size:14}),s.jsx("span",{children:e.trainer_name||e.trainer})]})]})]},a)):s.jsx("div",{className:"no-data",children:s.jsx("p",{children:"Keine Trainingsdaten f√ºr diesen Monat verf√ºgbar."})})]})]})]})})]})};export{u as default};
