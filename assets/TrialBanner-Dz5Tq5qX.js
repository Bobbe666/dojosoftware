import{j as e}from"./animation-1wuIdCBS.js";import{u as s,r as n}from"./vendor-router-BhMXg4Z-.js";import{b as a,u as i,d as t,k as r,c as l}from"./index-DUnH23_2.js";import{b as o,Y as d,x as c,_ as h,l as m,$ as j,M as u,C as x,a0 as p,v as g,t as v,q as b,T as N,g as f}from"./icons-D7rg4pDH.js";const w=()=>{const{dojos:t,activeDojo:r,switchDojo:l,loading:h,filter:m,setFilter:j}=a(),{user:u}=i(),x=s(),[p,g]=n.useState(!1),[v,b]=n.useState({top:0,left:0}),N=n.useRef(null),f="all"===m;if(n.useEffect(()=>{p&&D()},[p]),h)return e.jsx("div",{className:"dojo-switcher loading",children:e.jsx("div",{className:"spinner-small"})});if(!r)return e.jsx("div",{className:"dojo-switcher loading",children:e.jsx("div",{style:{color:"#ff6b35",fontSize:"0.85rem",padding:"10px"},children:"Kein Dojo gefunden"})});if(!t||0===t.length)return e.jsx("div",{className:"dojo-switcher loading",children:e.jsx("div",{style:{color:"#ff6b35",fontSize:"0.85rem",padding:"10px"},children:"Keine Dojos verfÃ¼gbar"})});const w=e=>{if("kleinunternehmer"===e.steuer_status){return`${(e.jahresumsatz_aktuell/e.kleinunternehmer_grenze*100).toFixed(0)}% der Grenze`}return`USt-pflichtig (${e.ust_satz}%)`},z=("admin"===(null==u?void 0:u.rolle)||"admin"===(null==u?void 0:u.role))&&null===(null==u?void 0:u.dojo_id),k="super-admin"===r,S="verband"===r,y="support"===r;console.log("ðŸ” DojoSwitcher Super-Admin Check:",{role:null==u?void 0:u.role,rolle:null==u?void 0:u.rolle,dojo_id:null==u?void 0:u.dojo_id,isSuperAdmin:z});const D=()=>{if(N.current){const e=N.current.getBoundingClientRect(),s={top:e.bottom+8,left:e.left};b(s)}};return e.jsxs("div",{className:"dojo-switcher",children:[e.jsxs("button",{ref:N,className:"dojo-switcher-trigger",onClick:e=>{e.preventDefault(),e.stopPropagation(),g(!p)},title:"Zwischen Dojos wechseln",type:"button",children:[y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)"}}),e.jsxs("div",{className:"dojo-switcher-content",children:[e.jsx("div",{className:"dojo-switcher-label",children:"Support:"}),e.jsx("div",{className:"dojo-switcher-name",children:"ðŸŽ« Support Center"})]})]}):S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%)"}}),e.jsxs("div",{className:"dojo-switcher-content",children:[e.jsx("div",{className:"dojo-switcher-label",children:"Verband:"}),e.jsx("div",{className:"dojo-switcher-name",children:"ðŸŒ TDA Verband"})]})]}):k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #DAA520 0%, #B8860B 100%)"}}),e.jsxs("div",{className:"dojo-switcher-content",children:[e.jsx("div",{className:"dojo-switcher-label",children:"Verwaltung:"}),e.jsx("div",{className:"dojo-switcher-name",children:"ðŸ† TDA Int'l Org"})]})]}):f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #FFD700 0%, #FF6B35 50%, #3B82F6 100%)"}}),e.jsxs("div",{className:"dojo-switcher-content",children:[e.jsx("div",{className:"dojo-switcher-label",children:"Ansicht:"}),e.jsx("div",{className:"dojo-switcher-name",children:"Alle Dojos"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dojo-color-indicator",style:{backgroundColor:r.farbe}}),e.jsxs("div",{className:"dojo-switcher-content",children:[e.jsx("div",{className:"dojo-switcher-label",children:"Aktives Dojo:"}),e.jsx("div",{className:"dojo-switcher-name",children:r.dojoname})]})]}),e.jsx(o,{size:14,className:"chevron "+(p?"open":"")})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dojo-switcher-overlay",onClick:e=>{e.preventDefault(),e.stopPropagation(),g(!1)}}),e.jsxs("div",{className:"dojo-switcher-dropdown",style:{top:`${v.top}px`,left:`${v.left}px`},children:[e.jsxs("div",{className:"dropdown-header",children:[e.jsx("h3",{children:"Dojo wechseln"}),e.jsx("p",{children:"WÃ¤hlen Sie das aktive Dojo aus"})]}),e.jsxs("div",{className:"dropdown-list",children:[z&&e.jsxs("button",{type:"button",className:"dropdown-item verband "+(S?"active":""),onClick:e=>{e.preventDefault(),e.stopPropagation(),l("verband"),j("current"),g(!1),x("/dashboard",{replace:!0})},children:[e.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%)"}}),e.jsxs("div",{className:"dropdown-item-content",children:[e.jsxs("div",{className:"dropdown-item-header",children:[e.jsx("span",{className:"dropdown-item-name",children:"ðŸŒ TDA Verband"}),e.jsx("span",{className:"badge badge-blue",children:"Verband"}),S&&e.jsx(d,{size:12,className:"check-icon"})]}),e.jsx("div",{className:"dropdown-item-info",children:e.jsx("span",{className:"dropdown-item-inhaber",children:"Verbandsverwaltung & Mitgliedsschulen"})}),e.jsx("div",{className:"dropdown-item-umsatz",children:"Mitglieder, Turniere, Events & Verbands-Finanzen"})]})]}),z&&e.jsxs("button",{type:"button",className:"dropdown-item super-admin "+(k?"active":""),onClick:e=>{e.preventDefault(),e.stopPropagation(),l("super-admin"),j("current"),g(!1),x("/dashboard",{replace:!0})},children:[e.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #DAA520 0%, #B8860B 100%)"}}),e.jsxs("div",{className:"dropdown-item-content",children:[e.jsxs("div",{className:"dropdown-item-header",children:[e.jsx("span",{className:"dropdown-item-name",children:"ðŸ† TDA Int'l Org"}),e.jsx("span",{className:"badge badge-gold",children:"Super-Admin"}),k&&e.jsx(d,{size:12,className:"check-icon"})]}),e.jsx("div",{className:"dropdown-item-info",children:e.jsx("span",{className:"dropdown-item-inhaber",children:"Verwaltung aller Dojos & Subdomains"})}),e.jsx("div",{className:"dropdown-item-umsatz",children:"Globale Statistiken, Dojo-Management & Software-Verwaltung"})]})]}),z&&e.jsxs("button",{type:"button",className:"dropdown-item support "+(y?"active":""),onClick:e=>{e.preventDefault(),e.stopPropagation(),l("support"),j("current"),g(!1),x("/dashboard",{replace:!0})},children:[e.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)"}}),e.jsxs("div",{className:"dropdown-item-content",children:[e.jsxs("div",{className:"dropdown-item-header",children:[e.jsx("span",{className:"dropdown-item-name",children:"ðŸŽ« Support Center"}),e.jsx("span",{className:"badge badge-green",children:"Support"}),y&&e.jsx(d,{size:12,className:"check-icon"})]}),e.jsx("div",{className:"dropdown-item-info",children:e.jsx("span",{className:"dropdown-item-inhaber",children:"Ticket-System & Kundenservice"})}),e.jsx("div",{className:"dropdown-item-umsatz",children:"Alle Support-Tickets, Statistiken & Bearbeitung"})]})]}),e.jsxs("button",{type:"button",className:"dropdown-item "+(f?"active":""),onClick:e=>{e.preventDefault(),e.stopPropagation(),(()=>{if(t.length>0){const e=t.find(e=>e.ist_hauptdojo)||t[0];l(e)}j("all"),g(!1),x("/dashboard",{replace:!0})})()},children:[e.jsx("div",{className:"dojo-color-indicator",style:{background:"linear-gradient(135deg, #FFD700 0%, #FF6B35 50%, #3B82F6 100%)"}}),e.jsxs("div",{className:"dropdown-item-content",children:[e.jsxs("div",{className:"dropdown-item-header",children:[e.jsx("span",{className:"dropdown-item-name",children:"Alle Dojos"}),e.jsx("span",{className:"badge badge-primary",children:"Gesamt"}),f&&e.jsx(d,{size:12,className:"check-icon"})]}),e.jsx("div",{className:"dropdown-item-info",children:e.jsx("span",{className:"dropdown-item-inhaber",children:"Kombinierte Ansicht aller Dojos"})}),e.jsxs("div",{className:"dropdown-item-umsatz",children:["Gesamtumsatz ",(new Date).getFullYear(),": ",(Array.isArray(t)?t.reduce((e,s)=>e+parseFloat(s.jahresumsatz_aktuell||0),0):0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})," â‚¬"]})]})]}),Array.isArray(t)&&t.map(s=>e.jsxs("button",{type:"button",className:"dropdown-item "+(f||r.id!==s.id?"":"active"),onClick:e=>{e.preventDefault(),e.stopPropagation(),(e=>{l(e),j("current"),g(!1),x("/dashboard",{replace:!0})})(s)},children:[e.jsx("div",{className:"dojo-color-indicator",style:{backgroundColor:s.farbe}}),e.jsxs("div",{className:"dropdown-item-content",children:[e.jsxs("div",{className:"dropdown-item-header",children:[e.jsx("span",{className:"dropdown-item-name",children:s.dojoname}),s.ist_hauptdojo&&e.jsx("span",{className:"badge badge-primary",children:"Haupt"}),!f&&r.id===s.id&&e.jsx(d,{size:12,className:"check-icon"})]}),e.jsxs("div",{className:"dropdown-item-info",children:[e.jsx("span",{className:"dropdown-item-inhaber",children:s.inhaber}),e.jsx("span",{className:"dropdown-item-status",children:w(s)})]}),e.jsxs("div",{className:"dropdown-item-umsatz",children:["Umsatz ",(new Date).getFullYear(),": ",parseFloat(s.jahresumsatz_aktuell||0).toLocaleString("de-DE")," â‚¬"]})]})]},s.id))]}),e.jsx("div",{className:"dropdown-footer",children:e.jsxs("a",{href:"/dashboard/dojos",className:"link-manage-dojos",children:[e.jsx(c,{size:12}),"Dojos verwalten"]})})]})]})]})},z=()=>{const{standorte:s,activeStandort:a,currentStandort:i,switchStandort:r,loading:l,hasMultipleLocations:m}=t(),[j,u]=n.useState(!1),[x,p]=n.useState({top:0,left:0}),g=n.useRef(null);if(!m)return null;if(n.useEffect(()=>{j&&b()},[j]),l)return e.jsx("div",{className:"standort-switcher loading",children:e.jsx("div",{className:"spinner-small"})});if(!s||0===s.length)return null;const v=e=>{r(e),u(!1)},b=()=>{if(g.current){const e=g.current.getBoundingClientRect(),s={top:e.bottom+8,left:e.left};p(s)}};return n.useEffect(()=>{const e=e=>{g.current&&!g.current.contains(e.target)&&u(!1)};return j&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[j]),e.jsxs("div",{className:"standort-switcher",children:[e.jsxs("button",{ref:g,className:"standort-switcher-trigger",onClick:e=>{e.preventDefault(),e.stopPropagation(),u(!j)},title:"Zwischen Standorten wechseln",type:"button",children:["all"===a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"standort-color-indicator",style:{background:"linear-gradient(135deg, #10B981 0%, #3B82F6 100%)"}}),e.jsxs("div",{className:"standort-switcher-content",children:[e.jsx("div",{className:"standort-switcher-label",children:"Standort:"}),e.jsx("div",{className:"standort-switcher-name",children:"Alle Standorte"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"standort-color-indicator",style:{background:(null==i?void 0:i.farbe)||"#4F46E5"}}),e.jsxs("div",{className:"standort-switcher-content",children:[e.jsx("div",{className:"standort-switcher-label",children:"Standort:"}),e.jsxs("div",{className:"standort-switcher-name",children:[(null==i?void 0:i.name)||"Unbekannt",(null==i?void 0:i.ist_hauptstandort)&&e.jsx("span",{className:"standort-badge",children:"Haupt"})]})]})]}),e.jsx(o,{size:16,className:"chevron "+(j?"open":"")})]}),j&&e.jsxs("div",{className:"standort-switcher-dropdown",style:{position:"fixed",top:`${x.top}px`,left:`${x.left}px`,zIndex:1e4},children:[e.jsxs("div",{className:"dropdown-header",children:[e.jsx(h,{size:14}),e.jsx("span",{children:"Standorte"})]}),e.jsxs("button",{className:"standort-option "+("all"===a?"active":""),onClick:()=>v("all"),children:[e.jsx("div",{className:"standort-option-indicator",style:{background:"linear-gradient(135deg, #10B981 0%, #3B82F6 100%)"}}),e.jsxs("div",{className:"standort-option-content",children:[e.jsxs("div",{className:"standort-option-name",children:[e.jsx(c,{size:14,style:{marginRight:"6px"}}),"Alle Standorte"]}),e.jsxs("div",{className:"standort-option-stats",children:[s.length," Standort",1!==s.length?"e":""]})]}),"all"===a&&e.jsx(d,{size:16,className:"check-icon"})]}),e.jsx("div",{className:"dropdown-divider"}),s.sort((e,s)=>e.ist_hauptstandort&&!s.ist_hauptstandort?-1:!e.ist_hauptstandort&&s.ist_hauptstandort?1:e.sortierung!==s.sortierung?e.sortierung-s.sortierung:(e.name||"").localeCompare(s.name||"")).map(s=>e.jsxs("button",{className:"standort-option "+(a===s.standort_id?"active":""),onClick:()=>v(s.standort_id),children:[e.jsx("div",{className:"standort-option-indicator",style:{background:s.farbe||"#4F46E5"}}),e.jsxs("div",{className:"standort-option-content",children:[e.jsxs("div",{className:"standort-option-name",children:[e.jsx(h,{size:14,style:{marginRight:"6px"}}),s.name,s.ist_hauptstandort&&e.jsx("span",{className:"standort-badge-small",children:"Haupt"})]}),e.jsxs("div",{className:"standort-option-stats",children:[s.anzahl_kurse||0," Kurse Â· ",s.anzahl_raeume||0," RÃ¤ume"]})]}),a===s.standort_id&&e.jsx(d,{size:16,className:"check-icon"})]},s.standort_id))]})]})},k=()=>{const[s,a]=n.useState([]),[i,t]=n.useState(!1),[o,d]=n.useState(null);n.useEffect(()=>{const e=async()=>{try{console.log("ðŸ” Checking for new registrations...");const e=await r(`${l.apiBaseUrl}/notifications/admin/unread`);console.log("ðŸ“¡ Response status:",e.status);const s=await e.json();if(console.log("ðŸ“¦ Response data:",s),s.success&&s.notifications&&s.notifications.length>0){console.log("âœ… Found notifications:",s.notifications.length);const e=s.notifications.filter(e=>"admin_alert"===e.type);console.log("ðŸš¨ Admin alerts found:",e.length),e.length>0&&(console.log("ðŸŽ‰ Showing popup with notification:",e[0]),a(e),d(e[0]),t(!0))}else console.log("â„¹ï¸ No new notifications")}catch(e){console.error("âŒ Fehler beim Abrufen der Benachrichtigungen:",e)}};console.log("ðŸš€ Starting notification checker..."),e();const s=setInterval(e,1e4);return()=>{console.log("ðŸ›‘ Stopping notification checker"),clearInterval(s)}},[]);const c=async()=>{if(o)try{await r(`/notifications/admin/${o.id}/read`,{method:"PUT"});const e=s.filter(e=>e.id!==o.id);a(e),e.length>0?d(e[0]):(t(!1),d(null))}catch(e){console.error("Fehler beim SchlieÃŸen der Benachrichtigung:",e),t(!1)}};if(!i||!o)return null;const v=(e=>{const s={};return e.split("<br>").forEach(e=>{const n=e.match(/<strong>(.*?):<\/strong>\s*(.*)/);if(n){const e=n[1].trim(),a=n[2].trim();s[e]=a}}),s})(o.message);return e.jsx("div",{className:"admin-registration-popup-overlay",children:e.jsxs("div",{className:"admin-registration-popup",children:[e.jsxs("div",{className:"popup-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx(m,{size:28,className:"header-icon"}),e.jsxs("div",{children:[e.jsx("h2",{children:o.subject}),e.jsx("p",{className:"timestamp",children:new Date(o.created_at).toLocaleString("de-DE")})]})]}),e.jsx("button",{className:"close-btn",onClick:c,children:e.jsx(j,{size:24})})]}),e.jsxs("div",{className:"popup-content",children:[e.jsx("div",{className:"notification-badge",children:s.length>1&&e.jsxs("span",{className:"badge",children:[s.length," neue Registrierung",s.length>1?"en":""]})}),e.jsxs("div",{className:"member-info-grid",children:[v.Name&&e.jsxs("div",{className:"info-item",children:[e.jsx(m,{size:20}),e.jsxs("div",{children:[e.jsx("label",{children:"Name"}),e.jsx("p",{children:v.Name})]})]}),v.Email&&e.jsxs("div",{className:"info-item",children:[e.jsx(u,{size:20}),e.jsxs("div",{children:[e.jsx("label",{children:"Email"}),e.jsx("p",{children:v.Email})]})]}),v.Geburtsdatum&&"N/A"!==v.Geburtsdatum&&e.jsxs("div",{className:"info-item",children:[e.jsx(x,{size:20}),e.jsxs("div",{children:[e.jsx("label",{children:"Geburtsdatum"}),e.jsx("p",{children:v.Geburtsdatum})]})]}),v.Telefon&&"N/A"!==v.Telefon&&e.jsxs("div",{className:"info-item",children:[e.jsx(p,{size:20}),e.jsxs("div",{children:[e.jsx("label",{children:"Telefon"}),e.jsx("p",{children:v.Telefon})]})]}),v.Adresse&&e.jsxs("div",{className:"info-item full-width",children:[e.jsx(h,{size:20}),e.jsxs("div",{children:[e.jsx("label",{children:"Adresse"}),e.jsx("p",{children:v.Adresse})]})]}),v.Tarif&&"N/A"!==v.Tarif&&e.jsxs("div",{className:"info-item full-width",children:[e.jsx(g,{size:20}),e.jsxs("div",{children:[e.jsx("label",{children:"GewÃ¤hlter Tarif"}),e.jsx("p",{children:v.Tarif})]})]}),v.Vertragsbeginn&&"N/A"!==v.Vertragsbeginn&&e.jsxs("div",{className:"info-item",children:[e.jsx(x,{size:20}),e.jsxs("div",{children:[e.jsx("label",{children:"Vertragsbeginn"}),e.jsx("p",{children:v.Vertragsbeginn})]})]}),v.Zahlungszyklus&&"N/A"!==v.Zahlungszyklus&&e.jsxs("div",{className:"info-item",children:[e.jsx(g,{size:20}),e.jsxs("div",{children:[e.jsx("label",{children:"Zahlungszyklus"}),e.jsx("p",{children:v.Zahlungszyklus})]})]}),v.Zahlungsmethode&&"N/A"!==v.Zahlungsmethode&&e.jsxs("div",{className:"info-item",children:[e.jsx(g,{size:20}),e.jsxs("div",{children:[e.jsx("label",{children:"Zahlungsmethode"}),e.jsx("p",{children:v.Zahlungsmethode})]})]})]})]}),e.jsx("div",{className:"popup-footer",children:e.jsx("button",{className:"btn-primary",onClick:c,children:"OK, verstanden"})})]})})},S=({stats:s})=>{if(!s||!s.subscription_status)return null;const{subscription_status:n,trial_days_remaining:a,subscription_days_remaining:i,subscription_plan:t}=s;if("trial"===n){if(null===a||a<0)return null;let s="info",n=e.jsx(b,{size:24}),i="",t=!1;return 0===a?(s="danger",n=e.jsx(N,{size:24}),i="â° Ihre Testphase lÃ¤uft heute ab! SchlieÃŸen Sie jetzt ein Abonnement ab.",t=!0):1===a?(s="danger",n=e.jsx(N,{size:24}),i="â° Ihre Testphase lÃ¤uft morgen ab! SchlieÃŸen Sie jetzt ein Abonnement ab.",t=!0):a<=3?(s="warning",n=e.jsx(N,{size:24}),i=`âš ï¸ Ihre Testphase lÃ¤uft in ${a} Tagen ab. Sichern Sie sich jetzt Ihren Zugang.`,t=!0):a<=7?(s="warning",n=e.jsx(b,{size:24}),i=`Ihre Testphase lÃ¤uft noch ${a} Tage.`,t=!1):(s="info",n=e.jsx(f,{size:24}),i=`âœ“ Testphase aktiv - Noch ${a} Tage verbleibend.`,t=!1),e.jsxs("div",{className:`trial-banner trial-banner-${s}`,children:[e.jsx("div",{className:"trial-banner-icon",children:n}),e.jsx("div",{className:"trial-banner-content",children:e.jsx("div",{className:"trial-banner-message",children:i})}),t&&e.jsx("a",{href:"mailto:abo@tda-intl.org",className:"trial-banner-button",children:"Jetzt Abo abschlieÃŸen"})]})}if("active"===n){if(null!==i&&i<=14){let s=i<=3?"danger":"warning",n=i<=3?e.jsx(N,{size:24}):e.jsx(b,{size:24}),a=0===i?"â° Ihr Abonnement lÃ¤uft heute ab!":1===i?"â° Ihr Abonnement lÃ¤uft morgen ab!":`Ihr ${t||"Abonnement"} lÃ¤uft in ${i} Tagen ab.`;return e.jsxs("div",{className:`trial-banner trial-banner-${s}`,children:[e.jsx("div",{className:"trial-banner-icon",children:n}),e.jsx("div",{className:"trial-banner-content",children:e.jsx("div",{className:"trial-banner-message",children:a})}),e.jsx("a",{href:"mailto:abo@tda-intl.org",className:"trial-banner-button",children:"Jetzt verlÃ¤ngern"})]})}}else if("expired"===n)return e.jsxs("div",{className:"trial-banner trial-banner-expired",children:[e.jsx("div",{className:"trial-banner-icon",children:e.jsx(v,{size:24})}),e.jsx("div",{className:"trial-banner-content",children:e.jsx("div",{className:"trial-banner-message",children:"âŒ Ihr Zugang ist abgelaufen. Bitte schlieÃŸen Sie ein Abonnement ab."})}),e.jsx("a",{href:"mailto:abo@tda-intl.org",className:"trial-banner-button",children:"Jetzt Abo abschlieÃŸen"})]});return null};export{k as A,w as D,z as S,S as T};
