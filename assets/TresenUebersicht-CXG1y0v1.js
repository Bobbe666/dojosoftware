import{a as e,j as s}from"./query-Caj74EYQ.js";import{b as t,u as n,f as a,c as r,j as i}from"./index-1YdTwRLp.js";import"./vendor-router-B2AaIOtG.js";import"./icons-UlaFLuKM.js";import"./charts-QHQg_ypW.js";const l=()=>{const{token:l}=t(),{getDojoFilterParam:c}=n(),[d,o]=e.useState([]),[h,u]=e.useState({}),[m,g]=e.useState({mitglieder:0,anwesenheit:0,checkins_heute:0,kurse:0,stile:0,trainer:0,beitraege:0}),[p,f]=e.useState(()=>(new Date).toISOString().split("T")[0]),[x,b]=e.useState(!1),[k,_]=e.useState(null),[j,v]=e.useState(""),[y,w]=e.useState(!1);e.useEffect(()=>{(async()=>{if(l)try{const e=c(),s=await i(l,e);g({mitglieder:s.mitglieder||0,anwesenheit:s.anwesenheit||0,checkins_heute:s.checkins_heute||0,kurse:s.kurse||0,stile:s.stile||0,trainer:s.trainer||0,beitraege:s.beitraege||0})}catch(e){console.error("Fehler beim Laden der Dashboard-Stats:",e)}})()},[l,c]),e.useEffect(()=>{N(p)},[p]);const N=async e=>{try{b(!0),_(null),console.log(`ğŸ“¢ Lade Tresen-Daten fÃ¼r ${e}...`);const s=await a(`${r.apiBaseUrl}/checkin/tresen/${e}`);if(!s.ok){const e=await s.text();throw console.error(`âŒ HTTP ${s.status}: ${e.substring(0,200)}`),new Error(`HTTP ${s.status}: ${s.statusText}`)}const t=s.headers.get("content-type");if(!t||!t.includes("application/json")){const e=await s.text();throw console.error(`âŒ UngÃ¼ltiger Content-Type: ${t}`),console.error(`Response: ${e.substring(0,500)}`),new Error("Server hat kein JSON zurÃ¼ckgegeben")}const n=await s.json();n.success?(console.log("ğŸ“¦ Rohe Daten vom Server:",n),console.log("ğŸ“‹ Anwesende Array:",n.anwesende),console.log("ğŸ“Š Anzahl Anwesende:",(n.anwesende||[]).length),o(n.anwesende||[]),u(n.stats||{}),console.log(`âœ… ${(n.anwesende||[]).length} Anwesende geladen`),console.log("ğŸ“Š Stats:",n.stats),(n.anwesende||[]).length>0&&console.log("ğŸ‘¥ Erste 3 Anwesende:",n.anwesende.slice(0,3))):(_(n.message||"Fehler beim Laden der Daten"),o([]),u({}))}catch(s){console.error("âŒ Fehler beim Laden der Tresen-Daten:",s),_(`Verbindungsfehler: ${s.message}`),o([]),u({})}finally{b(!1)}},z=e=>{f(e),v(""),w(!1)},S=e=>{const s=new Date;s.setDate(s.getDate()+e);const t=s.toISOString().split("T")[0];z(t)},C=async e=>{try{b(!0);const s=await a(`${r.apiBaseUrl}/checkin/tresen/batch-checkin`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mitglieder_ids:e,datum:p})}),t=await s.json();t.success?(console.log(`âœ… Batch Check-in erfolgreich: ${t.results.length} Mitglieder`),await N(p)):_(t.message||"Fehler beim Batch Check-in")}catch(s){console.error("âŒ Batch Check-in Fehler:",s),_("Batch Check-in fehlgeschlagen")}finally{b(!1)}},T=e.useMemo(()=>{const e=((e=[])=>{const s=new Map;return e.forEach(e=>{if(!e)return;const t=e.mitglied_id||`${e.full_name||""}-${e.stundenplan_id||""}`;if(!s.has(t)){const n=e.full_name||`${e.vorname||""} ${e.nachname||""}`.trim();s.set(t,{mitglied_id:e.mitglied_id,full_name:n,vorname:e.vorname,nachname:e.nachname,gurtfarbe:e.gurtfarbe,foto_pfad:e.foto_pfad,kurse:[],selbsteingechecktCount:0,trainerHinzugefuegtCount:0,selbst_checkin_time:e.selbst_checkin_time,checkout_time:e.checkout_time,trainer_hinzugefuegt_am:e.trainer_hinzugefuegt_am,anwesenheits_typ:e.anwesenheits_typ,erstesCheckinDatum:e.selbst_checkin_time||e.trainer_hinzugefuegt_am||null})}const n=s.get(t);n.kurse.push({kurs_name:e.kurs_name||"Freies Training",kurs_zeit:e.kurs_zeit,anwesenheits_typ:e.anwesenheits_typ,selbst_checkin_time:e.selbst_checkin_time,trainer_hinzugefuegt_am:e.trainer_hinzugefuegt_am,checkout_time:e.checkout_time}),"selbst_eingecheckt"===e.anwesenheits_typ&&(n.selbsteingechecktCount+=1,!n.selbst_checkin_time&&e.selbst_checkin_time&&(n.selbst_checkin_time=e.selbst_checkin_time)),"trainer_hinzugefuegt"===e.anwesenheits_typ&&(n.trainerHinzugefuegtCount+=1,!n.trainer_hinzugefuegt_am&&e.trainer_hinzugefuegt_am&&(n.trainer_hinzugefuegt_am=e.trainer_hinzugefuegt_am))}),Array.from(s.values()).map(e=>{const s=e.trainerHinzugefuegtCount>0,t=e.selbsteingechecktCount>0;return{...e,hatTrainerHinzugefuegt:s,hatSelbstEingecheckt:t,anwesenheits_typ:s?"trainer_hinzugefuegt":t?"selbst_eingecheckt":e.anwesenheits_typ}})})(d),s=j.trim().toLowerCase();return e.filter(e=>{var t,n,a,r;const i=!s||(null==(t=e.full_name)?void 0:t.toLowerCase().includes(s))||(null==(n=e.vorname)?void 0:n.toLowerCase().includes(s))||(null==(a=e.nachname)?void 0:a.toLowerCase().includes(s))||(null==(r=e.kurse)?void 0:r.some(e=>{var t;return null==(t=e.kurs_name)?void 0:t.toLowerCase().includes(s)})),l=!y||e.hatTrainerHinzugefuegt;return i&&l})},[d,j,y]),$=e=>0===e?"0":e.toLocaleString("de-DE");return s.jsxs("div",{className:"tresen-uebersicht-container",children:[s.jsxs("div",{className:"tresen-header",children:[s.jsx("h2",{children:"ğŸª Tresen-Ãœbersicht"}),s.jsx("p",{className:"description",children:"Alle heute anwesenden Mitglieder - eingecheckt oder vom Trainer hinzugefÃ¼gt"})]}),s.jsxs("div",{className:"stats-floating-bar",style:{display:"flex",alignItems:"center",justifyContent:"space-around",gap:"0.5rem",padding:"0.5rem 1rem",marginBottom:"1.5rem",background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(10px)",borderRadius:"8px",border:"1px solid rgba(255, 215, 0, 0.15)",flexWrap:"wrap"},children:[s.jsxs("div",{className:"stat-item",style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.25rem 0.75rem",borderRadius:"6px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 215, 0, 0.1)",flex:"1 1 auto",minWidth:"fit-content"},children:[s.jsx("span",{style:{fontSize:"0.95rem"},children:"ğŸ‘¥"}),s.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ffd700"},children:$(m.mitglieder)}),s.jsx("span",{style:{fontSize:"0.7rem",color:"rgba(255, 255, 255, 0.6)",textTransform:"uppercase",letterSpacing:"0.3px"},children:"Mitglieder"})]}),s.jsxs("div",{className:"stat-item",style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.25rem 0.75rem",borderRadius:"6px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 215, 0, 0.1)",flex:"1 1 auto",minWidth:"fit-content"},children:[s.jsx("span",{style:{fontSize:"0.95rem"},children:"âœ…"}),s.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ffd700"},children:$(m.anwesenheit)}),s.jsx("span",{style:{fontSize:"0.7rem",color:"rgba(255, 255, 255, 0.6)",textTransform:"uppercase",letterSpacing:"0.3px"},children:"Anwesenheiten"})]}),s.jsxs("div",{className:"stat-item",style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.25rem 0.75rem",borderRadius:"6px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 215, 0, 0.1)",flex:"1 1 auto",minWidth:"fit-content"},children:[s.jsx("span",{style:{fontSize:"0.95rem"},children:"ğŸ“±"}),s.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ffd700"},children:$(m.checkins_heute)}),s.jsx("span",{style:{fontSize:"0.7rem",color:"rgba(255, 255, 255, 0.6)",textTransform:"uppercase",letterSpacing:"0.3px"},children:"Check-ins"})]}),s.jsxs("div",{className:"stat-item",style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.25rem 0.75rem",borderRadius:"6px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 215, 0, 0.1)",flex:"1 1 auto",minWidth:"fit-content"},children:[s.jsx("span",{style:{fontSize:"0.95rem"},children:"ğŸ¥‹"}),s.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ffd700"},children:$(m.kurse)}),s.jsx("span",{style:{fontSize:"0.7rem",color:"rgba(255, 255, 255, 0.6)",textTransform:"uppercase",letterSpacing:"0.3px"},children:"Kurse"})]}),s.jsxs("div",{className:"stat-item",style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.25rem 0.75rem",borderRadius:"6px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 215, 0, 0.1)",flex:"1 1 auto",minWidth:"fit-content"},children:[s.jsx("span",{style:{fontSize:"0.95rem"},children:"ğŸ–ï¸"}),s.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ffd700"},children:$(m.stile)}),s.jsx("span",{style:{fontSize:"0.7rem",color:"rgba(255, 255, 255, 0.6)",textTransform:"uppercase",letterSpacing:"0.3px"},children:"Stile"})]}),s.jsxs("div",{className:"stat-item",style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.25rem 0.75rem",borderRadius:"6px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 215, 0, 0.1)",flex:"1 1 auto",minWidth:"fit-content"},children:[s.jsx("span",{style:{fontSize:"0.95rem"},children:"ğŸ‘¨â€ğŸ«"}),s.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ffd700"},children:$(m.trainer)}),s.jsx("span",{style:{fontSize:"0.7rem",color:"rgba(255, 255, 255, 0.6)",textTransform:"uppercase",letterSpacing:"0.3px"},children:"Trainer"})]}),s.jsxs("div",{className:"stat-item",style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.25rem 0.75rem",borderRadius:"6px",background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 215, 0, 0.1)",flex:"1 1 auto",minWidth:"fit-content"},children:[s.jsx("span",{style:{fontSize:"0.95rem"},children:"ğŸ’°"}),s.jsx("span",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ffd700"},children:$(m.beitraege)}),s.jsx("span",{style:{fontSize:"0.7rem",color:"rgba(255, 255, 255, 0.6)",textTransform:"uppercase",letterSpacing:"0.3px"},children:"BeitrÃ¤ge"})]})]}),s.jsxs("div",{className:"tresen-kontrollzeile",children:[s.jsxs("div",{className:"datum-kontrollen",children:[s.jsxs("div",{className:"datum-auswahl",children:[s.jsx("label",{children:"Datum:"}),s.jsx("input",{type:"date",value:p,onChange:e=>z(e.target.value)}),s.jsx("span",{className:"wochentag",children:(D=p,["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"][new Date(D).getDay()])})]}),s.jsxs("div",{className:"schnellzugriff",children:[s.jsx("button",{onClick:()=>S(-1),children:"â¬… Gestern"}),s.jsx("button",{onClick:()=>S(0),children:"ğŸ“… Heute"}),s.jsx("button",{onClick:()=>S(1),children:"Morgen â¡"})]})]}),s.jsxs("div",{className:"stats-overview",children:[s.jsxs("div",{className:"stat-card total",children:[s.jsx("div",{className:"stat-number",children:h.total_anwesend||0}),s.jsx("div",{className:"stat-label",children:"Gesamt"})]}),s.jsxs("div",{className:"stat-card eingecheckt",children:[s.jsx("div",{className:"stat-number",children:h.selbst_eingecheckt||0}),s.jsx("div",{className:"stat-label",children:"ğŸ“± Eingecheckt"})]}),s.jsxs("div",{className:"stat-card trainer",children:[s.jsx("div",{className:"stat-number",children:h.trainer_hinzugefuegt||0}),s.jsx("div",{className:"stat-label",children:"ğŸ‘¨â€ğŸ« Trainer"})]}),s.jsxs("div",{className:"stat-card warnung",children:[s.jsx("div",{className:"stat-number",children:h.brauchen_checkin||0}),s.jsx("div",{className:"stat-label",children:"âš ï¸ Offen"})]})]})]}),s.jsxs("div",{className:"filter-kontrollen",children:[s.jsx("div",{className:"suche",children:s.jsx("input",{type:"text",placeholder:"ğŸ” Name oder Kurs suchen...",value:j,onChange:e=>v(e.target.value),className:"suchfeld"})}),s.jsxs("div",{className:"filter-optionen",children:[s.jsxs("label",{className:"filter-checkbox-label",children:[s.jsx("input",{type:"checkbox",checked:y,onChange:e=>w(e.target.checked)}),'Nur "brauchen Check-in" anzeigen']}),h.brauchen_checkin>0&&s.jsxs("button",{className:"batch-checkin-button",onClick:()=>{const e=d.filter(e=>"trainer_hinzugefuegt"===e.anwesenheits_typ).map(e=>e.mitglied_id);e.length>0&&confirm(`${e.length} Mitglieder nachtrÃ¤glich einchecken?`)&&C(e)},disabled:x,children:["ğŸ“± Alle ",h.brauchen_checkin," nachtrÃ¤glich einchecken"]})]})]}),k&&s.jsxs("div",{className:"error-message",children:["âŒ ",k]}),x&&s.jsx("div",{className:"loading",children:"ğŸ”„ Lade..."}),s.jsxs("div",{className:"anwesende-liste",children:[!x&&0===T.length&&s.jsx("div",{className:"keine-anwesende",children:0===d.length?"ğŸ“­ Keine Anwesenden heute":"ğŸ“­ Keine Treffer fÃ¼r die aktuellen Filter"}),T.map(e=>{var t,n,a;const r=e.mitglied_id||e.full_name,i=(null==(t=e.kurse)?void 0:t.filter(e=>"trainer_hinzugefuegt"===e.anwesenheits_typ))||[],l=(null==(n=e.kurse)?void 0:n.filter(e=>"selbst_eingecheckt"===e.anwesenheits_typ))||[],c=e.full_name||`${e.vorname||""} ${e.nachname||""}`.trim();return s.jsxs("div",{className:`person-card ${e.anwesenheits_typ||""}`,children:[s.jsxs("div",{className:"person-card-main",children:[s.jsx("div",{className:"status-icon",children:e.hatTrainerHinzugefuegt?"ğŸ‘¨â€ğŸ«":"ğŸ“±"}),s.jsxs("div",{className:"person-info",children:[s.jsxs("div",{className:"person-name",children:[s.jsx("strong",{children:c}),e.gurtfarbe&&s.jsx("span",{className:"gurtfarbe",children:e.gurtfarbe})]}),(null==(a=e.kurse)?void 0:a.length)>0&&s.jsx("div",{className:"kurs-tags",children:e.kurse.map((t,n)=>s.jsxs("span",{className:"kurs-tag "+("trainer_hinzugefuegt"===t.anwesenheits_typ?"kurs-tag-trainer":"kurs-tag-checkin"),children:[s.jsx("span",{children:t.kurs_name||"Unbekannter Kurs"}),t.kurs_zeit&&s.jsx("span",{className:"kurs-tag-zeit",children:t.kurs_zeit})]},`${e.mitglied_id||n}-${t.stundenplan_id||n}`))})]})]}),s.jsxs("div",{className:"person-status",children:[l.length>0&&s.jsxs("div",{className:"status-block success",children:[s.jsx("div",{className:"status-label",children:"ğŸ“± Eingecheckt"}),s.jsx("ul",{className:"kurs-status-list",children:l.map((e,t)=>s.jsxs("li",{children:[e.kurs_name||"Kurs",e.selbst_checkin_time&&s.jsxs("span",{className:"kurs-status-zeit",children:[" ","Â·"," ",new Date(e.selbst_checkin_time).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})]})]},`selbst-${r}-${t}`))})]}),i.length>0&&s.jsxs("div",{className:"status-block warnung",children:[s.jsx("div",{className:"status-label warnung",children:"âš ï¸ Bitte einchecken"}),s.jsx("ul",{className:"kurs-status-list",children:i.map((e,t)=>s.jsxs("li",{children:[e.kurs_name||"Kurs",e.trainer_hinzugefuegt_am&&s.jsxs("span",{className:"kurs-status-zeit",children:[" ","Â·"," ",new Date(e.trainer_hinzugefuegt_am).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})]})]},`trainer-${r}-${t}`))}),s.jsx("button",{className:"einzelner-checkin-button",onClick:()=>C([e.mitglied_id]),disabled:x,children:"ğŸ“± Einchecken"})]})]})]},r)})]}),s.jsx("div",{className:"refresh-controls",children:s.jsx("button",{className:"refresh-button",onClick:()=>N(p),disabled:x,children:"ğŸ”„ Aktualisieren"})})]});var D};export{l as default};
