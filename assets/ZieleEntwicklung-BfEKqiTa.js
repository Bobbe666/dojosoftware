import{j as e}from"./animation-1wuIdCBS.js";import{u as s,r as a}from"./vendor-router-BhMXg4Z-.js";import{u as i,a as l}from"./index-DUnH23_2.js";/* empty css                         */import{H as n,o as r,G as t,aO as c,aU as d,N as o,ad as h,T as m,g as j,aK as g,a as u,b as x,aV as b,aW as p,aX as v,z,aY as N,p as k,ae as y,x as f,aZ as w,u as S}from"./icons-D7rg4pDH.js";const E=({bereich:E="org",kontextId:_=null,showFinanzrechner:F=!0,showNavigation:M=!0})=>{const{token:D,user:T}=i(),$=s(),L="admin"===(null==T?void 0:T.role),[P,U]=a.useState(!0),[C,R]=a.useState(!1),[V,A]=a.useState(""),[B,J]=a.useState(""),[O,Z]=a.useState({}),[I,G]=a.useState({}),[K,H]=a.useState([]),[W,Y]=a.useState(null),[X,q]=a.useState(!1),[Q,ee]=a.useState({vergleich:!0,ziele:!0,rechner:!1}),[se,ae]=a.useState({mitgliederPlanung:{},beitragsverteilung:[]}),ie=(new Date).getFullYear(),le=[ie,ie+1,ie+2,ie+3,ie+4],ne={org:{titel:"Organisation Gesamtübersicht",subtitel:"Alle Bereiche: Verband, Dojos & Software",kontextTyp:"global",icon:t,color:"#6366f1"},verband:{titel:"Verbandsmitgliedschaften",subtitel:"Entwicklung der Verbandsmitglieder",kontextTyp:"verband",icon:r,color:"#8b5cf6"},dojo:{titel:"Dojo-Mitglieder",subtitel:"Entwicklung der Dojo-Mitgliedschaften",kontextTyp:"dojo",icon:n,color:"#10b981"}},re=ne[E]||ne.org,te=(()=>{switch(E){case"verband":return[{key:"verband_mitglieder",label:"Verbandsmitglieder",icon:r,color:"#6366f1",einheit:""},{key:"umsatz",label:"Verbandsbeiträge",icon:S,color:"#f59e0b",einheit:"EUR"}];case"dojo":return[{key:"dojo_mitglieder",label:"Dojo-Mitglieder",icon:r,color:"#10b981",einheit:""},{key:"umsatz",label:"Mitgliedsbeiträge",icon:S,color:"#f59e0b",einheit:"EUR"}];default:return[{key:"verband_mitglieder",label:"Verbandsmitglieder",icon:r,color:"#6366f1",einheit:""},{key:"dojos",label:"Mitgliedsschulen",icon:f,color:"#8b5cf6",einheit:""},{key:"software_nutzer",label:"Software-Nutzer",icon:w,color:"#06b6d4",einheit:""},{key:"dojo_mitglieder",label:"Dojo-Mitglieder",icon:r,color:"#10b981",einheit:""},{key:"umsatz",label:"Gesamtumsatz",icon:S,color:"#f59e0b",einheit:"EUR"}]}})();a.useEffect(()=>{ce()},[E,_]);const ce=async()=>{var e;U(!0),A("");try{const[s,a,i,n]=await Promise.all([l.get("/entwicklungsziele",{params:{kontext_typ:re.kontextTyp,kontext_id:_},headers:{Authorization:`Bearer ${D}`}}).catch(()=>({data:[]})),l.get("/entwicklungsziele/statistiken",{params:{kontext_typ:re.kontextTyp,kontext_id:_},headers:{Authorization:`Bearer ${D}`}}).catch(()=>({data:{}})),l.get("/entwicklungsziele/beitraege",{params:{kontext_typ:re.kontextTyp,kontext_id:_},headers:{Authorization:`Bearer ${D}`}}).catch(()=>({data:[]})),l.get("/entwicklungsziele/vergleiche",{params:{kontext_typ:re.kontextTyp,kontext_id:_},headers:{Authorization:`Bearer ${D}`}}).catch(()=>({data:null}))]),r={};te.forEach(e=>{r[e.key]={},le.forEach(s=>{r[e.key][s]=0})}),(s.data||[]).forEach(e=>{r[e.typ]&&le.includes(e.jahr)&&(r[e.typ][e.jahr]=parseFloat(e.ziel_wert)||0)}),Z(r),G(a.data||{}),H(i.data||[]),Y(n.data);const t=(i.data||[]).map(e=>({id:e.id,name:e.name,monatsbeitrag:parseFloat(e.monatsbeitrag)||0,jahresbeitrag:parseFloat(e.jahresbeitrag)||0,anteil:parseFloat(e.anteil_prozent)||0,beschreibung:e.beschreibung})),c={},d="verband"===E?"verband_mitglieder":"dojo_mitglieder",o=(null==(e=a.data)?void 0:e[d])||0;le.forEach((e,s)=>{var a;const i=null==(a=r[d])?void 0:a[e];c[e]=i>0?i:Math.round(o*Math.pow(1.1,s))}),ae({mitgliederPlanung:c,beitragsverteilung:t.length>0?t:de()})}catch(s){console.error("Fehler beim Laden:",s),A("Fehler beim Laden der Entwicklungsziele")}finally{U(!1)}},de=()=>"verband"===E?[{id:1,name:"Mitgliedsschulen",monatsbeitrag:8.25,jahresbeitrag:99,anteil:40},{id:2,name:"Einzelmitglieder",monatsbeitrag:4.08,jahresbeitrag:49,anteil:60}]:[{id:1,name:"Erwachsene",monatsbeitrag:69,jahresbeitrag:828,anteil:45},{id:2,name:"Studenten & Schüler",monatsbeitrag:49,jahresbeitrag:588,anteil:20},{id:3,name:"Kinder & Jugendliche",monatsbeitrag:49,jahresbeitrag:588,anteil:35}],oe=e=>{const{beitragsverteilung:s}=se;let a=0;return{details:s.map(s=>{const i=Math.round(e*(s.anteil/100)),l=i*s.monatsbeitrag;return a+=l,{...s,anzahl:i,monatlich:l,jaehrlich:12*l}}),monatlich:a,jaehrlich:12*a}},he=e=>{ee(s=>({...s,[e]:!s[e]}))},me=e=>{var s;const a=I[e]||0,i=(null==(s=O[e])?void 0:s[ie])||0;if(0===i)return{prozent:0,differenz:0,trend:"neutral"};const l=Math.round(a/i*100);return{prozent:l,differenz:a-i,trend:l>=100?"up":l>=80?"neutral":"down"}},je=(e,s)=>"EUR"===s?`${Math.round(e).toLocaleString("de-DE")} EUR`:e.toLocaleString("de-DE"),ge=(()=>{const e=[];return"org"!==E&&e.push({key:"org",label:"Org-Übersicht",icon:t,path:"/dashboard/superadmin"}),"verband"!==E&&e.push({key:"verband",label:"Verband",icon:r,path:"/dashboard/verband"}),"dojo"!==E&&e.push({key:"dojo",label:"Dojo",icon:n,path:"/dashboard"}),e})(),ue=re.icon;return P?e.jsxs("div",{className:"ziele-entwicklung loading",children:[e.jsx(c,{className:"spin",size:32}),e.jsx("span",{children:"Lade Entwicklungsziele..."})]}):e.jsxs("div",{className:"ziele-entwicklung",children:[e.jsxs("div",{className:"ziele-header",children:[e.jsxs("div",{className:"ziele-title",children:[e.jsx(ue,{size:24,style:{color:re.color}}),e.jsxs("div",{children:[e.jsx("h2",{children:"Ziele & Entwicklung"}),e.jsx("span",{className:"bereich-subtitel",children:re.subtitel})]})]}),e.jsxs("div",{className:"ziele-header-right",children:[M&&ge.length>0&&e.jsx("div",{className:"bereich-navigation",children:ge.map(s=>{const a=s.icon;return e.jsxs("button",{className:"nav-link-btn",onClick:()=>$(s.path),title:`Zu ${s.label} wechseln`,children:[e.jsx(a,{size:16}),e.jsx("span",{children:s.label}),e.jsx(d,{size:12})]},s.key)})}),L&&e.jsx("div",{className:"ziele-actions",children:X?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-secondary",onClick:()=>q(!1),disabled:C,children:"Abbrechen"}),e.jsxs("button",{className:"btn-primary",onClick:async()=>{R(!0),A(""),J("");try{const e=[];Object.entries(O).forEach(([s,a])=>{Object.entries(a).forEach(([a,i])=>{i>0&&e.push({typ:s,kontext_typ:re.kontextTyp,kontext_id:_,jahr:parseInt(a),ziel_wert:parseFloat(i)})})}),await l.post("/entwicklungsziele/batch",{ziele:e},{headers:{Authorization:`Bearer ${D}`}}),J("Ziele erfolgreich gespeichert"),q(!1),ce(),setTimeout(()=>J(""),3e3)}catch(e){console.error("Fehler beim Speichern:",e),A("Fehler beim Speichern der Ziele")}finally{R(!1)}},disabled:C,children:[C?e.jsx(c,{className:"spin",size:16}):e.jsx(o,{size:16}),"Speichern"]})]}):e.jsxs("button",{className:"btn-secondary",onClick:()=>q(!0),children:[e.jsx(h,{size:16}),"Bearbeiten"]})})]})]}),V&&e.jsxs("div",{className:"ziele-message error",children:[e.jsx(m,{size:16}),V]}),B&&e.jsxs("div",{className:"ziele-message success",children:[e.jsx(j,{size:16}),B]}),e.jsxs("div",{className:"ziele-section",children:[e.jsxs("div",{className:"section-header clickable",onClick:()=>he("vergleich"),children:[e.jsxs("div",{className:"section-title",children:[e.jsx(g,{size:20}),e.jsxs("span",{children:["IST vs. SOLL Vergleich ",ie]})]}),Q.vergleich?e.jsx(u,{size:20}):e.jsx(x,{size:20})]}),Q.vergleich&&e.jsx("div",{className:"vergleich-grid",children:te.map(s=>{var a;const i=me(s.key),l=I[s.key]||0,n=(null==(a=O[s.key])?void 0:a[ie])||0,r=s.icon;return e.jsxs("div",{className:`vergleich-card ${i.trend}`,children:[e.jsxs("div",{className:"vergleich-header",children:[e.jsx(r,{size:20,style:{color:s.color}}),e.jsx("span",{children:s.label})]}),e.jsxs("div",{className:"vergleich-werte",children:[e.jsxs("div",{className:"wert-block ist",children:[e.jsx("span",{className:"wert-label",children:"IST"}),e.jsx("span",{className:"wert-zahl",children:je(l,s.einheit)})]}),e.jsxs("div",{className:"wert-divider",children:["up"===i.trend&&e.jsx(b,{size:20,className:"trend-up"}),"down"===i.trend&&e.jsx(p,{size:20,className:"trend-down"}),"neutral"===i.trend&&e.jsx(v,{size:20,className:"trend-neutral"})]}),e.jsxs("div",{className:"wert-block soll",children:[e.jsx("span",{className:"wert-label",children:"SOLL"}),e.jsx("span",{className:"wert-zahl",children:je(n,s.einheit)})]})]}),e.jsxs("div",{className:"vergleich-progress",children:[e.jsx("div",{className:"progress-bar-bg",children:e.jsx("div",{className:`progress-bar-fill ${i.trend}`,style:{width:`${Math.min(100,i.prozent)}%`}})}),e.jsxs("div",{className:"progress-stats",children:[e.jsxs("span",{className:`progress-prozent ${i.trend}`,children:[i.prozent,"%"]}),e.jsxs("span",{className:"progress-differenz "+(i.differenz>=0?"positive":"negative"),children:[i.differenz>=0?"+":"",je(i.differenz,s.einheit)]})]})]})]},s.key)})})]}),e.jsxs("div",{className:"ziele-section",children:[e.jsxs("div",{className:"section-header clickable",onClick:()=>he("ziele"),children:[e.jsxs("div",{className:"section-title",children:[e.jsx(z,{size:20}),e.jsx("span",{children:"5-Jahres-Planung"})]}),Q.ziele?e.jsx(u,{size:20}):e.jsx(x,{size:20})]}),Q.ziele&&e.jsx("div",{className:"ziele-table-container",children:e.jsxs("table",{className:"ziele-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"kennzahl-col",children:"Kennzahl"}),e.jsx("th",{className:"ist-col",children:"IST"}),le.map(s=>e.jsx("th",{className:s===ie?"current-year":"",children:s},s))]})}),e.jsx("tbody",{children:te.map(s=>{const a=I[s.key]||0,i=s.icon;return e.jsxs("tr",{children:[e.jsx("td",{className:"kennzahl-col",children:e.jsxs("div",{className:"kennzahl-label",children:[e.jsx(i,{size:16,style:{color:s.color}}),e.jsx("span",{children:s.label})]})}),e.jsx("td",{className:"ist-col",children:e.jsx("span",{className:"ist-wert",children:je(a,s.einheit)})}),le.map(a=>{var i,l;const n=(null==(i=O[s.key])?void 0:i[a])||0,r=a===ie,t=r?me(s.key):null;return e.jsx("td",{className:`${r?"current-year":""} ${X?"editable":""}`,children:X?e.jsx("input",{type:"number",min:"0",value:(null==(l=O[s.key])?void 0:l[a])||"",onChange:e=>((e,s,a)=>{Z(i=>({...i,[e]:{...i[e],[s]:parseFloat(a)||0}}))})(s.key,a,e.target.value),placeholder:"0"}):e.jsxs("div",{className:"ziel-cell",children:[e.jsx("span",{className:"ziel-wert",children:je(n,s.einheit)}),r&&t&&n>0&&e.jsxs("span",{className:`mini-badge ${t.trend}`,children:[t.prozent,"%"]})]})},a)})]},s.key)})})]})})]}),F&&e.jsxs("div",{className:"ziele-section",children:[e.jsxs("div",{className:"section-header clickable",onClick:()=>he("rechner"),children:[e.jsxs("div",{className:"section-title",children:[e.jsx(N,{size:20}),e.jsx("span",{children:"5-Jahres Finanzprognose"})]}),Q.rechner?e.jsx(u,{size:20}):e.jsx(x,{size:20})]}),Q.rechner&&e.jsxs("div",{className:"finanz-rechner",children:[e.jsxs("div",{className:"rechner-eingabe",children:[e.jsxs("div",{className:"eingabe-gruppe full-width",children:[e.jsx("label",{children:"Geplante Mitgliederzahlen pro Jahr"}),e.jsx("div",{className:"jahr-inputs",children:le.map(s=>e.jsxs("div",{className:"jahr-input-gruppe",children:[e.jsx("span",{className:"jahr-label",children:s}),e.jsx("input",{type:"number",min:"0",value:se.mitgliederPlanung[s]||0,onChange:e=>((e,s)=>{ae(a=>({...a,mitgliederPlanung:{...a.mitgliederPlanung,[e]:parseInt(s)||0}}))})(s,e.target.value)})]},s))})]}),e.jsxs("div",{className:"beitrags-gruppen",children:[e.jsx("label",{children:"Beitragsstruktur (basierend auf aktuellen Tarifen)"}),se.beitragsverteilung.map((s,a)=>e.jsxs("div",{className:"beitrags-gruppe",children:[e.jsx("span",{className:"gruppe-name",children:s.name}),e.jsxs("div",{className:"gruppe-info",children:[e.jsxs("span",{className:"gruppe-beitrag",children:[s.monatsbeitrag.toFixed(2)," EUR/Monat"]}),e.jsxs("span",{className:"gruppe-anteil",children:[s.anteil,"% Anteil"]})]})]},s.id||a))]})]}),e.jsx("div",{className:"prognose-tabelle",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Jahr"}),e.jsx("th",{children:"Mitglieder"}),e.jsx("th",{children:"Monatlich"}),e.jsx("th",{children:"Jährlich"}),e.jsx("th",{children:"Wachstum"})]})}),e.jsx("tbody",{children:le.map((s,a)=>{const i=se.mitgliederPlanung[s]||0,l=oe(i),n=a>0?se.mitgliederPlanung[le[a-1]]||0:null,r=n?Math.round((i-n)/n*100):null;return e.jsxs("tr",{className:s===ie?"current-year":"",children:[e.jsx("td",{className:"jahr",children:s}),e.jsx("td",{className:"mitglieder",children:i.toLocaleString("de-DE")}),e.jsxs("td",{className:"monatlich",children:[l.monatlich.toLocaleString("de-DE",{minimumFractionDigits:2})," EUR"]}),e.jsxs("td",{className:"jaehrlich highlight",children:[l.jaehrlich.toLocaleString("de-DE",{minimumFractionDigits:2})," EUR"]}),e.jsx("td",{className:"wachstum "+(r&&r>0?"positive":r&&r<0?"negative":""),children:null!==r?e.jsxs(e.Fragment,{children:[r>0&&e.jsx(k,{size:14}),r<0&&e.jsx(y,{size:14}),r>=0?"+":"",r,"%"]}):"-"})]},s)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"3",className:"summe-label",children:"5-Jahres Gesamtsumme:"}),e.jsxs("td",{className:"summe-wert",colSpan:"2",children:[le.reduce((e,s)=>{const a=se.mitgliederPlanung[s]||0;return e+oe(a).jaehrlich},0).toLocaleString("de-DE",{minimumFractionDigits:2})," EUR"]})]})})]})})]})]})]})};export{E as Z};
