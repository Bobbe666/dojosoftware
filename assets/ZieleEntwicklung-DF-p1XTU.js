import{a as e,j as s}from"./query-Caj74EYQ.js";import{b as a,a as i}from"./index-D4wQygnO.js";/* empty css                         */import{H as l,o as n,G as r,V as t,b4 as c,X as d,aB as o,T as h,g as m,aY as j,a as g,b as u,b5 as x,b6 as b,b7 as p,J as v,$ as z,p as N,u as k,N as y,v as f,O as w}from"./icons-eh0tbLFx.js";import{u as S}from"./vendor-router-B2AaIOtG.js";const E=({bereich:E="org",kontextId:_=null,showFinanzrechner:F=!0,showNavigation:M=!0})=>{const{token:D,user:$}=a(),T=S(),L="admin"===(null==$?void 0:$.role),[P,B]=e.useState(!0),[C,R]=e.useState(!1),[U,V]=e.useState(""),[A,J]=e.useState(""),[O,I]=e.useState({}),[Z,G]=e.useState({}),[K,Y]=e.useState([]),[q,H]=e.useState(null),[Q,W]=e.useState(!1),[X,ee]=e.useState({vergleich:!0,ziele:!0,rechner:!1}),[se,ae]=e.useState({mitgliederPlanung:{},beitragsverteilung:[]}),ie=(new Date).getFullYear(),le=[ie,ie+1,ie+2,ie+3,ie+4],ne={org:{titel:"Organisation Gesamtübersicht",subtitel:"Alle Bereiche: Verband, Dojos & Software",kontextTyp:"global",icon:r,color:"#6366f1"},verband:{titel:"Verbandsmitgliedschaften",subtitel:"Entwicklung der Verbandsmitglieder",kontextTyp:"verband",icon:n,color:"#8b5cf6"},dojo:{titel:"Dojo-Mitglieder",subtitel:"Entwicklung der Dojo-Mitgliedschaften",kontextTyp:"dojo",icon:l,color:"#10b981"}},re=ne[E]||ne.org,te=(()=>{switch(E){case"verband":return[{key:"verband_mitglieder",label:"Verbandsmitglieder",icon:n,color:"#6366f1",einheit:""},{key:"umsatz",label:"Verbandsbeiträge",icon:w,color:"#f59e0b",einheit:"EUR"}];case"dojo":return[{key:"dojo_mitglieder",label:"Dojo-Mitglieder",icon:n,color:"#10b981",einheit:""},{key:"umsatz",label:"Mitgliedsbeiträge",icon:w,color:"#f59e0b",einheit:"EUR"}];default:return[{key:"verband_mitglieder",label:"Verbandsmitglieder",icon:n,color:"#6366f1",einheit:""},{key:"dojos",label:"Mitgliedsschulen",icon:y,color:"#8b5cf6",einheit:""},{key:"software_nutzer",label:"Software-Nutzer",icon:f,color:"#06b6d4",einheit:""},{key:"dojo_mitglieder",label:"Dojo-Mitglieder",icon:n,color:"#10b981",einheit:""},{key:"umsatz",label:"Gesamtumsatz",icon:w,color:"#f59e0b",einheit:"EUR"}]}})();e.useEffect(()=>{ce()},[E,_]);const ce=async()=>{var e;B(!0),V("");try{const[s,a,l,n]=await Promise.all([i.get("/entwicklungsziele",{params:{kontext_typ:re.kontextTyp,kontext_id:_},headers:{Authorization:`Bearer ${D}`}}).catch(()=>({data:[]})),i.get("/entwicklungsziele/statistiken",{params:{kontext_typ:re.kontextTyp,kontext_id:_},headers:{Authorization:`Bearer ${D}`}}).catch(()=>({data:{}})),i.get("/entwicklungsziele/beitraege",{params:{kontext_typ:re.kontextTyp,kontext_id:_},headers:{Authorization:`Bearer ${D}`}}).catch(()=>({data:[]})),i.get("/entwicklungsziele/vergleiche",{params:{kontext_typ:re.kontextTyp,kontext_id:_},headers:{Authorization:`Bearer ${D}`}}).catch(()=>({data:null}))]),r={};te.forEach(e=>{r[e.key]={},le.forEach(s=>{r[e.key][s]=0})}),(s.data||[]).forEach(e=>{r[e.typ]&&le.includes(e.jahr)&&(r[e.typ][e.jahr]=parseFloat(e.ziel_wert)||0)}),I(r),G(a.data||{}),Y(l.data||[]),H(n.data);const t=(l.data||[]).map(e=>({id:e.id,name:e.name,monatsbeitrag:parseFloat(e.monatsbeitrag)||0,jahresbeitrag:parseFloat(e.jahresbeitrag)||0,anteil:parseFloat(e.anteil_prozent)||0,beschreibung:e.beschreibung})),c={},d="verband"===E?"verband_mitglieder":"dojo_mitglieder",o=(null==(e=a.data)?void 0:e[d])||0;le.forEach((e,s)=>{var a;const i=null==(a=r[d])?void 0:a[e];c[e]=i>0?i:Math.round(o*Math.pow(1.1,s))}),ae({mitgliederPlanung:c,beitragsverteilung:t.length>0?t:de()})}catch(s){console.error("Fehler beim Laden:",s),V("Fehler beim Laden der Entwicklungsziele")}finally{B(!1)}},de=()=>"verband"===E?[{id:1,name:"Mitgliedsschulen",monatsbeitrag:8.25,jahresbeitrag:99,anteil:40},{id:2,name:"Einzelmitglieder",monatsbeitrag:4.08,jahresbeitrag:49,anteil:60}]:[{id:1,name:"Erwachsene",monatsbeitrag:69,jahresbeitrag:828,anteil:45},{id:2,name:"Studenten & Schüler",monatsbeitrag:49,jahresbeitrag:588,anteil:20},{id:3,name:"Kinder & Jugendliche",monatsbeitrag:49,jahresbeitrag:588,anteil:35}],oe=e=>{const{beitragsverteilung:s}=se;let a=0;return{details:s.map(s=>{const i=Math.round(e*(s.anteil/100)),l=i*s.monatsbeitrag;return a+=l,{...s,anzahl:i,monatlich:l,jaehrlich:12*l}}),monatlich:a,jaehrlich:12*a}},he=e=>{ee(s=>({...s,[e]:!s[e]}))},me=e=>{var s;const a=Z[e]||0,i=(null==(s=O[e])?void 0:s[ie])||0;if(0===i)return{prozent:0,differenz:0,trend:"neutral"};const l=Math.round(a/i*100);return{prozent:l,differenz:a-i,trend:l>=100?"up":l>=80?"neutral":"down"}},je=(e,s)=>"EUR"===s?`${Math.round(e).toLocaleString("de-DE")} EUR`:e.toLocaleString("de-DE"),ge=(()=>{const e=[];return"org"!==E&&e.push({key:"org",label:"Org-Übersicht",icon:r,path:"/dashboard/superadmin"}),"verband"!==E&&e.push({key:"verband",label:"Verband",icon:n,path:"/dashboard/verband"}),"dojo"!==E&&e.push({key:"dojo",label:"Dojo",icon:l,path:"/dashboard"}),e})(),ue=re.icon;return P?s.jsxs("div",{className:"ziele-entwicklung loading",children:[s.jsx(t,{className:"spin",size:32}),s.jsx("span",{children:"Lade Entwicklungsziele..."})]}):s.jsxs("div",{className:"ziele-entwicklung",children:[s.jsxs("div",{className:"ziele-header",children:[s.jsxs("div",{className:"ziele-title",children:[s.jsx(ue,{size:24,style:{color:re.color}}),s.jsxs("div",{children:[s.jsx("h2",{children:"Ziele & Entwicklung"}),s.jsx("span",{className:"bereich-subtitel",children:re.subtitel})]})]}),s.jsxs("div",{className:"ziele-header-right",children:[M&&ge.length>0&&s.jsx("div",{className:"bereich-navigation",children:ge.map(e=>{const a=e.icon;return s.jsxs("button",{className:"nav-link-btn",onClick:()=>T(e.path),title:`Zu ${e.label} wechseln`,children:[s.jsx(a,{size:16}),s.jsx("span",{children:e.label}),s.jsx(c,{size:12})]},e.key)})}),L&&s.jsx("div",{className:"ziele-actions",children:Q?s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"btn-secondary",onClick:()=>W(!1),disabled:C,children:"Abbrechen"}),s.jsxs("button",{className:"btn-primary",onClick:async()=>{R(!0),V(""),J("");try{const e=[];Object.entries(O).forEach(([s,a])=>{Object.entries(a).forEach(([a,i])=>{i>0&&e.push({typ:s,kontext_typ:re.kontextTyp,kontext_id:_,jahr:parseInt(a),ziel_wert:parseFloat(i)})})}),await i.post("/entwicklungsziele/batch",{ziele:e},{headers:{Authorization:`Bearer ${D}`}}),J("Ziele erfolgreich gespeichert"),W(!1),ce(),setTimeout(()=>J(""),3e3)}catch(e){console.error("Fehler beim Speichern:",e),V("Fehler beim Speichern der Ziele")}finally{R(!1)}},disabled:C,children:[C?s.jsx(t,{className:"spin",size:16}):s.jsx(d,{size:16}),"Speichern"]})]}):s.jsxs("button",{className:"btn-secondary",onClick:()=>W(!0),children:[s.jsx(o,{size:16}),"Bearbeiten"]})})]})]}),U&&s.jsxs("div",{className:"ziele-message error",children:[s.jsx(h,{size:16}),U]}),A&&s.jsxs("div",{className:"ziele-message success",children:[s.jsx(m,{size:16}),A]}),s.jsxs("div",{className:"ziele-section",children:[s.jsxs("div",{className:"section-header clickable",onClick:()=>he("vergleich"),children:[s.jsxs("div",{className:"section-title",children:[s.jsx(j,{size:20}),s.jsxs("span",{children:["IST vs. SOLL Vergleich ",ie]})]}),X.vergleich?s.jsx(g,{size:20}):s.jsx(u,{size:20})]}),X.vergleich&&s.jsx("div",{className:"vergleich-grid",children:te.map(e=>{var a;const i=me(e.key),l=Z[e.key]||0,n=(null==(a=O[e.key])?void 0:a[ie])||0,r=e.icon;return s.jsxs("div",{className:`vergleich-card ${i.trend}`,children:[s.jsxs("div",{className:"vergleich-header",children:[s.jsx(r,{size:20,style:{color:e.color}}),s.jsx("span",{children:e.label})]}),s.jsxs("div",{className:"vergleich-werte",children:[s.jsxs("div",{className:"wert-block ist",children:[s.jsx("span",{className:"wert-label",children:"IST"}),s.jsx("span",{className:"wert-zahl",children:je(l,e.einheit)})]}),s.jsxs("div",{className:"wert-divider",children:["up"===i.trend&&s.jsx(x,{size:20,className:"trend-up"}),"down"===i.trend&&s.jsx(b,{size:20,className:"trend-down"}),"neutral"===i.trend&&s.jsx(p,{size:20,className:"trend-neutral"})]}),s.jsxs("div",{className:"wert-block soll",children:[s.jsx("span",{className:"wert-label",children:"SOLL"}),s.jsx("span",{className:"wert-zahl",children:je(n,e.einheit)})]})]}),s.jsxs("div",{className:"vergleich-progress",children:[s.jsx("div",{className:"progress-bar-bg",children:s.jsx("div",{className:`progress-bar-fill ${i.trend}`,style:{width:`${Math.min(100,i.prozent)}%`}})}),s.jsxs("div",{className:"progress-stats",children:[s.jsxs("span",{className:`progress-prozent ${i.trend}`,children:[i.prozent,"%"]}),s.jsxs("span",{className:"progress-differenz "+(i.differenz>=0?"positive":"negative"),children:[i.differenz>=0?"+":"",je(i.differenz,e.einheit)]})]})]})]},e.key)})})]}),s.jsxs("div",{className:"ziele-section",children:[s.jsxs("div",{className:"section-header clickable",onClick:()=>he("ziele"),children:[s.jsxs("div",{className:"section-title",children:[s.jsx(v,{size:20}),s.jsx("span",{children:"5-Jahres-Planung"})]}),X.ziele?s.jsx(g,{size:20}):s.jsx(u,{size:20})]}),X.ziele&&s.jsx("div",{className:"ziele-table-container",children:s.jsxs("table",{className:"ziele-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"kennzahl-col",children:"Kennzahl"}),s.jsx("th",{className:"ist-col",children:"IST"}),le.map(e=>s.jsx("th",{className:e===ie?"current-year":"",children:e},e))]})}),s.jsx("tbody",{children:te.map(e=>{const a=Z[e.key]||0,i=e.icon;return s.jsxs("tr",{children:[s.jsx("td",{className:"kennzahl-col",children:s.jsxs("div",{className:"kennzahl-label",children:[s.jsx(i,{size:16,style:{color:e.color}}),s.jsx("span",{children:e.label})]})}),s.jsx("td",{className:"ist-col",children:s.jsx("span",{className:"ist-wert",children:je(a,e.einheit)})}),le.map(a=>{var i,l;const n=(null==(i=O[e.key])?void 0:i[a])||0,r=a===ie,t=r?me(e.key):null;return s.jsx("td",{className:`${r?"current-year":""} ${Q?"editable":""}`,children:Q?s.jsx("input",{type:"number",min:"0",value:(null==(l=O[e.key])?void 0:l[a])||"",onChange:s=>((e,s,a)=>{I(i=>({...i,[e]:{...i[e],[s]:parseFloat(a)||0}}))})(e.key,a,s.target.value),placeholder:"0"}):s.jsxs("div",{className:"ziel-cell",children:[s.jsx("span",{className:"ziel-wert",children:je(n,e.einheit)}),r&&t&&n>0&&s.jsxs("span",{className:`mini-badge ${t.trend}`,children:[t.prozent,"%"]})]})},a)})]},e.key)})})]})})]}),F&&s.jsxs("div",{className:"ziele-section",children:[s.jsxs("div",{className:"section-header clickable",onClick:()=>he("rechner"),children:[s.jsxs("div",{className:"section-title",children:[s.jsx(z,{size:20}),s.jsx("span",{children:"5-Jahres Finanzprognose"})]}),X.rechner?s.jsx(g,{size:20}):s.jsx(u,{size:20})]}),X.rechner&&s.jsxs("div",{className:"finanz-rechner",children:[s.jsxs("div",{className:"rechner-eingabe",children:[s.jsxs("div",{className:"eingabe-gruppe full-width",children:[s.jsx("label",{children:"Geplante Mitgliederzahlen pro Jahr"}),s.jsx("div",{className:"jahr-inputs",children:le.map(e=>s.jsxs("div",{className:"jahr-input-gruppe",children:[s.jsx("span",{className:"jahr-label",children:e}),s.jsx("input",{type:"number",min:"0",value:se.mitgliederPlanung[e]||0,onChange:s=>((e,s)=>{ae(a=>({...a,mitgliederPlanung:{...a.mitgliederPlanung,[e]:parseInt(s)||0}}))})(e,s.target.value)})]},e))})]}),s.jsxs("div",{className:"beitrags-gruppen",children:[s.jsx("label",{children:"Beitragsstruktur (basierend auf aktuellen Tarifen)"}),se.beitragsverteilung.map((e,a)=>s.jsxs("div",{className:"beitrags-gruppe",children:[s.jsx("span",{className:"gruppe-name",children:e.name}),s.jsxs("div",{className:"gruppe-info",children:[s.jsxs("span",{className:"gruppe-beitrag",children:[e.monatsbeitrag.toFixed(2)," EUR/Monat"]}),s.jsxs("span",{className:"gruppe-anteil",children:[e.anteil,"% Anteil"]})]})]},e.id||a))]})]}),s.jsx("div",{className:"prognose-tabelle",children:s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Jahr"}),s.jsx("th",{children:"Mitglieder"}),s.jsx("th",{children:"Monatlich"}),s.jsx("th",{children:"Jährlich"}),s.jsx("th",{children:"Wachstum"})]})}),s.jsx("tbody",{children:le.map((e,a)=>{const i=se.mitgliederPlanung[e]||0,l=oe(i),n=a>0?se.mitgliederPlanung[le[a-1]]||0:null,r=n?Math.round((i-n)/n*100):null;return s.jsxs("tr",{className:e===ie?"current-year":"",children:[s.jsx("td",{className:"jahr",children:e}),s.jsx("td",{className:"mitglieder",children:i.toLocaleString("de-DE")}),s.jsxs("td",{className:"monatlich",children:[l.monatlich.toLocaleString("de-DE",{minimumFractionDigits:2})," EUR"]}),s.jsxs("td",{className:"jaehrlich highlight",children:[l.jaehrlich.toLocaleString("de-DE",{minimumFractionDigits:2})," EUR"]}),s.jsx("td",{className:"wachstum "+(r&&r>0?"positive":r&&r<0?"negative":""),children:null!==r?s.jsxs(s.Fragment,{children:[r>0&&s.jsx(N,{size:14}),r<0&&s.jsx(k,{size:14}),r>=0?"+":"",r,"%"]}):"-"})]},e)})}),s.jsx("tfoot",{children:s.jsxs("tr",{children:[s.jsx("td",{colSpan:"3",className:"summe-label",children:"5-Jahres Gesamtsumme:"}),s.jsxs("td",{className:"summe-wert",colSpan:"2",children:[le.reduce((e,s)=>{const a=se.mitgliederPlanung[s]||0;return e+oe(a).jaehrlich},0).toLocaleString("de-DE",{minimumFractionDigits:2})," EUR"]})]})})]})})]})]})]})};export{E as Z};
