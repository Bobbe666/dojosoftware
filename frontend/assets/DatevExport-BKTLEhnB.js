import{j as e}from"./animation-1wuIdCBS.js";import{r as t}from"./vendor-router-BhMXg4Z-.js";import{b as n,a as r}from"./index-BJCk5MxH.js";import{bg as i,k as s,g as o,I as l,ax as a,w as d,F as p,v as x,o as c,q as g}from"./icons-C6KFH58b.js";import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";const h=()=>{var h;const{activeDojo:y}=n(),[f,j]=t.useState(!1),[m,b]=t.useState([]),[v,S]=t.useState(!1),[I,D]=t.useState(!0),[w,k]=t.useState("invoices"),[T,z]=t.useState({start:new Date((new Date).getFullYear(),(new Date).getMonth(),1).toISOString().split("T")[0],end:(new Date).toISOString().split("T")[0]}),E=(null==y?void 0:y.id)||y;t.useEffect(()=>{E&&"super-admin"!==E&&(R(),B())},[E]);const R=async()=>{var e;try{D(!0);const t=await r.get(`/integrations/status?dojo_id=${E}`);S((null==(e=t.data.datev)?void 0:e.configured)||!1)}catch(t){console.error("Fehler beim Prüfen der Konfiguration:",t),S(!1)}finally{D(!1)}},B=async()=>{try{const e=await r.get(`/integrations/datev/exports?dojo_id=${E}`);b(e.data.exports||[])}catch(e){console.error("Fehler beim Laden der Export-Historie:",e)}},C=[{key:"invoices",title:"Rechnungen",description:"Buchungsstapel mit allen Rechnungen",icon:e.jsx(p,{size:24})},{key:"payments",title:"Zahlungen",description:"Zahlungseingänge für den Zeitraum",icon:e.jsx(x,{size:24})},{key:"debitoren",title:"Debitoren",description:"Stammdaten aller Mitglieder",icon:e.jsx(c,{size:24})}];return I?e.jsx("div",{style:u.container,children:e.jsx("div",{style:u.loading,children:"Prüfe Konfiguration..."})}):e.jsxs("div",{style:u.container,children:[e.jsxs("div",{style:u.header,children:[e.jsx(i,{size:32,color:"#006633"}),e.jsxs("div",{children:[e.jsx("h2",{style:u.title,children:"DATEV Export"}),e.jsx("p",{style:u.subtitle,children:"Exportiere Buchungsdaten im DATEV-Format"})]})]}),!v&&e.jsxs("div",{style:u.warningBox,children:[e.jsx(s,{size:24}),e.jsxs("div",{children:[e.jsx("strong",{children:"DATEV nicht konfiguriert"}),e.jsx("p",{style:{margin:"4px 0 0 0"},children:"Bitte konfiguriere zuerst die Beraternummer und Mandantennummer in den Integration-Einstellungen."})]})]}),e.jsxs("div",{style:u.section,children:[e.jsx("h3",{style:u.sectionTitle,children:"1. Export-Typ wählen"}),e.jsx("div",{style:u.exportTypeGrid,children:C.map(t=>e.jsxs("button",{style:{...u.exportTypeCard,borderColor:w===t.key?"#ffd700":"rgba(255, 255, 255, 0.1)",background:w===t.key?"rgba(255, 215, 0, 0.1)":"rgba(255, 255, 255, 0.05)"},onClick:()=>k(t.key),children:[e.jsx("div",{style:{...u.exportTypeIcon,color:w===t.key?"#ffd700":"#888"},children:t.icon}),e.jsxs("div",{style:u.exportTypeInfo,children:[e.jsx("strong",{style:{color:w===t.key?"#ffd700":"#fff"},children:t.title}),e.jsx("span",{style:{color:"#888",fontSize:"12px"},children:t.description})]}),w===t.key&&e.jsx(o,{size:20,color:"#ffd700"})]},t.key))})]}),e.jsxs("div",{style:u.section,children:[e.jsx("h3",{style:u.sectionTitle,children:"2. Zeitraum wählen"}),e.jsxs("div",{style:u.dateRangeRow,children:[e.jsxs("div",{style:u.dateGroup,children:[e.jsx("label",{style:u.label,children:"Von"}),e.jsx("input",{type:"date",value:T.start,onChange:e=>z({...T,start:e.target.value}),style:u.dateInput})]}),e.jsxs("div",{style:u.dateGroup,children:[e.jsx("label",{style:u.label,children:"Bis"}),e.jsx("input",{type:"date",value:T.end,onChange:e=>z({...T,end:e.target.value}),style:u.dateInput})]}),e.jsxs("div",{style:u.presetButtons,children:[e.jsx("button",{style:u.presetButton,onClick:()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1);z({start:t.toISOString().split("T")[0],end:e.toISOString().split("T")[0]})},children:"Dieser Monat"}),e.jsx("button",{style:u.presetButton,onClick:()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth()-1,1),n=new Date(e.getFullYear(),e.getMonth(),0);z({start:t.toISOString().split("T")[0],end:n.toISOString().split("T")[0]})},children:"Letzter Monat"}),e.jsx("button",{style:u.presetButton,onClick:()=>{const e=new Date,t=new Date(e.getFullYear(),0,1);z({start:t.toISOString().split("T")[0],end:e.toISOString().split("T")[0]})},children:"Dieses Jahr"})]})]})]}),e.jsxs("div",{style:u.section,children:[e.jsx("h3",{style:u.sectionTitle,children:"3. Export starten"}),e.jsxs("div",{style:u.exportInfo,children:[e.jsx(l,{size:20}),e.jsx("p",{children:"Der Export wird im DATEV-EXTF-Format (ASCII) erstellt und kann direkt in DATEV Unternehmen Online oder DATEV Kanzlei-Rechnungswesen importiert werden."})]}),e.jsx("button",{style:{...u.exportButton,opacity:!v||f?.5:1},onClick:async()=>{var e,t,n,i;try{j(!0);const n=await r.get(`/integrations/datev/export/${w}?dojo_id=${E}&start=${T.start}&end=${T.end}`,{responseType:"blob"}),i=(null==(t=null==(e=n.headers["content-disposition"])?void 0:e.split("filename=")[1])?void 0:t.replace(/"/g,""))||`datev_${w}_${T.start}_${T.end}.csv`,s=window.URL.createObjectURL(new Blob([n.data])),o=document.createElement("a");o.href=s,o.setAttribute("download",i),document.body.appendChild(o),o.click(),o.parentNode.removeChild(o),window.URL.revokeObjectURL(s),B()}catch(s){console.error("Fehler beim Export:",s),alert("Export fehlgeschlagen: "+((null==(i=null==(n=s.response)?void 0:n.data)?void 0:i.error)||s.message))}finally{j(!1)}},disabled:!v||f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(a,{size:20,className:"spinning"})," Exportiere..."]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{size:20})," ",null==(h=C.find(e=>e.key===w))?void 0:h.title," exportieren"]})})]}),e.jsxs("div",{style:u.section,children:[e.jsx("h3",{style:u.sectionTitle,children:"Letzte Exporte"}),0===m.length?e.jsx("p",{style:{color:"#888",textAlign:"center",padding:"20px"},children:"Noch keine Exporte durchgeführt"}):e.jsx("div",{style:u.historyList,children:m.slice(0,10).map((t,n)=>e.jsxs("div",{style:u.historyItem,children:[e.jsxs("div",{style:u.historyIcon,children:["invoices"===t.export_type&&e.jsx(p,{size:18}),"payments"===t.export_type&&e.jsx(x,{size:18}),"debitoren"===t.export_type&&e.jsx(c,{size:18})]}),e.jsxs("div",{style:u.historyInfo,children:[e.jsxs("strong",{style:{color:"#fff"},children:["invoices"===t.export_type&&"Rechnungen","payments"===t.export_type&&"Zahlungen","debitoren"===t.export_type&&"Debitoren"]}),e.jsxs("span",{style:{color:"#888",fontSize:"12px"},children:[t.record_count," Datensätze | ",t.start_date," - ",t.end_date]})]}),e.jsxs("div",{style:u.historyDate,children:[e.jsx(g,{size:14}),e.jsx("span",{children:new Date(t.created_at).toLocaleDateString("de-DE")})]})]},n))})]}),e.jsxs("div",{style:u.helpSection,children:[e.jsx("h4",{style:{color:"#ffd700",margin:"0 0 12px 0"},children:"DATEV Import-Anleitung"}),e.jsxs("ol",{style:{margin:0,paddingLeft:"20px",color:"#aaa",lineHeight:1.8},children:[e.jsx("li",{children:"Exportiere die gewünschten Daten als CSV-Datei"}),e.jsx("li",{children:"Öffne DATEV Unternehmen Online oder Kanzlei-Rechnungswesen"}),e.jsx("li",{children:'Gehe zu "Stapelverarbeitung" → "ASCII-Import"'}),e.jsx("li",{children:"Wähle die heruntergeladene CSV-Datei"}),e.jsx("li",{children:"Prüfe die Vorschau und bestätige den Import"})]})]})]})},u={container:{padding:"24px",maxWidth:"900px",margin:"0 auto"},header:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"32px"},title:{color:"#006633",margin:0,fontSize:"24px"},subtitle:{color:"#aaa",margin:"4px 0 0 0",fontSize:"14px"},warningBox:{display:"flex",alignItems:"flex-start",gap:"16px",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"12px",padding:"20px",marginBottom:"24px",color:"#ef4444"},section:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 215, 0, 0.2)",borderRadius:"12px",padding:"24px",marginBottom:"20px"},sectionTitle:{color:"#ffd700",margin:"0 0 16px 0",fontSize:"16px"},exportTypeGrid:{display:"flex",flexDirection:"column",gap:"12px"},exportTypeCard:{display:"flex",alignItems:"center",gap:"16px",padding:"16px 20px",background:"transparent",border:"2px solid",borderRadius:"12px",cursor:"pointer",textAlign:"left",transition:"all 0.2s"},exportTypeIcon:{width:"48px",height:"48px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center"},exportTypeInfo:{flex:1,display:"flex",flexDirection:"column",gap:"4px"},dateRangeRow:{display:"flex",alignItems:"flex-end",gap:"16px",flexWrap:"wrap"},dateGroup:{display:"flex",flexDirection:"column",gap:"8px"},label:{color:"#888",fontSize:"13px"},dateInput:{padding:"12px 16px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid rgba(255, 215, 0, 0.3)",borderRadius:"8px",color:"#fff",fontSize:"14px"},presetButtons:{display:"flex",gap:"8px",marginLeft:"auto"},presetButton:{padding:"10px 16px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"#fff",fontSize:"13px",cursor:"pointer"},exportInfo:{display:"flex",alignItems:"flex-start",gap:"12px",background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:"8px",padding:"16px",marginBottom:"20px",color:"#aaa",fontSize:"14px"},exportButton:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",width:"100%",padding:"16px 24px",background:"#006633",border:"none",borderRadius:"12px",color:"#fff",fontWeight:"bold",fontSize:"16px",cursor:"pointer"},historyList:{display:"flex",flexDirection:"column",gap:"8px"},historyItem:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",background:"rgba(0, 0, 0, 0.2)",borderRadius:"8px"},historyIcon:{color:"#888"},historyInfo:{flex:1,display:"flex",flexDirection:"column",gap:"2px"},historyDate:{display:"flex",alignItems:"center",gap:"6px",color:"#888",fontSize:"12px"},helpSection:{background:"rgba(0, 102, 51, 0.1)",border:"1px solid rgba(0, 102, 51, 0.3)",borderRadius:"12px",padding:"20px"},loading:{textAlign:"center",padding:"60px",color:"#888"}};export{h as default};
