import{j as e}from"./animation-1wuIdCBS.js";import{r as t}from"./vendor-router-BhMXg4Z-.js";import{b as r,g as s,k as n}from"./index-BJCk5MxH.js";import{ab as a,P as i,aj as l,ak as o,X as d,N as c,aa as g,K as m,an as u,ao as h,ap as b,aq as x,al as p,Y as j,ar as y,ad as f,d as v,as as k,at as S,o as w,H as B}from"./icons-C6KFH58b.js";import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";const z={miete:B,personal:w,material:S,marketing:k,versicherung:v,gebuehren:f,fahrtkosten:y,telefon:j,software:p,fortbildung:x,reparatur:b,buero:h,sonstiges:u},A={miete:"Miete & Nebenkosten",personal:"Personalkosten",material:"Material & Ausstattung",marketing:"Marketing & Werbung",versicherung:"Versicherungen",gebuehren:"Gebühren & Beiträge",fahrtkosten:"Fahrtkosten",telefon:"Telefon & Internet",software:"Software & Lizenzen",fortbildung:"Fortbildung & Seminare",reparatur:"Reparaturen & Wartung",buero:"Büromaterial",sonstiges:"Sonstige Ausgaben"},C=()=>{const{activeDojo:h}=r(),[b,x]=t.useState(!0),[p,j]=t.useState([]),[y,f]=t.useState({anzahl:0,gesamt:0}),[v,k]=t.useState((new Date).getFullYear()),[S,w]=t.useState(null),[B,C]=t.useState(null),[N,W]=t.useState(!1),[D,I]=t.useState(null),[F,_]=t.useState({datum:(new Date).toISOString().split("T")[0],betrag:"",beschreibung:"",beleg_nummer:"",kategorie:"sonstiges"});t.useEffect(()=>{h&&E()},[h,v,S,B]);const E=async()=>{try{x(!0);const e=(null==h?void 0:h.dojo_id)||(null==h?void 0:h.id);let t=`${s.apiBaseUrl}/ausgaben?dojo_id=${e}&jahr=${v}`;S&&(t+=`&monat=${S}`),B&&(t+=`&kategorie=${B}`);const r=await n(t),a=await r.json();a.success&&(j(a.ausgaben),f(a.summen))}catch(e){console.error("Fehler beim Laden:",e)}finally{x(!1)}},T=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e||0),$=({kategorie:t})=>{const r=z[t]||u;return e.jsx(r,{size:16})};return e.jsxs("div",{className:"ausgaben-verwaltung",style:{padding:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1.5rem",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(a,{size:24}),"Ausgaben erfassen"]}),e.jsx("p",{style:{margin:"0.5rem 0 0 0",color:"var(--text-secondary)"},children:"Betriebsausgaben für die EÜR verwalten"})]}),e.jsxs("button",{onClick:()=>{W(!0),I(null),_({datum:(new Date).toISOString().split("T")[0],betrag:"",beschreibung:"",beleg_nummer:"",kategorie:"sonstiges"})},className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(i,{size:18}),"Neue Ausgabe"]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"1.5rem",flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>k(e=>e-1),className:"btn btn-icon",children:e.jsx(l,{size:18})}),e.jsx("span",{style:{fontWeight:"600",minWidth:"50px",textAlign:"center"},children:v}),e.jsx("button",{onClick:()=>k(e=>e+1),className:"btn btn-icon",disabled:v>=(new Date).getFullYear(),children:e.jsx(o,{size:18})})]}),e.jsx("select",{value:S||"",onChange:e=>w(e.target.value?parseInt(e.target.value):null),className:"form-select",style:{minWidth:"150px"},children:["Alle Monate","Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"].map((t,r)=>e.jsx("option",{value:0===r?"":r,children:t},r))}),e.jsxs("select",{value:B||"",onChange:e=>C(e.target.value||null),className:"form-select",style:{minWidth:"180px"},children:[e.jsx("option",{value:"",children:"Alle Kategorien"}),Object.entries(A).map(([t,r])=>e.jsx("option",{value:t,children:r},t))]})]}),e.jsxs("div",{style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",marginBottom:"1.5rem",border:"1px solid var(--border-primary)",display:"flex",gap:"2rem",flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Anzahl Ausgaben"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700"},children:y.anzahl})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Gesamt"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"var(--error)"},children:T(y.gesamt)})]})]}),N&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.5rem",width:"100%",maxWidth:"500px",margin:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{margin:0},children:D?"Ausgabe bearbeiten":"Neue Ausgabe"}),e.jsx("button",{onClick:()=>W(!1),className:"btn btn-icon",children:e.jsx(d,{size:20})})]}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),F.betrag&&F.beschreibung)try{const e=(null==h?void 0:h.dojo_id)||(null==h?void 0:h.id),t=D?`${s.apiBaseUrl}/ausgaben/${D}`:`${s.apiBaseUrl}/ausgaben`,r=D?"PUT":"POST",a=await n(t,{method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify({...F,dojo_id:e})}),i=await a.json();i.success?(W(!1),I(null),_({datum:(new Date).toISOString().split("T")[0],betrag:"",beschreibung:"",beleg_nummer:"",kategorie:"sonstiges"}),E()):alert(i.error||"Fehler beim Speichern")}catch(t){console.error("Fehler:",t),alert("Fehler beim Speichern")}else alert("Bitte Betrag und Beschreibung eingeben")},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontSize:"0.9rem"},children:"Datum *"}),e.jsx("input",{type:"date",value:F.datum,onChange:e=>_({...F,datum:e.target.value}),className:"form-input",required:!0,style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontSize:"0.9rem"},children:"Betrag (EUR) *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:F.betrag,onChange:e=>_({...F,betrag:e.target.value}),className:"form-input",placeholder:"0,00",required:!0,style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontSize:"0.9rem"},children:"Kategorie"}),e.jsx("select",{value:F.kategorie,onChange:e=>_({...F,kategorie:e.target.value}),className:"form-select",style:{width:"100%"},children:Object.entries(A).map(([t,r])=>e.jsx("option",{value:t,children:r},t))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontSize:"0.9rem"},children:"Beschreibung *"}),e.jsx("input",{type:"text",value:F.beschreibung,onChange:e=>_({...F,beschreibung:e.target.value}),className:"form-input",placeholder:"z.B. Miete Januar 2026",required:!0,style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.25rem",fontSize:"0.9rem"},children:"Belegnummer (optional)"}),e.jsx("input",{type:"text",value:F.beleg_nummer,onChange:e=>_({...F,beleg_nummer:e.target.value}),className:"form-input",placeholder:"z.B. RE-2026-001",style:{width:"100%"}})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:()=>W(!1),className:"btn btn-secondary",style:{flex:1},children:"Abbrechen"}),e.jsxs("button",{type:"submit",className:"btn btn-primary",style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(c,{size:18}),"Speichern"]})]})]})})]})}),e.jsx("div",{style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",border:"1px solid var(--border-primary)",overflow:"hidden"},children:b?e.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Lade Ausgaben..."})]}):0===p.length?e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"var(--text-secondary)"},children:[e.jsx(a,{size:48,style:{opacity:.3,marginBottom:"1rem"}}),e.jsx("p",{children:"Keine Ausgaben für den gewählten Zeitraum"})]}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Datum"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Kategorie"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Beschreibung"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Beleg"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600"},children:"Betrag"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center",fontWeight:"600"},children:"Aktionen"})]})}),e.jsx("tbody",{children:p.map(t=>{return e.jsxs("tr",{style:{borderBottom:"1px solid var(--border-secondary)"},children:[e.jsx("td",{style:{padding:"0.75rem"},children:(r=t.datum,r?new Date(r).toLocaleDateString("de-DE"):"-")}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx($,{kategorie:t.kategorie}),A[t.kategorie]||t.kategorie]})}),e.jsx("td",{style:{padding:"0.75rem"},children:t.beschreibung}),e.jsx("td",{style:{padding:"0.75rem",color:"var(--text-secondary)"},children:t.beleg_nummer||"-"}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600",color:"var(--error)"},children:T(t.betrag)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:"0.25rem",justifyContent:"center"},children:[e.jsx("button",{onClick:()=>(e=>{var t,r;_({datum:(null==(t=e.datum)?void 0:t.split("T")[0])||"",betrag:(null==(r=e.betrag)?void 0:r.toString())||"",beschreibung:e.beschreibung||"",beleg_nummer:e.beleg_nummer||"",kategorie:e.kategorie||"sonstiges"}),I(e.id),W(!0)})(t),className:"btn btn-icon",title:"Bearbeiten",children:e.jsx(g,{size:16})}),e.jsx("button",{onClick:()=>(async e=>{if(confirm("Ausgabe wirklich löschen?"))try{const t=await n(`${s.apiBaseUrl}/ausgaben/${e}`,{method:"DELETE"}),r=await t.json();r.success?E():alert(r.error||"Fehler beim Löschen")}catch(t){console.error("Fehler:",t),alert("Fehler beim Löschen")}})(t.id),className:"btn btn-icon",title:"Löschen",style:{color:"var(--error)"},children:e.jsx(m,{size:16})})]})})]},t.id);var r})})]})})})]})};export{C as default};
