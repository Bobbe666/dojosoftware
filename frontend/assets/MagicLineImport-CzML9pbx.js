import{j as e}from"./animation-1wuIdCBS.js";import{r as s}from"./vendor-router-BhMXg4Z-.js";import{bk as t,F as r,bd as a,bc as l,k as i,g as n,o as d,v as o}from"./icons-C6KFH58b.js";import"./vendor-react-DtuzQOD1.js";const c=()=>{var c;const[m,x]=s.useState(null),[g,p]=s.useState(!1),[h,u]=s.useState(null),[b,j]=s.useState(null);return e.jsx("div",{className:"container mx-auto p-6 max-w-6xl",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(t,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"MagicLine Import"}),e.jsx("p",{className:"text-gray-600",children:"Importiere Mitglieder, VertrÃ¤ge und Dokumente aus MagicLine"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(r,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-semibold mb-2",children:"So funktioniert der Import:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:"Exportiere deine Daten aus MagicLine als ZIP-Datei"}),e.jsx("li",{children:"Lade die ZIP-Datei hier hoch"}),e.jsxs("li",{children:["Das System importiert automatisch:",e.jsxs("ul",{className:"list-disc list-inside ml-6 mt-1",children:[e.jsx("li",{children:"Mitgliederdaten (Name, Adresse, Geburtsdatum, etc.)"}),e.jsx("li",{children:"Vertragsdaten (Original-Startdatum, Laufzeit, Tarif)"}),e.jsx("li",{children:"SEPA-Mandate (Bankverbindung, Mandatsreferenz)"}),e.jsx("li",{children:"PDF-Dokumente (VertrÃ¤ge, SEPA-Mandate)"})]})]})]})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"MagicLine Export (ZIP-Datei)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"file",accept:".zip",onChange:e=>{const s=e.target.files[0];s&&s.name.endsWith(".zip")?(x(s),j(null)):(j("Bitte wÃ¤hle eine ZIP-Datei aus"),x(null))},disabled:g,className:"block w-full text-sm text-gray-500\n                  file:mr-4 file:py-2 file:px-4\n                  file:rounded-lg file:border-0\n                  file:text-sm file:font-semibold\n                  file:bg-blue-50 file:text-blue-700\n                  hover:file:bg-blue-100\n                  disabled:opacity-50 disabled:cursor-not-allowed"})}),e.jsx("button",{onClick:async()=>{if(!m)return void j("Bitte wÃ¤hle zuerst eine Datei aus");console.log("ðŸš€ Starting import...",{fileName:m.name,fileSize:`${(m.size/1024/1024).toFixed(2)} MB`,fileType:m.type}),p(!0),j(null);const e=new FormData;e.append("zipFile",m);try{const s=localStorage.getItem("dojo_auth_token");console.log("ðŸ“¤ Uploading to /api/magicline-import/upload...");const t=await fetch("/api/magicline-import/upload",{method:"POST",headers:{Authorization:`Bearer ${s}`},body:e});console.log("ðŸ“¥ Response received:",{status:t.status,statusText:t.statusText,contentType:t.headers.get("content-type")});const r=t.headers.get("content-type");if(!r||!r.includes("application/json")){const e=await t.text();throw console.error("âŒ Non-JSON response:",e.substring(0,500)),new Error(`Server-Fehler: ${e.substring(0,200)}`)}const a=await t.json();if(console.log("âœ… Import data:",a),!t.ok)throw new Error(a.error||"Import fehlgeschlagen");u(a.results),x(null)}catch(s){console.error("âŒ Import error:",s),j(s.message)}finally{p(!1)}},disabled:!m||g,className:"px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold\n                hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed\n                flex items-center gap-2 transition-colors",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Importiere..."]}):e.jsxs(e.Fragment,{children:[e.jsx(a,{className:"w-5 h-5"}),"Import starten"]})})]}),m&&!g&&e.jsxs("p",{className:"mt-2 text-sm text-green-600 flex items-center gap-2",children:[e.jsx(l,{className:"w-4 h-4"}),"Datei ausgewÃ¤hlt: ",m.name," (",(m.size/1024/1024).toFixed(2)," MB)"]})]}),b&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(i,{className:"w-5 h-5"}),e.jsx("p",{className:"font-semibold",children:b})]})}),h&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-800 mb-3",children:[e.jsx(n,{className:"w-5 h-5"}),e.jsx("p",{className:"font-semibold",children:"Import erfolgreich abgeschlossen!"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(d,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Mitglieder"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[h.successful," / ",h.totalMembers]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(r,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"VertrÃ¤ge"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:h.logs.filter(e=>{var s;return null==(s=e.imported)?void 0:s.contract}).length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(o,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"SEPA-Mandate"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:h.logs.filter(e=>{var s;return null==(s=e.imported)?void 0:s.sepaMandate}).length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(l,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Dokumente"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:h.logs.reduce((e,s)=>{var t;return e+((null==(t=s.imported)?void 0:t.documents)||0)},0)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(o,{className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Zahlungen"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:h.logs.reduce((e,s)=>{var t;return e+((null==(t=s.imported)?void 0:t.payments)||0)},0)})]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-3",children:["Dauer: ",null==(c=h.duration)?void 0:c.toFixed(1)," Sekunden"]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Import-Details"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:h.logs.map((s,t)=>{var r,a,l,d,o;return e.jsxs("div",{className:"p-3 rounded-lg border "+(s.success?"bg-white border-green-200":"bg-red-50 border-red-200"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.success?e.jsx(n,{className:"w-4 h-4 text-green-600"}):e.jsx(i,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"font-medium text-gray-800",children:s.memberNumber})]}),e.jsxs("div",{className:"flex gap-2 text-xs flex-wrap",children:[(null==(r=s.imported)?void 0:r.member)&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded",children:"Mitglied"}),(null==(a=s.imported)?void 0:a.contract)&&e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 rounded",children:"Vertrag"}),(null==(l=s.imported)?void 0:l.sepaMandate)&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded",children:"SEPA"}),(null==(d=s.imported)?void 0:d.payments)>0&&e.jsxs("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-700 rounded",children:[s.imported.payments," Zahl."]}),(null==(o=s.imported)?void 0:o.documents)>0&&e.jsxs("span",{className:"px-2 py-1 bg-orange-100 text-orange-700 rounded",children:[s.imported.documents," Dok."]})]})]}),s.errors&&s.errors.length>0&&e.jsx("div",{className:"mt-2 text-sm text-red-600",children:s.errors.map((s,t)=>e.jsxs("p",{children:["â€¢ ",s]},t))}),s.warnings&&s.warnings.length>0&&e.jsx("div",{className:"mt-2 text-sm text-yellow-600",children:s.warnings.map((s,t)=>e.jsxs("p",{children:["â€¢ ",s]},t))})]},t)})})]}),e.jsx("button",{onClick:()=>u(null),className:"w-full py-2 bg-gray-100 text-gray-700 rounded-lg font-medium\n                hover:bg-gray-200 transition-colors",children:"Neuen Import starten"})]})]})})};export{c as default};
