import{j as e}from"./animation-1wuIdCBS.js";import{r}from"./vendor-router-BhMXg4Z-.js";import{b as n,g as s,k as i}from"./index-BJCk5MxH.js";import{ai as t,aj as a,ak as l,w as d,F as o,p as m,ab as c,D as h,x as g,o as x,al as u,v as j,am as v}from"./icons-C6KFH58b.js";import{R as p,h as y,C as b,X as f,Y as S,T as k,L as w,b as z,g as A}from"./charts-CuVbSI8O.js";import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";const E=({isTDA:E=!1})=>{var R,_,F,D,C,N,I,U,W,$,B,L,T,V,M,K,P,O,Y,G,J,X;const{activeDojo:q}=n(),[H,Q]=r.useState(!0),[Z,ee]=r.useState(null),[re,ne]=r.useState((new Date).getFullYear()),[se,ie]=r.useState(null),[te,ae]=r.useState(null);r.useEffect(()=>{le()},[re,q,E]);const le=async()=>{try{Q(!0),ee(null);const e=E?`${s.apiBaseUrl}/euer/tda?jahr=${re}`:`${s.apiBaseUrl}/euer/dojo/${(null==q?void 0:q.dojo_id)||(null==q?void 0:q.id)}?jahr=${re}`,r=await i(e);if(!r.ok)throw new Error("Fehler beim Laden der EÜR-Daten");const n=await r.json();if(!n.success)throw new Error(n.error||"Unbekannter Fehler");ie(n)}catch(e){console.error("EÜR Fehler:",e),ee(e.message)}finally{Q(!1)}},de=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e||0),oe=e=>new Date(2024,e-1,1).toLocaleString("de-DE",{month:"short"}),me=(null==(R=null==se?void 0:se.monate)?void 0:R.map(e=>({name:oe(e.monat),monat:e.monat,einnahmen:e.einnahmen.gesamt,ausgaben:e.ausgaben.gesamt,ueberschuss:e.ueberschuss})))||[];!E||!(null==se?void 0:se.monate)||se.monate.map(e=>({name:oe(e.monat),mitglieder:e.einnahmen.mitglieder||0,verband:e.einnahmen.verbandsmitgliedschaften||0,software:e.einnahmen.software_lizenzen||0,rechnungen:e.einnahmen.rechnungen||0,verkaeufe:e.einnahmen.verkaeufe||0}));const ce=({active:r,payload:n,label:s})=>r&&n&&n.length?e.jsxs("div",{className:"chart-tooltip",style:{backgroundColor:"var(--bg-modal)",border:"1px solid var(--border-primary)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.3)"},children:[e.jsx("p",{style:{fontWeight:"600",marginBottom:"8px"},children:s}),n.map((r,n)=>e.jsxs("p",{style:{color:r.color,margin:"4px 0"},children:[r.name,": ",de(r.value)]},n))]}):null;return H?e.jsxs("div",{className:"loading-container",style:{padding:"2rem",textAlign:"center"},children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Lade EÜR-Daten..."})]}):Z?e.jsxs("div",{className:"error-container",style:{padding:"2rem",textAlign:"center",color:"var(--error)"},children:[e.jsxs("p",{children:["Fehler: ",Z]}),e.jsx("button",{onClick:le,className:"btn btn-primary",style:{marginTop:"1rem"},children:"Erneut versuchen"})]}):e.jsxs("div",{className:"euer-uebersicht",children:[e.jsxs("div",{className:"euer-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(t,{size:24}),"EÜR - Einnahmen-Überschuss-Rechnung",E&&e.jsx("span",{style:{backgroundColor:"var(--primary)",color:"white",padding:"2px 8px",borderRadius:"4px",fontSize:"0.7rem",marginLeft:"0.5rem"},children:"TDA"})]}),e.jsx("p",{style:{margin:"0.5rem 0 0 0",color:"var(--text-secondary)"},children:E?"Tiger & Dragon Association International":(null==q?void 0:q.dojoname)||"Dojo"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>ne(e=>e-1),className:"btn btn-icon",title:"Vorheriges Jahr",children:e.jsx(a,{size:20})}),e.jsx("span",{style:{fontWeight:"600",fontSize:"1.1rem",minWidth:"60px",textAlign:"center"},children:re}),e.jsx("button",{onClick:()=>ne(e=>e+1),className:"btn btn-icon",disabled:re>=(new Date).getFullYear(),title:"Nächstes Jahr",children:e.jsx(l,{size:20})})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("button",{onClick:async()=>{try{const e=E?`${s.apiBaseUrl}/euer/export/tda?jahr=${re}`:`${s.apiBaseUrl}/euer/export/${(null==q?void 0:q.dojo_id)||(null==q?void 0:q.id)}?jahr=${re}`,r=await i(e),n=await r.blob(),t=window.URL.createObjectURL(n),a=document.createElement("a");a.href=t,a.download=`EUER_${E?"TDA":"Dojo"}_${re}.csv`,document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(t)}catch(e){console.error("Export Fehler:",e),alert("Fehler beim Export")}},className:"btn btn-secondary",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(d,{size:16}),"CSV"]}),e.jsxs("button",{onClick:async()=>{try{const e=E?`${s.apiBaseUrl}/euer/pdf/tda?jahr=${re}`:`${s.apiBaseUrl}/euer/pdf/dojo/${(null==q?void 0:q.dojo_id)||(null==q?void 0:q.id)}?jahr=${re}`,r=await i(e),n=r.headers.get("content-type");if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(e.error||e.details||"PDF-Generierung fehlgeschlagen")}if(!n||!n.includes("application/pdf"))throw new Error("Server hat kein PDF zurückgegeben");const t=await r.blob(),a=window.URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=`EUER_${E?"TDA_International":(null==q?void 0:q.dojoname)||"Dojo"}_${re}.pdf`,document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(a)}catch(e){console.error("PDF Export Fehler:",e),alert("Fehler beim PDF-Export: "+e.message)}},className:"btn btn-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(o,{size:16}),"PDF für Finanzamt"]})]})]})]}),e.jsxs("div",{className:"euer-summary-cards",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"2rem"},children:[e.jsxs("div",{className:"stat-card",style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",border:"1px solid var(--border-primary)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx(m,{size:20,color:"var(--success)"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:["Einnahmen ",re]})]}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"var(--success)"},children:de(null==(_=null==se?void 0:se.jahresSumme)?void 0:_.einnahmen_gesamt)})]}),e.jsxs("div",{className:"stat-card",style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",border:"1px solid var(--border-primary)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx(c,{size:20,color:"var(--error)"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:["Ausgaben ",re]})]}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:"var(--error)"},children:de(null==(F=null==se?void 0:se.jahresSumme)?void 0:F.ausgaben_gesamt)})]}),e.jsxs("div",{className:"stat-card",style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",border:"1px solid var(--border-primary)",borderLeft:"4px solid "+(((null==(D=null==se?void 0:se.jahresSumme)?void 0:D.ueberschuss)||0)>=0?"var(--success)":"var(--error)")},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx(h,{size:20}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:["Überschuss ",re]})]}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700",color:((null==(C=null==se?void 0:se.jahresSumme)?void 0:C.ueberschuss)||0)>=0?"var(--success)":"var(--error)"},children:de(null==(N=null==se?void 0:se.jahresSumme)?void 0:N.ueberschuss)})]}),E&&(null==se?void 0:se.statistiken)&&e.jsxs("div",{className:"stat-card",style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",border:"1px solid var(--border-primary)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx(g,{size:20,color:"var(--primary)"}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Verbandsmitglieder"})]}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"700"},children:se.statistiken.aktive_verbandsmitglieder.gesamt}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[se.statistiken.aktive_verbandsmitglieder.dojos," Dojos, ",se.statistiken.aktive_verbandsmitglieder.einzelpersonen," Einzelpersonen"]})]})]}),E&&e.jsxs("div",{className:"euer-einnahmen-breakdown",style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",border:"1px solid var(--border-primary)",marginBottom:"2rem"},children:[e.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Einnahmen nach Kategorie"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(x,{size:18,color:"#10b981"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Mitgliedsbeiträge"}),e.jsx("div",{style:{fontWeight:"600"},children:de(null==(I=null==se?void 0:se.jahresSumme)?void 0:I.einnahmen_mitglieder)})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(g,{size:18,color:"#3b82f6"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Verbandsmitgliedschaften"}),e.jsx("div",{style:{fontWeight:"600"},children:de(null==(U=null==se?void 0:se.jahresSumme)?void 0:U.einnahmen_verband)})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(u,{size:18,color:"#8b5cf6"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Software-Lizenzen"}),e.jsx("div",{style:{fontWeight:"600"},children:de(null==(W=null==se?void 0:se.jahresSumme)?void 0:W.einnahmen_software)})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(j,{size:18,color:"#f59e0b"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Rechnungen"}),e.jsx("div",{style:{fontWeight:"600"},children:de(null==($=null==se?void 0:se.jahresSumme)?void 0:$.einnahmen_rechnungen)})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(v,{size:18,color:"#ef4444"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Verkäufe/Kasse"}),e.jsx("div",{style:{fontWeight:"600"},children:de(null==(B=null==se?void 0:se.jahresSumme)?void 0:B.einnahmen_verkaeufe)})]})]})]})]}),e.jsxs("div",{className:"euer-chart",style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",border:"1px solid var(--border-primary)",marginBottom:"2rem"},children:[e.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Monatlicher Verlauf"}),e.jsx(p,{width:"100%",height:300,children:e.jsxs(y,{data:me,children:[e.jsx(b,{strokeDasharray:"3 3",stroke:"var(--border-secondary)"}),e.jsx(f,{dataKey:"name",tick:{fill:"var(--text-secondary)"}}),e.jsx(S,{tick:{fill:"var(--text-secondary)"},tickFormatter:e=>Math.abs(e||0)>=1e3?new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:1}).format(e/1e3)+"k":de(e)}),e.jsx(k,{content:e.jsx(ce,{})}),e.jsx(w,{}),e.jsx(z,{dataKey:"einnahmen",name:"Einnahmen",fill:"#10b981",radius:[4,4,0,0]}),e.jsx(z,{dataKey:"ausgaben",name:"Ausgaben",fill:"#ef4444",radius:[4,4,0,0]}),e.jsx(A,{type:"monotone",dataKey:"ueberschuss",name:"Überschuss",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6"}})]})})]}),e.jsxs("div",{className:"euer-table",style:{backgroundColor:"var(--bg-card)",borderRadius:"12px",padding:"1.25rem",border:"1px solid var(--border-primary)",overflowX:"auto"},children:[e.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Monatliche Übersicht"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"2px solid var(--border-primary)"},children:[e.jsx("th",{style:{textAlign:"left",padding:"0.75rem 0.5rem"},children:"Monat"}),E?e.jsxs(e.Fragment,{children:[e.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:"Mitglieder"}),e.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:"Verband"}),e.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:"Software"})]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:"Beiträge"}),e.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:"Rechnungen"}),e.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:"Verkäufe"})]}),e.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem",color:"var(--success)"},children:"Einnahmen"}),e.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem",color:"var(--error)"},children:"Ausgaben"}),e.jsx("th",{style:{textAlign:"right",padding:"0.75rem 0.5rem",fontWeight:"700"},children:"Überschuss"})]})}),e.jsxs("tbody",{children:[null==(L=null==se?void 0:se.monate)?void 0:L.map(r=>e.jsxs("tr",{style:{borderBottom:"1px solid var(--border-secondary)",backgroundColor:te===r.monat?"var(--bg-hover)":"transparent",cursor:"pointer"},onClick:()=>ae(te===r.monat?null:r.monat),children:[e.jsx("td",{style:{padding:"0.75rem 0.5rem",fontWeight:"500"},children:r.monat_name}),E?e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(r.einnahmen.mitglieder)}),e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(r.einnahmen.verbandsmitgliedschaften)}),e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(r.einnahmen.software_lizenzen)})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(r.einnahmen.beitraege)}),e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(r.einnahmen.rechnungen)}),e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(r.einnahmen.verkaeufe)})]}),e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem",color:"var(--success)",fontWeight:"500"},children:de(r.einnahmen.gesamt)}),e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem",color:"var(--error)"},children:de(r.ausgaben.gesamt)}),e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem",fontWeight:"700",color:r.ueberschuss>=0?"var(--success)":"var(--error)"},children:de(r.ueberschuss)})]},r.monat)),e.jsxs("tr",{style:{borderTop:"2px solid var(--border-primary)",backgroundColor:"var(--bg-secondary)",fontWeight:"700"},children:[e.jsxs("td",{style:{padding:"0.75rem 0.5rem"},children:["GESAMT ",re]}),E?e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(null==(T=null==se?void 0:se.jahresSumme)?void 0:T.einnahmen_mitglieder)}),e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(null==(V=null==se?void 0:se.jahresSumme)?void 0:V.einnahmen_verband)}),e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(null==(M=null==se?void 0:se.jahresSumme)?void 0:M.einnahmen_software)})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(null==(K=null==se?void 0:se.jahresSumme)?void 0:K.einnahmen_beitraege)}),e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(null==(P=null==se?void 0:se.jahresSumme)?void 0:P.einnahmen_rechnungen)}),e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem"},children:de(null==(O=null==se?void 0:se.jahresSumme)?void 0:O.einnahmen_verkaeufe)})]}),e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem",color:"var(--success)"},children:de(null==(Y=null==se?void 0:se.jahresSumme)?void 0:Y.einnahmen_gesamt)}),e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem",color:"var(--error)"},children:de(null==(G=null==se?void 0:se.jahresSumme)?void 0:G.ausgaben_gesamt)}),e.jsx("td",{style:{textAlign:"right",padding:"0.75rem 0.5rem",color:((null==(J=null==se?void 0:se.jahresSumme)?void 0:J.ueberschuss)||0)>=0?"var(--success)":"var(--error)"},children:de(null==(X=null==se?void 0:se.jahresSumme)?void 0:X.ueberschuss)})]})]})]})]})]})};export{E as default};
