import{j as e}from"./animation-1wuIdCBS.js";import{u as s,r as a}from"./vendor-router-BhMXg4Z-.js";import{k as n,g as t}from"./index-BJCk5MxH.js";import{O as r,F as l,ax as i,k as c,o as d,D as h,C as o,v as x,j as m,w as j,g as u,q as f,av as g}from"./icons-C6KFH58b.js";import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";const b=({embedded:u=!1})=>{const f=s(),[g,b]=a.useState(!1),[p,v]=a.useState(null),[N,z]=a.useState([]),[w,k]=a.useState("csv"),[S,y]=a.useState((new Date).getMonth()+1),[E,A]=a.useState((new Date).getFullYear()),L=async()=>{try{b(!0);const s=await n(`${t.apiBaseUrl}/lastschriftlauf/preview`);if(!s.ok){let a="Fehler beim Laden der Vorschau";try{const e=await s.json();a=e.details||e.error||a,console.error("‚ùå API Error Response:",e)}catch(e){console.error("‚ùå Response Status:",s.status,s.statusText)}throw new Error(a)}const a=s.headers.get("content-type");if(!a||!a.includes("application/json"))throw new Error("Ung√ºltige Antwort vom Server");const r=await s.json();if(!r.success&&r.error)throw new Error(r.error+(r.details?": "+r.details:""));v(r),b(!1)}catch(s){console.error("‚ùå Fehler beim Laden der Vorschau:",s),console.error("‚ùå Error Stack:",s.stack),alert("Fehler beim Laden der Vorschau: "+s.message),b(!1)}};a.useEffect(()=>{L(),(async()=>{try{const e=await n(`${t.apiBaseUrl}/lastschriftlauf/missing-mandates`);if(e.ok){const s=await e.json();z(s.members||[])}}catch(e){console.error("Fehler beim Laden fehlender Mandate:",e)}})()},[]);const C=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e||0),D=e=>["Januar","Februar","M√§rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"][e-1];return e.jsxs("div",{className:"lastschriftlauf-container",children:[!u&&e.jsxs("div",{className:"lastschriftlauf-header",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:()=>f("/dashboard/beitraege"),style:{padding:"0.4rem 0.75rem",fontSize:"0.85rem"},children:[e.jsx(r,{size:16}),"Zur√ºck"]}),e.jsxs("div",{children:[e.jsx("h1",{children:"üí∂ SEPA-Lastschriftlauf"}),e.jsx("p",{children:"Monatliche Lastschriften generieren und an Bank √ºbermitteln"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("button",{className:"btn btn-secondary",onClick:()=>f("/dashboard/zahllaeufe"),style:{padding:"0.4rem 0.75rem",fontSize:"0.85rem"},children:[e.jsx(l,{size:16}),"Zahll√§ufe-√úbersicht"]}),e.jsxs("button",{className:"btn btn-info",onClick:L,disabled:g,style:{padding:"0.4rem 0.75rem",fontSize:"0.85rem"},children:[e.jsx(i,{size:16}),"Aktualisieren"]})]})]}),e.jsxs("div",{className:"main-layout-container",children:[e.jsxs("div",{className:"left-section",children:[e.jsxs("div",{className:"info-box compact",children:[e.jsx(c,{size:20}),e.jsxs("div",{children:[e.jsx("h3",{children:"SEPA-Lastschriftverfahren"}),e.jsxs("p",{children:["Der Lastschriftlauf generiert eine Datei mit allen aktiven SEPA-Mandaten. Diese Datei kann direkt in Ihre Online-Banking Software oder bei Ihrer Bank importiert werden.",e.jsx("strong",{children:' Nur Mitglieder mit aktivem SEPA-Mandat und Zahlungsmethode "SEPA-Lastschrift" werden ber√ºcksichtigt.'})]})]})]}),p&&e.jsxs("div",{className:"stats-grid-compact",children:[e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(d,{size:16})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Aktive Mandate"}),e.jsx("p",{className:"stat-value",children:p.count}),e.jsx("span",{className:"stat-trend",children:"SEPA-Lastschriften"})]})]}),e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(h,{size:16})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Gesamtbetrag"}),e.jsx("p",{className:"stat-value",children:C(p.total_amount)}),e.jsx("span",{className:"stat-trend",children:"Monatlich"})]})]}),e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(o,{size:16})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Abrechnungsmonat"}),e.jsx("p",{className:"stat-value",children:D(S)}),e.jsx("span",{className:"stat-trend",children:E})]})]}),e.jsxs("div",{className:"stat-card positive",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(x,{size:16})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Bank / Anbieter"}),e.jsx("p",{className:"stat-value",children:p.primary_bank||"Gemischte Banken"}),e.jsx("span",{className:"stat-trend",children:p.count>0?"Export bereit":"Keine Mandate"})]})]})]})]}),N.length>0&&e.jsx("div",{className:"right-section",children:e.jsxs("div",{className:"warning-box",children:[e.jsx(c,{size:24}),e.jsxs("div",{children:[e.jsxs("h3",{children:["‚ö†Ô∏è Fehlende SEPA-Mandate (",N.length,")"]}),e.jsxs("p",{children:['Die folgenden Mitglieder haben Vertr√§ge mit Zahlungsmethode "Lastschrift", aber ',e.jsx("strong",{children:"kein aktives SEPA-Mandat"}),". Lastschriften k√∂nnen f√ºr diese Mitglieder nicht durchgef√ºhrt werden:"]}),e.jsxs("div",{className:"missing-mandates-list",children:[N.slice(0,5).map(s=>e.jsxs("div",{className:"missing-mandate-item",onClick:()=>f(`/dashboard/mitglieder/${s.mitglied_id}`),style:{cursor:"pointer"},children:[e.jsxs("span",{className:"member-name",children:[s.vorname," ",s.nachname," (ID: ",s.mitglied_id,")"]}),e.jsxs("span",{className:"contract-count",children:[s.anzahl_vertraege," Vertrag",s.anzahl_vertraege>1?"e":""]})]},s.mitglied_id)),N.length>5&&e.jsxs("div",{className:"more-info",children:["... und ",N.length-5," weitere"]})]}),e.jsx("button",{className:"logout-button",onClick:()=>f("/dashboard/sepa-mandate"),style:{marginTop:"1rem"},children:"SEPA-Mandate verwalten"})]})]})})]}),e.jsxs("div",{className:"export-config-card",children:[e.jsx("h2",{children:"Export Konfiguration"}),e.jsxs("div",{className:"config-single-row",children:[e.jsxs("div",{className:"form-field-inline",children:[e.jsxs("label",{children:[e.jsx(l,{size:14}),"Export Format"]}),e.jsxs("select",{value:w,onChange:e=>k(e.target.value),className:"form-select-compact",children:[e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"xml",children:"SEPA XML pain.008 (Standard)"})]})]}),e.jsxs("div",{className:"form-field-inline",children:[e.jsxs("label",{children:[e.jsx(o,{size:14}),"Abrechnungsmonat"]}),e.jsx("select",{value:S,onChange:e=>y(parseInt(e.target.value)),className:"form-select-compact",children:[...Array(12)].map((s,a)=>e.jsx("option",{value:a+1,children:D(a+1)},a+1))})]}),e.jsxs("div",{className:"form-field-inline",children:[e.jsx("label",{children:"Jahr"}),e.jsxs("select",{value:E,onChange:e=>A(parseInt(e.target.value)),className:"form-select-compact",children:[e.jsx("option",{value:2024,children:"2024"}),e.jsx("option",{value:2025,children:"2025"}),e.jsx("option",{value:2026,children:"2026"})]})]}),e.jsxs("button",{className:"logout-button",onClick:L,disabled:g,style:{whiteSpace:"nowrap"},children:[e.jsx(m,{size:16}),g?"L√§dt...":"Vorschau aktualisieren"]}),e.jsxs("button",{className:"logout-button",onClick:()=>{if(!p||0===p.count)return void alert("Keine Lastschriften zum Exportieren vorhanden");const e=`SEPA-Lastschriftlauf exportieren?\n\nFormat: ${w.toUpperCase()}\nMonat: ${S}/${E}\nAnzahl Mandate: ${p.count}\nGesamtbetrag: ‚Ç¨${p.total_amount}\n\nDie Datei wird heruntergeladen und kann in Ihre Banking-Software importiert werden.`;window.confirm(e)&&("csv"===w?window.open(`${t.apiBaseUrl}/lastschriftlauf`,"_blank"):"xml"===w&&window.open(`${t.apiBaseUrl}/lastschriftlauf/xml`,"_blank"))},disabled:g||!p||0===p.count,style:{whiteSpace:"nowrap"},children:[e.jsx(j,{size:16}),"Jetzt exportieren"]})]})]}),p&&p.preview&&p.preview.length>0&&e.jsxs("div",{className:"preview-card",children:[e.jsxs("h2",{children:["Vorschau (",p.count," Eintr√§ge)"]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"preview-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Mitglied"}),e.jsx("th",{children:"IBAN"}),e.jsx("th",{children:"Betrag"}),e.jsx("th",{children:"Mandatsreferenz"}),e.jsx("th",{children:"Tarif"}),e.jsx("th",{children:"Zyklus"})]})}),e.jsx("tbody",{children:p.preview.map((s,a)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("strong",{children:s.name}),e.jsx("br",{}),e.jsxs("small",{children:["ID: ",s.mitglied_id]})]}),e.jsx("td",{children:e.jsx("code",{children:s.iban})}),e.jsx("td",{children:e.jsx("strong",{style:{color:"#10b981"},children:C(s.betrag)})}),e.jsx("td",{children:"KEIN MANDAT"===s.mandatsreferenz?e.jsx("span",{className:"badge badge-danger",children:s.mandatsreferenz}):e.jsx("span",{className:"badge badge-success",children:s.mandatsreferenz})}),e.jsx("td",{children:s.tarif}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-info",children:s.zahlungszyklus||"monatlich"})})]},a))})]})})]}),e.jsxs("div",{className:"hints-card",children:[e.jsx("h3",{children:"üí° Wichtige Hinweise"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"SEPA-Mandat erforderlich:"})," Es werden nur Mitglieder mit aktivem SEPA-Mandat exportiert."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Vorlaufzeit beachten:"})," SEPA-Lastschriften ben√∂tigen mind. 5 Bankarbeitstage Vorlaufzeit."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Format w√§hlen:"})," CSV f√ºr deutsche Banken, XML f√ºr internationale Standards."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Pr√ºfung durchf√ºhren:"})," Kontrollieren Sie die Vorschau vor dem Export."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Datenschutz:"})," Die exportierte Datei enth√§lt sensible Kontodaten - sicher aufbewahren!"]})]})]})]})},p=({embedded:i=!1})=>{const d=s(),[x,b]=a.useState(!0),[p,v]=a.useState([]),[N,z]=a.useState([]),[w,k]=a.useState(""),[S,y]=a.useState("all"),[E,A]=a.useState({gesamt:0,abgeschlossen:0,offen:0,gesamtbetrag:0});a.useEffect(()=>{L()},[]),a.useEffect(()=>{D()},[w,S,p]);const L=async()=>{try{b(!0);const e=await n(`${t.apiBaseUrl}/zahllaeufe`);if(!e.ok)throw new Error("Fehler beim Laden der Zahll√§ufe");const s=await e.json();v(s.data||[]),C(s.data||[]),b(!1)}catch(e){console.error("Fehler beim Laden der Zahll√§ufe:",e),alert("Fehler beim Laden: "+e.message),b(!1)}},C=e=>{const s={gesamt:e.length,abgeschlossen:e.filter(e=>"abgeschlossen"===e.status).length,offen:e.filter(e=>"offen"===e.status||"geplant"===e.status).length,gesamtbetrag:e.reduce((e,s)=>e+parseFloat(s.betrag||0),0)};A(s)},D=()=>{let e=[...p];if("all"!==S&&(e=e.filter(e=>e.status===S)),w){const s=w.toLowerCase();e=e.filter(e=>{var a,n;return(null==(a=e.buchungsnummer)?void 0:a.toLowerCase().includes(s))||(null==(n=e.zahlungsanbieter)?void 0:n.toLowerCase().includes(s))})}z(e)},M=e=>e?new Date(e).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",B=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e),Z=s=>{switch(s){case"abgeschlossen":return e.jsxs("span",{className:"badge badge-success",children:[e.jsx(u,{size:14})," Abgeschlossen"]});case"offen":return e.jsxs("span",{className:"badge badge-warning",children:[e.jsx(f,{size:14})," Offen"]});case"geplant":return e.jsxs("span",{className:"badge badge-info",children:[e.jsx(o,{size:14})," Geplant"]});case"fehler":return e.jsxs("span",{className:"badge badge-danger",children:[e.jsx(c,{size:14})," Fehler"]});default:return e.jsx("span",{className:"badge badge-neutral",children:s})}};return x?e.jsx("div",{className:"zahllaeufe-container",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Lade Zahll√§ufe..."})]})}):e.jsxs("div",{className:"zahllaeufe-container",children:[!i&&e.jsxs("div",{className:"zahllaeufe-header",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:()=>d("/dashboard/beitraege"),children:[e.jsx(r,{size:20}),"Zur√ºck"]}),e.jsxs("div",{children:[e.jsx("h1",{children:"üìä Zahll√§ufe √úbersicht"}),e.jsx("p",{children:"Alle durchgef√ºhrten SEPA-Lastschriftl√§ufe im √úberblick"})]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>d("/dashboard/lastschriftlauf"),children:[e.jsx(o,{size:20}),"Neuer Zahllauf"]})]}),e.jsxs("div",{className:"info-box",children:[e.jsx(l,{size:24}),e.jsxs("div",{children:[e.jsx("h3",{children:"Zahll√§ufe Verwaltung"}),e.jsx("p",{children:"Hier sehen Sie alle durchgef√ºhrten SEPA-Lastschriftl√§ufe mit Status, Buchungen und Betr√§gen. Jeder Zahllauf enth√§lt die Mandate-Informationen und kann heruntergeladen werden."})]})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(l,{size:16})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Gesamt Zahll√§ufe"}),e.jsx("p",{className:"stat-value",children:E.gesamt}),e.jsx("span",{className:"stat-trend",children:"Alle L√§ufe"})]})]}),e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(u,{size:16})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Abgeschlossen"}),e.jsx("p",{className:"stat-value",children:E.abgeschlossen}),e.jsx("span",{className:"stat-trend",children:"Erfolgreich durchgef√ºhrt"})]})]}),e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(f,{size:16})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Offen / Geplant"}),e.jsx("p",{className:"stat-value",children:E.offen}),e.jsx("span",{className:"stat-trend",children:"Noch nicht abgeschlossen"})]})]}),e.jsxs("div",{className:"stat-card primary",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(h,{size:16})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Gesamtbetrag"}),e.jsx("p",{className:"stat-value",children:B(E.gesamtbetrag)}),e.jsx("span",{className:"stat-trend",children:"Alle Zahll√§ufe"})]})]})]}),e.jsxs("div",{className:"filter-bar",children:[e.jsxs("div",{className:"search-bar",children:[e.jsx(g,{size:20}),e.jsx("input",{type:"text",placeholder:"Suche nach Buchungsnummer oder Anbieter...",value:w,onChange:e=>k(e.target.value)})]}),e.jsxs("select",{value:S,onChange:e=>y(e.target.value),className:"status-filter",children:[e.jsx("option",{value:"all",children:"Alle Status"}),e.jsx("option",{value:"abgeschlossen",children:"Abgeschlossen"}),e.jsx("option",{value:"offen",children:"Offen"}),e.jsx("option",{value:"geplant",children:"Geplant"}),e.jsx("option",{value:"fehler",children:"Fehler"})]})]}),e.jsx("div",{className:"zahllaeufe-table-container",children:0===N.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(c,{size:64}),e.jsx("h3",{children:"Keine Zahll√§ufe gefunden"}),e.jsxs("p",{children:["all"!==S&&`Keine Zahll√§ufe mit Status "${S}" vorhanden.`,w&&`Keine Treffer f√ºr "${w}".`,!S&&!w&&"Es wurden noch keine Zahll√§ufe erstellt."]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>d("/dashboard/lastschriftlauf"),style:{marginTop:"1rem"},children:"Ersten Zahllauf erstellen"})]}):e.jsxs("table",{className:"zahllaeufe-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Erstellt am"}),e.jsx("th",{children:"Forderungen bis einschl."}),e.jsx("th",{children:"Geplanter Einzug"}),e.jsx("th",{children:"Zahlungsanbieter"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Buchungsnummer"}),e.jsx("th",{children:"Buchungen"}),e.jsx("th",{children:"RLS-% (Anzahl)"}),e.jsx("th",{children:"Betrag"}),e.jsx("th",{children:"Aktionen"})]})}),e.jsx("tbody",{children:N.map(s=>{return e.jsxs("tr",{children:[e.jsx("td",{children:(a=s.erstellt_am,a?new Date(a).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-")}),e.jsx("td",{children:M(s.forderungen_bis)}),e.jsx("td",{children:M(s.geplanter_einzug)}),e.jsx("td",{children:s.zahlungsanbieter||"-"}),e.jsx("td",{children:Z(s.status)}),e.jsx("td",{children:e.jsx("code",{children:s.buchungsnummer})}),e.jsx("td",{children:e.jsx("strong",{children:s.anzahl_buchungen||0})}),e.jsx("td",{children:s.ruecklastschrift_prozent?`${s.ruecklastschrift_prozent}%`:"0%"}),e.jsx("td",{children:e.jsx("strong",{children:B(s.betrag)})}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-icon btn-info",onClick:()=>alert("Details anzeigen"),title:"Details anzeigen",children:e.jsx(m,{size:16})}),e.jsx("button",{className:"btn-icon btn-secondary",onClick:()=>alert("CSV herunterladen"),title:"CSV herunterladen",children:e.jsx(j,{size:16})})]})})]},s.zahllauf_id);var a})})]})})]})},v=()=>{const n=s(),[t,i]=a.useState("lastschriftlauf");return e.jsxs("div",{className:"lastschrift-management-container",children:[e.jsxs("div",{className:"management-header",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:()=>n("/dashboard/beitraege"),children:[e.jsx(r,{size:20}),"Zur√ºck zu Beitr√§ge"]}),e.jsxs("div",{className:"sub-tabs-sidebar-style",children:[e.jsxs("button",{className:"tab-vertical-btn "+("lastschriftlauf"===t?"active":""),onClick:()=>i("lastschriftlauf"),children:[e.jsx("span",{className:"tab-icon",children:e.jsx(x,{size:20})}),e.jsx("span",{className:"tab-label",children:"Neuer Lastschriftlauf"})]}),e.jsxs("button",{className:"tab-vertical-btn "+("zahllaeufe"===t?"active":""),onClick:()=>i("zahllaeufe"),children:[e.jsx("span",{className:"tab-icon",children:e.jsx(l,{size:20})}),e.jsx("span",{className:"tab-label",children:"Zahll√§ufe-√úbersicht"})]})]})]}),e.jsxs("div",{className:"tab-content",children:["lastschriftlauf"===t&&e.jsx(b,{embedded:!0}),"zahllaeufe"===t&&e.jsx(p,{embedded:!0})]})]})};export{v as default};
