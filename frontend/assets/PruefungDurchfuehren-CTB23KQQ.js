import{j as e}from"./animation-1wuIdCBS.js";import{r}from"./vendor-router-BhMXg4Z-.js";import{b as n}from"./index-BJCk5MxH.js";/* empty css                  */import{k as t,V as a,C as i,b as s,X as l,A as o,a as d,N as g}from"./icons-C6KFH58b.js";import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";const u=()=>{const{getDojoFilterParam:u,activeDojo:c}=n(),m="/api",[h,p]=r.useState([]),[f,b]=r.useState(!1),[x,y]=r.useState(""),[j,k]=r.useState(""),[_,v]=r.useState("alle"),[z,w]=r.useState(""),[S,F]=r.useState("all"),[D,I]=r.useState(new Set),[N,$]=r.useState([]),[B,A]=r.useState({}),[C,P]=r.useState(null),[W,T]=r.useState({}),[R,E]=r.useState({}),[G,K]=r.useState({});r.useEffect(()=>{L(),O()},[]);const L=async()=>{try{const e=await fetch(`${m}/stile`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),r=await e.json();console.log("ðŸ“š Stile geladen:",r),$(r||[]);const n={};for(const t of r){const e=t.stil_id||t.id,r=await fetch(`${m}/stile/${e}/graduierungen`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),a=await r.json();console.log(`ðŸ¥‹ Graduierungen fÃ¼r ${t.name} (ID: ${e}):`,a),n[e]=a||[]}console.log("âœ… Alle Graduierungen geladen:",n),A(n)}catch(e){console.error("âŒ Fehler beim Laden der Stile:",e)}},O=async()=>{b(!0),y("");try{const e=u(),r=await fetch(`${m}/pruefungen?${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!r.ok)throw new Error("Fehler beim Laden der PrÃ¼fungen");const n=await r.json();console.log("ðŸ“‹ Alle PrÃ¼fungen geladen:",n),p(n.pruefungen||[])}catch(e){y(e.message)}finally{b(!1)}},H=(e,r,n)=>{console.log(`ðŸ”„ Gurt Ã¤ndern: PrÃ¼fung ${e}, Stil ${r}, Richtung: ${n}`),T(t=>{const a=B[r]||[];console.log("ðŸ“‹ VerfÃ¼gbare Graduierungen:",a);const i=t[e];if(!i)return console.log("âŒ Kein Ergebnis gefunden fÃ¼r PrÃ¼fung",e),t;let s=i.neuer_gurt_index;console.log("ðŸ“ Aktueller Index:",s),"up"===n?s=Math.min(s+1,a.length-1):"down"===n&&(s=Math.max(s-1,0)),console.log("ðŸ“ Neuer Index:",s);const l=a[s];return l?(console.log("âœ… Neue Graduierung:",l),{...t,[e]:{...i,neuer_gurt_index:s,neuer_gurt_id:l.id,neuer_gurt_name:l.name,neuer_gurt_farbe:l.farbe_hex}}):(console.log("âŒ Keine Graduierung fÃ¼r Index",s),t)})},M=(e,r,n)=>{T(t=>({...t,[e]:{...t[e],[r]:n}}))},U=async(e,r,n,t)=>{try{if(!(await fetch(`${m}/mitglieder/${e}/graduierung`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({stil_id:r,graduierung_id:n,pruefungsdatum:t})})).ok)throw new Error("Fehler beim Aktualisieren der Graduierung")}catch(a){throw console.error("Fehler beim Aktualisieren der Graduierung:",a),a}},V=async(e,r,n)=>{try{const t=await fetch(`${m}/stile/${r}/graduierungen/${n}/pruefungsinhalte`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)return void console.error("Fehler beim Laden der PrÃ¼fungsinhalte");const a=await t.json();console.log("ðŸ“š PrÃ¼fungsinhalte geladen:",a),E(r=>({...r,[e]:a.pruefungsinhalte||{}})),await Z(e)}catch(t){console.error("Fehler beim Laden der PrÃ¼fungsinhalte:",t)}},Z=async e=>{try{const r=await fetch(`${m}/pruefungen/${e}/bewertungen`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!r.ok)return;const n=await r.json();n.success&&n.bewertungen&&K(r=>({...r,[e]:n.bewertungen}))}catch(r){console.error("Fehler beim Laden der Bewertungen:",r)}},J=(e,r,n,t,a)=>{console.log("ðŸ”§ updateBewertung called:",{pruefungId:e,inhaltId:r,kategorie:n,field:t,value:a}),K(i=>{const s=i[e]||{},l={};Object.keys(s).forEach(e=>{l[e]=[...s[e]]}),l[n]||(l[n]=[]);const o=l[n].findIndex(e=>e.inhalt_id===r);if(o>=0)l[n]=l[n].map((e,r)=>r===o?{...e,[t]:a}:e),console.log("âœï¸ Updated existing:",l[n][o]);else{const e={inhalt_id:r,[t]:a};l[n]=[...l[n],e],console.log("âž• Created new:",e)}const d={...i,[e]:l};return console.log("ðŸ“¦ New bewertungen state:",d),d})},q=r=>"bestanden"===r.status?e.jsx("span",{className:"badge badge-success",children:"âœ“ Bestanden"}):"nicht_bestanden"===r.status?e.jsx("span",{className:"badge badge-danger",children:"âœ— Nicht bestanden"}):e.jsx("span",{className:"badge badge-warning",children:"â³ Offen"});return e.jsxs("div",{className:"content-card",children:[e.jsx("div",{className:"page-header",children:e.jsxs("div",{children:[e.jsx("h1",{children:"PrÃ¼fung durchfÃ¼hren"}),e.jsx("p",{children:"Live-Ansicht fÃ¼r den PrÃ¼fungstag - Ergebnisse direkt eintragen"})]})}),x&&e.jsxs("div",{className:"alert alert-error",style:{marginBottom:"1rem"},children:[e.jsx(t,{size:20}),x]}),j&&e.jsxs("div",{className:"alert alert-success",style:{marginBottom:"1rem"},children:[e.jsx(a,{size:20}),j]}),e.jsx("div",{style:{background:"rgba(255, 255, 255, 0.03)",padding:"1.5rem",borderRadius:"12px",marginBottom:"2rem",border:"1px solid rgba(255, 215, 0, 0.2)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1.5rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("label",{style:{fontWeight:"600",color:"#FFD700",fontSize:"1rem",whiteSpace:"nowrap"},children:"Zeitraum"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>v("alle"),className:"logout-button",style:{background:"alle"===_?"linear-gradient(135deg, #FFD700, #FFA500)":void 0,color:"alle"===_?"#1a1a2e":void 0},children:"Alle"}),e.jsx("button",{onClick:()=>v("zukuenftig"),className:"logout-button",style:{background:"zukuenftig"===_?"linear-gradient(135deg, #FFD700, #FFA500)":void 0,color:"zukuenftig"===_?"#1a1a2e":void 0},children:"ZukÃ¼nftig"}),e.jsx("button",{onClick:()=>v("vergangen"),className:"logout-button",style:{background:"vergangen"===_?"linear-gradient(135deg, #FFD700, #FFA500)":void 0,color:"vergangen"===_?"#1a1a2e":void 0},children:"Vergangen"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{fontSize:"0.9rem",color:"rgba(255, 255, 255, 0.7)",whiteSpace:"nowrap"},children:"Zu Datum springen:"}),e.jsx("input",{type:"date",value:z,onChange:e=>w(e.target.value),style:{padding:"0.5rem",borderRadius:"6px",border:"1px solid rgba(255, 215, 0, 0.3)",background:"rgba(255, 255, 255, 0.05)",color:"white",fontSize:"0.9rem"}}),z&&e.jsx("button",{onClick:()=>w(""),className:"logout-button",style:{padding:"8px 16px",fontSize:"0.85rem"},children:"ZurÃ¼cksetzen"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{fontWeight:"600",color:"#FFD700",fontSize:"1rem",whiteSpace:"nowrap"},children:"Kampfkunst-Stil"}),e.jsxs("select",{value:S,onChange:e=>F(e.target.value),style:{padding:"0.5rem 0.8rem",borderRadius:"8px",border:"1px solid rgba(255, 215, 0, 0.3)",background:"rgba(255, 255, 255, 0.05)",color:"white",fontSize:"0.9rem",cursor:"pointer",minWidth:"180px",height:"38px"},children:[e.jsx("option",{value:"all",style:{background:"#1a1a2e"},children:"Alle Stile"}),N.map(r=>e.jsx("option",{value:r.stil_id,style:{background:"#1a1a2e"},children:r.name},r.stil_id))]})]})]})}),f?e.jsxs("div",{style:{textAlign:"center",padding:"3rem"},children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Lade PrÃ¼fungen..."})]}):0===h.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(i,{size:48}),e.jsx("h3",{children:"Keine PrÃ¼fungen gefunden"}),e.jsx("p",{children:"Es gibt keine geplanten PrÃ¼fungen."})]}):e.jsx("div",{style:{display:"grid",gap:"1rem"},children:(()=>{const r=new Date;r.setHours(0,0,0,0);let n=h.filter(e=>{if("all"!==S&&e.stil_id!==parseInt(S))return!1;if(z){const r=new Date(z);r.setHours(0,0,0,0);const n=new Date(e.pruefungsdatum);return n.setHours(0,0,0,0),n.getTime()===r.getTime()}if(!e.pruefungsdatum)return!0;const n=new Date(e.pruefungsdatum);return n.setHours(0,0,0,0),"zukuenftig"===_?n>=r:"vergangen"!==_||n<r});const t={};n.forEach(e=>{const r=e.pruefungsdatum||"Kein Datum";t[r]||(t[r]=[]),t[r].push(e)});const u=Object.keys(t).sort((e,n)=>{if("Kein Datum"===e)return 1;if("Kein Datum"===n)return-1;const t=new Date(e),a=new Date(n);t.setHours(0,0,0,0),a.setHours(0,0,0,0);const i=t>=r,s=a>=r;return i&&s?t-a:i||s?i?-1:1:a-t}),c=e=>{if("Kein Datum"===e)return e;return new Date(e).toLocaleDateString("de-DE",{weekday:"long",year:"numeric",month:"long",day:"numeric"})};return u.map(n=>{const u=t[n],h=D.has(n),p=(e=>{if("Kein Datum"===e)return!1;const n=new Date(e);return n.setHours(0,0,0,0),n<r})(n),f=(e=>{if("Kein Datum"===e)return!1;const n=new Date(e);return n.setHours(0,0,0,0),n.getTime()===r.getTime()})(n);return e.jsxs("div",{style:{background:f?"rgba(59, 130, 246, 0.1)":p?"rgba(255, 255, 255, 0.03)":"rgba(255, 255, 255, 0.05)",borderRadius:"12px",border:f?"2px solid rgba(59, 130, 246, 0.5)":p?"1px solid rgba(156, 163, 175, 0.2)":"1px solid rgba(255, 215, 0, 0.3)",overflow:"hidden",transition:"all 0.3s ease"},children:[e.jsxs("div",{onClick:()=>(e=>{const r=new Set(D);r.has(e)?r.delete(e):r.add(e),I(r)})(n),style:{padding:"1.25rem 1.5rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",background:f?"linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.05) 100%)":p?"linear-gradient(135deg, rgba(156, 163, 175, 0.15) 0%, rgba(156, 163, 175, 0.05) 100%)":"linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 215, 0, 0.05) 100%)",transition:"all 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.background=f?"linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(59, 130, 246, 0.1) 100%)":p?"linear-gradient(135deg, rgba(156, 163, 175, 0.25) 0%, rgba(156, 163, 175, 0.1) 100%)":"linear-gradient(135deg, rgba(255, 215, 0, 0.3) 0%, rgba(255, 215, 0, 0.1) 100%)"},onMouseLeave:e=>{e.currentTarget.style.background=f?"linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.05) 100%)":p?"linear-gradient(135deg, rgba(156, 163, 175, 0.15) 0%, rgba(156, 163, 175, 0.05) 100%)":"linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 215, 0, 0.05) 100%)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(i,{size:28,style:{color:f?"#3b82f6":p?"#9ca3af":"#FFD700"}}),e.jsxs("div",{children:[e.jsxs("h3",{style:{margin:0,fontSize:"1.2rem",color:f?"#3b82f6":p?"#9ca3af":"#FFD700",fontWeight:"700"},children:[c(n),f&&e.jsx("span",{style:{marginLeft:"0.75rem",fontSize:"0.9rem",fontWeight:"600"},children:"â€¢ HEUTE"}),p&&e.jsx("span",{style:{marginLeft:"0.75rem",fontSize:"0.9rem",fontWeight:"500",opacity:.7},children:"â€¢ vergangen"})]}),e.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.95rem",color:"rgba(255, 255, 255, 0.7)"},children:[u.length," ",1===u.length?"PrÃ¼fling":"PrÃ¼flinge"]})]})]}),e.jsx(s,{size:24,style:{color:f?"#3b82f6":p?"#9ca3af":"#FFD700",transform:h?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s ease"}})]}),h&&e.jsx("div",{style:{padding:"0 1rem 1rem 1rem"},children:u.map((r,n)=>{const t=(null==C?void 0:C.pruefung_id)===r.pruefung_id,i=W[r.pruefung_id]||{bestanden:!1,punktzahl:"",max_punktzahl:100,prueferkommentar:"",neuer_gurt_name:""};return e.jsxs("div",{style:{marginTop:"0.75rem",background:t?"rgba(255, 215, 0, 0.08)":"rgba(255, 255, 255, 0.05)",borderRadius:"8px",border:t?"2px solid rgba(255, 215, 0, 0.5)":"1px solid rgba(255, 215, 0, 0.2)",overflow:"hidden",transition:"all 0.3s ease"},children:[e.jsxs("div",{onClick:()=>(e=>{if((null==C?void 0:C.pruefung_id)===e.pruefung_id)P(null);else{const r=B[e.stil_id]||[];let n,t;if(console.log("ðŸŽ¯ Graduierungen fÃ¼r Stil",e.stil_id,":",r),console.log("ðŸ“‹ PrÃ¼fling:",e),e.graduierung_nachher_id)n=r.findIndex(r=>r.id===e.graduierung_nachher_id),t=r[n],console.log("ðŸ“Œ Verwende gespeicherte Graduierung:",t);else{const a=r.findIndex(r=>r.id===e.graduierung_vorher_id);n=Math.min(a+1,r.length-1),t=r[n],console.log("ðŸ†• Berechne nÃ¤chste Graduierung:",t)}console.log("ðŸ“ Target Index:",n),console.log("ðŸ¥‹ Target Gurt:",t);const a={bestanden:e.bestanden||!1,punktzahl:e.punktzahl||"",max_punktzahl:e.max_punktzahl||100,prueferkommentar:e.prueferkommentar||"",neuer_gurt_index:n,neuer_gurt_id:(null==t?void 0:t.id)||e.graduierung_nachher_id,neuer_gurt_name:(null==t?void 0:t.name)||"",neuer_gurt_farbe:(null==t?void 0:t.farbe_hex)||""};console.log("âœ… Neues Ergebnis:",a),T(r=>({...r,[e.pruefung_id]:a})),P(e),V(e.pruefung_id,e.stil_id,(null==t?void 0:t.id)||e.graduierung_nachher_id)}})(r),style:{padding:"1rem",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{t||(e.currentTarget.style.background="rgba(255, 255, 255, 0.05)")},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flex:1},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"linear-gradient(135deg, #FFD700, #FFA500)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.1rem",fontWeight:"bold",color:"#1a1a2e"},children:n+1}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("h4",{style:{margin:0,fontSize:"1.05rem",color:"#FFD700"},children:[r.vorname," ",r.nachname]}),e.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.9rem",color:"rgba(255, 255, 255, 0.7)"},children:[r.stil_name," â€¢ ",r.graduierung_vorher," â†’ ",r.graduierung_nachher]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[q(r),r.punktzahl&&e.jsxs("div",{style:{padding:"0.4rem 0.8rem",background:"rgba(255, 215, 0, 0.1)",borderRadius:"6px",fontWeight:"600",fontSize:"0.9rem"},children:[r.punktzahl," / ",r.max_punktzahl," Pkt."]})]})]}),e.jsx(s,{size:20,style:{color:"#FFD700",transform:t?"rotate(180deg)":"rotate(0deg)",marginLeft:"0.5rem",transition:"transform 0.3s ease"}})]}),t&&e.jsxs("div",{style:{padding:"1.5rem",borderTop:"1px solid rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.2)"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.75rem",marginBottom:"1.5rem",alignItems:"flex-end",flexWrap:"wrap"},children:[e.jsxs("div",{style:{flex:"0 0 auto"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.4rem",fontWeight:"600",color:"#FFD700",fontSize:"0.75rem"},children:"Ergebnis"}),e.jsxs("div",{style:{display:"flex",gap:"0.4rem"},children:[e.jsxs("button",{type:"button",onClick:()=>M(r.pruefung_id,"bestanden",!0),className:"btn-toggle btn-toggle-success "+(i.bestanden?"active":""),style:{padding:"0.4rem 0.6rem",fontSize:"0.75rem",minWidth:"auto"},children:[e.jsx(a,{size:14}),"Bestanden"]}),e.jsxs("button",{type:"button",onClick:()=>M(r.pruefung_id,"bestanden",!1),className:"btn-toggle btn-toggle-danger "+(i.bestanden?"":"active"),style:{padding:"0.4rem 0.6rem",fontSize:"0.75rem",minWidth:"auto"},children:[e.jsx(l,{size:14}),"Nicht bestanden"]})]})]}),i.bestanden&&e.jsxs("div",{style:{flex:"0 0 auto",minWidth:"180px"},children:[e.jsxs("label",{style:{display:"block",marginBottom:"0.4rem",fontWeight:"600",color:"#FFD700",fontSize:"0.75rem"},children:[e.jsx(o,{size:12,style:{display:"inline",marginRight:"0.3rem"}}),"Neuer Gurt"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.3rem"},children:[e.jsx("button",{type:"button",onClick:()=>H(r.pruefung_id,r.stil_id,"down"),style:{padding:"0.3rem",borderRadius:"4px",border:"1px solid rgba(255, 215, 0, 0.3)",background:"rgba(255, 215, 0, 0.1)",color:"#FFD700",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center"},title:"Gurt herabstufen",children:e.jsx(s,{size:14})}),e.jsx("div",{style:{flex:1,textAlign:"center",padding:"0.3rem 0.5rem",background:i.neuer_gurt_farbe||"rgba(255, 255, 255, 0.1)",borderRadius:"4px",border:"1px solid rgba(255, 215, 0, 0.3)",minWidth:"80px"},children:e.jsx("span",{style:{fontSize:"0.75rem",color:i.neuer_gurt_farbe?"#1a1a2e":"#FFD700",fontWeight:"600"},children:i.neuer_gurt_name||"Kein Gurt"})}),e.jsx("button",{type:"button",onClick:()=>H(r.pruefung_id,r.stil_id,"up"),style:{padding:"0.3rem",borderRadius:"4px",border:"1px solid rgba(255, 215, 0, 0.3)",background:"rgba(255, 215, 0, 0.1)",color:"#FFD700",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center"},title:"Gurt hochstufen",children:e.jsx(d,{size:14})})]})]}),e.jsxs("div",{style:{flex:"0 0 auto",minWidth:"100px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.4rem",fontWeight:"600",color:"#FFD700",fontSize:"0.75rem"},children:"Erreicht"}),e.jsx("input",{type:"number",value:i.punktzahl||"",onChange:e=>M(r.pruefung_id,"punktzahl",e.target.value),placeholder:"85",className:"form-input",style:{fontSize:"0.8rem",padding:"0.4rem",width:"100%",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 215, 0, 0.3)",borderRadius:"6px",color:"white"}})]}),e.jsxs("div",{style:{flex:"0 0 auto",minWidth:"100px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.4rem",fontWeight:"600",color:"#FFD700",fontSize:"0.75rem"},children:"Max."}),e.jsx("input",{type:"number",value:i.max_punktzahl||100,onChange:e=>M(r.pruefung_id,"max_punktzahl",e.target.value),className:"form-input",style:{fontSize:"0.8rem",padding:"0.4rem",width:"100%",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 215, 0, 0.3)",borderRadius:"6px",color:"white"}})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"600",color:"#FFD700",fontSize:"0.95rem"},children:"PrÃ¼ferkommentar / Bemerkungen"}),e.jsx("textarea",{value:i.prueferkommentar||"",onChange:e=>M(r.pruefung_id,"prueferkommentar",e.target.value),rows:"3",placeholder:"Notizen zum PrÃ¼fungsverlauf, StÃ¤rken, SchwÃ¤chen, etc.",style:{width:"100%",fontSize:"0.95rem",padding:"0.7rem",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 215, 0, 0.3)",borderRadius:"6px",color:"white",resize:"vertical"}})]}),R[r.pruefung_id]&&e.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"rgba(255,255,255,0.03)",borderRadius:"8px"},children:[e.jsx("h4",{style:{color:"#ffd700",marginBottom:"1rem",fontSize:"1.1rem"},children:"ðŸ“‹ PrÃ¼fungsinhalte bewerten"}),Object.entries(R[r.pruefung_id]).map(([n,t])=>e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsxs("h5",{style:{color:"#ffd700",fontSize:"0.95rem",marginBottom:"0.75rem",borderBottom:"1px solid rgba(255,215,0,0.2)",paddingBottom:"0.5rem"},children:["grundtechniken"===n&&"ðŸ¥‹ Grundtechniken","kata"===n&&"ðŸŽ­ Kata / Formen","kumite"===n&&"âš”ï¸ Kumite / Sparring","theorie"===n&&"ðŸ“š Theorie"]}),e.jsx("div",{style:{display:"grid",gap:"0.75rem"},children:t.map((t,i)=>{var s,o;const d=t.id||t.inhalt_id,g=(null==(o=null==(s=G[r.pruefung_id])?void 0:s[n])?void 0:o.find(e=>e.inhalt_id===d))||{};return e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",padding:"0.75rem",background:"rgba(0,0,0,0.2)",borderRadius:"6px",fontSize:"0.9rem"},children:[e.jsx("span",{style:{color:"rgba(255,255,255,0.9)",flex:1},children:t.inhalt||t.titel}),e.jsx("div",{style:{minWidth:"140px"},children:e.jsx("button",{type:"button",onClick:()=>J(r.pruefung_id,d,n,"bestanden",!g.bestanden),className:"btn-toggle "+(g.bestanden?"btn-toggle-success active":"btn-toggle-neutral"),style:{padding:"0.4rem 0.8rem",fontSize:"0.8rem",width:"100%"},children:g.bestanden?e.jsxs(e.Fragment,{children:[e.jsx(a,{size:14,style:{marginRight:"0.3rem"}}),"Bestanden"]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{size:14,style:{marginRight:"0.3rem"}}),"Offen"]})})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",minWidth:"120px"},children:[e.jsx("input",{type:"number",placeholder:"0",min:"0",max:t.max_punktzahl||g.max_punktzahl||10,value:g.punktzahl||"",onChange:e=>J(r.pruefung_id,d,n,"punktzahl",parseFloat(e.target.value)||0),style:{width:"70px",padding:"0.4rem",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,215,0,0.3)",borderRadius:"4px",color:"#fff",fontSize:"0.85rem",textAlign:"center"}}),e.jsxs("span",{style:{color:"rgba(255,255,255,0.6)",fontSize:"0.85rem"},children:["/ ",t.max_punktzahl||g.max_punktzahl||10]})]})]},`${n}-${i}-${d}`)})})]},n))]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>P(null),className:"btn btn-secondary",children:"Abbrechen"}),e.jsxs("button",{onClick:()=>(async e=>{const r=W[e.pruefung_id];if(r)try{b(!0);const n={bestanden:r.bestanden,punktzahl:r.punktzahl?parseFloat(r.punktzahl):null,max_punktzahl:r.max_punktzahl?parseFloat(r.max_punktzahl):null,prueferkommentar:r.prueferkommentar,status:r.bestanden?"bestanden":"nicht_bestanden"};if(r.bestanden&&r.neuer_gurt_id&&(n.graduierung_nachher_id=r.neuer_gurt_id),!(await fetch(`${m}/pruefungen/${e.pruefung_id}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify(n)})).ok)throw new Error("Fehler beim Speichern");r.bestanden&&r.neuer_gurt_id&&(console.log("ðŸŽ–ï¸ Aktualisiere Graduierung:",{mitglied_id:e.mitglied_id,stil_id:e.stil_id,graduierung_id:r.neuer_gurt_id,pruefungsdatum:e.pruefungsdatum,pruefling:e}),await U(e.mitglied_id,e.stil_id,r.neuer_gurt_id,e.pruefungsdatum));const t=G[e.pruefung_id];if(t){const r=[];Object.values(t).forEach(e=>{Array.isArray(e)&&e.forEach(e=>{r.push({inhalt_id:e.inhalt_id,bestanden:e.bestanden,punktzahl:e.punktzahl,max_punktzahl:e.max_punktzahl||10,kommentar:e.kommentar})})}),r.length>0&&await fetch(`${m}/pruefungen/${e.pruefung_id}/bewertungen`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({bewertungen:r})})}k("PrÃ¼fungsergebnis erfolgreich gespeichert!"),P(null),O(),setTimeout(()=>k(""),3e3)}catch(n){y(n.message),setTimeout(()=>y(""),3e3)}finally{b(!1)}})(r),className:"btn btn-icon btn-success",children:[e.jsx(g,{size:18}),"Speichern"]})]})]})]},n)})})]},n)})})()})]})};export{u as default};
