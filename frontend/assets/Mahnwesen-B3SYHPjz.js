import{j as e}from"./animation-1wuIdCBS.js";import{u as n,r as s}from"./vendor-router-BhMXg4Z-.js";import{k as a,g as t}from"./index-BJCk5MxH.js";import{O as i,c as r,aw as l,ax as d,k as h,D as c,q as o,F as m,g as u,M as g,Y as j,ay as x,w as b}from"./icons-C6KFH58b.js";import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";const f=()=>{var f,p,w,N,v,M;const y=n(),[k,z]=s.useState(!0),[F,_]=s.useState([]),[E,S]=s.useState([]),[B,C]=s.useState({}),[$,D]=s.useState("offene"),[O,U]=s.useState(!1),[L,T]=s.useState(null);s.useEffect(()=>{P()},[]);const P=async()=>{try{z(!0);const[e,n,s]=await Promise.all([a(`${t.apiBaseUrl}/mahnwesen/offene-beitraege`),a(`${t.apiBaseUrl}/mahnwesen/mahnungen`),a(`${t.apiBaseUrl}/mahnwesen/statistiken`)]);if(!e.ok||!n.ok||!s.ok)throw new Error("Fehler beim Laden der Mahnwesen-Daten");const i=await e.json(),r=await n.json(),l=await s.json();_(i.data||[]),S(r.data||[]),C(l.data||{}),z(!1)}catch(e){console.error("Fehler beim Laden der Mahnwesen-Daten:",e),z(!1)}},K=async(e=!0)=>{const n=e?"Mahnlauf simulieren? Es werden keine echten Mahnungen erstellt.":"Automatischen Mahnlauf durchfuehren? Es werden echte Mahnungen erstellt!";if(window.confirm(n))try{U(!0),T(null);const n=await a(`${t.apiBaseUrl}/mahnwesen/mahnlauf`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nurSimulation:e})});if(!n.ok)throw new Error("Mahnlauf fehlgeschlagen");const s=await n.json();T(s),e||P()}catch(s){console.error("Fehler beim Mahnlauf:",s),alert("Fehler beim Mahnlauf: "+s.message)}finally{U(!1)}},A=e=>0===e?"info":1===e?"warning":"danger",R=e=>0===e?"Keine Mahnung":1===e?"1. Mahnung":2===e?"2. Mahnung":"3. Mahnung";return k?e.jsx("div",{className:"mahnwesen-container",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Lade Mahnwesen-Daten..."})]})}):e.jsxs("div",{className:"mahnwesen-container",children:[e.jsxs("div",{className:"mahnwesen-header",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:()=>y("/dashboard/beitraege"),children:[e.jsx(i,{size:20}),"ZurÃ¼ck"]}),e.jsxs("div",{children:[e.jsx("h1",{children:"âš ï¸ Mahnwesen"}),e.jsx("p",{children:"Verwalte offene BeitrÃ¤ge und Mahnungen"})]}),e.jsxs("div",{className:"header-actions",style:{marginLeft:"auto",display:"flex",gap:"0.5rem"},children:[e.jsxs("button",{className:"btn btn-secondary",onClick:()=>y("/dashboard/einstellungen/mahnstufen"),title:"Mahnstufen konfigurieren",children:[e.jsx(r,{size:18}),"Einstellungen"]}),e.jsxs("button",{className:"btn btn-warning",onClick:()=>K(!0),disabled:O,title:"Simuliert den Mahnlauf ohne echte Mahnungen zu erstellen",children:[e.jsx(l,{size:18}),O?"LÃ¤uft...":"Mahnlauf simulieren"]}),e.jsxs("button",{className:"btn btn-danger",onClick:()=>K(!1),disabled:O,title:"Erstellt echte Mahnungen basierend auf den Mahnstufen-Einstellungen",children:[e.jsx(d,{size:18}),"Mahnlauf starten"]})]})]}),L&&e.jsxs("div",{className:"mahnlauf-ergebnis",style:{background:L.simulation?"rgba(251, 191, 36, 0.1)":"rgba(34, 197, 94, 0.1)",border:"1px solid "+(L.simulation?"#f59e0b":"#22c55e"),borderRadius:"12px",padding:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[e.jsx("h3",{style:{margin:0,color:L.simulation?"#f59e0b":"#22c55e"},children:L.simulation?"ðŸ” Simulation":"âœ… Mahnlauf durchgefÃ¼hrt"}),e.jsx("button",{className:"btn btn-sm btn-secondary",onClick:()=>T(null),style:{padding:"0.25rem 0.5rem"},children:"Ã—"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1rem",fontSize:"0.9rem"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"GeprÃ¼ft:"})," ",(null==(f=L.zusammenfassung)?void 0:f.geprueft)||0]}),e.jsxs("div",{style:{color:"#22c55e"},children:[e.jsx("strong",{children:"Neue Mahnungen:"})," ",(null==(p=L.zusammenfassung)?void 0:p.neueMahnungen)||0]}),e.jsxs("div",{style:{color:"#6b7280"},children:[e.jsx("strong",{children:"Ãœbersprungen:"})," ",(null==(w=L.zusammenfassung)?void 0:w.uebersprungen)||0]}),e.jsxs("div",{style:{color:"#ef4444"},children:[e.jsx("strong",{children:"Fehler:"})," ",(null==(N=L.zusammenfassung)?void 0:N.fehler)||0]})]}),(null==(M=null==(v=L.ergebnisse)?void 0:v.neueMahnungen)?void 0:M.length)>0&&e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("strong",{children:"Neue Mahnungen:"}),e.jsxs("ul",{style:{margin:"0.5rem 0",paddingLeft:"1.5rem"},children:[L.ergebnisse.neueMahnungen.slice(0,5).map((n,s)=>e.jsxs("li",{children:[n.mitglied," - ",n.mahnstufe,". Mahnung (â‚¬",parseFloat(n.betrag).toFixed(2),")"]},s)),L.ergebnisse.neueMahnungen.length>5&&e.jsxs("li",{children:["... und ",L.ergebnisse.neueMahnungen.length-5," weitere"]})]})]})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card warning",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(h,{size:24})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Offene BeitrÃ¤ge"}),e.jsx("p",{className:"stat-value",children:B.offene_beitraege||0}),e.jsx("span",{className:"stat-trend",children:"Nicht bezahlt"})]})]}),e.jsxs("div",{className:"stat-card danger",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(c,{size:24})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Offene Summe"}),e.jsxs("p",{className:"stat-value",children:["â‚¬",parseFloat(B.offene_summe||0).toFixed(2)]}),e.jsx("span",{className:"stat-trend",children:"Gesamt"})]})]}),e.jsxs("div",{className:"stat-card info",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(o,{size:24})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"ÃœberfÃ¤llig 30+ Tage"}),e.jsx("p",{className:"stat-value",children:B.ueberfaellig_30_tage||0}),e.jsx("span",{className:"stat-trend",children:"Kritisch"})]})]}),e.jsxs("div",{className:"stat-card success",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(m,{size:24})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Mahnungen gesamt"}),e.jsx("p",{className:"stat-value",children:B.anzahl_mahnungen||0}),e.jsxs("span",{className:"stat-trend",children:[B.mahnstufe_1||0," / ",B.mahnstufe_2||0," / ",B.mahnstufe_3||0]})]})]})]}),e.jsxs("div",{className:"view-toggle",children:[e.jsxs("button",{className:"btn-toggle "+("offene"===$?"active":""),onClick:()=>D("offene"),children:[e.jsx(h,{size:18}),"Offene BeitrÃ¤ge (",F.length,")"]}),e.jsxs("button",{className:"btn-toggle "+("mahnungen"===$?"active":""),onClick:()=>D("mahnungen"),children:[e.jsx(m,{size:18}),"Mahnungen (",E.length,")"]})]}),"offene"===$&&e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-header",children:e.jsx("h2",{children:"Offene BeitrÃ¤ge"})}),0===F.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(u,{size:48}),e.jsx("p",{children:"Keine offenen BeitrÃ¤ge vorhanden"})]}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Mitglied"}),e.jsx("th",{children:"Betrag"}),e.jsx("th",{children:"FÃ¤llig seit"}),e.jsx("th",{children:"ÃœberfÃ¤llig"}),e.jsx("th",{children:"Mahnstufe"}),e.jsx("th",{children:"Kontakt"}),e.jsx("th",{children:"Aktionen"})]})}),e.jsx("tbody",{children:F.map(n=>e.jsxs("tr",{children:[e.jsx("td",{children:n.mitglied_name}),e.jsxs("td",{className:"amount",children:["â‚¬",parseFloat(n.betrag).toFixed(2)]}),e.jsx("td",{children:new Date(n.zahlungsdatum).toLocaleDateString("de-DE")}),e.jsxs("td",{className:n.tage_ueberfaellig>30?"critical":"warning",children:[n.tage_ueberfaellig," Tage"]}),e.jsx("td",{children:e.jsx("span",{className:`badge badge-${A(n.mahnstufe)}`,children:R(n.mahnstufe)})}),e.jsxs("td",{className:"contact-info",children:[n.email&&e.jsxs("div",{children:[e.jsx(g,{size:14})," ",n.email]}),n.telefon&&e.jsxs("div",{children:[e.jsx(j,{size:14})," ",n.telefon]})]}),e.jsxs("td",{className:"actions",children:[e.jsxs("button",{className:"btn btn-sm btn-warning",onClick:()=>(async(e,n)=>{if(window.confirm(`Mahnung der Stufe ${n} erstellen?`))try{if(!(await a(`${t.apiBaseUrl}/mahnwesen/mahnungen`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({beitrag_id:e,mahnstufe:n,mahngebuehr:1===n?5:2===n?10:15,versand_art:"email"})})).ok)throw new Error("Fehler beim Erstellen der Mahnung");alert("Mahnung erfolgreich erstellt"),P()}catch(s){console.error("Fehler beim Erstellen der Mahnung:",s),alert("Fehler beim Erstellen der Mahnung")}})(n.beitrag_id,n.mahnstufe+1),disabled:n.mahnstufe>=3,children:[e.jsx(x,{size:14}),"Mahnung"]}),e.jsxs("button",{className:"btn btn-sm btn-success",onClick:()=>(async e=>{if(window.confirm("Beitrag als bezahlt markieren?"))try{if(!(await a(`${t.apiBaseUrl}/mahnwesen/beitraege/${e}/bezahlt`,{method:"PUT"})).ok)throw new Error("Fehler beim Markieren als bezahlt");alert("Beitrag als bezahlt markiert"),P()}catch(n){console.error("Fehler beim Markieren als bezahlt:",n),alert("Fehler beim Markieren als bezahlt")}})(n.beitrag_id),children:[e.jsx(u,{size:14}),"Bezahlt"]})]})]},n.beitrag_id))})]})})]}),"mahnungen"===$&&e.jsxs("div",{className:"section",children:[e.jsx("div",{className:"section-header",children:e.jsx("h2",{children:"Versendete Mahnungen"})}),0===E.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(m,{size:48}),e.jsx("p",{children:"Keine Mahnungen vorhanden"})]}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Mitglied"}),e.jsx("th",{children:"Beitrag"}),e.jsx("th",{children:"Mahnstufe"}),e.jsx("th",{children:"Mahndatum"}),e.jsx("th",{children:"MahngebÃ¼hr"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Aktionen"})]})}),e.jsx("tbody",{children:E.map(n=>e.jsxs("tr",{children:[e.jsx("td",{children:n.mitglied_name}),e.jsxs("td",{className:"amount",children:["â‚¬",parseFloat(n.beitrag_betrag).toFixed(2)]}),e.jsx("td",{children:e.jsx("span",{className:`badge badge-${A(n.mahnstufe)}`,children:R(n.mahnstufe)})}),e.jsx("td",{children:new Date(n.mahndatum).toLocaleDateString("de-DE")}),e.jsxs("td",{className:"amount",children:["â‚¬",parseFloat(n.mahngebuehr).toFixed(2)]}),e.jsx("td",{children:n.versandt?e.jsx("span",{className:"badge badge-success",children:"Versendet"}):e.jsx("span",{className:"badge badge-warning",children:"Ausstehend"})}),e.jsxs("td",{className:"actions",children:[e.jsx("button",{className:"btn btn-sm btn-secondary",onClick:()=>(async(e,n)=>{try{const s=await a(`${t.apiBaseUrl}/mahnwesen/mahnungen/${e}/pdf`);if(!s.ok)throw new Error("PDF konnte nicht generiert werden");const i=await s.blob(),r=window.URL.createObjectURL(i),l=document.createElement("a");l.href=r,l.download=`Mahnung_${n.replace(/\s+/g,"_")}.pdf`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(r),document.body.removeChild(l)}catch(s){console.error("Fehler beim PDF-Download:",s),alert("Fehler beim PDF-Download: "+s.message)}})(n.mahnung_id,n.mitglied_name),title:"PDF herunterladen",children:e.jsx(b,{size:14})}),!n.versandt&&e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>(async(e,n)=>{if(n){if(window.confirm(`Mahnung per E-Mail an ${n} senden?`))try{const n=await a(`${t.apiBaseUrl}/mahnwesen/mahnungen/${e}/senden`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mitPdf:!0})});if(!n.ok){const e=await n.json();throw new Error(e.error||"E-Mail konnte nicht gesendet werden")}alert("Mahnung erfolgreich versendet!"),P()}catch(s){console.error("Fehler beim Versenden:",s),alert("Fehler beim Versenden: "+s.message)}}else alert("Mitglied hat keine E-Mail-Adresse hinterlegt")})(n.mahnung_id,n.email),title:n.email?`E-Mail an ${n.email}`:"Keine E-Mail hinterlegt",disabled:!n.email,children:e.jsx(x,{size:14})})]})]},n.mahnung_id))})]})})]})]})};export{f as default};
