import{j as e}from"./animation-1wuIdCBS.js";import{u as s,r as a}from"./vendor-router-BhMXg4Z-.js";import{k as t,g as r}from"./index-BJCk5MxH.js";import{P as i,x as n,J as l,K as d}from"./icons-C6KFH58b.js";import"./vendor-react-DtuzQOD1.js";import"./query-Bs1dTGah.js";const c=()=>{const c=s(),[o,h]=a.useState([]),[j,m]=a.useState(!1),[u,x]=a.useState(""),[g,v]=a.useState(null);a.useEffect(()=>{N(),p()},[]);const N=async()=>{m(!0);try{const e=await t(`${r.apiBaseUrl}/admin/dojos?filter=managed`);if(!e.ok)throw new Error("Fehler beim Laden der Dojos");const s=await e.json();h(s.dojos||s)}catch(e){x("Fehler beim Laden der Dojos"),console.error(e)}finally{m(!1)}},p=async()=>{try{const e=await t(`${r.apiBaseUrl}/admin/dojos?filter=managed`);if(!e.ok)throw new Error("Fehler beim Laden der Dojos");const s=await e.json(),a=s.dojos||s,i={dojos_anzahl:a.length,mitglieder_gesamt:a.reduce((e,s)=>e+(s.mitglieder_anzahl||0),0),umsatz_gesamt:a.reduce((e,s)=>e+(s.jahresumsatz_aktuell||0),0),ust_gesamt:a.reduce((e,s)=>{const a=s.jahresumsatz_aktuell||0;return e+("regelbesteuert"===s.steuer_status?.19*a:0)},0)};v(i)}catch(e){console.error("Fehler beim Laden der Statistiken:",e)}},b=s=>{if("kleinunternehmer"===s.steuer_status){const a=s.jahresumsatz_aktuell/s.kleinunternehmer_grenze*100;return a>=100?e.jsx("span",{className:"badge badge-danger",children:"Grenze Ã¼berschritten"}):a>=80?e.jsxs("span",{className:"badge badge-warning",children:[a.toFixed(0),"% erreicht"]}):e.jsx("span",{className:"badge badge-success",children:"Kleinunternehmer"})}return e.jsxs("span",{className:"badge badge-info",children:["USt-pflichtig (",s.ust_satz,"%)"]})};return e.jsxs("div",{className:"dojos-verwaltung",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Multi-Dojo-Verwaltung"}),e.jsx("p",{children:"Verwalten Sie mehrere GeschÃ¤fte mit separater Steuerverwaltung"}),e.jsxs("button",{className:"btn-primary",onClick:()=>c("/dashboard/dojos/new"),children:[e.jsx(i,{size:20}),"Neues Dojo hinzufÃ¼gen"]})]}),u&&e.jsx("div",{className:"message "+(u.includes("erfolgreich")?"success":"error"),children:u}),g&&e.jsxs("div",{className:"gesamt-statistiken",children:[e.jsx("h2",{children:"Gesamt-Ãœbersicht (alle Dojos)"}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"ðŸ¢"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:g.dojos_anzahl}),e.jsx("div",{className:"stat-label",children:"Aktive Dojos"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"ðŸ‘¥"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:g.mitglieder_gesamt}),e.jsx("div",{className:"stat-label",children:"Mitglieder gesamt"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"ðŸ’°"}),e.jsxs("div",{className:"stat-content",children:[e.jsxs("div",{className:"stat-value",children:[parseFloat(g.umsatz_gesamt||0).toLocaleString("de-DE")," EUR"]}),e.jsxs("div",{className:"stat-label",children:["Gesamtumsatz ",(new Date).getFullYear()]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"ðŸ§¾"}),e.jsxs("div",{className:"stat-content",children:[e.jsxs("div",{className:"stat-value",children:[parseFloat(g.ust_gesamt||0).toLocaleString("de-DE")," EUR"]}),e.jsx("div",{className:"stat-label",children:"USt zu zahlen"})]})]})]})]}),e.jsxs("div",{className:"dojos-list",children:[e.jsx("h2",{children:"Ihre Dojos"}),j?e.jsx("div",{className:"loading",children:"Laden..."}):0===o.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(n,{size:64}),e.jsx("p",{children:"Noch keine Dojos vorhanden"})]}):e.jsx("div",{className:"dojos-grid",children:o.map(s=>e.jsxs("div",{className:"dojo-card",style:{borderLeftColor:s.farbe},children:[e.jsxs("div",{className:"dojo-header",children:[e.jsx("div",{className:"dojo-icon",style:{backgroundColor:s.farbe},children:"ðŸ¢"}),e.jsxs("div",{className:"dojo-info",children:[e.jsx("h3",{children:s.dojoname}),e.jsx("p",{className:"dojo-inhaber",children:s.inhaber}),s.ist_hauptdojo&&e.jsx("span",{className:"badge badge-primary",children:"Haupt-Dojo"}),b(s)]})]}),e.jsxs("div",{className:"dojo-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"ðŸ“"}),e.jsxs("span",{children:[s.strasse," ",s.hausnummer,", ",s.plz," ",s.ort]})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"ðŸ“§"}),e.jsx("span",{children:s.email})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"ðŸ’°"}),e.jsxs("span",{children:["Umsatz ",(new Date).getFullYear(),": ",parseFloat(s.jahresumsatz_aktuell||0).toLocaleString("de-DE")," EUR"]})]}),"kleinunternehmer"===s.steuer_status&&e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"ðŸ“Š"}),e.jsxs("span",{children:["Grenze: ",parseFloat(s.kleinunternehmer_grenze||0).toLocaleString("de-DE")," EUR (",(s.jahresumsatz_aktuell/s.kleinunternehmer_grenze*100).toFixed(1),"%)"]})]})]}),e.jsxs("div",{className:"dojo-actions",children:[e.jsxs("button",{className:"btn-action btn-edit",onClick:()=>c(`/dashboard/dojos/edit/${s.id}`),children:[e.jsx(l,{size:18}),"Bearbeiten"]}),!s.ist_hauptdojo&&e.jsxs("button",{className:"btn-action btn-delete",onClick:()=>(async e=>{if(window.confirm("MÃ¶chten Sie dieses Dojo wirklich deaktivieren?"))try{const s=await t(`${r.apiBaseUrl}/admin/dojos/${e}`,{method:"DELETE"});if(!s.ok){const e=await s.json();throw new Error(e.error)}x("Dojo erfolgreich deaktiviert"),N()}catch(s){x(`Fehler: ${s.message}`)}})(s.id),children:[e.jsx(d,{size:18}),"Deaktivieren"]})]})]},s.id))})]})]})};export{c as default};
