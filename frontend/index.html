<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />
    <meta name="theme-color" content="#0f0f23" />
    <meta name="description" content="Dojosoftware Mitgliederbereich - Check-in, Trainingsplan, Statistiken" />

    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Dojo Member" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <title>Dojosoftware</title>

    <!-- CRITICAL: Kill Service Workers BEFORE loading React -->
    <script>
      (function() {
        'use strict';

        const SW_KILLED_KEY = 'sw_cleanup_done';
        const hasCleanedUp = sessionStorage.getItem(SW_KILLED_KEY);

        if (!hasCleanedUp && 'serviceWorker' in navigator) {
          console.log('[CLEANUP] Starting Service Worker cleanup...');

          navigator.serviceWorker.getRegistrations().then(function(registrations) {
            if (registrations.length > 0) {
              console.warn('[CLEANUP] Found', registrations.length, 'Service Workers - removing...');

              Promise.all(registrations.map(function(reg) {
                return reg.unregister();
              })).then(function() {
                console.log('[CLEANUP] All Service Workers removed');
                sessionStorage.setItem(SW_KILLED_KEY, 'true');

                // Force reload to start fresh
                window.location.reload();
              });
            } else {
              console.log('[CLEANUP] No Service Workers found');
              sessionStorage.setItem(SW_KILLED_KEY, 'true');
            }
          }).catch(function(err) {
            console.error('[CLEANUP] Error during cleanup:', err);
            sessionStorage.setItem(SW_KILLED_KEY, 'true');
          });
        } else {
          console.log('[CLEANUP] Already cleaned up or no SW support');
        }
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
